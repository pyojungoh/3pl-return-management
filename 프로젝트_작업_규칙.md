# 프로젝트 작업 규칙 및 주의사항

## ⛔ 하지 말아야 할 것들

1. **PowerShell 명령어 실행 금지**
   - 사용자는 CMD에서 직접 실행함
   - 터미널 명령어를 실행하지 말고, 사용자가 복사해서 실행할 수 있도록 명령어만 제공

2. **불필요한 .md 파일 생성 금지**
   - 설명 문서나 가이드 파일을 만들지 말 것
   - 사용자가 명시적으로 요청한 경우만 생성

3. **명령어를 하나의 코드 블록에 묶지 말 것**
   - 각 명령어를 개별 코드 블록으로 제공
   - 복사하기 편하도록 하나씩 따로 제공

4. **Railway 관련 작업 금지**
   - 이 프로젝트는 GitHub + Vercel을 사용
   - Railway 관련 파일이나 설정 제안하지 말 것

## ✅ 수정 시 주의사항

### 1. 파일 삭제 시 확인
- 실제 사용 중인 파일인지 반드시 확인
- `__init__.py` 파일들이 올바른 모듈을 import하는지 확인
- `app.py`에서 사용하는 파일인지 확인

### 2. 데이터베이스 호환성
- **로컬**: SQLite 사용 (`data.db`)
- **배포 (Vercel)**: PostgreSQL/Neon 사용
- 두 환경 모두 지원하도록 코드 작성

### 3. Import 에러 방지
- SQLite 모드: `from sqlite3 import OperationalError, IntegrityError`
- PostgreSQL 모드: `from psycopg2 import IntegrityError, OperationalError`
- `api/database/models.py`에서 두 가지 모두 import 필요

### 4. __init__.py 파일 확인
- `api/auth/__init__.py`: `from .routes_db import auth_bp` (routes.py 아님)
- `api/returns/__init__.py`: `from .routes_db import returns_bp` (routes.py 아님)
- 파일 삭제 후 반드시 확인 필요

### 5. 메인 파일
- **HTML**: `dashboard_server.html` (메인 파일)
- `dashboard.html`, `dashboard_simple.html` 등은 삭제됨
- `app.py`는 `dashboard_server.html`만 사용

## 📋 프로젝트 구조

### 주요 파일
- `app.py`: Flask 메인 서버
- `dashboard_server.html`: 메인 대시보드 (로그인 + 관리 화면)
- `api/database/models.py`: 데이터베이스 모델 (SQLite/PostgreSQL 호환)
- `api/auth/routes_db.py`: 인증 API (로그인, 회원가입)
- `api/returns/routes_db.py`: 반품 데이터 API
- `api/admin/routes.py`: 관리자 API (CSV 마이그레이션 등)
- `api/uploads/routes.py`: 이미지 업로드 API

### 데이터베이스
- 로컬: SQLite (`data.db`)
- 배포: PostgreSQL/Neon (환경변수 `DATABASE_URL`)

### 배포
- GitHub에 푸시
- Vercel 자동 배포
- 환경변수: `DATABASE_URL` (PostgreSQL 연결 문자열)
- 도메인: `jjaysolution.com` (Vercel에서 구매 및 연결 완료)

## 🔧 일반적인 작업 흐름

### 코드 수정 후 배포
1. 수정 완료
2. 사용자에게 명령어 제공 (각각 개별 코드 블록)
   ```bash
   git add .
   ```
   ```bash
   git commit -m "수정 내용"
   ```
   ```bash
   git push origin main
   ```
3. Vercel 자동 배포 대기

### 파일 삭제 시 체크리스트
- [ ] `app.py`에서 import하는지 확인
- [ ] `__init__.py`에서 import하는지 확인
- [ ] 다른 파일에서 사용하는지 확인 (grep으로 검색)
- [ ] 삭제 후 관련 import 경로 수정

### 데이터베이스 관련 수정 시
- [ ] SQLite와 PostgreSQL 모두 테스트
- [ ] `OperationalError`, `IntegrityError` import 확인
- [ ] 환경변수 `DATABASE_URL` 확인

## 🚨 자주 발생하는 오류

### 1. ModuleNotFoundError
- `__init__.py`에서 삭제된 파일을 import하는 경우
- 해결: `routes_db.py`로 변경

### 2. NameError: name 'OperationalError' is not defined
- SQLite 모드에서 `OperationalError` import 누락
- 해결: `from sqlite3 import OperationalError, IntegrityError` 추가

### 3. 화주사 등록 오류
- None 값에 `.strip()` 호출
- 해결: None 체크 후 처리

### 4. 화주사 데이터 필터링 문제
- 관리자는 모든 데이터, 화주사는 자신의 데이터만
- 해결: `company` 파라미터로 필터링

## 📝 기타 주의사항

1. **언어**: 항상 한국어로 응답
2. **명령어 제공**: CMD에서 실행 가능한 형태로 제공
3. **파일 삭제**: 신중하게 확인 후 삭제
4. **에러 처리**: 상세한 로그 추가하여 디버깅 용이하게
5. **코드 수정**: 기존 기능을 깨뜨리지 않도록 주의

## 🔄 작업 시 확인 사항

1. 로컬에서 테스트 가능한지
2. 배포 후에도 작동하는지
3. SQLite와 PostgreSQL 모두 지원하는지
4. 기존 기능이 깨지지 않았는지
5. 에러 처리가 적절한지

## 📌 중요 기능 규칙

### F5 새로고침 시 현재 메뉴/탭 유지
- **관리자 모드**: `localStorage.setItem('activeAdminTab', tabName)` - 현재 활성 탭 저장
- **화주사 모드**: `localStorage.setItem('activeConsignorMenu', menuName)` - 현재 활성 메뉴 저장
- **복원 로직**: 페이지 로드 시 `localStorage.getItem()`으로 저장된 값 복원
- **기본값**: 저장된 값이 없으면 관리자는 'returns', 화주사는 'returns' 메뉴로 이동
- **주의사항**: 어떤 메뉴가 추가되어도 반드시 이 규칙을 따라야 함
  - 메뉴/탭 전환 시 localStorage에 저장
  - 페이지 로드 시 저장된 값으로 복원
  - 새로고침(F5) 후에도 현재 메뉴/탭이 유지되어야 함


