<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì œì´ì œì´ 3PL í™”ì£¼ì‚¬ ê´€ë¦¬ í”„ë¡œê·¸ë¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* Google Apps Script ë°°ë„ˆ ìˆ¨ê¸°ê¸° ì‹œë„ */
    body > div[style*="background"] {
      display: none !important;
    }
    
    /* iframe ë‚´ë¶€ì˜ ë°°ë„ˆ ìˆ¨ê¸°ê¸° */
    #docs-banner, 
    .docs-gm,
    [role="banner"],
    div[style*="border-bottom"] {
      display: none !important;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f5f7fa;
      padding: 20px;
      padding-top: 5px; /* ìƒë‹¨ ì—¬ë°± ìµœì†Œí™” */
      font-size: 14px;
      /* ë°°ê²½ ì´ë¯¸ì§€ - êµ¬ê¸€ ë“œë¼ì´ë¸Œ URLë¡œ êµì²´ ê°€ëŠ¥ */
      /* background-image: url('YOUR_GOOGLE_DRIVE_BACKGROUND_URL'); */
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      min-height: 100vh;
    }
    
    /* ë°°ê²½ ì˜¤ë²„ë ˆì´ (ì´ë¯¸ì§€ ì‚¬ìš© ì‹œ í…ìŠ¤íŠ¸ ê°€ë…ì„± í–¥ìƒ) */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(245, 247, 250, 0.85);
      z-index: -1;
      /* ë°°ê²½ ì´ë¯¸ì§€ ì‚¬ìš© ì‹œ ì˜¤ë²„ë ˆì´ ìƒ‰ìƒ ì¡°ì • */
      /* background: rgba(102, 126, 234, 0.1); */
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ë¡œê·¸ì¸ ì„¹ì…˜ */
    .login-section {
      max-width: 450px;
      margin: 60px auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 40px 35px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
      text-align: center;
      position: relative;
      overflow: hidden;
      /* ë°°ê²½ ì´ë¯¸ì§€ - JavaScriptë¡œ ë™ì  ë¡œë“œ */
      background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-size: cover;
      background-position: center;
      background-blend-mode: overlay;
    }
    
    .login-section .logo {
      width: 140px;
      height: 140px;
      margin: 0 auto 18px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 4px solid rgba(255, 255, 255, 0.5);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
      position: relative;
      z-index: 1;
      overflow: hidden;
    }
    
    .login-section .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }
    
    .login-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 4s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .login-section h1 {
      font-size: 32px;
      color: white;
      margin-bottom: 8px;
      font-weight: 800;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 1;
    }
    
    .login-section .version-badge {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      margin: 8px 0 15px 0;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 1;
    }
    
    .login-section .subtitle {
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
      margin-bottom: 25px;
      position: relative;
      z-index: 1;
    }
    
    .login-section .creator-info {
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.95);
      font-size: 13px;
      position: relative;
      z-index: 1;
      line-height: 1.6;
    }
    
    .login-section .creator-info strong {
      color: white;
      font-weight: 700;
    }
    
    .login-form {
      background: white;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      position: relative;
      z-index: 1;
    }
    
    .login-form .input-group {
      margin-bottom: 16px;
      text-align: left;
    }
    
    .login-form .input-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }
    
    .login-form input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e8e8e8;
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
      box-sizing: border-box;
      background: #fafafa;
    }
    
    .login-form input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }
    
    .login-form input::placeholder {
      color: #bbb;
    }
    
    .login-form button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .login-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
    }
    
    .login-form button:active {
      transform: translateY(0);
    }
    
    .login-form button:disabled {
      background: #bdbdbd;
      transform: none;
      cursor: not-allowed;
      box-shadow: none;
    }
    
    #loginMessage {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }
    
    #loginMessage.success {
      background: rgba(76, 175, 80, 0.2);
      color: white;
      border: 1px solid rgba(76, 175, 80, 0.5);
    }
    
    #loginMessage.error {
      background: rgba(244, 67, 54, 0.2);
      color: white;
      border: 1px solid rgba(244, 67, 54, 0.5);
    }
    
    /* ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ */
    .dashboard-section {
      display: none;
    }
    
    .header {
      background: white;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .header h1 {
      font-size: 24px;
      color: #333;
      font-weight: 800;
    }
    
    .company-info {
      font-size: 16px;
      color: #666;
      font-weight: 600;
    }
    
    .logout-btn {
      padding: 10px 20px;
      background: #f44336;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: #d32f2f;
    }
    
    .filters {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filters label {
      font-weight: 600;
      color: #333;
    }
    
    .filters select {
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filters select:focus {
      outline: none;
      border-color: #667eea;
      background: white;
    }
    
    .refresh-btn {
      padding: 10px 20px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .refresh-btn:hover {
      background: #1976D2;
    }
    
    .stats {
      background: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
      cursor: pointer;
      padding: 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    
    .stat-item:hover {
      background: #f0f0f0;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .stat-item.active {
      background: #667eea;
    }
    
    .stat-item.active .stat-number {
      color: white;
    }
    
    .stat-item.active .stat-label {
      color: white;
    }
    
    .stat-number {
      font-size: 28px;
      font-weight: 800;
      color: #667eea;
    }
    
    .stat-label {
      font-size: 13px;
      color: #666;
      margin-top: 5px;
    }
    
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    thead {
      background: #667eea;
      color: white;
    }
    
    th {
      padding: 15px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
      white-space: nowrap;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 13px;
      vertical-align: middle;
    }
    
    tr:hover {
      background: #f8f9fa;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .status-completed {
      background: #d4edda;
      color: #155724;
    }
    
    .status-pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .request-input {
      width: 100%;
      padding: 8px 10px;
      border: 1.5px solid #e0e0e0;
      border-radius: 6px;
      font-size: 13px;
      resize: vertical;
      min-height: 60px;
      font-family: inherit;
    }
    
    .save-btn {
      padding: 6px 10px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      margin-top: 5px;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-width: fit-content;
    }
    
    .save-btn:hover {
      background: #45a049;
    }
    
    .photo-links {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .photo-link {
      color: #2196F3;
      text-decoration: none;
      font-size: 12px;
      font-weight: 600;
    }
    
    .message {
      padding: 15px 20px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 600;
      text-align: center;
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .no-data {
      text-align: center;
      padding: 60px 20px;
      color: #999;
      font-size: 16px;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .custom-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 13px;
      max-width: 400px;
      word-wrap: break-word;
      z-index: 10000;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: none;
    }
    
    .custom-tooltip::before {
      content: 'ğŸ“ ë¹„ê³ ';
      display: block;
      font-weight: 700;
      margin-bottom: 6px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      font-size: 12px;
      color: #ffd700;
    }
    
    .tooltip-empty {
      color: #999;
      font-style: italic;
    }
    
    tbody tr {
      cursor: pointer;
      position: relative;
    }
    
    /* ìƒˆ ë°˜í’ˆ ê±´ ì…ë ¥ í¼ */
    .add-return-section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }
    
    .add-return-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin: -20px -20px 15px -20px;
      background: #f8f9fa;
      border-radius: 12px 12px 0 0;
      transition: all 0.3s ease;
    }
    
    .add-return-header:hover {
      background: #e9ecef;
    }
    
    .add-return-header h3 {
      font-size: 18px;
      color: #333;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #toggleIcon {
      font-size: 16px;
      transition: transform 0.3s ease;
      display: inline-block;
    }
    
    #toggleIcon.open {
      transform: rotate(90deg);
    }
    
    .add-return-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .form-col label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 13px;
      color: #333;
    }
    
    .form-col input,
    .form-col select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .form-col input:focus,
    .form-col select:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }
    
    /* ë¹„ê³  ë²„íŠ¼ */
    .memo-btn {
      padding: 5px 8px;
      background: #9C27B0;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-width: fit-content;
      display: inline-block;
    }
    
    .memo-btn:hover {
      background: #7B1FA2;
    }
    
    .memo-btn.has-memo {
      background: #FF9800;
    }
    
    /* ë¹„ê³  ëª¨ë‹¬ íŒì—… */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      backdrop-filter: blur(3px);
    }
    
    .modal-overlay.show {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 25px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease;
    }
    
    @keyframes modalSlideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .modal-header h3 {
      font-size: 20px;
      color: #333;
      font-weight: 700;
      margin: 0;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: #999;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .modal-close:hover {
      color: #333;
      background: #f0f0f0;
      border-radius: 50%;
    }
    
    .modal-body {
      margin-bottom: 20px;
    }
    
    .modal-textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      transition: all 0.3s ease;
    }
    
    .modal-textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .modal-footer {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .modal-btn-cancel {
      background: #e0e0e0;
      color: #666;
    }
    
    .modal-btn-cancel:hover {
      background: #d0d0d0;
    }
    
    .modal-btn-save {
      background: #4CAF50;
      color: white;
    }
    
    .modal-btn-save:hover {
      background: #45a049;
    }
    
    /* QR ì½”ë“œ ëª¨ë‹¬ */
    .qr-modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    
    .qr-modal-content h3 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #333;
    }
    
    .qr-code-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    
    .qr-code-container img {
      display: block;
      max-width: 100%;
    }
    
    .qr-info {
      background: #f5f7fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .qr-info-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .qr-info-row:last-child {
      border-bottom: none;
    }
    
    .qr-info-label {
      font-weight: 600;
      color: #666;
    }
    
    .qr-info-value {
      color: #333;
      font-weight: 600;
    }
    
    .qr-code-text {
      font-size: 18px;
      font-weight: 800;
      color: #667eea;
      margin-top: 10px;
      letter-spacing: 2px;
    }
    
    .qr-btn {
      padding: 5px 10px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 600;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .qr-btn:hover {
      background: #5568d3;
    }

    .product-name {
      color: #3b82f6;
      cursor: pointer;
      font-weight: 600;
      display: inline-block;
    }

    .product-name:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- íˆ´íŒ ìš”ì†Œ -->
  <div id="customTooltip" class="custom-tooltip"></div>
  
  <!-- ë¹„ê³  ëª¨ë‹¬ íŒì—… -->
  <div id="memoModal" class="modal-overlay" onclick="closeModalIfClickedOutside(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“ ë¹„ê³  ì…ë ¥</h3>
        <button class="modal-close" onclick="closeMemoModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <textarea id="memoTextarea" class="modal-textarea" placeholder="ë¹„ê³  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="modal-btn modal-btn-cancel" onclick="closeMemoModal()">ì·¨ì†Œ</button>
        <button class="modal-btn modal-btn-save" onclick="saveMemo()">ì €ì¥</button>
      </div>
    </div>
  </div>
  
  <!-- QR ì½”ë“œ ëª¨ë‹¬ íŒì—… -->
  <div id="qrModal" class="modal-overlay" onclick="closeQRModal()">
    <div class="qr-modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ“± QR ì½”ë“œ</h3>
        <button class="modal-close" onclick="closeQRModal()">Ã—</button>
      </div>
      <div class="qr-info" id="qrInfo"></div>
      <div class="qr-code-container">
        <img id="qrCodeImage" src="" alt="QR Code">
      </div>
      <div class="qr-code-text" id="qrCodeText"></div>
      <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 13px; color: #856404;">
        <strong>ì‚¬ìš© ë°©ë²•:</strong><br>
        1. ëª¨ë°”ì¼ í˜ì´ì§€ë¡œ ì´ë™<br>
        2. "ğŸ“· QR ì½”ë“œ ìŠ¤ìº”" ë²„íŠ¼ í´ë¦­<br>
        3. ì´ QR ì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë¹„ì¶”ê¸°<br>
        4. ì†¡ì¥ë²ˆí˜¸ê°€ ìë™ ì…ë ¥ë¨<br>
        5. "ğŸ” ê²€ìƒ‰" ë²„íŠ¼ í´ë¦­
      </div>
      <div class="modal-footer" style="justify-content: center; flex-direction: column; gap: 10px;">
        <a id="mobileLink" href="#" target="_blank" style="display: inline-block; width: 100%; text-decoration: none;">
          <button class="modal-btn modal-btn-save" style="width: 100%;">ğŸ“± ëª¨ë°”ì¼ í˜ì´ì§€ë¡œ ì´ë™</button>
        </a>
        <button class="modal-btn modal-btn-cancel" onclick="closeQRModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
  
  <div class="container">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="loginSection" class="login-section">
      <!-- ë¡œê³  ì˜ì—­ -->
      <div class="logo">
        <img src="" alt="ë¡œê³ " style="display: none;">
      </div>
      <h1>ì œì´ì œì´ 3PL í™”ì£¼ì‚¬ ê´€ë¦¬ í”„ë¡œê·¸ë¨</h1>
      <div class="version-badge">Version 1.0.0</div>
      <div class="subtitle">ë¡œê·¸ì¸í•˜ì—¬ ë°˜í’ˆ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</div>
      <div class="login-form">
        <div class="input-group">
          <label for="username">ì•„ì´ë””</label>
          <input type="text" id="username" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="username" required>
        </div>
        <div class="input-group">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="current-password" required>
        </div>
        <button id="loginBtn" type="button" onclick="doLogin(); return false;">ë¡œê·¸ì¸</button>
      </div>
      <div id="loginMessage"></div>
      <div class="creator-info">
        <strong>Developed by</strong> í‘œì´ì‚¬ Pyoisa Co., Ltd.<br>
        <span style="font-size: 11px; opacity: 0.9;">Â© 2025 All Rights Reserved</span>
      </div>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboardSection" class="dashboard-section">
      <!-- í—¤ë” -->
      <div class="header">
        <div>
          <h1>ğŸ“¦ ë°˜í’ˆ ë‚´ì—­ ì¡°íšŒ</h1>
          <div class="company-info" id="companyInfo"></div>
        </div>
        <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      
      <!-- í•„í„° -->
      <div class="filters">
        <label for="monthSelect">ğŸ“… ì¡°íšŒ ì›”:</label>
        <select id="monthSelect">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        </select>
        <button class="refresh-btn" onclick="loadData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      </div>
      
      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-item active" id="statAll" onclick="filterData('all')">
          <div class="stat-number" id="totalCount">0</div>
          <div class="stat-label">ì „ì²´ ë°˜í’ˆ ê±´</div>
        </div>
        <div class="stat-item" id="statCompleted" onclick="filterData('completed')">
          <div class="stat-number" id="completedCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ì™„ë£Œ</div>
        </div>
        <div class="stat-item" id="statPending" onclick="filterData('pending')">
          <div class="stat-number" id="pendingCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
        </div>
      </div>
      
      <!-- ê´€ë¦¬ì ì „ìš©: ìƒˆ ë°˜í’ˆ ê±´ ì…ë ¥ í¼ -->
      <div id="addReturnSection" class="add-return-section admin-only" style="display: none;">
        <div class="add-return-header" onclick="toggleAddForm()" style="cursor: pointer; user-select: none;">
          <h3>
            <span id="toggleIcon">â–¶</span> ìƒˆ ë°˜í’ˆ ê±´ ë“±ë¡
          </h3>
          <span style="font-size: 13px; color: #999;">(í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°/ì ‘ê¸°)</span>
        </div>
        <div id="addReturnForm" class="add-return-form" style="display: none;">
          <div class="form-row">
            <div class="form-col">
              <label>ë°˜í’ˆ ì ‘ìˆ˜ì¼ (ìë™ì…ë ¥)</label>
              <input type="text" id="newReturnDate" placeholder="ì˜ˆ: 7">
            </div>
            <div class="form-col">
              <label>í™”ì£¼ëª…</label>
              <input type="text" id="newCompany" placeholder="ì˜ˆ: TKS">
            </div>
            <div class="form-col">
              <label>ì œí’ˆ</label>
              <input type="text" id="newProduct" placeholder="ì œí’ˆëª…">
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label>ê³ ê°ëª…</label>
              <input type="text" id="newCustomer" placeholder="ê³ ê°ëª…">
            </div>
            <div class="form-col">
              <label>ì†¡ì¥ë²ˆí˜¸</label>
              <input type="text" id="newTracking" placeholder="ìˆ«ìë§Œ ì…ë ¥">
            </div>
            <div class="form-col">
              <label>ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡</label>
              <select id="newReturnType">
                <option value="ë°˜í’ˆ">ë°˜í’ˆ</option>
                <option value="êµí™˜">êµí™˜</option>
                <option value="ì˜¤ë°°ì†¡">ì˜¤ë°°ì†¡</option>
                <option value="ëˆ„ë½">ëˆ„ë½</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-col">
              <label>ì¬ê³ ìƒíƒœ</label>
              <select id="newStockStatus">
                <option value="ì •ìƒ">ì •ìƒ</option>
                <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
              </select>
            </div>
            <div class="form-col">
              <label>ë¹„ê³ </label>
              <input type="text" id="newMemo" placeholder="ë¹„ê³ ">
            </div>
          </div>
          <button class="refresh-btn" onclick="submitNewReturn()" style="width: auto; padding: 12px 30px; background: #4CAF50;">
            âœ… ë°˜í’ˆ ê±´ ë“±ë¡
          </button>
        </div>
      </div>
      
      <!-- í…Œì´ë¸” -->
      <div class="table-container">
        <table id="returnTable">
          <thead id="tableHeader">
            <tr>
              <th>ì ‘ìˆ˜ì¼</th>
              <th class="admin-only" style="display: none;">í™”ì£¼ì‚¬</th>
              <th>ì œí’ˆ</th>
              <th>ê³ ê°ëª…</th>
              <th>ì†¡ì¥ë²ˆí˜¸</th>
              <th>ë°˜í’ˆ/êµí™˜</th>
              <th>ì¬ê³ ìƒíƒœ</th>
              <th>ì²˜ë¦¬ì™„ë£Œ</th>
              <th>ì‚¬ì§„</th>
              <th class="admin-only" style="display: none;">ë¹„ê³ </th>
              <th>í™”ì£¼ì‚¬ ìš”ì²­ì‚¬í•­</th>
              <th class="admin-only" style="display: none;">QR</th>
              <th class="admin-only" style="display: none;">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="13" class="no-data">ë¡œê·¸ì¸ í›„ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div id="message"></div>
    </div>
  </div>
  
  <script>
    // ì „ì—­ ë³€ìˆ˜
    let currentCompany = '';
    let currentUsername = '';
    let currentRole = ''; // ê¶Œí•œ ì •ë³´ ì¶”ê°€
    let currentData = [];
    let currentFilter = 'all'; // 'all', 'completed', 'pending'
    let currentMemoRowIndex = null; // í˜„ì¬ ë¹„ê³  ìˆ˜ì • ì¤‘ì¸ í–‰
    let currentMemoSheetName = ''; // í˜„ì¬ ë¹„ê³  ìˆ˜ì • ì¤‘ì¸ ì‹œíŠ¸
    let sessionCheckInterval = null; // ì„¸ì…˜ ì²´í¬ íƒ€ì´ë¨¸
    
    // ë¡œê·¸ì¸ í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ëª…ì‹œì  í• ë‹¹)
    window.doLogin = function doLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');
      
      if (!username || !password) {
        showLoginMessage('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return false;
      }
      
      if (typeof google === 'undefined' || !google.script || !google.script.run) {
        showLoginMessage('âŒ ì„œë²„ ì—°ê²°ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return false;
      }
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span class="spinner" style="display: inline-block; margin-right: 8px;"></span>ë¡œê·¸ì¸ ì¤‘...';
      showLoginMessage('ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...', '');
      
      google.script.run
        .withSuccessHandler(function(result) {
          loginBtn.disabled = false;
          loginBtn.innerHTML = 'ë¡œê·¸ì¸';
          
          if (result && result.success) {
            currentCompany = result.company;
            currentUsername = result.username;
            currentRole = result.role || '';
            
            localStorage.setItem('client_company', result.company);
            localStorage.setItem('client_username', result.username);
            localStorage.setItem('client_role', result.role);
            localStorage.setItem('client_loginTime', new Date().toISOString());
            
            showLoginMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
            setTimeout(function(){
              showDashboard();
              startSessionCheck();
            }, 500);
          } else {
            const msg = result ? (result.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨') : 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
            showLoginMessage('âŒ ' + msg, 'error');
          }
        })
        .withFailureHandler(function(error) {
          loginBtn.disabled = false;
          loginBtn.innerHTML = 'ë¡œê·¸ì¸';
          const errorMsg = error && error.message ? error.message : (typeof error === 'string' ? error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          showLoginMessage('âŒ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜: ' + errorMsg, 'error');
        })
        .loginClient(username, password);
      
      return false;
    }
    
    // login í•¨ìˆ˜ (ê¸°ì¡´ í˜¸í™˜ì„±)
    window.login = function login() {
      return doLogin();
    }
    
    function escapeHtml(text) {
      if (text === undefined || text === null) {
        return '';
      }
      return text
        .toString()
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì´ë¯¸ì§€ ë¡œë“œ í•¨ìˆ˜
    function loadGoogleDriveImage(imgElement, fileId) {
      const urls = [
        `https://drive.google.com/uc?export=view&id=${fileId}`,
        `https://lh3.googleusercontent.com/d/${fileId}=w1000`,
        `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`,
        `https://drive.google.com/file/d/${fileId}/preview`
      ];
      
      let currentIndex = 0;
      
      function tryNextUrl() {
        if (currentIndex >= urls.length) {
          console.error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', fileId);
          // ëª¨ë“  URL ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì´ëª¨ì§€ í‘œì‹œ
          const logoDiv = imgElement.parentElement;
          if (logoDiv && !logoDiv.querySelector('span')) {
            logoDiv.innerHTML = '<span style="font-size: 48px; color: white;">ğŸ¢</span>';
          }
          return;
        }
        
        const testImg = new Image();
        testImg.crossOrigin = 'anonymous';
        testImg.onload = function() {
          imgElement.src = urls[currentIndex];
          imgElement.style.display = 'block';
          imgElement.onerror = null; // ì„±ê³µ ì‹œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì œê±°
          console.log('âœ… ë¡œê³  ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ:', urls[currentIndex]);
        };
        testImg.onerror = function() {
          console.warn('âš ï¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', urls[currentIndex]);
          currentIndex++;
          tryNextUrl();
        };
        testImg.src = urls[currentIndex];
      }
      
      tryNextUrl();
    }
    
    // google.script ê°ì²´ ì¤€ë¹„ í™•ì¸
    function waitForGoogleScript(callback) {
      if (typeof google !== 'undefined' && google.script && google.script.run) {
        callback();
      } else {
        setTimeout(function() {
          waitForGoogleScript(callback);
        }, 100);
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    window.addEventListener('DOMContentLoaded', function() {
      // google.script ê°ì²´ ì¤€ë¹„ ëŒ€ê¸°
      waitForGoogleScript(function() {
        console.log('google.script ê°ì²´ ì¤€ë¹„ ì™„ë£Œ');
      });
      
      // ë¡œê³  ì´ë¯¸ì§€ ë¡œë“œ
      const logoImg = document.querySelector('.logo img');
      if (logoImg) {
        loadGoogleDriveImage(logoImg, '1p2Ma445a1e5XC_cXPUbrU7-fATc9ReL0');
      }
      
      // ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ
      const loginSection = document.querySelector('.login-section');
      if (loginSection) {
        const bgFileId = '1DZcJIlKgYDVYAPflsRq2eIJ96RHBXTmL';
        const bgUrls = [
          `https://drive.google.com/uc?export=view&id=${bgFileId}`,
          `https://lh3.googleusercontent.com/d/${bgFileId}=w1920`,
          `https://drive.google.com/thumbnail?id=${bgFileId}&sz=w1920`
        ];
        
        const bgImg = new Image();
        bgImg.crossOrigin = 'anonymous';
        let bgIndex = 0;
        
        function tryBgUrl() {
          if (bgIndex >= bgUrls.length) {
            console.error('ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', bgFileId);
            // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ê·¸ë¼ë°ì´ì…˜ ìœ ì§€
            return;
          }
          
          bgImg.onload = function() {
            loginSection.style.backgroundImage = `url(${bgUrls[bgIndex]}), linear-gradient(135deg, #667eea 0%, #764ba2 100%)`;
            console.log('âœ… ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ:', bgUrls[bgIndex]);
          };
          bgImg.onerror = function() {
            console.warn('âš ï¸ ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', bgUrls[bgIndex]);
            bgIndex++;
            tryBgUrl();
          };
          bgImg.src = bgUrls[bgIndex];
        }
        
        tryBgUrl();
      }
      
      // Google Apps Script ë°°ë„ˆ ìˆ¨ê¸°ê¸° ì‹œë„
      try {
        setTimeout(function() {
          const banners = document.querySelectorAll('div[style*="background"], div[style*="border-bottom"], [role="banner"]');
          banners.forEach(banner => {
            if (banner.textContent.includes('Google Apps Script') || 
                banner.textContent.includes('ì• í”Œë¦¬ì¼€ì´ì…˜')) {
              banner.style.display = 'none';
            }
          });
        }, 100);
      } catch (e) {
        console.log('ë°°ë„ˆ ìˆ¨ê¸°ê¸° ì‹¤íŒ¨:', e);
      }
      
      // ì—”í„°í‚¤ ì²˜ë¦¬
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      
      if (usernameInput) {
        usernameInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            if (passwordInput) {
              passwordInput.focus();
            }
          }
        });
      }
      
      if (passwordInput) {
        passwordInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            if (typeof doLogin === 'function') {
              doLogin();
            }
          }
        });
      }
      
      const savedCompany = localStorage.getItem('client_company');
      const savedUsername = localStorage.getItem('client_username');
      const savedRole = localStorage.getItem('client_role');
      const loginTime = localStorage.getItem('client_loginTime');
      
      if (savedCompany && savedUsername && loginTime) {
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        if (hoursDiff < 1) {
          // ìë™ ë¡œê·¸ì¸ (1ì‹œê°„ ì´ë‚´)
          currentCompany = savedCompany;
          currentUsername = savedUsername;
          currentRole = savedRole || '';
          showDashboard();
          // ì„¸ì…˜ ë§Œë£Œ ì²´í¬ ì‹œì‘
          startSessionCheck();
        } else {
          // 1ì‹œê°„ ì§€ë‚¬ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ
          localStorage.removeItem('client_company');
          localStorage.removeItem('client_username');
          localStorage.removeItem('client_role');
          localStorage.removeItem('client_loginTime');
        }
      }
    });
    
    
    // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
    function showDashboard() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'block';
      
      // ê´€ë¦¬ì í‘œì‹œ
      const isAdmin = (currentRole === 'ê´€ë¦¬ì');
      const roleText = isAdmin ? ' [ê´€ë¦¬ì]' : '';
      document.getElementById('companyInfo').textContent = `${currentCompany}${roleText} (${currentUsername})`;
      
      // ê´€ë¦¬ìì¼ ë•Œë§Œ í™”ì£¼ì‚¬ëª… ì—´ í‘œì‹œ
      const adminColumns = document.querySelectorAll('.admin-only');
      adminColumns.forEach(col => {
        col.style.display = isAdmin ? 'table-cell' : 'none';
      });
      
      // ê´€ë¦¬ìì¼ ë•Œë§Œ ë°˜í’ˆ ê±´ ì…ë ¥ í¼ í‘œì‹œ
      const addReturnSection = document.getElementById('addReturnSection');
      if (isAdmin) {
        addReturnSection.style.display = 'block';
      } else {
        addReturnSection.style.display = 'none';
      }
      
      // ì›” ëª©ë¡ ë¡œë“œ
      loadAvailableSheets();
    }
    
    // ë°˜í’ˆ ì…ë ¥ í¼ í† ê¸€
    function toggleAddForm() {
      const form = document.getElementById('addReturnForm');
      const icon = document.getElementById('toggleIcon');
      
      if (form.style.display === 'none') {
        form.style.display = 'flex';
        icon.textContent = 'â–¼';
        icon.classList.add('open');
        
        // í¼ì„ í¼ì¹  ë•Œ ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì…ë ¥
        const today = new Date();
        const day = today.getDate(); // 1~31
        document.getElementById('newReturnDate').value = day;
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¶';
        icon.classList.remove('open');
      }
    }
    
    // ì„¸ì…˜ ë§Œë£Œ ì²´í¬ (1ì‹œê°„)
    function startSessionCheck() {
      // ê¸°ì¡´ íƒ€ì´ë¨¸ ì •ë¦¬
      if (sessionCheckInterval) {
        clearInterval(sessionCheckInterval);
      }
      
      // 1ë¶„ë§ˆë‹¤ ì„¸ì…˜ ì²´í¬
      sessionCheckInterval = setInterval(function() {
        const loginTime = localStorage.getItem('client_loginTime');
        if (!loginTime) {
          // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìœ¼ë©´ íƒ€ì´ë¨¸ ì •ë¦¬
          clearInterval(sessionCheckInterval);
          return;
        }
        
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        if (hoursDiff >= 1) {
          // 1ì‹œê°„ ì§€ë‚¬ìœ¼ë©´ ìë™ ë¡œê·¸ì•„ì›ƒ
          clearInterval(sessionCheckInterval);
          showMessage('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'error');
          setTimeout(function() {
            logout();
          }, 2000);
        }
      }, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬
    }
    
    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      // ì„¸ì…˜ ì²´í¬ íƒ€ì´ë¨¸ ì •ë¦¬
      if (sessionCheckInterval) {
        clearInterval(sessionCheckInterval);
        sessionCheckInterval = null;
      }
      
      localStorage.removeItem('client_company');
      localStorage.removeItem('client_username');
      localStorage.removeItem('client_role');
      localStorage.removeItem('client_loginTime');
      
      currentCompany = '';
      currentUsername = '';
      currentRole = '';
      
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'block';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginMessage').innerHTML = '';
    }
    
    // ì›” ëª©ë¡ ë¡œë“œ
    function loadAvailableSheets() {
      google.script.run
        .withSuccessHandler(function(sheets) {
          const monthSelect = document.getElementById('monthSelect');
          monthSelect.innerHTML = '';
          
          if (!sheets || sheets.length === 0) {
            monthSelect.innerHTML = '<option value="">ì‚¬ìš© ê°€ëŠ¥í•œ ì›”ì´ ì—†ìŠµë‹ˆë‹¤</option>';
            return;
          }
          
          sheets.forEach(sheetName => {
            const option = document.createElement('option');
            option.value = sheetName;
            option.textContent = sheetName;
            monthSelect.appendChild(option);
          });
          
          // í˜„ì¬ ì›” ì„ íƒ
          const today = new Date();
          const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
          const found = sheets.find(s => s === currentMonth);
          
          monthSelect.value = found || sheets[0];
          
          // ë°ì´í„° ë¡œë“œ
          loadData();
        })
        .withFailureHandler(function(error) {
          showMessage('ì›” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + error, 'error');
        })
        .getAvailableSheets();
    }
    
    // ë°ì´í„° ë¡œë“œ
    function loadData() {
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!selectedMonth || !currentCompany) {
        return;
      }
      
      const isAdmin = (currentRole === 'ê´€ë¦¬ì');
      const colspan = isAdmin ? 13 : 9; // ê´€ë¦¬ìëŠ” í™”ì£¼ì‚¬+ë¹„ê³ +QR+ê´€ë¦¬ 4ê°œ ì¶”ê°€
      document.getElementById('tableBody').innerHTML = 
        `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>`;
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            currentData = result.data || [];
            currentFilter = 'all'; // ë°ì´í„° ë¡œë“œ ì‹œ ì „ì²´ë¡œ ë¦¬ì…‹
            updateStatButtons('all');
            renderTable(getFilteredData());
            updateStats(currentData);
            showMessage(`âœ… ${result.count}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
          } else {
            showMessage('âŒ ' + (result.message || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'), 'error');
            const isAdmin = (currentRole === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
          }
        })
        .withFailureHandler(function(error) {
          showMessage('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error, 'error');
          const isAdmin = (currentRole === 'ê´€ë¦¬ì');
          const colspan = isAdmin ? 13 : 9;
          document.getElementById('tableBody').innerHTML = 
            `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</td></tr>`;
        })
        .getReturnsByCompany(currentCompany, selectedMonth, currentRole);
    }
    
    // íˆ´íŒ í‘œì‹œ í•¨ìˆ˜ (position: fixedì´ë¯€ë¡œ clientX/Y ì‚¬ìš©)
    function showTooltip(e, memoText) {
      const tooltip = document.getElementById('customTooltip');
      
      if (memoText && memoText.trim()) {
        tooltip.innerHTML = memoText;
      } else {
        tooltip.innerHTML = '<span class="tooltip-empty">ë¹„ê³  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</span>';
      }
      
      tooltip.style.display = 'block';
      
      // íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      updateTooltipPosition(e);
    }
    
    function hideTooltip() {
      const tooltip = document.getElementById('customTooltip');
      tooltip.style.display = 'none';
    }
    
    function moveTooltip(e) {
      const tooltip = document.getElementById('customTooltip');
      if (tooltip.style.display === 'block') {
        updateTooltipPosition(e);
      }
    }
    
    function updateTooltipPosition(e) {
      const tooltip = document.getElementById('customTooltip');
      const offsetX = 15;
      const offsetY = 15;
      
      // position: fixedì´ë¯€ë¡œ clientX/Y ì‚¬ìš© (ë·°í¬íŠ¸ ê¸°ì¤€)
      let left = e.clientX + offsetX;
      let top = e.clientY + offsetY;
      
      // íˆ´íŒ í¬ê¸° (ì•„ì§ ë Œë”ë§ ì•ˆ ëì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì²´í¬)
      const tooltipWidth = tooltip.offsetWidth || 300;
      const tooltipHeight = tooltip.offsetHeight || 100;
      
      // ì˜¤ë¥¸ìª½ ê²½ê³„ ì²´í¬
      if (left + tooltipWidth > window.innerWidth) {
        left = e.clientX - tooltipWidth - offsetX;
      }
      
      // ì™¼ìª½ ê²½ê³„ ì²´í¬
      if (left < 0) {
        left = offsetX;
      }
      
      // ì•„ë˜ìª½ ê²½ê³„ ì²´í¬
      if (top + tooltipHeight > window.innerHeight) {
        top = e.clientY - tooltipHeight - offsetY;
      }
      
      // ìœ„ìª½ ê²½ê³„ ì²´í¬
      if (top < 0) {
        top = offsetY;
      }
      
      tooltip.style.left = left + 'px';
      tooltip.style.top = top + 'px';
    }
    
    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      if (!data || data.length === 0) {
        const isAdmin = (currentRole === 'ê´€ë¦¬ì');
        const colspan = isAdmin ? 13 : 9; // ê´€ë¦¬ìëŠ” í™”ì£¼ì‚¬+ë¹„ê³ +QR+ê´€ë¦¬ 4ê°œ ì¶”ê°€
        tbody.innerHTML = `<tr><td colspan="${colspan}" class="no-data">ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }
      
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        const completed = row['ì²˜ë¦¬ì™„ë£Œ'] ? row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim() : ''; // Iì—´
        const requestStatus = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] ? row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'].toString().trim() : ''; // Oì—´
        const memoText = row['ë¹„ê³ '] || ''; // Jì—´
        
        let photoHtml = '-';
        if (row['ì‚¬ì§„'] && Array.isArray(row['ì‚¬ì§„']) && row['ì‚¬ì§„'].length > 0) {
          photoHtml = '<div class="photo-links">';
          row['ì‚¬ì§„'].forEach(photo => {
            if (photo.url) {
              photoHtml += `<a href="${photo.url}" target="_blank" class="photo-link">${photo.text || 'ì‚¬ì§„'}</a>`;
            }
          });
          photoHtml += '</div>';
        }
        
        // ìš”ì²­ì‚¬í•­ ì²˜ë¦¬ ë¡œì§
        const requestValue = row['í™”ì£¼ì‚¬ìš”ì²­'] || '';
        let requestHtml = '';
        
        const isAdminMode = (currentRole === 'ê´€ë¦¬ì');
        
        // ê´€ë¦¬ì ëª¨ë“œ: ì½ê¸°ë§Œ ê°€ëŠ¥ (ì €ì¥ ë²„íŠ¼ ì—†ìŒ)
        if (isAdminMode) {
          if (requestValue) {
            requestHtml = `
              <textarea class="request-input" id="request_${index}" readonly>${requestValue}</textarea>
              ${requestStatus === 'ìš”ì²­ì™„ë£Œ' ? 
                '<div style="margin-top:5px; font-size:12px; color:#0c5460; font-weight:600;">âœ“ í™”ì£¼ì‚¬ ìš”ì²­ì™„ë£Œ</div>' : ''}
            `;
          } else {
            requestHtml = `<div style="color: #999; font-size: 13px; text-align: center; padding: 20px;">ìš”ì²­ì‚¬í•­ ì—†ìŒ</div>`;
          }
        }
        // í™”ì£¼ì‚¬ ëª¨ë“œ: ì…ë ¥ ë° ì €ì¥ ê°€ëŠ¥
        else {
          // ì¼€ì´ìŠ¤ 1: ìš”ì²­ì™„ë£Œ + ë‹´ë‹¹ì ì´ë¦„ ì…ë ¥ë¨ â†’ ì²˜ë¦¬ì™„ë£Œ í‘œì‹œ
          if (requestStatus === 'ìš”ì²­ì™„ë£Œ' && completed) {
            requestHtml = `
              <textarea class="request-input" id="request_${index}" readonly>${requestValue}</textarea>
              <div style="margin-top:5px; font-size:13px; color:#155724; font-weight:700; background: #d4edda; padding: 6px 10px; border-radius: 6px;">
                âœ“ ì²˜ë¦¬ì™„ë£Œ (${completed})
              </div>
            `;
          }
          // ì¼€ì´ìŠ¤ 2: ìš”ì²­ì™„ë£Œ + ë‹´ë‹¹ì ì´ë¦„ ì—†ìŒ â†’ ìš”ì²­ì™„ë£Œ í‘œì‹œ
          else if (requestStatus === 'ìš”ì²­ì™„ë£Œ' && !completed) {
            requestHtml = `
              <textarea class="request-input" id="request_${index}" readonly>${requestValue}</textarea>
              <div style="margin-top:5px; font-size:13px; color:#0c5460; font-weight:700; background: #d1ecf1; padding: 6px 10px; border-radius: 6px;">
                â³ ìš”ì²­ì™„ë£Œ (ì²˜ë¦¬ ëŒ€ê¸°ì¤‘)
              </div>
            `;
          }
          // ì¼€ì´ìŠ¤ 3: ìš”ì²­ ì•ˆ í•¨ â†’ ì…ë ¥ë€ + ì €ì¥ ë²„íŠ¼
          else {
            requestHtml = `
              <textarea class="request-input" id="request_${index}" 
                placeholder="ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”">${requestValue}</textarea>
              <button class="save-btn" onclick="saveRequest(${index}, ${row.rowIndex})">ì €ì¥</button>
            `;
          }
        }
        
        // ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ í‘œì‹œ
        let statusHtml = '';
        // isAdminModeëŠ” ìœ„ì—ì„œ ì´ë¯¸ ì„ ì–¸ë¨ (1152ë²ˆì§¸ ì¤„)
        
        if (completed) {
          // ë‹´ë‹¹ì ì´ë¦„ì´ ìˆìœ¼ë©´ ì²˜ë¦¬ì™„ë£Œ
          statusHtml = `<span class="status-badge status-completed">âœ“ ${completed}</span>`;
        } else if (requestStatus === 'ìš”ì²­ì™„ë£Œ') {
          // ìš”ì²­ì™„ë£Œ ìƒíƒœ
          statusHtml = '<span class="status-badge" style="background: #d1ecf1; color: #0c5460;">â³ ìš”ì²­ì™„ë£Œ</span>';
        } else {
          // ìš”ì²­ë„ ì•ˆ í•œ ìƒíƒœ
          statusHtml = '<span class="status-badge status-pending">â³ ëŒ€ê¸°ì¤‘</span>';
        }
        
        // ê´€ë¦¬ìì¼ ë•ŒëŠ” í™”ì£¼ì‚¬ëª… + ë¹„ê³  ì—´ ì¶”ê°€
        // isAdminModeëŠ” ìœ„ì—ì„œ ì´ë¯¸ ì„ ì–¸ë¨ (1152ë²ˆì§¸ ì¤„)
        const companyCell = isAdminMode ? 
          `<td class="admin-only">${row['í™”ì£¼ëª…'] || ''}</td>` : '';
        
        // ë¹„ê³  ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) - memoTextëŠ” ìœ„ì—ì„œ ì´ë¯¸ ì„ ì–¸ë¨ (1135ë²ˆì§¸ ì¤„)
        const memoCell = isAdminMode ? 
          `<td class="admin-only" style="text-align: center; min-width: 80px;">
            <button class="memo-btn ${memoText ? 'has-memo' : ''}" 
              onclick="openMemoModal(${index}, ${row.rowIndex}, '${memoText.replace(/'/g, "\\'")}')">
              ${memoText ? 'ğŸ“ ìˆ˜ì •' : 'ğŸ“ ë¹„ê³ '}
            </button>
          </td>` : '';
        
        // QR ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©)
        const trackingNumber = row['ì†¡ì¥ë²ˆí˜¸'] ? row['ì†¡ì¥ë²ˆí˜¸'].toString().trim() : '';
        const productName = row['ì œí’ˆ'] || '';
        const customerName = row['ê³ ê°ëª…'] || '';
        const safeProductName = escapeHtml(productName);
        const productCellContent = `${safeProductName}`;
        const qrCell = isAdminMode ? 
          `<td class="admin-only" style="text-align: center; min-width: 70px;">
            ${trackingNumber ? 
              `<button class="qr-btn" onclick='showQRCode(${JSON.stringify(trackingNumber)}, ${JSON.stringify(productName)}, ${JSON.stringify(customerName)}, ${JSON.stringify(trackingNumber)})'>
                ğŸ“± QR
              </button>` : 
              '<span style="color: #999; font-size: 11px;">ë¯¸ìƒì„±</span>'}
          </td>` : '';
        
        // ê´€ë¦¬ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš© - ì²˜ë¦¬ì™„ë£Œ ë²„íŠ¼)
        const manageCell = isAdminMode ? 
          `<td class="admin-only" style="text-align: center; min-width: 80px;">
            ${completed ? 
              '<span style="color: #4CAF50; font-size: 11px; font-weight: 600; white-space: nowrap;">âœ“ ì™„ë£Œ</span>' : 
              `<button class="save-btn" onclick="completeReturn(${index}, ${row.rowIndex})" 
                style="background: #FF5722; padding: 5px 10px; font-size: 11px; white-space: nowrap; min-width: 60px;">ì²˜ë¦¬ì™„ë£Œ</button>`
            }
          </td>` : '';
        
        tr.innerHTML = `
          <td>${row['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || ''}</td>
          ${companyCell}
          <td>${productCellContent}</td>
          <td>${row['ê³ ê°ëª…'] || ''}</td>
          <td>${row['ì†¡ì¥ë²ˆí˜¸'] || ''}</td>
          <td>${row['ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡'] || ''}</td>
          <td>${row['ì¬ê³ ìƒíƒœ'] || ''}</td>
          <td>${statusHtml}</td>
          <td>${photoHtml}</td>
          ${memoCell}
          <td style="min-width: 200px; max-width: 300px;">${requestHtml}</td>
          ${qrCell}
          ${manageCell}
        `;
        
        // íˆ´íŒ ì´ë²¤íŠ¸ ì¶”ê°€
        tr.addEventListener('mouseenter', function(e) {
          showTooltip(e, memoText);
        });
        
        tr.addEventListener('mousemove', function(e) {
          moveTooltip(e);
        });
        
        tr.addEventListener('mouseleave', function() {
          hideTooltip();
        });
        
        tbody.appendChild(tr);
      });
    }
    
    // í•„í„°ë§ í•¨ìˆ˜
    function filterData(filterType) {
      currentFilter = filterType;
      updateStatButtons(filterType);
      renderTable(getFilteredData());
    }
    
    // í†µê³„ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatButtons(activeFilter) {
      document.getElementById('statAll').classList.remove('active');
      document.getElementById('statCompleted').classList.remove('active');
      document.getElementById('statPending').classList.remove('active');
      
      if (activeFilter === 'all') {
        document.getElementById('statAll').classList.add('active');
      } else if (activeFilter === 'completed') {
        document.getElementById('statCompleted').classList.add('active');
      } else if (activeFilter === 'pending') {
        document.getElementById('statPending').classList.add('active');
      }
    }
    
    // í•„í„°ë§ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function getFilteredData() {
      if (currentFilter === 'all') {
        return currentData;
      } else if (currentFilter === 'completed') {
        // ì²˜ë¦¬ ì™„ë£Œëœ ê²ƒë§Œ (Iì—´ì— ë‹´ë‹¹ì ì´ë¦„ ìˆìŒ)
        return currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return completed;
        });
      } else if (currentFilter === 'pending') {
        // ì²˜ë¦¬ ëŒ€ê¸° ì¤‘ì¸ ê²ƒë§Œ (Iì—´ì— ë‹´ë‹¹ì ì´ë¦„ ì—†ìŒ)
        return currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return !completed;
        });
      }
      return currentData;
    }
    
    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats(data) {
      const total = data.length;
      const completed = data.filter(row => {
        const hasCompleted = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
        return hasCompleted;
      }).length;
      
      const requested = data.filter(row => {
        const hasCompleted = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
        const requestStatus = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] && row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'].toString().trim();
        return !hasCompleted && requestStatus === 'ìš”ì²­ì™„ë£Œ';
      }).length;
      
      const pending = total - completed - requested;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('pendingCount').textContent = `${pending} / ìš”ì²­ì¤‘ ${requested}`;
    }
    
    // ìƒˆ ë°˜í’ˆ ê±´ ë“±ë¡
    function submitNewReturn() {
      const selectedMonth = document.getElementById('monthSelect').value;
      
      const newReturn = {
        returnDate: document.getElementById('newReturnDate').value.trim(),
        company: document.getElementById('newCompany').value.trim(),
        product: document.getElementById('newProduct').value.trim(),
        customer: document.getElementById('newCustomer').value.trim(),
        trackingNumber: document.getElementById('newTracking').value.trim(),
        returnType: document.getElementById('newReturnType').value,
        stockStatus: document.getElementById('newStockStatus').value,
        memo: document.getElementById('newMemo').value.trim()
      };
      
      // í•„ìˆ˜ í•­ëª© ê²€ì¦
      if (!selectedMonth) {
        alert('ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!newReturn.company || !newReturn.customer || !newReturn.trackingNumber) {
        alert('í™”ì£¼ëª…, ê³ ê°ëª…, ì†¡ì¥ë²ˆí˜¸ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
        return;
      }
      
      // ì†¡ì¥ë²ˆí˜¸ ìˆ«ì ê²€ì¦
      if (!/^[\d\s\-]+$/.test(newReturn.trackingNumber)) {
        alert('ì†¡ì¥ë²ˆí˜¸ëŠ” ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!confirm('ìƒˆ ë°˜í’ˆ ê±´ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showMessage('âœ… ' + result.message, 'success');
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('newReturnDate').value = '';
            document.getElementById('newCompany').value = '';
            document.getElementById('newProduct').value = '';
            document.getElementById('newCustomer').value = '';
            document.getElementById('newTracking').value = '';
            document.getElementById('newMemo').value = '';
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
          } else {
            showMessage('âŒ ' + (result.message || 'ë“±ë¡ ì‹¤íŒ¨'), 'error');
          }
        })
        .withFailureHandler(function(error) {
          showMessage('âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜: ' + error, 'error');
        })
        .addNewReturn(newReturn, selectedMonth, currentCompany);
    }
    
    // ë¹„ê³  ëª¨ë‹¬ ì—´ê¸°
    function openMemoModal(dataIndex, rowIndex, currentMemo) {
      currentMemoRowIndex = rowIndex;
      currentMemoSheetName = document.getElementById('monthSelect').value;
      
      document.getElementById('memoTextarea').value = currentMemo;
      document.getElementById('memoModal').classList.add('show');
      document.getElementById('memoTextarea').focus();
    }
    
    // ë¹„ê³  ëª¨ë‹¬ ë‹«ê¸°
    function closeMemoModal() {
      document.getElementById('memoModal').classList.remove('show');
      currentMemoRowIndex = null;
      currentMemoSheetName = '';
    }
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    function closeModalIfClickedOutside(event) {
      if (event.target.id === 'memoModal') {
        closeMemoModal();
      }
    }
    
    // QR ì½”ë“œ í‘œì‹œ
    function showQRCode(qrValue, product, customer, tracking) {
      if (!qrValue) {
        alert('QR ì½”ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì†¡ì¥ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ê³ ìœ ì½”ë“œ ì •ë³´ í‘œì‹œ
      const infoHtml = `
        <div class="qr-info-row">
          <span class="qr-info-label">ì œí’ˆ:</span>
          <span class="qr-info-value">${escapeHtml(product)}</span>
        </div>
        <div class="qr-info-row">
          <span class="qr-info-label">ê³ ê°ëª…:</span>
          <span class="qr-info-value">${escapeHtml(customer)}</span>
        </div>
        <div class="qr-info-row">
          <span class="qr-info-label">ì†¡ì¥ë²ˆí˜¸:</span>
          <span class="qr-info-value">${escapeHtml(tracking)}</span>
        </div>
      `;
      document.getElementById('qrInfo').innerHTML = infoHtml;
      
      // ëª¨ë°”ì¼ í˜ì´ì§€ ë§í¬ ì„¤ì • (ê³ ì •ëœ ë°°í¬ URL ì‚¬ìš©)
      // ë°°í¬ URL: https://script.google.com/macros/s/AKfycbxdA3aUh6eR59czlpdx1xrzoN1bq2ycjynfxUOUXBy4Ayk6Xbh_LbUF_uYtF3-EE9ToZg/exec
      const DEPLOYED_URL = 'https://script.google.com/macros/s/AKfycbxdA3aUh6eR59czlpdx1xrzoN1bq2ycjynfxUOUXBy4Ayk6Xbh_LbUF_uYtF3-EE9ToZg/exec';
      const mobileUrl = DEPLOYED_URL + '?page=admin';
      
      console.log('=== QR ì½”ë“œ ìƒì„± ì •ë³´ ===');
      console.log('ì†¡ì¥ë²ˆí˜¸:', qrValue);
      console.log('ëª¨ë°”ì¼ í˜ì´ì§€ URL:', mobileUrl);
      
      // QR ì½”ë“œì—ëŠ” ì†¡ì¥ë²ˆí˜¸ë§Œ í¬í•¨ (ëª¨ë°”ì¼ í˜ì´ì§€ì—ì„œ ì§ì ‘ ìŠ¤ìº”)
      const qrData = qrValue; // ì†¡ì¥ë²ˆí˜¸ë§Œ QRì— ë‹´ìŒ
      const qrSize = 220;
      // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•´ íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
      const timestamp = new Date().getTime();
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(qrData)}&t=${timestamp}`;
      
      console.log('QR ë°ì´í„° (ì†¡ì¥ë²ˆí˜¸):', qrData);
      console.log('QR ì½”ë“œ ì´ë¯¸ì§€ URL:', qrUrl);
      
      document.getElementById('qrCodeImage').src = qrUrl;
      document.getElementById('qrCodeText').textContent = qrValue;
      document.getElementById('mobileLink').href = mobileUrl;
      
      document.getElementById('qrModal').classList.add('show');
    }
    
    // QR ëª¨ë‹¬ ë‹«ê¸°
    function closeQRModal() {
      document.getElementById('qrModal').classList.remove('show');
    }
    
    // ë¹„ê³  ì €ì¥
    function saveMemo() {
      const memoText = document.getElementById('memoTextarea').value.trim();
      
      if (!currentMemoRowIndex || !currentMemoSheetName) {
        alert('ì˜¤ë¥˜: ì €ì¥í•  ëŒ€ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showMessage('âœ… ' + result.message, 'success');
            closeMemoModal();
            loadData(); // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
          } else {
            showMessage('âŒ ' + (result.message || 'ë¹„ê³  ì €ì¥ ì‹¤íŒ¨'), 'error');
          }
        })
        .withFailureHandler(function(error) {
          showMessage('âŒ ë¹„ê³  ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error, 'error');
        })
        .saveMemo(currentMemoRowIndex, currentMemoSheetName, memoText);
    }
    
    // ì²˜ë¦¬ì™„ë£Œ ì²˜ë¦¬ (ê´€ë¦¬ì ì „ìš©)
    function completeReturn(dataIndex, rowIndex) {
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!confirm(`ì´ ë°˜í’ˆ ê±´ì„ ì²˜ë¦¬ì™„ë£Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në‹´ë‹¹ì: ${currentCompany}`)) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showMessage('âœ… ' + result.message, 'success');
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            loadData();
          } else {
            showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ì™„ë£Œ ì‹¤íŒ¨'), 'error');
          }
        })
        .withFailureHandler(function(error) {
          showMessage('âŒ ì²˜ë¦¬ì™„ë£Œ ì¤‘ ì˜¤ë¥˜: ' + error, 'error');
        })
        .markAsCompleted(rowIndex, selectedMonth, currentCompany);
    }
    
    // ìš”ì²­ì‚¬í•­ ì €ì¥
    function saveRequest(dataIndex, rowIndex) {
      const requestText = document.getElementById(`request_${dataIndex}`).value.trim();
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!requestText) {
        alert('ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!confirm('ìš”ì²­ì‚¬í•­ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì €ì¥ í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showMessage('âœ… ' + result.message, 'success');
            loadData();
          } else {
            showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
          }
        })
        .withFailureHandler(function(error) {
          showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error, 'error');
        })
        .saveClientRequest(rowIndex, selectedMonth, requestText);
    }
    
    // ë¡œê·¸ì¸ ë©”ì‹œì§€ í‘œì‹œ
    function showLoginMessage(text, type) {
      const div = document.getElementById('loginMessage');
      div.textContent = text;
      div.className = type || '';
      div.style.display = text ? 'block' : 'none';
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(text, type) {
      const div = document.getElementById('message');
      div.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => { div.innerHTML = ''; }, 5000);
    }
  </script>
</body>
</html>

