<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JJAY 3PL ì¢…í•© ë¬¼ë¥˜ - í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 50%, #ffeaa7 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ë¡œê·¸ì¸ ì„¹ì…˜ */
    .login-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 50%, #ffa502 100%);
      position: relative;
      overflow: hidden;
    }
    
    .login-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .login-form {
      background: rgba(255, 255, 255, 0.98);
      padding: 50px 40px;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 8px 24px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(10px);
    }
    
    .login-logo {
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      border: 4px solid rgba(255, 255, 255, 0.9);
      overflow: hidden;
    }
    
    .login-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 15px;
    }
    
    .login-form h1 {
      text-align: center;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    
    .login-form .subtitle {
      text-align: center;
      color: #636e72;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .footer-info {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 107, 53, 0.1);
    }
    
    .version-info {
      text-align: center;
      margin-bottom: 16px;
    }
    
    .version-text {
      font-size: 11px;
      color: #b2bec3;
      font-weight: 500;
      letter-spacing: 1px;
      padding: 4px 12px;
      background: rgba(255, 107, 53, 0.05);
      border-radius: 12px;
      display: inline-block;
    }
    
    .creator-credit {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
      padding: 0;
    }
    
    .creator-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.2), transparent);
    }
    
    .creator-text {
      font-size: 11px;
      color: #95a5a6;
      font-weight: 400;
      white-space: nowrap;
      letter-spacing: 0.5px;
    }
    
    .creator-text strong {
      color: #ff6b35;
      font-weight: 600;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .login-form .input-group {
      position: relative;
      margin-bottom: 4px;
    }
    
    .login-form .input-group i {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #ff6b35;
      font-size: 18px;
      z-index: 1;
    }
    
    .login-form input {
      width: 100%;
      padding: 16px 18px 16px 50px;
      border: 2px solid #ffeaa7;
      border-radius: 14px;
      font-size: 15px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .login-form input::placeholder {
      color: #b2bec3;
    }
    
    .login-form input:focus {
      outline: none;
      border-color: #ff6b35;
      box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
      background: #fffef9;
    }
    
    .login-form .remember-forgot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 14px;
    }
    
    .login-form .remember-forgot label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #636e72;
      cursor: pointer;
    }
    
    .login-form .remember-forgot input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #ff6b35;
    }
    
    .login-form .remember-forgot a {
      color: #ff6b35;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    
    .login-form .remember-forgot a:hover {
      color: #ff5722;
      text-decoration: underline;
    }
    
    .login-form button {
      padding: 16px 30px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 8px;
    }
    
    .login-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.5);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .login-form button:active {
      transform: translateY(0);
    }
    
    .login-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    /* ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ */
    .dashboard-section {
      display: none;
      position: relative;
    }
    
    .dashboard-section.show {
      display: block;
    }
    
    /* ë¡œê³  ìŠ¤íƒ€ì¼ */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-letters {
      display: flex;
      align-items: center;
      position: relative;
      height: 32px;
    }
    
    .logo-j {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #ff6b35 0%, #ff5722 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      z-index: 2;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-c {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #feca57 0%, #ffa502 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      margin-left: -20px;
      z-index: 1;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-text {
      font-size: 11px;
      font-weight: 500;
      color: #636e72;
      letter-spacing: 3px;
      margin-top: 4px;
    }
    
    .header {
      background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 1;
      flex: 1;
    }
    
    .header-logo {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .header h1 {
      color: #ff6b35;
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.3px;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      border-left: 2px solid #ffeaa7;
      padding-left: 15px;
    }
    
    .header .subtitle {
      color: #636e72;
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header .creator {
      color: #b2bec3;
      font-size: 10px;
      font-style: italic;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    
    .company-info {
      color: #2d3436;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
      border: 2px solid #ffa502;
      line-height: 1.3;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(255, 165, 2, 0.15);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    
    .logout-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    /* ë©”ë‰´ë°” ìŠ¤íƒ€ì¼ */
    .menu-bar {
      background: #ffffff;
      padding: 12px 20px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .menu-item {
      padding: 10px 20px;
      border: none;
      background: transparent;
      border-radius: 10px;
      color: #636e72;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .menu-item:hover {
      background: #fff9e6;
      color: #ff6b35;
    }
    
    .menu-item.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      background: #ffffff;
      padding: 6px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 6px;
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      border-radius: 10px;
      color: #636e72;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
      background: #fff9e6;
      color: #ff6b35;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .tab-content {
      display: block;
      visibility: visible;
      opacity: 1;
    }
    
    .tab-content.hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
    
    /* í™”ì£¼ì‚¬ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
    .admin-form {
      background: #ffffff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
    }
    
    .admin-form h3 {
      margin: 0 0 24px;
      color: #ff6b35;
      font-size: 22px;
      font-weight: 700;
    }
    
    .admin-form .form-group {
      margin-bottom: 20px;
    }
    
    .admin-form label {
      display: block;
      margin-bottom: 10px;
      color: #2d3436;
      font-weight: 600;
      font-size: 14px;
    }
    
    .admin-form input,
    .admin-form textarea,
    .admin-form select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .admin-form input::placeholder,
    .admin-form textarea::placeholder {
      color: #b2bec3;
    }
    
    .admin-form input:focus,
    .admin-form textarea:focus,
    .admin-form select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .admin-form textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .admin-form button {
      padding: 14px 32px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .admin-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    .admin-form .form-section {
      margin-top: 30px;
      padding-top: 24px;
      border-top: 2px solid #ffeaa7;
    }
    
    .admin-form .form-section h4 {
      margin: 0 0 18px;
      color: #636e72;
      font-size: 16px;
      font-weight: 600;
    }
    
    .admin-status {
      margin-top: 18px;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .admin-status.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(0, 184, 148, 0.25);
    }
    
    .admin-status.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-status.loading {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%);
      color: #ff6b35;
      border: 2px solid #ffa502;
      display: block;
    }
    
    .filters {
      background: #ffffff;
      padding: 20px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filters label {
      font-weight: 600;
      color: #2d3436;
    }
    
    .filters select {
      padding: 12px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filters select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
    }
    
    .refresh-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .refresh-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .stats {
      background: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
      padding: 20px 24px;
      border-radius: 14px;
      min-width: 120px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #ffeaa7;
      background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%);
    }
    
    .stat-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2);
      border-color: #ffa502;
    }
    
    .stat-item.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      border-color: #ff6b35;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      transform: translateY(-3px);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 800;
      color: #ff6b35;
      user-select: none;
    }
    
    .stat-item.active .stat-number {
      color: white;
    }
    
    .stat-label {
      font-size: 13px;
      color: #636e72;
      margin-top: 8px;
      user-select: none;
    }
    
    .stat-item.active .stat-label {
      color: white;
      font-weight: 600;
    }
    
    .table-container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 20px 20px 60px 20px;
      margin-bottom: 40px;
      min-height: 200px;
    }
    
    /* í…Œì´ë¸” ìŠ¤í¬ë¡¤ ì˜ì—­ */
    .table-container > table,
    .table-container > div:last-child > table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      border-spacing: 0;
      display: table;
    }
    
    /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ í…Œì´ë¸” ë˜í¼ */
    .table-scroll-wrapper {
      overflow-x: scroll;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      margin: 0 -20px;
      padding: 0 20px 100px 20px;
      margin-top: 15px;
      margin-bottom: 20px;
      flex: 1;
      min-height: 0;
      position: relative;
    }
    
    /* í…Œì´ë¸”ì— í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ */
    .table-scroll-wrapper > table {
      margin-bottom: 30px;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ ê°œì„  */
    .table-scroll-wrapper::-webkit-scrollbar,
    .table-container::-webkit-scrollbar {
      height: 12px;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-track,
    .table-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
      margin: 0 4px;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-thumb,
    .table-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%);
      border-radius: 10px;
      border: 2px solid #f1f1f1;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-thumb:hover,
    .table-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #ff6b35 0%, #ff9500 100%);
    }
    
    .table-container > table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      border-spacing: 0;
      display: table;
    }
    
    /* í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸”ì€ ì»¬ëŸ¼ì´ ë§ì•„ì„œ ë” í° ìµœì†Œ ë„ˆë¹„ í•„ìš” */
    .table-container:has(#companiesTableBody) > table,
    .table-container table:has(#companiesTableBody) {
      min-width: 1200px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
    }
    
    thead {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead tr {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      border: none !important;
      margin: 0 !important;
    }
    
    thead,
    thead:hover,
    thead:active,
    thead:focus,
    thead:visited {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead *,
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    th {
      padding: 12px 10px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      white-space: nowrap;
      cursor: default !important;
      transition: none !important;
      -webkit-transition: none !important;
      -moz-transition: none !important;
      -o-transition: none !important;
      pointer-events: auto;
      user-select: none;
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      border: none !important;
      margin: 0 !important;
      border-spacing: 0 !important;
    }
    
    thead tr:first-child th:first-child {
      border-top-left-radius: 12px;
    }
    
    thead tr:first-child th:last-child {
      border-top-right-radius: 12px;
    }
    
    /* í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì œê±° - ëª¨ë“  ê°€ëŠ¥í•œ ìƒíƒœì™€ ì¡°í•© */
    th,
    th:hover,
    th:active,
    th:focus,
    th:visited,
    th:link,
    th::before,
    th::after {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      outline: none !important;
      box-shadow: none !important;
      transform: none !important;
      border: none !important;
      opacity: 1 !important;
    }
    
    thead th,
    thead th:hover,
    thead th:active,
    thead th:focus,
    thead th:visited,
    thead th:link,
    thead:hover th,
    thead:active th,
    thead:focus th,
    thead:hover th:hover,
    thead:active th:active {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      border: none !important;
    }
    
    /* ëª¨ë“  th ìì‹ ìš”ì†Œì—ë„ ì ìš© */
    th *,
    th *:hover,
    th *:active,
    th *:focus {
      background: transparent !important;
      background-color: transparent !important;
      color: white !important;
    }
    
    /* theadì˜ ëª¨ë“  ìš”ì†Œì— hover íš¨ê³¼ ì—†ìŒ */
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    /* í…Œì´ë¸” í—¤ë”ì˜ ëª¨ë“  ìƒíƒœì—ì„œ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ìœ ì§€ - ëª¨ë“  ì¡°í•© */
    table thead,
    table thead:hover,
    table thead:active,
    table thead th,
    table thead th:hover,
    table thead th:active,
    table thead th:focus,
    table thead:hover th,
    table thead:hover th:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    /* ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë³´ë‹¤ ìš°ì„ ìˆœìœ„ ë†’ì´ê¸° */
    thead[style],
    th[style] {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead[style]:hover,
    th[style]:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #e0e0e0;
      border-left: none !important;
      border-right: none !important;
      border-top: none !important;
      font-size: 12px;
      color: #2d3436;
      background: #ffffff;
      vertical-align: middle;
      line-height: 1.4;
    }
    
    /* thì™€ td ì‚¬ì´ì˜ ì„¸ë¡œ ê²½ê³„ì„  ì œê±° */
    th + th,
    td + td {
      border-left: none !important;
    }
    
    /* í…Œì´ë¸” ì…€ ê°„ ê°„ê²© ì œê±° */
    table th,
    table td {
      border-collapse: collapse;
    }
    
    tr:hover {
      background: #fff9e6;
    }
    
    tr {
      background: #ffffff;
      transition: background 0.2s ease;
    }
    
    tr:last-child td:first-child {
      border-bottom-left-radius: 12px;
    }
    
    tr:last-child td:last-child {
      border-bottom-right-radius: 12px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      border: none;
      line-height: 1.2;
    }
    
    .status-completed {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: none;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
    }
    
    .request-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 13px;
      resize: vertical;
      min-height: 60px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .request-input:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .save-btn {
      padding: 4px 8px;
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      margin: 0;
      transition: all 0.2s ease;
      box-shadow: none;
      display: inline-block;
      line-height: 1.2;
      height: auto;
    }
    
    .save-btn:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ff8800 100%);
      transform: none;
      box-shadow: none;
    }
    
    /* ìˆ˜ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .edit-btn {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%) !important;
      color: #ff6b35 !important;
      border: 2px solid #ffa502 !important;
    }
    
    .edit-btn:hover {
      background: linear-gradient(135deg, #ffa502 0%, #ffeaa7 100%) !important;
      color: white !important;
      border-color: #ff6b35 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 165, 2, 0.3);
    }
    
    .edit-btn:disabled {
      background: #ddd !important;
      color: #999 !important;
      border-color: #ddd !important;
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
      box-shadow: none;
    }
    
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      border: none;
      font-weight: 600;
      z-index: 1000;
      display: none;
      background: #ffffff;
      animation: slideInRight 0.3s ease;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .message.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }
    
    .message.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
    }
    
    .no-data {
      text-align: center;
      padding: 60px 40px;
      color: #b2bec3;
      font-size: 15px;
    }
    
    .admin-only {
      display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€, JavaScriptë¡œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´ */
    }
    
    #loginMessage {
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* ë¹„ê³  íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .download-tooltip {
      position: fixed;
      background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.6;
      z-index: 10000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      max-width: 350px;
      pointer-events: none;
      white-space: normal;
      word-wrap: break-word;
    }
    
    .download-tooltip::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 20px;
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 8px solid #2d3436;
    }
    
    .download-tooltip strong {
      color: #ffeaa7;
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .download-tooltip ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }
    
    .download-tooltip li {
      margin: 4px 0;
    }
    
    .memo-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      max-width: 300px;
      z-index: 10000;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .memo-tooltip::before {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 5px solid rgba(0, 0, 0, 0.9);
    }
    
    /* ì œí’ˆëª… ì…€ ìŠ¤íƒ€ì¼ */
    table th:nth-child(3) {
      text-align: center;
      width: 150px !important;
      min-width: 120px !important;
      max-width: 150px !important;
      box-sizing: border-box !important;
    }
    
    table td:nth-child(3) {
      text-align: center;
      width: 150px !important;
      min-width: 120px !important;
      max-width: 150px !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      padding: 10px 8px !important;
      vertical-align: middle !important;
      box-sizing: border-box !important;
    }
    
    .product-cell {
      text-align: center !important;
      font-weight: normal;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      display: table-cell !important;
      width: 150px !important;
      max-width: 150px !important;
      min-width: 120px !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
      box-sizing: border-box !important;
    }
    
    .product-cell.has-memo {
      color: #e74c3c !important;
      font-weight: 700 !important;
      text-decoration: none !important;
      background: transparent !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
    }
    
    /* ì‚¬ì§„ ë§í¬ ìŠ¤íƒ€ì¼ */
    .photo-links {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      align-items: center;
      line-height: 1.4;
    }
    
    .photo-link {
      color: #4a90e2;
      text-decoration: underline;
      font-size: 11px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    
    .photo-link:hover {
      color: #357abd;
    }
    
    /* ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ - ì‘ì€ ê·¸ë¼ë””ì–¸íŠ¸ ë°•ìŠ¤ì— ì²´í¬ì™€ ì´ë¦„ */
    .status-completed-circle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      padding: 3px 8px;
      border: none;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      box-shadow: none;
      line-height: 1.2;
    }
    
    .status-completed-circle::before {
      content: 'âœ“';
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      background: rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 14px;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* ì ‘ì´ì‹ ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #addReturnBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
    
    #addCompanyBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="loginSection" class="login-section">
      <div class="login-form">
        <!-- ë¡œê³  ì˜ì—­ -->
        <div class="login-logo">
          <img id="loginLogo" src="" alt="JJAY ë¡œê³ " onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'font-size:48px; font-weight:800; color:white;\'>JJ</div>';">
        </div>
        
        <h1>JJAY 3PL ì¢…í•© ë¬¼ë¥˜</h1>
        <p class="subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        
        <div class="input-group">
          <i>ğŸ‘¤</i>
          <input type="text" id="username" placeholder="ì•„ì´ë””" autocomplete="username">
        </div>
        
        <div class="input-group">
          <i>ğŸ”’</i>
          <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password">
        </div>
        
        <div class="remember-forgot">
          <label>
            <input type="checkbox" id="rememberMe">
            <span>ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
          </label>
          <a href="#" onclick="alert('ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.'); return false;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>
        
        <button id="loginBtn" type="button" onclick="doLogin(); return false;">ë¡œê·¸ì¸</button>
        <div id="loginMessage"></div>
        
        <!-- ë²„ì „ ë° ë§Œë“ ì´ ì •ë³´ -->
        <div class="footer-info">
          <div class="version-info">
            <span class="version-text">v4.0</span>
          </div>
          <div class="creator-credit">
            <div class="creator-line"></div>
            <span class="creator-text">Made with â¤ï¸ by <strong>Pyojungoh</strong></span>
            <div class="creator-line"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboardSection" class="dashboard-section">
      <!-- í—¤ë” -->
      <div class="header">
        <div class="header-left">
          <div class="header-logo">
            <img id="headerLogo" src="https://res.cloudinary.com/dokk81rjh/image/upload/v1762922695/logo_srff9i.png" alt="JJAY Logo" style="width: 50px; height: 50px; object-fit: contain; margin-right: 12px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="logo-container" style="display: none;">
              <div class="logo-letters">
                <span class="logo-j">J</span>
                <span class="logo-c">C</span>
              </div>
            </div>
            <div class="logo-text" style="display: none;">JAY JAY</div>
          </div>
          <div class="header-info">
            <div class="subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div class="creator">Developed by pyojungoh</div>
          </div>
        </div>
        <div class="header-center">
          <div class="company-info" id="companyInfo"></div>
        </div>
        <div class="header-right">
          <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
      
      <!-- ì‚¬ì—…ì ì •ë³´ ë¯¸ì…ë ¥ ë°°ë„ˆ (ì‚¬ì´ë“œì—ì„œ íŠ€ì–´ë‚˜ì˜´, ìŠ¤í¬ë¡¤ ê³ ì •) -->
      <div id="companyInfoBanner" style="display: none; position: fixed; top: 80px; right: 20px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; padding: 14px 28px; border-radius: 12px; font-weight: 700; font-size: 16px; text-align: center; box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5); animation: blink 1.5s infinite; z-index: 1000; white-space: nowrap; transform: translateX(0); transition: transform 0.3s ease;">
        âš ï¸ í™”ì£¼ì‚¬ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
      </div>
      
      <!-- íŒì—… ë ˆì´ì–´ -->
      <div id="popupLayer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div id="popupContent" style="background: white; padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;">
          <button id="popupCloseBtn" onclick="closePopup()" style="position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">Ã—</button>
          <h2 id="popupTitle" style="margin: 0 0 20px 0; color: #ff6b35; font-size: 24px; font-weight: 700;"></h2>
          <div id="popupBody" style="color: #2d3436; font-size: 16px; line-height: 1.6; white-space: pre-wrap;"></div>
          <div style="margin-top: 20px; text-align: center; display: flex; gap: 10px; justify-content: center;">
            <button onclick="closePopup()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);">ë‹«ê¸°</button>
            <button onclick="closePopupForToday()" class="save-btn" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">í•˜ë£¨ ë™ì•ˆ ë³´ì§€ ì•Šê¸°</button>
          </div>
        </div>
      </div>
      
      <!-- ë©”ë‰´ë°” (í™”ì£¼ì‚¬ ëª¨ë“œë§Œ í‘œì‹œ) -->
      <div class="menu-bar" id="menuBar" style="display: none;">
        <button type="button" class="menu-item" id="companyInfoMenuBtn" onclick="switchMenu('companyInfo')">ğŸ‘¤ í™”ì£¼ì‚¬ ì •ë³´</button>
        <button type="button" class="menu-item" id="returnsMenuBtn" onclick="switchMenu('returns')">ğŸ“¦ ë°˜í’ˆê´€ë¦¬</button>
        <button type="button" class="menu-item" id="scheduleMenuBtn" onclick="switchMenu('schedule')">ğŸ“… íŒë§¤ìŠ¤ì¼€ì¥´</button>
        <button type="button" class="menu-item" id="boardMenuBtn" onclick="switchMenu('board')">ğŸ“‹ ê²Œì‹œíŒ</button>
      </div>
      
      <!-- ê´€ë¦¬ì ì „ìš© íƒ­ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
      <div id="adminTabs" style="display: none;">
        <div class="tabs">
          <button type="button" class="tab-btn active" id="returnsTabBtn" onclick="switchAdminTab('returns')">ğŸ“¦ ë°˜í’ˆ ë‚´ì—­</button>
          <button type="button" class="tab-btn" id="scheduleCalendarTabBtn" onclick="switchAdminTab('scheduleCalendar')">ğŸ“… ìŠ¤ì¼€ì¥´ ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="boardTabBtn" onclick="switchAdminTab('board')">ğŸ“‹ ê²Œì‹œíŒ ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="popupTabBtn" onclick="switchAdminTab('popup')">ğŸ”” íŒì—… ê´€ë¦¬</button>
          <button type="button" class="tab-btn admin-only-tab" id="registerTabBtn" onclick="switchAdminTab('register')" style="display: none;">ğŸ¢ í™”ì£¼ì‚¬ ë“±ë¡</button>
        </div>
      </div>
      
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ -->
      <div id="returnsTab" class="tab-content">
      <!-- í•„í„° -->
      <div class="filters">
        <label for="monthSelect">ğŸ“… ì¡°íšŒ ì›”:</label>
        <select id="monthSelect">
          <option value="">ë¡œë”© ì¤‘...</option>
        </select>
        <button class="refresh-btn" onclick="refreshReturnsData()" id="refreshReturnsBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="refresh-btn admin-only-btn" id="downloadTemplateBtn" onclick="downloadCsvTemplate()" onmouseenter="showDownloadTooltip(event)" onmouseleave="hideDownloadTooltip()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); position: relative; display: none;">ğŸ“¥ ì„œì‹ ë‹¤ìš´ë¡œë“œ</button>
        <label for="csvUploadInput" class="admin-only-btn" style="cursor: pointer; display: none; margin: 0;">
          <span class="refresh-btn" style="display: inline-block; margin: 0;">ğŸ“¤ CSV ì—…ë¡œë“œ</span>
          <input type="file" id="csvUploadInput" accept=".csv" style="display: none;" onchange="handleCsvUpload(event)">
        </label>
      </div>
      
      <!-- ë°˜í’ˆ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
      <div id="addReturnSection" style="display: none; margin-bottom: 20px;">
        <button id="addReturnBtn" class="refresh-btn" onclick="toggleAddForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
          <span>â• ë°˜í’ˆ ë“±ë¡</span>
          <span id="addReturnIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
        </button>
        
        <!-- ë°˜í’ˆ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
        <div id="addReturnForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ë°˜í’ˆ ë‚´ì—­ ë“±ë¡</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ ì ‘ìˆ˜ì¼ (ì¼ìë§Œ):</label>
              <input type="number" id="newReturnDate" class="request-input" style="min-height: auto;" placeholder="ì¼ì (1-31)" min="1" max="31">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ëª…:</label>
              <input type="text" id="newCompanyName" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ëª…">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œí’ˆ:</label>
              <input type="text" id="newProduct" class="request-input" style="min-height: auto;" placeholder="ì œí’ˆëª…">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê³ ê°ëª…:</label>
              <input type="text" id="newCustomerName" class="request-input" style="min-height: auto;" placeholder="ê³ ê°ëª…" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì†¡ì¥ë²ˆí˜¸:</label>
              <input type="text" id="newTrackingNumber" class="request-input" style="min-height: auto;" placeholder="ì†¡ì¥ë²ˆí˜¸" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡:</label>
              <select id="newReturnType" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ë°˜í’ˆ">ë°˜í’ˆ</option>
                <option value="êµí™˜">êµí™˜</option>
                <option value="ì˜¤ë°°ì†¡">ì˜¤ë°°ì†¡</option>
                <option value="ëˆ„ë½">ëˆ„ë½</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¬ê³ ìƒíƒœ:</label>
              <select id="newStockStatus" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ì •ìƒ">ì •ìƒ</option>
                <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë¹„ê³ :</label>
              <textarea id="newMemo" class="request-input" style="min-height: 60px;" placeholder="ë¹„ê³ "></textarea>
            </div>
          </div>
          <div style="margin-top: 20px; display: flex; gap: 12px;">
            <button class="save-btn" onclick="addReturn()">ì €ì¥</button>
            <button class="save-btn" onclick="toggleAddForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
      
      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-item active" id="filterAll" onclick="filterByStatus('all')">
          <div class="stat-number" id="totalCount">0</div>
          <div class="stat-label">ì „ì²´ ë°˜í’ˆ ê±´</div>
        </div>
        <div class="stat-item" id="filterCompleted" onclick="filterByStatus('completed')">
          <div class="stat-number" id="completedCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ì™„ë£Œ</div>
        </div>
        <div class="stat-item" id="filterPending" onclick="filterByStatus('pending')">
          <div class="stat-number" id="pendingCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
        </div>
      </div>
      
      <!-- í…Œì´ë¸” -->
      <div class="table-container">
        <div class="table-scroll-wrapper">
          <table>
            <thead>
              <tr>
                <th>ì ‘ìˆ˜ì¼</th>
                <th class="admin-only" style="display: none;">í™”ì£¼ì‚¬</th>
                <th>ì œí’ˆ</th>
                <th>ê³ ê°ëª…</th>
                <th>ì†¡ì¥ë²ˆí˜¸</th>
              <th>ë°˜í’ˆ/êµí™˜</th>
              <th>ì¬ê³ ìƒíƒœ</th>
              <th>ì²˜ë¦¬ì™„ë£Œ</th>
              <th>ì‚¬ì§„</th>
              <th class="admin-only" style="display: none;">ë¹„ê³ </th>
              <th>í™”ì£¼ì‚¬ ìš”ì²­ì‚¬í•­</th>
              <th class="admin-only" style="display: none;">QR</th>
              <th class="admin-only" style="display: none;">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>
      </div>
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ ë -->
      
      <!-- í™”ì£¼ì‚¬ ì •ë³´ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="companyInfoTab" class="tab-content hidden">
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ‘¤ í™”ì£¼ì‚¬ ì •ë³´</h3>
            <button class="refresh-btn" onclick="loadCompanyInfo()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          
          <!-- í™”ì£¼ì‚¬ ì •ë³´ í¼ -->
          <form id="companyInfoForm" onsubmit="saveCompanyInfo(event); return false;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
              <!-- ê¸°ë³¸ ì •ë³´ -->
              <div style="grid-column: 1 / -1;">
                <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px; padding-bottom: 10px; border-bottom: 2px solid #ffeaa7;">ê¸°ë³¸ ì •ë³´</h4>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ëª… *</label>
                <input type="text" id="companyInfoName" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì•„ì´ë”” *</label>
                <input type="text" id="companyInfoUsername" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê¶Œí•œ</label>
                <input type="text" id="companyInfoRole" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <!-- ì‚¬ì—…ì ì •ë³´ -->
              <div style="grid-column: 1 / -1; margin-top: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px; padding-bottom: 10px; border-bottom: 2px solid #ffeaa7;">ì‚¬ì—…ì ì •ë³´</h4>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‚¬ì—…ìë²ˆí˜¸</label>
                <input type="text" id="companyInfoBusinessNumber" class="request-input" style="min-height: auto;" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ëŒ€í‘œëª…</label>
                <input type="text" id="companyInfoBusinessName" class="request-input" style="min-height: auto;" placeholder="ëŒ€í‘œëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì£¼ì†Œ</label>
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                  <input type="text" id="companyInfoPostcode" class="request-input" style="min-height: auto; width: 120px;" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                  <button type="button" onclick="openPostcodeSearch()" class="save-btn" style="padding: 10px 20px; font-size: 14px; white-space: nowrap;">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
                <input type="text" id="companyInfoBusinessAddress" class="request-input" style="min-height: auto; margin-bottom: 8px;" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly>
                <input type="text" id="companyInfoBusinessAddressDetail" class="request-input" style="min-height: auto;" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="companyInfoBusinessTel" class="request-input" style="min-height: auto;" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼</label>
                <input type="email" id="companyInfoBusinessEmail" class="request-input" style="min-height: auto;" placeholder="ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button type="submit" class="save-btn">ğŸ’¾ ì •ë³´ ì €ì¥</button>
              <button type="button" class="save-btn" onclick="loadCompanyInfo()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
            <div id="companyInfoMessage" style="margin-top: 15px;"></div>
          </form>
          
          <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„¹ì…˜ -->
          <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #ffeaa7;">
            <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px;">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h4>
            <form id="changePasswordForm" onsubmit="changePassword(event); return false;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="currentPassword" class="request-input" style="min-height: auto;" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="newPassword" class="request-input" style="min-height: auto;" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                  <input type="password" id="newPasswordConfirm" class="request-input" style="min-height: auto;" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
              </div>
              <div style="margin-top: 15px; display: flex; gap: 12px;">
                <button type="submit" class="save-btn">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                <button type="button" class="save-btn" onclick="resetPasswordForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì´ˆê¸°í™”</button>
              </div>
              <div id="passwordChangeMessage" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
      </div>
      <!-- í™”ì£¼ì‚¬ ì •ë³´ íƒ­ ë -->
      
      <!-- íŒë§¤ìŠ¤ì¼€ì¥´ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="scheduleTab" class="tab-content hidden">
        <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ -->
        <div style="margin-bottom: 20px;">
          <button id="addScheduleBtn" class="refresh-btn" onclick="toggleScheduleForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• ìŠ¤ì¼€ì¥´ ë“±ë¡</span>
            <span id="addScheduleIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¶</span>
          </button>
          
          <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="scheduleForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ìŠ¤ì¼€ì¥´ ë“±ë¡</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="scheduleTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: 11ì›” ëŒ€í˜• í• ì¸í–‰ì‚¬" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                <input type="date" id="scheduleStartDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                <input type="date" id="scheduleEndDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í–‰ì‚¬ ë‚´ìš© *</label>
                <textarea id="scheduleEventDescription" class="request-input" style="min-height: 80px;" placeholder="í–‰ì‚¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                <textarea id="scheduleRequestNote" class="request-input" style="min-height: 60px;" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveSchedule()">ì €ì¥</button>
              <button class="save-btn" onclick="resetScheduleForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì´ˆê¸°í™”</button>
            </div>
            <div id="scheduleMessage" style="margin-top: 15px;"></div>
          </div>
        </div>
        
        <!-- ì•ˆë‚´ ì„¤ëª… ë°•ìŠ¤ -->
        <div style="background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%); padding: 20px; border-radius: 14px; border: 2px solid #ffeaa7; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; align-items: flex-start; gap: 12px;">
            <div style="font-size: 24px; line-height: 1;">â„¹ï¸</div>
            <div style="flex: 1;">
              <h4 style="margin: 0 0 12px 0; color: #ff6b35; font-weight: 700; font-size: 16px;">ğŸ“‹ íŒë§¤ìŠ¤ì¼€ì¥´ ë“±ë¡ ì•ˆë‚´</h4>
              <div style="color: #2d3436; font-size: 14px; line-height: 1.7;">
                <p style="margin: 0 0 10px 0;">
                  ì´ ë©”ë‰´ëŠ” í™”ì£¼ì‚¬ë‹˜ì˜ <strong>ì…ê³ , ì¶œê³ , íŒë§¤ ìŠ¤ì¼€ì¥´</strong>ì„ ì‚¬ì „ì— ë“±ë¡í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
                </p>
                <p style="margin: 0 0 10px 0;">
                  ëŒ€ëŸ‰ì˜ ë¬¼ëŸ‰ì´ ì˜ˆìƒë˜ëŠ” ê²½ìš°, ë°˜ë“œì‹œ <strong>ì‚¬ì „ì— ìŠ¤ì¼€ì¥´ì„ ë“±ë¡</strong>í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. 
                  ì‚¬ì „ ì‹ ì²­ ì—†ì´ ëŒ€ëŸ‰ì˜ ë¬¼ëŸ‰ì´ ê°‘ìê¸° ë“¤ì–´ì˜¬ ê²½ìš°, ë¬¼ë¥˜ ì²˜ë¦¬ ì‹œê°„ì´ ì§€ì—°ë  ìˆ˜ ìˆìœ¼ë©°, 
                  ì´ë¡œ ì¸í•œ ì±…ì„ì€ ì œì´ì œì´ì—ì„œ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </p>
                <p style="margin: 0; color: #e74c3c; font-weight: 600;">
                  âš ï¸ ì›í™œí•œ ë¬¼ë¥˜ ì²˜ë¦¬ë¥¼ ìœ„í•´ ê°€ëŠ¥í•œ í•œ ì¼ì° ìŠ¤ì¼€ì¥´ì„ ë“±ë¡í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¥´ ëª©ë¡ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“‹ ë“±ë¡ëœ ìŠ¤ì¼€ì¥´</h3>
            <button class="refresh-btn" onclick="refreshSchedules()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‹œì‘ì¼</th>
                  <th>ì¢…ë£Œì¼</th>
                  <th>í–‰ì‚¬ ë‚´ìš©</th>
                  <th>ìš”ì²­ì‚¬í•­</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="scheduleTableBody">
                <tr>
                  <td colspan="6" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- íŒë§¤ìŠ¤ì¼€ì¥´ íƒ­ ë -->
      
      <!-- ê²Œì‹œíŒ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="boardCategoryTab" class="tab-content hidden">
        <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë°•ìŠ¤ -->
        <div style="background: #ffffff; padding: 20px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“‹ ê²Œì‹œíŒ</h3>
            <button class="refresh-btn" onclick="loadBoardPostsByCategoryFilter()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="boardCategoryMenuBox" style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button type="button" class="category-menu-btn active" data-category-id="" onclick="selectBoardCategory('')" style="padding: 10px 20px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(255, 107, 53, 0.25);">ì „ì²´</button>
          </div>
        </div>
        
        <!-- ê²Œì‹œê¸€ ëª©ë¡ ë°•ìŠ¤ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th style="width: 80px;">ë²ˆí˜¸</th>
                  <th style="width: 120px;">ì¹´í…Œê³ ë¦¬</th>
                  <th>ì œëª©</th>
                  <th style="width: 120px;">ê¸€ì“´ì´</th>
                  <th style="width: 120px;">ì‘ì„±ë‚ ì§œ</th>
                </tr>
              </thead>
              <tbody id="boardPostList">
                <tr>
                  <td colspan="5" class="no-data">ë¡œë”© ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ê²Œì‹œíŒ íƒ­ ë -->
      
      <!-- ìŠ¤ì¼€ì¥´ ë‹¬ë ¥ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="scheduleCalendarTab" class="tab-content hidden">
        <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (ê´€ë¦¬ììš©) -->
        <div style="margin-bottom: 20px;">
          <button id="addAdminScheduleBtn" class="refresh-btn" onclick="toggleAdminScheduleForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• ìŠ¤ì¼€ì¥´ ë“±ë¡ (ê´€ë¦¬ì)</span>
            <span id="addAdminScheduleIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addAdminScheduleForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ìŠ¤ì¼€ì¥´ ë“±ë¡ (ê´€ë¦¬ì)</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ ì„ íƒ *</label>
                <select id="adminScheduleCompanyName" class="request-input" style="min-height: auto;" required>
                  <option value="">í™”ì£¼ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="adminScheduleTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: 11ì›” ëŒ€í˜• í• ì¸í–‰ì‚¬" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                <input type="date" id="adminScheduleStartDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                <input type="date" id="adminScheduleEndDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í–‰ì‚¬ ë‚´ìš© *</label>
                <textarea id="adminScheduleEventDescription" class="request-input" style="min-height: 80px;" placeholder="í–‰ì‚¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                <textarea id="adminScheduleRequestNote" class="request-input" style="min-height: 60px;" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveAdminSchedule()">ì €ì¥</button>
              <button class="save-btn" onclick="toggleAdminScheduleForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
            </div>
            <div id="adminScheduleMessage" style="margin-top: 15px;"></div>
          </div>
        </div>
        
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ì „ì²´ í™”ì£¼ì‚¬ ìŠ¤ì¼€ì¥´</h3>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input type="month" id="calendarMonthSelect" style="padding: 8px 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px;" onchange="loadCalendarSchedules()">
              <button class="refresh-btn" onclick="loadCalendarSchedules()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
          </div>
          <div id="calendarContainer" style="min-height: 500px;">
            <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¥´ ëª©ë¡ í…Œì´ë¸” -->
        <div class="table-container" style="margin-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0; color: #333; font-size: 18px; display: inline-block; margin-right: 15px;">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ ëª©ë¡</h3>
              <span id="schedulesStatistics" style="color: #666; font-size: 14px;">(ì´ 0ê°œ)</span>
            </div>
            <button class="refresh-btn" onclick="loadCalendarSchedules()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>í™”ì£¼ì‚¬ëª…</th>
                <th>ì œëª©</th>
                <th>ì‹œì‘ì¼</th>
                <th>ì¢…ë£Œì¼</th>
                <th>í–‰ì‚¬ ë‚´ìš©</th>
                <th>ìš”ì²­ì‚¬í•­</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="scheduleListTableBody">
              <tr>
                <td colspan="8" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- ìŠ¤ì¼€ì¥´ ë‹¬ë ¥ íƒ­ ë -->
      
      <!-- ê²Œì‹œíŒ ê´€ë¦¬ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="boardTab" class="tab-content hidden">
        <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ (ì ‘ì´ì‹) -->
        <div style="margin-bottom: 20px;">
          <button id="categoryManagementBtn" class="refresh-btn" onclick="toggleCategoryManagement()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>ğŸ“ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</span>
            <span id="categoryManagementIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¶</span>
          </button>
          
          <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ë‚´ìš© (ì ‘ì´ì‹) -->
          <div id="categoryManagementContent" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h3>
              <button class="refresh-btn" onclick="toggleCategoryForm()">â• ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ (ì ‘ì´ì‹) -->
            <div id="categoryForm" style="display: none; background: #fff9e6; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ffeaa7;">
              <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 12px; align-items: end;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¹´í…Œê³ ë¦¬ëª… *</label>
                  <input type="text" id="categoryName" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: í™”ì£¼ì‚¬êµìœ¡, ì¼ë°˜, ê³µì§€ì‚¬í•­" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í‘œì‹œ ìˆœì„œ</label>
                  <input type="number" id="categoryOrder" class="request-input" style="min-height: auto;" value="0" min="0">
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="save-btn" onclick="saveCategory()">ì €ì¥</button>
                  <button class="save-btn" onclick="toggleCategoryForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
                </div>
              </div>
              <div id="categoryMessage" style="margin-top: 12px;"></div>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ì¹´í…Œê³ ë¦¬ëª…</th>
                    <th>í‘œì‹œ ìˆœì„œ</th>
                    <th>ìƒì„±ì¼</th>
                    <th>ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody id="categoryTableBody">
                  <tr>
                    <td colspan="4" class="no-data">ë¡œë”© ì¤‘...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- ê²Œì‹œê¸€ ê´€ë¦¬ ì„¹ì…˜ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</h3>
            <button class="refresh-btn" onclick="toggleBoardForm()">â• ê²Œì‹œê¸€ ì‘ì„±</button>
          </div>
          
          <!-- ê²Œì‹œê¸€ ì‘ì„± í¼ (ì ‘ì´ì‹) -->
          <div id="boardForm" style="display: none; background: #fff9e6; padding: 24px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ffeaa7;">
            <h4 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ê²Œì‹œê¸€ ì‘ì„±</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¹´í…Œê³ ë¦¬ *</label>
                <select id="boardCategoryId" class="request-input" style="min-height: auto;" required>
                  <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="boardTitle" class="request-input" style="min-height: auto;" placeholder="ê²Œì‹œê¸€ ì œëª©" required>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; margin-top: 24px;">
                <input type="checkbox" id="boardIsPinned" style="width: 18px; height: 18px; cursor: pointer;">
                <label for="boardIsPinned" style="color: #2d3436; font-weight: 600; cursor: pointer;">ê³µì§€ì‚¬í•­ìœ¼ë¡œ ë“±ë¡</label>
              </div>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
              <textarea id="boardContent" class="request-input" style="min-height: 200px;" placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì²¨ë¶€íŒŒì¼</label>
              <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <input type="file" id="boardFileInput" multiple style="display: none;" onchange="handleBoardFileSelect(event)">
                <button type="button" class="save-btn" onclick="document.getElementById('boardFileInput').click()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">ğŸ“ íŒŒì¼ ì„ íƒ</button>
                <div id="boardFileList" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
              </div>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveBoard()">ì €ì¥</button>
              <button class="save-btn" onclick="toggleBoardForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
            </div>
            <div id="boardMessage" style="margin-top: 15px;"></div>
          </div>
          
          <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
          <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <div>
                <label for="boardCategoryFilter" style="color: #333; font-size: 14px; margin-right: 8px;">ì¹´í…Œê³ ë¦¬:</label>
                <select id="boardCategoryFilter" style="padding: 8px 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px;" onchange="loadBoards()">
                  <option value="">ì „ì²´</option>
                </select>
              </div>
              <button class="refresh-btn" onclick="loadBoards()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì¹´í…Œê³ ë¦¬</th>
                  <th>ì œëª©</th>
                  <th>ì‘ì„±ì</th>
                  <th>ì¡°íšŒìˆ˜</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="boardTableBody">
                <tr>
                  <td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ê²Œì‹œíŒ ê´€ë¦¬ íƒ­ ë -->
      
      <!-- íŒì—… ê´€ë¦¬ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="popupTab" class="tab-content hidden">
        <div class="admin-form">
          <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ğŸ”” íŒì—… ê´€ë¦¬</h3>
          
          <!-- íŒì—… ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div style="margin-bottom: 20px;">
            <button id="addPopupBtn" class="refresh-btn" onclick="togglePopupForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
              <span>â• íŒì—… ë“±ë¡</span>
              <span id="addPopupIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
            </button>
            
            <div id="popupForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
              <input type="hidden" id="popupId">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                  <input type="text" id="popupTitleInput" class="request-input" style="min-height: auto;" placeholder="íŒì—… ì œëª©" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                  <input type="date" id="popupStartDate" class="request-input" style="min-height: auto;" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                  <input type="date" id="popupEndDate" class="request-input" style="min-height: auto;" required>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 24px;">
                  <input type="checkbox" id="popupIsActive" style="width: 18px; height: 18px; cursor: pointer;" checked>
                  <label for="popupIsActive" style="color: #2d3436; font-weight: 600; cursor: pointer;">í™œì„±í™”</label>
                </div>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
                <textarea id="popupContentText" class="request-input" style="min-height: 200px;" placeholder="íŒì—… ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                  <input type="file" id="popupImageInput" accept="image/*" style="display: none;" onchange="handlePopupImageSelect(event)">
                  <button type="button" class="save-btn" onclick="document.getElementById('popupImageInput').click()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">ğŸ“· ì´ë¯¸ì§€ ì„ íƒ</button>
                  <button type="button" class="save-btn" onclick="removePopupImage()" id="removePopupImageBtn" style="display: none; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">ğŸ—‘ï¸ ì´ë¯¸ì§€ ì œê±°</button>
                  <div id="popupImagePreview" style="display: none; max-width: 200px; max-height: 200px; margin-top: 10px;">
                    <img id="popupImagePreviewImg" src="" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  </div>
                </div>
                <input type="hidden" id="popupImageUrl">
              </div>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">íŒì—… ë„ˆë¹„ (px)</label>
                  <input type="number" id="popupWidth" class="request-input" style="min-height: auto;" placeholder="600" value="600" min="300" max="1200">
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">íŒì—… ë†’ì´ (px)</label>
                  <input type="number" id="popupHeight" class="request-input" style="min-height: auto;" placeholder="400" value="400" min="200" max="800">
                </div>
              </div>
              <div style="display: flex; gap: 12px;">
                <button class="save-btn" onclick="savePopup()">ì €ì¥</button>
                <button class="save-btn" onclick="togglePopupForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="popupMessage" style="margin-top: 15px;"></div>
            </div>
          </div>
          
          <!-- íŒì—… ëª©ë¡ -->
          <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h4 style="color: #333; font-size: 16px; font-weight: 600;">ë“±ë¡ëœ íŒì—… ëª©ë¡</h4>
              <button class="refresh-btn" onclick="loadPopups()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‹œì‘ì¼</th>
                  <th>ì¢…ë£Œì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ìƒì„±ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="popupListTableBody">
                <tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- íŒì—… ê´€ë¦¬ íƒ­ ë -->
      
      <!-- í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ -->
      <div id="registerTab" class="tab-content hidden">
        <!-- í™”ì£¼ì‚¬ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ -->
        <div style="margin-bottom: 20px;">
          <button id="addCompanyBtn" class="refresh-btn" onclick="toggleAddCompanyForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• í™”ì£¼ì‚¬ ë“±ë¡</span>
            <span id="addCompanyIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- í™”ì£¼ì‚¬ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addCompanyForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">í™”ì£¼ì‚¬ ë“±ë¡</h3>
            <form id="adminRegisterForm">
              <!-- í•„ìˆ˜ ì •ë³´ -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">í™”ì£¼ì‚¬ëª… *</label>
                  <input type="text" id="adminRegCompanyName" placeholder="í™”ì£¼ì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì•„ì´ë”” *</label>
                  <input type="text" id="adminRegUsername" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="adminRegPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ê¶Œí•œ *</label>
                  <select id="adminRegRole" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                    <option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="í™”ì£¼ì‚¬">í™”ì£¼ì‚¬</option>
                    <option value="ê´€ë¦¬ì">ê´€ë¦¬ì</option>
                  </select>
                </div>
              </div>

              <!-- ì‚¬ì—…ì ì •ë³´ (ì„ íƒ) -->
              <div style="margin-top: 30px; padding-top: 24px; border-top: 2px solid #ffeaa7;">
                <h4 style="margin: 0 0 18px; color: #636e72; font-size: 16px; font-weight: 600;">ì‚¬ì—…ì ì •ë³´ (ì„ íƒì‚¬í•­)</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìë²ˆí˜¸</label>
                    <input type="text" id="adminRegBusinessNumber" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìëª…</label>
                    <input type="text" id="adminRegBusinessName" placeholder="ì‚¬ì—…ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì£¼ì†Œ</label>
                    <input type="text" id="adminRegBusinessAddress" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="adminRegBusinessTel" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì´ë©”ì¼</label>
                    <input type="email" id="adminRegBusinessEmail" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                </div>
              </div>

              <div style="margin-top: 24px; display: flex; gap: 12px;">
                <button type="button" id="adminRegisterBtn" onclick="registerCompany()" style="padding: 14px 32px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);">ë“±ë¡í•˜ê¸°</button>
                <button type="button" onclick="toggleAddCompanyForm()" style="padding: 14px 32px; background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="adminRegisterStatus" class="admin-status" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
        
        <!-- í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸” -->
        <div class="table-container">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0; color: #333; font-size: 18px; display: inline-block; margin-right: 15px;">ë“±ë¡ëœ í™”ì£¼ì‚¬ ëª©ë¡</h3>
              <span id="companiesStatistics" style="color: #666; font-size: 14px;">(ê´€ë¦¬ì: 0, í™”ì£¼ì‚¬: 0)</span>
            </div>
            <button class="refresh-btn" onclick="refreshCompaniesData()" id="refreshCompaniesBtn" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="table-scroll-wrapper">
            <table style="min-width: 1200px;">
            <thead>
              <tr>
                <th>í™”ì£¼ì‚¬ëª…</th>
                <th>ì•„ì´ë””</th>
                <th>ê¶Œí•œ</th>
                <th>íƒœê·¸</th>
                <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                <th>ì‚¬ì—…ìëª…</th>
                <th>ì£¼ì†Œ</th>
                <th>ì „í™”ë²ˆí˜¸</th>
                <th>ì´ë©”ì¼</th>
                <th>ì‚¬ì—…ì ë“±ë¡ì¦</th>
                <th>ìµœê·¼ ë¡œê·¸ì¸</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="companiesTableBody">
              <tr>
                <td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
              </tr>
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ë©”ì‹œì§€ -->
  <div id="message" class="message"></div>
  
  <script>
    // API ê¸°ë³¸ URL (ì„œë²„ ì£¼ì†Œ)
    const API_BASE_URL = window.location.origin; // í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš©
    
    // ì „ì—­ ë³€ìˆ˜
    let currentCompany = '';
    let currentUsername = '';
    let currentRole = '';
    let currentData = [];
    let currentFilter = 'all'; // 'all', 'completed', 'pending'
    
    // ë¡œê·¸ì¸ ë©”ì‹œì§€ í‘œì‹œ
    function showLoginMessage(text, type) {
      const div = document.getElementById('loginMessage');
      if (!div) return;
      
      let bgColor = '#d1ecf1';
      let textColor = '#0c5460';
      
      if (type === 'success') {
        bgColor = '#d4edda';
        textColor = '#155724';
      } else if (type === 'error') {
        bgColor = '#f8d7da';
        textColor = '#721c24';
      }
      
      div.innerHTML = `<div style="padding: 10px 15px; border-radius: 8px; background: ${bgColor}; color: ${textColor}; font-weight: 600;">${text}</div>`;
      
      if (type !== 'loading') {
        setTimeout(() => { div.innerHTML = ''; }, 5000);
      }
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = 'message ' + type;
      messageDiv.style.display = 'block';
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }
    
    // ë¡œê·¸ì¸ í•¨ìˆ˜
    window.doLogin = function doLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');
      
      if (!username || !password) {
        showLoginMessage('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return false;
      }
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = 'ë¡œê·¸ì¸ ì¤‘...';
      showLoginMessage('ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...', 'loading');
      
      // ì„œë²„ API í˜¸ì¶œ
      fetch(`${API_BASE_URL}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      })
      .then(response => response.json())
      .then(result => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        
        if (result.success) {
          currentCompany = result.company;
          currentUsername = result.username;
          currentRole = (result.role || '').toString().trim();
          
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - result:', result); // ë””ë²„ê¹…ìš©
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole, 'ê¸¸ì´:', currentRole.length); // ë””ë²„ê¹…ìš©
          console.log('ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          
          localStorage.setItem('client_company', result.company);
          localStorage.setItem('client_username', result.username);
          localStorage.setItem('client_role', currentRole);
          localStorage.setItem('client_loginTime', new Date().toISOString());
          
          showLoginMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
          setTimeout(() => {
            showDashboard();
            // ë¡œê·¸ì¸ í›„ í™œì„± íŒì—… í™•ì¸
            checkAndShowPopup();
          }, 500);
        } else {
          showLoginMessage('âŒ ' + (result.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        showLoginMessage('âŒ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
      
      return false;
    }
    
    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      localStorage.removeItem('client_company');
      localStorage.removeItem('client_username');
      localStorage.removeItem('client_role');
      localStorage.removeItem('client_loginTime');
      
      currentCompany = '';
      currentUsername = '';
      currentRole = '';
      
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginMessage').innerHTML = '';
    }
    
    // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
    function showDashboard() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'block';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('showDashboard - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const roleText = isAdmin ? ' [ê´€ë¦¬ì]' : '';
      document.getElementById('companyInfo').textContent = `${currentCompany}${roleText} (${currentUsername})`;
      
      // ë©”ë‰´ë°” í‘œì‹œ/ìˆ¨ê¹€ (í™”ì£¼ì‚¬ ëª¨ë“œë§Œ í‘œì‹œ)
      const menuBar = document.getElementById('menuBar');
      if (menuBar) {
        menuBar.style.display = isAdmin ? 'none' : 'flex';
        // í™”ì£¼ì‚¬ ëª¨ë“œì¼ ë•Œ ì €ì¥ëœ ë©”ë‰´ ë³µì› ë˜ëŠ” ê¸°ë³¸ê°’
        if (!isAdmin) {
          const savedMenu = localStorage.getItem('activeConsignorMenu') || 'returns';
          // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ë©”ë‰´ ì „í™˜ (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
          setTimeout(() => {
            switchMenu(savedMenu);
          }, 100);
        }
      }
      
      
      // ë‹¬ë ¥ ì›” ì„ íƒ ì´ˆê¸°í™”
      const calendarMonthSelect = document.getElementById('calendarMonthSelect');
      if (calendarMonthSelect) {
        const today = new Date();
        calendarMonthSelect.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      }
      
      // ê´€ë¦¬ì íƒ­ í‘œì‹œ/ìˆ¨ê¸°ê¸°
      const adminTabs = document.getElementById('adminTabs');
      if (adminTabs) {
        adminTabs.style.display = isAdmin ? 'block' : 'none';
      }
      
      // í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©)
      const registerTabBtn = document.getElementById('registerTabBtn');
      if (registerTabBtn) {
        registerTabBtn.style.display = isAdmin ? 'inline-block' : 'none';
      }
      
      // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë°˜í’ˆ ë‚´ì—­ íƒ­ë§Œ í‘œì‹œ (switchMenuì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°)
      if (!isAdmin) {
        // switchMenu í•¨ìˆ˜ê°€ ëª¨ë“  íƒ­ì„ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬í•¨
      } else {
        // ê´€ë¦¬ìë©´ ì €ì¥ëœ íƒ­ ì •ë³´ í™•ì¸ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ í˜„ì¬ íƒ­ ìœ ì§€)
        const savedTab = localStorage.getItem('activeAdminTab');
        const validTabs = ['returns', 'scheduleCalendar', 'board', 'register'];
        const activeTab = savedTab && validTabs.includes(savedTab) ? savedTab : 'returns';
        console.log('ì €ì¥ëœ íƒ­:', savedTab, 'í™œì„±í™”í•  íƒ­:', activeTab);
        // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  íƒ­ ì „í™˜ (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
        setTimeout(() => {
          switchAdminTab(activeTab);
        }, 100);
      }
      
          // ê´€ë¦¬ì ì ‘ì´ì‹ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¸°ê¸° (í™”ì£¼ì‚¬ëŠ” ë°˜í’ˆ ë“±ë¡ ë¶ˆê°€)
          const addReturnSection = document.getElementById('addReturnSection');
          if (addReturnSection) {
            if (isAdmin) {
              addReturnSection.style.display = 'block';
            } else {
              addReturnSection.style.display = 'none';
              // í¼ë„ ê°•ì œë¡œ ìˆ¨ê¸°ê¸°
              const addReturnForm = document.getElementById('addReturnForm');
              if (addReturnForm) {
                addReturnForm.style.display = 'none';
              }
              const addReturnBtn = document.getElementById('addReturnBtn');
              if (addReturnBtn) {
                addReturnBtn.style.display = 'none';
              }
            }
            console.log('ë°˜í’ˆ ë“±ë¡ ì„¹ì…˜ í‘œì‹œ:', isAdmin, 'ì„¹ì…˜ ìš”ì†Œ:', addReturnSection); // ë””ë²„ê¹…ìš©
          }
          
          // ê´€ë¦¬ì ì „ìš© ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ (ì„œì‹ ë‹¤ìš´ë¡œë“œ, CSV ì—…ë¡œë“œ)
          const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
          const csvUploadLabel = document.querySelector('label[for="csvUploadInput"]');
          if (downloadTemplateBtn) {
            downloadTemplateBtn.style.display = isAdmin ? 'inline-block' : 'none';
          }
          if (csvUploadLabel) {
            csvUploadLabel.style.display = isAdmin ? 'inline-block' : 'none';
          }
          
          const addReturnForm = document.getElementById('addReturnForm');
          if (addReturnForm && !isAdmin) {
            addReturnForm.style.display = 'none';
          }
      
      // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° (ì´ˆê¸°í™” - í…Œì´ë¸” í—¤ë”)
      updateAdminColumns();
      
      // í—¤ë” hover íš¨ê³¼ ì°¨ë‹¨ (í…Œì´ë¸”ì´ ìˆì„ ë•Œ)
      setTimeout(() => {
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 500);
      
      // ì›” ëª©ë¡ ë¡œë“œ
      loadAvailableMonths();
      
      // í™”ì£¼ì‚¬ ëª¨ë“œì¼ ë•Œ ì‚¬ì—…ì ì •ë³´ í™•ì¸ ë° ë°°ë„ˆ í‘œì‹œ
      if (!isAdmin) {
        setTimeout(() => {
          checkAndShowBusinessInfoBanner();
        }, 500);
      }
    }
    
    // ì‚¬ì—…ì ì •ë³´ í™•ì¸ ë° ë°°ë„ˆ í‘œì‹œ
    async function checkAndShowBusinessInfoBanner() {
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          updateBusinessInfoBanner(result.data);
        }
      } catch (error) {
        console.error('ì‚¬ì—…ì ì •ë³´ í™•ì¸ ì˜¤ë¥˜:', error);
      }
    }
    window.checkAndShowBusinessInfoBanner = checkAndShowBusinessInfoBanner;
    
    // ì‚¬ìš© ê°€ëŠ¥í•œ ì›” ëª©ë¡ ë¡œë“œ
    function loadAvailableMonths() {
      fetch(`${API_BASE_URL}/api/auth/months`)
        .then(response => response.json())
        .then(result => {
          const monthSelect = document.getElementById('monthSelect');
          monthSelect.innerHTML = '';
          
          if (result.success && result.months && result.months.length > 0) {
            // ë…„ë„ë³„ë¡œ ê·¸ë£¹í™”
            const monthsByYear = {};
            result.months.forEach(monthStr => {
              try {
                const year = monthStr.split('ë…„')[0];
                if (!monthsByYear[year]) {
                  monthsByYear[year] = [];
                }
                monthsByYear[year].push(monthStr);
              } catch (e) {
                // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê·¸ëƒ¥ ì¶”ê°€
                if (!monthsByYear['ê¸°íƒ€']) {
                  monthsByYear['ê¸°íƒ€'] = [];
                }
                monthsByYear['ê¸°íƒ€'].push(monthStr);
              }
            });
            
            // ë…„ë„ë³„ë¡œ ì •ë ¬ (ìµœì‹  ë…„ë„ê°€ ë¨¼ì €)
            const years = Object.keys(monthsByYear).sort((a, b) => {
              if (a === 'ê¸°íƒ€') return 1;
              if (b === 'ê¸°íƒ€') return -1;
              return parseInt(b) - parseInt(a);
            });
            
            // ì˜µì…˜ ê·¸ë£¹ìœ¼ë¡œ ë…„ë„ë³„ í‘œì‹œ
            years.forEach(year => {
              const optgroup = document.createElement('optgroup');
              optgroup.label = `${year}ë…„`;
              monthsByYear[year].forEach(monthStr => {
                const option = document.createElement('option');
                option.value = monthStr;
                option.textContent = monthStr;
                optgroup.appendChild(option);
              });
              monthSelect.appendChild(optgroup);
            });
            
            // í˜„ì¬ ì›” ì„ íƒ (ê¸°ë³¸ê°’)
            const currentMonth = result.current_month || '';
            if (currentMonth) {
              monthSelect.value = currentMonth;
            } else if (result.months.length > 0) {
              monthSelect.value = result.months[0];
            }
            
            // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë°ì´í„° ë¡œë“œ
            const returnsTab = document.getElementById('returnsTab');
            if (returnsTab && !returnsTab.classList.contains('hidden') && returnsTab.style.display !== 'none') {
              loadData();
            }
          } else {
            // í˜„ì¬ ì›” ì¶”ê°€ (ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
            const option = document.createElement('option');
            option.value = currentMonth;
            option.textContent = currentMonth;
            monthSelect.appendChild(option);
            monthSelect.value = currentMonth;
          }
        })
        .catch(error => {
          console.error('ì›” ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          // ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì •
          const monthSelect = document.getElementById('monthSelect');
          const today = new Date();
          const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
          monthSelect.innerHTML = `<option value="${currentMonth}">${currentMonth}</option>`;
          monthSelect.value = currentMonth;
          showMessage('âš ï¸ ì›” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ í˜„ì¬ ì›”ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      
      // ì›” ë³€ê²½ ì´ë²¤íŠ¸
      const monthSelect = document.getElementById('monthSelect');
      if (monthSelect) {
        monthSelect.onchange = function() {
          // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë¡œë“œ
          refreshReturnsData();
        };
      }
    }
    
    /* ========== ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨ ========== */
    function refreshReturnsData() {
      console.log('ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨');
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && !returnsTab.classList.contains('hidden') && returnsTab.style.display !== 'none') {
        loadData();
      } else {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      }
    }
    window.refreshReturnsData = refreshReturnsData;
    
    /* ========== CSV íŒŒì¼ ì—…ë¡œë“œ ========== */
    function handleCsvUpload(event) {
      const file = event.target.files[0];
      if (!file) {
        return;
      }
      
      if (!file.name.endsWith('.csv')) {
        showMessage('âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
        event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
        return;
      }
      
      // íŒŒì¼ëª…ì—ì„œ ì›” ì¶”ì¶œ ì‹œë„
      let month = '';
      const filenameWithoutExt = file.name.replace('.csv', '').trim();
      if (filenameWithoutExt.includes('ë…„') && filenameWithoutExt.includes('ì›”')) {
        month = filenameWithoutExt;
      } else {
        // í˜„ì¬ ì„ íƒëœ ì›” ì‚¬ìš©
        const monthSelect = document.getElementById('monthSelect');
        if (monthSelect && monthSelect.value) {
          month = monthSelect.value;
        }
      }
      
      // ì›”ì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ì…ë ¥ ìš”ì²­
      if (!month) {
        const userMonth = prompt('ì›” ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 2025ë…„11ì›”)');
        if (!userMonth) {
          event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
          return;
        }
        month = userMonth;
      }
      
      // FormData ìƒì„±
      const formData = new FormData();
      formData.append('file', file);
      formData.append('month', month);
      formData.append('force', 'false');
      
      // ì—…ë¡œë“œ ì‹œì‘ ë©”ì‹œì§€
      showMessage('ğŸ“¤ CSV íŒŒì¼ ì—…ë¡œë“œ ì¤‘...', 'info');
      
      // API í˜¸ì¶œ
      fetch('/api/returns/upload-csv', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage(`âœ… ${data.message}`, 'success');
          // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
          event.target.value = '';
          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
          setTimeout(() => {
            refreshReturnsData();
          }, 500);
        } else {
          showMessage(`âŒ ${data.message}`, 'error');
          event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
        }
      })
      .catch(error => {
        console.error('CSV ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        showMessage(`âŒ CSV ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
        event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
      });
    }
    
    window.handleCsvUpload = handleCsvUpload;
    
    /* ========== CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ========== */
    function downloadCsvTemplate() {
      console.log('CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì‹œì‘');
      // ì„œë²„ì—ì„œ UTF-8 BOM ì¸ì½”ë”©ìœ¼ë¡œ CSV ìƒì„±í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
      fetch('/api/returns/download-template')
        .then(response => {
          console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
          if (!response.ok) {
            return response.text().then(text => {
              console.error('ì„œë²„ ì˜¤ë¥˜ ì‘ë‹µ:', text);
              throw new Error(`ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
            });
          }
          return response.blob();
        })
        .then(blob => {
          console.log('Blob ìƒì„± ì™„ë£Œ, í¬ê¸°:', blob.size, 'íƒ€ì…:', blob.type);
          if (blob.size === 0) {
            throw new Error('ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
          }
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = 'ë°˜í’ˆë‚´ì—­_ì„œì‹.csv';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);
          showMessage('âœ… CSV ì„œì‹ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤. (Excelì—ì„œ í•œê¸€ ì •ìƒ í‘œì‹œ)', 'success');
        })
        .catch(error => {
          console.error('CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage(`âŒ CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
        });
    }
    
    window.downloadCsvTemplate = downloadCsvTemplate;
    
    /* ========== ì„œì‹ ë‹¤ìš´ë¡œë“œ íˆ´íŒ ========== */
    window.showDownloadTooltip = function showDownloadTooltip(event) {
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      hideDownloadTooltip();
      
      const tooltip = document.createElement('div');
      tooltip.id = 'downloadTooltip';
      tooltip.className = 'download-tooltip';
      tooltip.innerHTML = `
        <strong>ğŸ“¥ CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì‚¬ìš© ë°©ë²•</strong>
        <ul>
          <li>1. ë²„íŠ¼ í´ë¦­í•˜ì—¬ ì„œì‹ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</li>
          <li>2. Excelì—ì„œ íŒŒì¼ ì—´ê¸° (í•œê¸€ ì •ìƒ í‘œì‹œ)</li>
          <li>3. <strong>ì†¡ì¥ë²ˆí˜¸ ì»¬ëŸ¼ ì„ íƒ</strong> â†’ ì…€ ì„œì‹ â†’ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½</li>
          <li>4. ì˜ˆì‹œ ë°ì´í„° ì°¸ê³ í•˜ì—¬ ë°˜í’ˆ ë‚´ì—­ ì…ë ¥</li>
          <li>5. íŒŒì¼ëª…ì— ì›” ì •ë³´ í¬í•¨ (ì˜ˆ: 2025ë…„11ì›”.csv)</li>
          <li>6. CSV ì—…ë¡œë“œ ë²„íŠ¼ìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ</li>
        </ul>
        <div style="margin-top: 8px; font-size: 12px; color: #b2bec3;">
          ğŸ’¡ í•„ìˆ˜ ì»¬ëŸ¼: ê³ ê°ëª…, ì†¡ì¥ë²ˆí˜¸<br>
          ğŸ’¡ ì†¡ì¥ë²ˆí˜¸ ì»¬ëŸ¼ì„ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ê³¼í•™ì  í‘œê¸°ë²• ë°©ì§€
        </div>
      `;
      document.body.appendChild(tooltip);
      
      // íˆ´íŒ ìœ„ì¹˜ ì„¤ì • (ë§ˆìš°ìŠ¤ ë°”ë¡œ ì•„ë˜)
      updateDownloadTooltipPosition(event, tooltip);
    };
    
    function updateDownloadTooltipPosition(event, tooltip) {
      if (!tooltip) return;
      
      const x = event.clientX;
      const y = event.clientY + 15; // ë§ˆìš°ìŠ¤ ë°”ë¡œ ì•„ë˜
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 0) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 0) {
          tooltip.style.top = '15px';
        }
      }, 0);
    }
    
    window.hideDownloadTooltip = function hideDownloadTooltip() {
      const tooltip = document.getElementById('downloadTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    };
    
    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    document.addEventListener('mousemove', function(event) {
      const tooltip = document.getElementById('downloadTooltip');
      if (tooltip) {
        updateDownloadTooltipPosition(event, tooltip);
      }
    });
    
    // ë°ì´í„° ë¡œë“œ
    function loadData() {
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && (returnsTab.classList.contains('hidden') || returnsTab.style.display === 'none')) {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ë°ì´í„° ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!selectedMonth) {
        return;
      }
      
      showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'success');
      
      // í™”ì£¼ì‚¬ì¸ ê²½ìš° ìì‹ ì˜ company_nameìœ¼ë¡œ í•„í„°ë§
      // ê´€ë¦¬ìì¸ ê²½ìš° ë¹ˆ ë¬¸ìì—´ë¡œ ëª¨ë“  ë°ì´í„° ì¡°íšŒ
      const companyFilter = (currentRole === 'ê´€ë¦¬ì') ? '' : currentCompany;
      
      console.log('ë°ì´í„° ë¡œë“œ - company:', companyFilter, 'month:', selectedMonth, 'role:', currentRole);
      
      // username íŒŒë¼ë¯¸í„° ì¶”ê°€ (í™”ì£¼ì‚¬ì¸ ê²½ìš°)
      const usernameParam = currentUsername ? `&username=${encodeURIComponent(currentUsername)}` : '';
      const url = `${API_BASE_URL}/api/returns/data?company=${encodeURIComponent(companyFilter)}&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}${usernameParam}`;
      
      console.log('API URL:', url);
      
      fetch(url)
        .then(response => response.json())
        .then(result => {
          // ì‚¬ì—…ì ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° í° íŒì—… í‘œì‹œ
          if (result.requires_business_info) {
            showBusinessInfoRequiredModal();
            const isAdmin = ((currentRole || '').toString().trim() === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ì‚¬ì—…ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</td></tr>`;
            return;
          }
          
          if (result.success) {
            currentData = result.data || [];
            // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
            updateStats(currentData);
            // í•„í„° ì ìš© (í˜„ì¬ ì„ íƒëœ í•„í„°ì— ë”°ë¼)
            applyFilter();
            showMessage(`âœ… ${result.count}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
          } else {
            showMessage('âŒ ' + (result.message || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'), 'error');
            const isAdmin = ((currentRole || '').toString().trim() === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            setTimeout(() => {
              updateAdminColumns();
              // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
              if (typeof disableHeaderHover === 'function') {
                disableHeaderHover();
              }
            }, 150);
          }
        })
        .catch(error => {
          console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('renderTable - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const colspan = isAdmin ? 13 : 9;
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${colspan}" class="no-data">ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        // ë¹ˆ ë°ì´í„°ì¼ ë•Œë„ ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
        updateAdminColumns();
        return;
      }
      
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        const isCompleted = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
        const isConfirmed = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] && row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'].toString().trim();
        const memoText = row['ë¹„ê³ '] || '';
        
        // ì‚¬ì§„ ë§í¬ ì²˜ë¦¬
        let photoHtml = '-';
        if (row['ì‚¬ì§„']) {
          // ë°°ì—´ì¸ ê²½ìš°
          if (Array.isArray(row['ì‚¬ì§„']) && row['ì‚¬ì§„'].length > 0) {
            photoHtml = '<div class="photo-links">';
            row['ì‚¬ì§„'].forEach(photo => {
              if (photo && typeof photo === 'object') {
                // URLì´ ìˆìœ¼ë©´ ë§í¬ë¡œ í‘œì‹œ
                if (photo.url) {
                  photoHtml += `<a href="${photo.url}" target="_blank" class="photo-link">${photo.text || 'ì‚¬ì§„'}</a>`;
                } else if (photo.text) {
                  // URLì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ
                  photoHtml += `<span class="photo-link" style="cursor: default; text-decoration: none;">${photo.text}</span>`;
                }
              }
            });
            photoHtml += '</div>';
          }
          // ë¬¸ìì—´ì¸ ê²½ìš° (ì§ì ‘ í…ìŠ¤íŠ¸)
          else if (typeof row['ì‚¬ì§„'] === 'string' && row['ì‚¬ì§„'].trim()) {
            photoHtml = '<div class="photo-links">';
            photoHtml += `<span class="photo-link" style="cursor: default; text-decoration: none;">${row['ì‚¬ì§„']}</span>`;
            photoHtml += '</div>';
          }
        }
        
        // ìš”ì²­ì‚¬í•­ ì²˜ë¦¬
        const requestValue = row['í™”ì£¼ì‚¬ìš”ì²­'] || '';
        let requestHtml = '';
        
        if (isAdmin) {
          // ê´€ë¦¬ì: ì½ê¸° ì „ìš©
          if (requestValue) {
            requestHtml = `<textarea class="request-input" readonly>${requestValue}</textarea>`;
          } else {
            requestHtml = '<div style="color: #999; text-align: center; padding: 20px;">ìš”ì²­ì‚¬í•­ ì—†ìŒ</div>';
          }
        } else {
          // í™”ì£¼ì‚¬: ì…ë ¥ ë° ì €ì¥ ê°€ëŠ¥ (ì €ì¥ í›„ì—ë„ ìˆ˜ì • ê°€ëŠ¥)
          // ì €ì¥ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ "ìˆ˜ì •" ë²„íŠ¼, ì—†ìœ¼ë©´ "ì €ì¥" ë²„íŠ¼
          const buttonText = requestValue ? 'ìˆ˜ì •' : 'ì €ì¥';
          const buttonClass = requestValue ? 'save-btn edit-btn' : 'save-btn';
          requestHtml = `
            <textarea class="request-input" id="request_${index}" placeholder="ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”">${escapeHtml(requestValue)}</textarea>
            <button class="${buttonClass}" onclick="saveRequest(${index}, ${row.rowIndex})">${buttonText}</button>
          `;
        }
        
        // ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ (ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ)
        let statusHtml = '';
        const confirmedText = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] || '';
        let completedName = row['ì²˜ë¦¬ì™„ë£Œ'] || '';
        
        // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ì—ì„œ ì´ë¦„ë§Œ ì¶”ì¶œ
        if (completedName) {
          // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ ì²˜ë¦¬
          if (completedName.includes('(') && completedName.includes(')')) {
            const match = completedName.match(/\(([^)]+)\)/);
            if (match && match[1]) {
              completedName = match[1].trim();
            }
          }
          // "ì™„ë£Œ ì´ë¦„" í˜•ì‹ ì²˜ë¦¬ (ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬)
          else if (completedName.includes('ì™„ë£Œ')) {
            completedName = completedName.replace(/ì™„ë£Œ\s*/g, '').trim();
          }
        }
        
        if (isCompleted && completedName) {
          // ì²˜ë¦¬ì™„ë£Œì¼ ë•Œ ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ í‘œì‹œ
          statusHtml = `<span class="status-completed-circle">${escapeHtml(completedName)}</span>`;
        } else if (isConfirmed || confirmedText) {
          // í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œê°€ ìˆìœ¼ë©´ ê´€ë¦¬ì ì´ë¦„ í‘œì‹œ
          statusHtml = `<span class="status-badge" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; border-radius: 12px; padding: 3px 8px; font-size: 10px;">â³ ${escapeHtml(confirmedText) || 'ìš”ì²­ì™„ë£Œ'}</span>`;
        } else {
          statusHtml = '<span class="status-badge status-pending">â³ ëŒ€ê¸°ì¤‘</span>';
        }
        
        // ê´€ë¦¬ì ì „ìš© ì…€ (í•­ìƒ ìƒì„±, updateAdminColumnsì—ì„œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´)
        const companyCell = `<td class="admin-only">${row['í™”ì£¼ëª…'] || ''}</td>`;
        const memoTextSafe = escapeHtml(memoText || '').replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
        const memoCell = `
          <td class="admin-only" style="text-align: center; min-width: 80px;">
            <button class="save-btn" onclick="editMemo(${index}, ${row.rowIndex}, '${memoTextSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">
              ${memoText ? 'ğŸ“ ë¹„ê³ ' : 'ğŸ“ ì¶”ê°€'}
            </button>
          </td>
        `;
        const trackingNumber = row['ì†¡ì¥ë²ˆí˜¸'] ? row['ì†¡ì¥ë²ˆí˜¸'].toString().trim() : '';
        const trackingNumberSafe = escapeHtml(trackingNumber).replace(/'/g, "\\'").replace(/"/g, '&quot;');
        const qrCell = `
          <td class="admin-only" style="text-align: center; min-width: 70px;">
            ${trackingNumber ? 
              `<button class="save-btn" onclick="showQRCode('${trackingNumberSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">ğŸ“± QR</button>` :
              '<span style="color: #b2bec3; font-size: 10px;">ë¯¸ìƒì„±</span>'}
          </td>
        `;
        
        // ê´€ë¦¬ ì…€ (ì‚­ì œ ë²„íŠ¼ì„ ì˜†ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ì‹¤ìˆ˜ í´ë¦­ ë°©ì§€)
        const hasCompleted = isCompleted && completedName;
        const manageCell = `
          <td class="admin-only" style="text-align: center; min-width: 140px;">
            <div style="display: flex; flex-direction: row; gap: 4px; align-items: center; justify-content: center;">
              ${hasCompleted ? 
                `<span style="color: #00b894; font-size: 11px; font-weight: 600; flex: 1; text-align: center;">ì™„ë£Œ</span>` : 
                `<button class="save-btn" onclick="completeReturn(${index}, ${row.rowIndex})" style="background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%); color: white; border: none; padding: 3px 8px; font-size: 10px; flex: 1; border-radius: 4px; box-shadow: none;">ì²˜ë¦¬ì™„ë£Œ</button>`}
              <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) deleteReturn(${index}, ${row.rowIndex})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 3px 6px; font-size: 9px; min-width: 28px; border-radius: 4px; box-shadow: none;" title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
          </td>
        `;
        
        // ìƒí’ˆëª… ì…€ì— ë¹„ê³  íˆ´íŒ ì¶”ê°€ (ë¹„ê³ ê°€ ìˆì„ ë•Œë§Œ, ë¹¨ê°„ìƒ‰ ë‘ê»ê²Œ)
        const productName = escapeHtml(row['ì œí’ˆ'] || '');
        const hasMemo = memoText && memoText.trim() !== '';
        const productCellClass = hasMemo ? 'product-cell has-memo' : 'product-cell';
        const productCellAttributes = hasMemo 
          ? `class="${productCellClass}" style="text-align: center; position: relative; cursor: help;" 
             data-memo="${escapeHtml(memoText || '')}" 
             title="${escapeHtml(memoText || '')}"
             onmouseenter="showMemoTooltip(event, '${memoTextSafe.replace(/'/g, "\\'")}')" 
             onmouseleave="hideMemoTooltip()"`
          : `class="${productCellClass}" style="text-align: center;"`;
        const productCell = `
          <td ${productCellAttributes}>
            ${productName}
          </td>
        `;
        
        tr.innerHTML = `
          <td>${row['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || ''}</td>
          ${companyCell}
          ${productCell}
          <td>${row['ê³ ê°ëª…'] || ''}</td>
          <td>${row['ì†¡ì¥ë²ˆí˜¸'] || ''}</td>
          <td>${row['ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡'] || ''}</td>
          <td>${row['ì¬ê³ ìƒíƒœ'] || ''}</td>
          <td>${statusHtml}</td>
          <td>${photoHtml}</td>
          ${memoCell}
          <td style="min-width: 250px;">${requestHtml}</td>
          ${qrCell}
          ${manageCell}
        `;
        
        tbody.appendChild(tr);
      });
      
      // í…Œì´ë¸” ë Œë”ë§ í›„ ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸
      // DOM ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
      setTimeout(() => {
        if (typeof updateAdminColumns === 'function') {
          updateAdminColumns();
        }
        // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    window.updateAdminColumns = function updateAdminColumns() {
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('=== updateAdminColumns í˜¸ì¶œ ===');
      console.log('currentRole:', JSON.stringify(currentRole));
      console.log('roleNormalized:', JSON.stringify(roleNormalized));
      console.log('isAdmin:', isAdmin);
      
      // í…Œì´ë¸” í—¤ë”ì™€ ë³¸ë¬¸ì˜ ëª¨ë“  admin-only ìš”ì†Œ ì°¾ê¸°
      const adminElements = document.querySelectorAll('.admin-only');
      console.log('ê´€ë¦¬ì ìš”ì†Œ ê°œìˆ˜:', adminElements.length);
      
      if (adminElements.length === 0) {
        console.warn('âš ï¸ admin-only ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! í…Œì´ë¸”ì´ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        // í…Œì´ë¸”ì´ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
        setTimeout(() => {
          console.log('ì¬ì‹œë„: updateAdminColumns');
          updateAdminColumns();
        }, 300);
        return;
      }
      
      const displayValue = isAdmin ? 'table-cell' : 'none';
      let updatedCount = 0;
      
      adminElements.forEach((cell, index) => {
        cell.style.display = displayValue;
        updatedCount++;
        if (index < 15) { // ì²˜ìŒ 15ê°œë§Œ ìƒì„¸ ë¡œê·¸
          const text = (cell.textContent || cell.innerText || cell.innerHTML || '').substring(0, 40).replace(/\s+/g, ' ');
          console.log(`ìš”ì†Œ ${index}:`, cell.tagName, text, 'â†’ display:', displayValue);
        }
      });
      
      console.log(`âœ… ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸ ì™„ë£Œ - ${updatedCount}ê°œ ìš”ì†Œ, í‘œì‹œ: ${isAdmin}`);
      console.log('=== updateAdminColumns ì™„ë£Œ ===');
    };
    
    // í•„í„°ë§ í•¨ìˆ˜
    function filterByStatus(status) {
      currentFilter = status;
      
      // í™œì„±í™”ëœ í•„í„° í‘œì‹œ
      document.querySelectorAll('.stat-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (status === 'all') {
        document.getElementById('filterAll').classList.add('active');
      } else if (status === 'completed') {
        document.getElementById('filterCompleted').classList.add('active');
      } else if (status === 'pending') {
        document.getElementById('filterPending').classList.add('active');
      }
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      applyFilter();
    }
    
    // í•„í„° ì ìš© í•¨ìˆ˜
    function applyFilter() {
      if (!currentData || currentData.length === 0) {
        return;
      }
      
      let filteredData = [];
      
      if (currentFilter === 'all') {
        filteredData = [...currentData];
      } else if (currentFilter === 'completed') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return completed && completed.length > 0;
        });
      } else if (currentFilter === 'pending') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return !completed || completed.length === 0;
        });
      }
      
      // ë‚ ì§œ ìµœì‹ ìˆœ ì •ë ¬ (ì¼ì ê¸°ì¤€, ë‚´ë¦¼ì°¨ìˆœ)
      filteredData.sort((a, b) => {
        const dateA = a['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        const dateB = b['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        
        // ì¼ì ìˆ«ì ì¶”ì¶œ
        const getDayNumber = (dateStr) => {
          if (!dateStr) return 0;
          const str = dateStr.toString().trim();
          if (str.includes('-')) {
            const parts = str.split('-');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.includes('/')) {
            const parts = str.split('/');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.match(/^\d+$/)) {
            return parseInt(str) || 0;
          }
          return 0;
        };
        
        const dayA = getDayNumber(dateA);
        const dayB = getDayNumber(dateB);
        
        // ì¼ìê°€ ê°™ìœ¼ë©´ IDë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
        if (dayA === dayB) {
          return (b.id || b.rowIndex || 0) - (a.id || a.rowIndex || 0);
        }
        
        // ì¼ì ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)
        return dayB - dayA;
      });
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë Œë”ë§
      renderTable(filteredData);
      
      // ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
      setTimeout(() => {
        updateAdminColumns();
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
    window.filterByStatus = filterByStatus;
    
    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats(data) {
      const total = data.length;
      const completed = data.filter(row => row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim()).length;
      const pending = total - completed;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('pendingCount').textContent = pending;
    }
    
    // ìš”ì²­ì‚¬í•­ ì €ì¥
    function saveRequest(dataIndex, rowIndex) {
      const requestText = document.getElementById(`request_${dataIndex}`).value.trim();
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!requestText) {
        alert('ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì €ì¥ ë°©ì§€)
      const textarea = document.getElementById(`request_${dataIndex}`);
      const saveButton = textarea ? textarea.nextElementSibling : null;
      if (saveButton && saveButton.tagName === 'BUTTON') {
        saveButton.disabled = true;
        saveButton.textContent = 'ì €ì¥ ì¤‘...';
      }
      
      fetch(`${API_BASE_URL}/api/returns/save-request`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: rowIndex,
          month: selectedMonth,
          requestText: requestText
        })
      })
      .then(response => response.json())
      .then(result => {
        // ì €ì¥ ë²„íŠ¼ ì°¾ê¸° (textarea ë‹¤ìŒ ìš”ì†Œ)
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        
        if (result.success) {
          // ì›ë³¸ ë°ì´í„°ì—ì„œ í•´ë‹¹ í•­ëª© ì°¾ê¸° (rowIndex ê¸°ì¤€)
          const dataItem = currentData.find(item => 
            item.rowIndex === rowIndex || item.id === rowIndex
          );
          
          if (dataItem) {
            dataItem['í™”ì£¼ì‚¬ìš”ì²­'] = requestText;
          }
          
          // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
          updateStats(currentData);
          // í•„í„° ì¬ì ìš© (í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€, ë²„íŠ¼ ìƒíƒœë„ ìœ ì§€ë¨)
          applyFilter();
        } else {
          // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
          if (saveBtn && saveBtn.tagName === 'BUTTON') {
            saveBtn.disabled = false;
            const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
            if (currentText) {
              saveBtn.textContent = 'ìˆ˜ì •';
              saveBtn.classList.add('edit-btn');
            } else {
              saveBtn.textContent = 'ì €ì¥';
              saveBtn.classList.remove('edit-btn');
            }
          }
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        if (saveBtn && saveBtn.tagName === 'BUTTON') {
          saveBtn.disabled = false;
          const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
          if (currentText) {
            saveBtn.textContent = 'ìˆ˜ì •';
            saveBtn.classList.add('edit-btn');
          } else {
            saveBtn.textContent = 'ì €ì¥';
            saveBtn.classList.remove('edit-btn');
          }
        }
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    
    // ì²˜ë¦¬ì™„ë£Œ í‘œì‹œ (ê´€ë¦¬ì)
    window.completeReturn = function completeReturn(dataIndex, rowIndex) {
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì²˜ë¦¬ì™„ë£Œë¡œ í‘œì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      const managerName = currentCompany; // í™”ì£¼ëª… ì‚¬ìš©
      
      fetch(`${API_BASE_URL}/api/returns/mark-completed`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: rowIndex,
          month: selectedMonth,
          managerName: managerName
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ' + result.message, 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì²˜ë¦¬ì™„ë£Œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // QR ì½”ë“œ í‘œì‹œ
    window.showQRCode = function showQRCode(trackingNumber) {
      if (!trackingNumber) {
        alert('ì†¡ì¥ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(trackingNumber)}`;
      const modal = document.createElement('div');
      modal.id = 'qrModal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
      modal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
          <h3 style="margin-bottom: 20px;">ğŸ“± QR ì½”ë“œ</h3>
          <img src="${qrUrl}" alt="QR Code" style="margin: 20px 0; max-width: 100%; border: 2px solid #e0e0e0; padding: 10px; border-radius: 8px;">
          <p style="margin: 15px 0; font-size: 14px; color: #666;">ì†¡ì¥ë²ˆí˜¸: <strong>${trackingNumber}</strong></p>
          <button onclick="document.getElementById('qrModal').remove()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹«ê¸°</button>
        </div>
      `;
      document.body.appendChild(modal);
    };
    
    // ë¹„ê³  ìˆ˜ì •
    window.editMemo = function editMemo(dataIndex, returnId, currentMemo) {
      const memoText = prompt('ë¹„ê³ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', currentMemo || '');
      if (memoText === null) return; // ì·¨ì†Œ
      
      fetch(`${API_BASE_URL}/api/returns/update-memo`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId,
          memo: memoText
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë¹„ê³ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ê³  ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë°˜í’ˆ ì‚­ì œ
    window.deleteReturn = function deleteReturn(dataIndex, returnId) {
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      fetch(`${API_BASE_URL}/api/returns/delete`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ê±´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë¹„ê³  íˆ´íŒ í‘œì‹œ
    window.showMemoTooltip = function showMemoTooltip(event, memoText) {
      if (!memoText || memoText.trim() === '' || memoText === 'undefined') {
        return; // ë¹„ê³ ê°€ ì—†ìœ¼ë©´ íˆ´íŒ í‘œì‹œ ì•ˆ í•¨
      }
      
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      hideMemoTooltip();
      
      // íˆ´íŒ ìƒì„±
      const tooltip = document.createElement('div');
      tooltip.id = 'memoTooltip';
      tooltip.className = 'memo-tooltip';
      tooltip.textContent = memoText.replace(/\\n/g, '\n');
      document.body.appendChild(tooltip);
      
      // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì— íˆ´íŒ í‘œì‹œ
      updateTooltipPosition(event, tooltip);
    };
    
    // ë¹„ê³  íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ë§ˆìš°ìŠ¤ ë”°ë¼ë‹¤ë‹ˆê¸°)
    function updateTooltipPosition(event, tooltip) {
      if (!tooltip) return;
      
      const x = event.clientX + 15;
      const y = event.clientY + 15;
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // ì•½ê°„ì˜ ì§€ì—° í›„ í™”ë©´ ë°– ì²´í¬ (ë Œë”ë§ ì™„ë£Œ í›„)
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth - 10) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight - 10) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 10) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 10) {
          tooltip.style.top = '15px';
        }
      }, 10);
    }
    
    // ë¹„ê³  íˆ´íŒ ìˆ¨ê¸°ê¸°
    window.hideMemoTooltip = function hideMemoTooltip() {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    };
    
    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    document.addEventListener('mousemove', function(event) {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        updateTooltipPosition(event, tooltip);
      }
    });
    
    // ë°˜í’ˆ ë“±ë¡ í¼ í† ê¸€ (ì ‘ì´ì‹)
    function toggleAddForm() {
      const form = document.getElementById('addReturnForm');
      const icon = document.getElementById('addReturnIcon');
      const btn = document.getElementById('addReturnBtn');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        icon.textContent = 'â–²';
        btn.style.borderRadius = '12px 12px 0 0';
        // ì˜¤ëŠ˜ ì¼ìë¡œ ê¸°ë³¸ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
        // í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì • (ì›” ì„ íƒì´ ì—†ìœ¼ë©´ í˜„ì¬ ì›”ë¡œ ì„¤ì •)
        const monthSelect = document.getElementById('monthSelect');
        if (!monthSelect.value) {
          const now = new Date();
          const currentMonth = `${now.getFullYear()}ë…„${now.getMonth() + 1}ì›”`;
          monthSelect.value = currentMonth;
        }
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¼';
        btn.style.borderRadius = '12px';
        // í¼ ì´ˆê¸°í™”
        document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
          if (el.id !== 'newReturnDate') el.value = '';
        });
        // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
      }
    }
    window.toggleAddForm = toggleAddForm;
    
    // ë°˜í’ˆ ë“±ë¡ (ê´€ë¦¬ì ì „ìš©)
    function addReturn() {
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      const isAdmin = (currentRole === 'ê´€ë¦¬ì');
      if (!isAdmin) {
        alert('ë°˜í’ˆ ë“±ë¡ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      if (!selectedMonth) {
        alert('ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì¼ìë§Œ ì…ë ¥ë°›ìŒ (1-31)
      const dayInput = document.getElementById('newReturnDate').value.trim();
      const day = parseInt(dayInput);
      if (!dayInput || isNaN(day) || day < 1 || day > 31) {
        alert('ì¼ìë¥¼ 1-31 ì‚¬ì´ì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const companyName = document.getElementById('newCompanyName').value.trim();
      const product = document.getElementById('newProduct').value.trim();
      const customerName = document.getElementById('newCustomerName').value.trim();
      const trackingNumber = document.getElementById('newTrackingNumber').value.trim();
      
      if (!customerName || !trackingNumber) {
        alert('ê³ ê°ëª…ê³¼ ì†¡ì¥ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }
      
      if (!companyName) {
        alert('í™”ì£¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }
      
      // ì¼ìë§Œ ì €ì¥ (ë¬¸ìì—´ë¡œ ì €ì¥í•˜ì—¬ ì •ë ¬ì´ ì˜ ë˜ë„ë¡)
      const returnData = {
        return_date: String(day),  // ì¼ìë§Œ ì €ì¥
        company_name: companyName,
        product: product,
        customer_name: customerName,
        tracking_number: trackingNumber,
        return_type: document.getElementById('newReturnType').value,
        stock_status: document.getElementById('newStockStatus').value,
        inspection: '',  // ê²€í’ˆìœ ë¬´ ì œê±°
        completed: '',
        memo: document.getElementById('newMemo').value.trim(),
        photo_links: '',
        other_courier: '',  // ë‹¤ë¥¸ì™¸ë¶€íƒë°°ì‚¬ ì œê±°
        shipping_fee: '',  // ë°°ì†¡ë¹„ ì œê±°
        client_request: '',
        client_confirmed: '',
        month: selectedMonth
      };
      
      fetch(`${API_BASE_URL}/api/returns/create`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(returnData)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ë‚´ì—­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          // í¼ ì ‘ê¸° ë° ì´ˆê¸°í™”
          const form = document.getElementById('addReturnForm');
          const icon = document.getElementById('addReturnIcon');
          const btn = document.getElementById('addReturnBtn');
          if (form && icon && btn) {
            form.style.display = 'none';
            icon.textContent = 'â–¼';
            btn.style.borderRadius = '12px';
            // í¼ ì´ˆê¸°í™”
            document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
              if (el.id !== 'newReturnDate') el.value = '';
            });
            // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
            const today = new Date().getDate();
            document.getElementById('newReturnDate').value = today;
          }
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ë“±ë¡ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.addReturn = addReturn;
    
    // ë©”ë‰´ ì „í™˜ í•¨ìˆ˜
    function switchMenu(menuName) {
      // ëª¨ë“  ë©”ë‰´ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        item.classList.remove('active');
      });
      
      // ì„ íƒëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
      const selectedMenu = document.getElementById(menuName + 'MenuBtn');
      if (selectedMenu) {
        selectedMenu.classList.add('active');
      }
      
      // ë©”ë‰´ë³„ ì½˜í…ì¸  í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬
      if (menuName === 'companyInfo') {
        // í™”ì£¼ì‚¬ ì •ë³´ ë©”ë‰´
        document.getElementById('returnsTab').classList.add('hidden');
        document.getElementById('scheduleTab').classList.add('hidden');
        document.getElementById('boardCategoryTab').classList.add('hidden');
        document.getElementById('companyInfoTab').classList.remove('hidden');
        // í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
        loadCompanyInfo();
      } else if (menuName === 'returns') {
        document.getElementById('companyInfoTab').classList.add('hidden');
        document.getElementById('returnsTab').classList.remove('hidden');
        document.getElementById('scheduleTab').classList.add('hidden');
        document.getElementById('boardCategoryTab').classList.add('hidden');
      } else if (menuName === 'schedule') {
        document.getElementById('companyInfoTab').classList.add('hidden');
        document.getElementById('returnsTab').classList.add('hidden');
        document.getElementById('scheduleTab').classList.remove('hidden');
        document.getElementById('boardCategoryTab').classList.add('hidden');
        // ìŠ¤ì¼€ì¥´ ëª©ë¡ ë¡œë“œ
        refreshSchedules();
      } else if (menuName === 'board') {
        // ê²Œì‹œíŒ ë©”ë‰´
        document.getElementById('companyInfoTab').classList.add('hidden');
        document.getElementById('returnsTab').classList.add('hidden');
        document.getElementById('scheduleTab').classList.add('hidden');
        document.getElementById('boardCategoryTab').classList.remove('hidden');
        // ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ë° ê²Œì‹œê¸€ ë¡œë“œ
        loadBoardCategoriesForSelect();
        // ì „ì²´ ì¹´í…Œê³ ë¦¬ ì„ íƒ ë° ê²Œì‹œê¸€ ë¡œë“œ
        setTimeout(() => {
          selectBoardCategory('');
        }, 100);
      }
      
      // í˜„ì¬ í™œì„± ë©”ë‰´ë¥¼ localStorageì— ì €ì¥ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ ë³µì›ìš©)
      localStorage.setItem('activeConsignorMenu', menuName);
      
      console.log('ë©”ë‰´ ì „í™˜:', menuName);
    }
    window.switchMenu = switchMenu;
    
    // ========== íŒë§¤ ìŠ¤ì¼€ì¥´ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleScheduleForm() {
      const form = document.getElementById('scheduleForm');
      const icon = document.getElementById('addScheduleIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none';
        form.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
      }
    }
    window.toggleScheduleForm = toggleScheduleForm;
    
    // ìŠ¤ì¼€ì¥´ ì €ì¥
    async function saveSchedule() {
      const title = document.getElementById('scheduleTitle').value.trim();
      const startDate = document.getElementById('scheduleStartDate').value;
      const endDate = document.getElementById('scheduleEndDate').value;
      const eventDescription = document.getElementById('scheduleEventDescription').value.trim();
      const requestNote = document.getElementById('scheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('scheduleMessage');
      
      if (!title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/schedules/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: currentCompany,
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetScheduleForm();
          refreshSchedules();
          // í¼ ì ‘ê¸°
          const form = document.getElementById('scheduleForm');
          const icon = document.getElementById('addScheduleIcon');
          if (form && icon) {
            form.style.display = 'none';
            icon.textContent = 'â–¶';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveSchedule = saveSchedule;
    
    // ìŠ¤ì¼€ì¥´ í¼ ì´ˆê¸°í™”
    function resetScheduleForm() {
      document.getElementById('scheduleTitle').value = '';
      document.getElementById('scheduleStartDate').value = '';
      document.getElementById('scheduleEndDate').value = '';
      document.getElementById('scheduleEventDescription').value = '';
      document.getElementById('scheduleRequestNote').value = '';
      document.getElementById('scheduleMessage').innerHTML = '';
      
      // ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
      const saveBtn = document.querySelector('#scheduleTab .save-btn');
      if (saveBtn) {
        saveBtn.onclick = saveSchedule;
        saveBtn.textContent = 'ì €ì¥';
      }
    }
    window.resetScheduleForm = resetScheduleForm;
    
    // ìŠ¤ì¼€ì¥´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    async function refreshSchedules() {
      const tbody = document.getElementById('scheduleTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch(`/api/schedules/list?company=${encodeURIComponent(currentCompany)}&role=${encodeURIComponent(currentRole || 'í™”ì£¼ì‚¬')}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach((schedule, index) => {
            const row = document.createElement('tr');
            const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '';
            const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '';
            
            row.innerHTML = `
              <td>${escapeHtml(schedule.title || '')}</td>
              <td>${startDate}</td>
              <td>${endDate}</td>
              <td style="max-width: 300px; word-wrap: break-word;">${escapeHtml(schedule.event_description || '')}</td>
              <td style="max-width: 200px; word-wrap: break-word;">${escapeHtml(schedule.request_note || '-')}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="editSchedule(${schedule.id})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 4px 10px; font-size: 11px; border-radius: 4px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) deleteSchedule(${schedule.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 4px 10px; font-size: 11px; border-radius: 4px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.refreshSchedules = refreshSchedules;
    
    // ìŠ¤ì¼€ì¥´ ìˆ˜ì •
    async function editSchedule(scheduleId) {
      try {
        const response = await fetch(`/api/schedules/${scheduleId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const schedule = result.data;
          document.getElementById('scheduleTitle').value = schedule.title || '';
          document.getElementById('scheduleStartDate').value = schedule.start_date || '';
          document.getElementById('scheduleEndDate').value = schedule.end_date || '';
          document.getElementById('scheduleEventDescription').value = schedule.event_description || '';
          document.getElementById('scheduleRequestNote').value = schedule.request_note || '';
          
          // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
          const saveBtn = document.querySelector('#scheduleTab .save-btn');
          if (saveBtn) {
            saveBtn.onclick = () => updateSchedule(scheduleId);
            saveBtn.textContent = 'ìˆ˜ì •';
          }
          
          // ìŠ¤í¬ë¡¤ì„ í¼ìœ¼ë¡œ ì´ë™
          document.getElementById('scheduleTab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editSchedule = editSchedule;
    
    // ìŠ¤ì¼€ì¥´ ì—…ë°ì´íŠ¸
    async function updateSchedule(scheduleId) {
      const title = document.getElementById('scheduleTitle').value.trim();
      const startDate = document.getElementById('scheduleStartDate').value;
      const endDate = document.getElementById('scheduleEndDate').value;
      const eventDescription = document.getElementById('scheduleEventDescription').value.trim();
      const requestNote = document.getElementById('scheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('scheduleMessage');
      
      if (!title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/schedules/update/${scheduleId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetScheduleForm();
          refreshSchedules();
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#scheduleTab .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveSchedule;
            saveBtn.textContent = 'ì €ì¥';
          }
          // í¼ ì ‘ê¸°
          const form = document.getElementById('scheduleForm');
          const icon = document.getElementById('addScheduleIcon');
          if (form && icon) {
            form.style.display = 'none';
            icon.textContent = 'â–¶';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateSchedule = updateSchedule;
    
    // ìŠ¤ì¼€ì¥´ ì‚­ì œ
    async function deleteSchedule(scheduleId) {
      try {
        const response = await fetch(`/api/schedules/delete/${scheduleId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ìŠ¤ì¼€ì¥´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          // ê´€ë¦¬ì ëª¨ë“œì¸ì§€ í™”ì£¼ì‚¬ ëª¨ë“œì¸ì§€ í™•ì¸
          const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
          if (scheduleCalendarTab && !scheduleCalendarTab.classList.contains('hidden')) {
            // ê´€ë¦¬ì ëª¨ë“œ: ë‹¬ë ¥ê³¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            loadCalendarSchedules();
          } else {
            // í™”ì£¼ì‚¬ ëª¨ë“œ: ìŠ¤ì¼€ì¥´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            refreshSchedules();
          }
        } else {
          alert(result.message || 'ìŠ¤ì¼€ì¥´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¥´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteSchedule = deleteSchedule;
    
    // ========== ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ì €ì¥
    async function saveAdminSchedule() {
      const companyName = document.getElementById('adminScheduleCompanyName').value.trim();
      const title = document.getElementById('adminScheduleTitle').value.trim();
      const startDate = document.getElementById('adminScheduleStartDate').value;
      const endDate = document.getElementById('adminScheduleEndDate').value;
      const eventDescription = document.getElementById('adminScheduleEventDescription').value.trim();
      const requestNote = document.getElementById('adminScheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('adminScheduleMessage');
      
      if (!companyName || !title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/schedules/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: companyName,
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetAdminScheduleForm();
          toggleAdminScheduleForm(); // í¼ ì ‘ê¸°
          loadCalendarSchedules();
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveAdminSchedule = saveAdminSchedule;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ í¼ ì´ˆê¸°í™”
    function resetAdminScheduleForm() {
      document.getElementById('adminScheduleCompanyName').value = '';
      document.getElementById('adminScheduleTitle').value = '';
      document.getElementById('adminScheduleStartDate').value = '';
      document.getElementById('adminScheduleEndDate').value = '';
      document.getElementById('adminScheduleEventDescription').value = '';
      document.getElementById('adminScheduleRequestNote').value = '';
      document.getElementById('adminScheduleMessage').innerHTML = '';
    }
    window.resetAdminScheduleForm = resetAdminScheduleForm;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ìš© í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
    async function loadCompaniesForSchedule() {
      const select = document.getElementById('adminScheduleCompanyName');
      if (!select) return;
      
      try {
        const response = await fetch('/api/auth/companies');
        const result = await response.json();
        
        if (result.success && result.companies) {
          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì˜µì…˜ ì œì™¸)
          while (select.options.length > 1) {
            select.remove(1);
          }
          
          // í™”ì£¼ì‚¬ë§Œ í•„í„°ë§ (ê´€ë¦¬ì ì œì™¸)
          const companies = result.companies.filter(company => company.role !== 'ê´€ë¦¬ì');
          
          companies.forEach(company => {
            const option = document.createElement('option');
            option.value = company.company_name;
            option.textContent = company.company_name;
            select.appendChild(option);
          });
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCompaniesForSchedule = loadCompaniesForSchedule;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleAdminScheduleForm() {
      const form = document.getElementById('addAdminScheduleForm');
      const icon = document.getElementById('addAdminScheduleIcon');
      
      if (form && icon) {
        if (form.style.display === 'none' || !form.style.display) {
          form.style.display = 'block';
          icon.textContent = 'â–²';
          // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
          loadCompaniesForSchedule();
        } else {
          form.style.display = 'none';
          icon.textContent = 'â–¼';
        }
      }
    }
    window.toggleAdminScheduleForm = toggleAdminScheduleForm;
    
    // ========== ê´€ë¦¬ì ë‹¬ë ¥ ë·° ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ë¡œë“œ
    async function loadCalendarSchedules() {
      const container = document.getElementById('calendarContainer');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      const listTableBody = document.getElementById('scheduleListTableBody');
      if (listTableBody) {
        listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      }
      
      try {
        const monthInput = document.getElementById('calendarMonthSelect');
        const month = monthInput ? monthInput.value : '';
        
        let url = '/api/schedules/calendar';
        if (month) {
          url += `?month=${encodeURIComponent(month)}`;
        }
        
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          renderCalendar(result.data, month);
          renderScheduleListTable(result.data);
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          const listTableBody = document.getElementById('scheduleListTableBody');
          if (listTableBody) {
            listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
          }
        }
      } catch (error) {
        console.error('ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ì¡°íšŒ ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        const listTableBody = document.getElementById('scheduleListTableBody');
        if (listTableBody) {
          listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      }
    }
    window.loadCalendarSchedules = loadCalendarSchedules;
    
    // í™”ì£¼ì‚¬ë³„ ìƒ‰ìƒ í• ë‹¹ í•¨ìˆ˜
    function getCompanyColor(companyName) {
      // ë‹¤ì–‘í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
      const colorPalette = [
        { start: '#ff6b35', end: '#feca57' }, // ì˜¤ë Œì§€-ë…¸ë‘
        { start: '#6c5ce7', end: '#a29bfe' }, // ë³´ë¼
        { start: '#00b894', end: '#00cec9' }, // ì²­ë¡
        { start: '#e17055', end: '#fdcb6e' }, // ì½”ë„-ë…¸ë‘
        { start: '#0984e3', end: '#74b9ff' }, // íŒŒë‘
        { start: '#d63031', end: '#ff7675' }, // ë¹¨ê°•
        { start: '#00b894', end: '#55efc4' }, // ë¯¼íŠ¸
        { start: '#fdcb6e', end: '#ffeaa7' }, // ë…¸ë‘
        { start: '#e84393', end: '#fd79a8' }, // í•‘í¬
        { start: '#00b894', end: '#6c5ce7' }, // ì²­ë¡-ë³´ë¼
        { start: '#f39c12', end: '#f1c40f' }, // ì£¼í™©-ë…¸ë‘
        { start: '#16a085', end: '#1abc9c' }, // ì²­ë¡
        { start: '#8e44ad', end: '#9b59b6' }, // ë³´ë¼
        { start: '#c0392b', end: '#e74c3c' }, // ë¹¨ê°•
        { start: '#2980b9', end: '#3498db' }, // íŒŒë‘
      ];
      
      if (!companyName) return colorPalette[0];
      
      // í™”ì£¼ì‚¬ëª…ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒ‰ìƒ ì¸ë±ìŠ¤ ê²°ì • (ì¼ê´€ì„± ìœ ì§€)
      let hash = 0;
      for (let i = 0; i < companyName.length; i++) {
        hash = companyName.charCodeAt(i) + ((hash << 5) - hash);
      }
      const index = Math.abs(hash) % colorPalette.length;
      return colorPalette[index];
    }
    window.getCompanyColor = getCompanyColor;
    
    // ë‹¬ë ¥ ë Œë”ë§
    function renderCalendar(schedules, month) {
      const container = document.getElementById('calendarContainer');
      if (!container) return;
      
      // ì›” ì„¤ì •
      let currentDate;
      if (month) {
        const [year, monthNum] = month.split('-');
        currentDate = new Date(parseInt(year), parseInt(monthNum) - 1, 1);
      } else {
        currentDate = new Date();
        currentDate.setDate(1);
      }
      
      const year = currentDate.getFullYear();
      const monthNum = currentDate.getMonth();
      const firstDay = new Date(year, monthNum, 1);
      const lastDay = new Date(year, monthNum + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      // ë‚ ì§œë³„ë¡œ ìŠ¤ì¼€ì¥´ ê·¸ë£¹í™”
      const schedulesByDate = {};
      schedules.forEach(schedule => {
        const start = new Date(schedule.start_date);
        const end = new Date(schedule.end_date);
        const current = new Date(start);
        
        while (current <= end) {
          const dateKey = current.toISOString().split('T')[0];
          if (!schedulesByDate[dateKey]) {
            schedulesByDate[dateKey] = [];
          }
          schedulesByDate[dateKey].push(schedule);
          current.setDate(current.getDate() + 1);
        }
      });
      
      // ë‹¬ë ¥ HTML ìƒì„±
      const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
      const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      
      let html = `
        <div style="background: #ffffff; border-radius: 14px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <h4 style="text-align: center; margin-bottom: 20px; color: #ff6b35; font-size: 24px; font-weight: 700;">
            ${year}ë…„ ${monthNames[monthNum]}
          </h4>
          <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
      `;
      
      // ìš”ì¼ í—¤ë”
      dayNames.forEach(day => {
        html += `
          <div style="text-align: center; padding: 12px; font-weight: 700; color: ${day === 'ì¼' ? '#e74c3c' : day === 'í† ' ? '#3498db' : '#2d3436'}; background: #fff9e6; border-radius: 8px;">
            ${day}
          </div>
        `;
      });
      
      // ë¹ˆ ì¹¸ (ì²« ì£¼ ì‹œì‘ì¼ ì „)
      for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div style="min-height: 100px; background: #f8f9fa; border-radius: 8px;"></div>';
      }
      
      // ë‚ ì§œ ì¹¸
      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${String(monthNum + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const daySchedules = schedulesByDate[dateKey] || [];
        const isToday = new Date().toDateString() === new Date(year, monthNum, day).toDateString();
        
        const schedulesJson = JSON.stringify(daySchedules).replace(/"/g, '&quot;').replace(/'/g, "&#39;");
        html += `
          <div style="min-height: 100px; background: ${isToday ? '#fff9e6' : '#ffffff'}; border: 2px solid ${isToday ? '#ff6b35' : '#ffeaa7'}; border-radius: 8px; padding: 8px; cursor: pointer; transition: all 0.2s;" 
               onclick="showScheduleModal('${dateKey}', '${schedulesJson}')">
            <div style="font-weight: 700; margin-bottom: 6px; color: ${isToday ? '#ff6b35' : '#2d3436'};">
              ${day}
            </div>
            <div style="display: flex; flex-direction: column; gap: 4px;">
        `;
        
        // ìŠ¤ì¼€ì¥´ í‘œì‹œ (ìµœëŒ€ 3ê°œ)
        daySchedules.slice(0, 3).forEach((schedule, idx) => {
          const companyName = escapeHtml(schedule.company_name || '');
          const title = escapeHtml(schedule.title || '');
          const color = getCompanyColor(schedule.company_name);
          html += `
            <div style="background: linear-gradient(135deg, ${color.start} 0%, ${color.end} 100%); color: white; padding: 4px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                 title="${companyName}: ${title}">
              ${companyName.length > 6 ? companyName.substring(0, 6) + '...' : companyName}
            </div>
          `;
        });
        
        if (daySchedules.length > 3) {
          html += `<div style="font-size: 10px; color: #636e72; text-align: center;">+${daySchedules.length - 3}ê°œ</div>`;
        }
        
        html += `
            </div>
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    window.renderCalendar = renderCalendar;
    
    // ìŠ¤ì¼€ì¥´ ëª©ë¡ í…Œì´ë¸” ë Œë”ë§
    function renderScheduleListTable(schedules) {
      const tbody = document.getElementById('scheduleListTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      // í†µê³„ ì—…ë°ì´íŠ¸
      const statisticsSpan = document.getElementById('schedulesStatistics');
      if (statisticsSpan) {
        statisticsSpan.textContent = `(ì´ ${schedules ? schedules.length : 0}ê°œ)`;
      }
      
      if (!schedules || schedules.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="no-data">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      // ì‹œì‘ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
      const sortedSchedules = [...schedules].sort((a, b) => {
        const dateA = new Date(a.start_date);
        const dateB = new Date(b.start_date);
        return dateB - dateA;
      });
      
      sortedSchedules.forEach(schedule => {
        const tr = document.createElement('tr');
        
        // ë‚ ì§œ í¬ë§·íŒ…
        const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '-';
        const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '-';
        const createdAt = schedule.created_at ? new Date(schedule.created_at).toLocaleDateString('ko-KR') : '-';
        
        // í–‰ì‚¬ ë‚´ìš©ê³¼ ìš”ì²­ì‚¬í•­ì€ ê¸¸ì´ ì œí•œ
        const eventDescription = schedule.event_description || '';
        const requestNote = schedule.request_note || '';
        const eventDescriptionShort = eventDescription.length > 50 ? eventDescription.substring(0, 50) + '...' : eventDescription;
        const requestNoteShort = requestNote.length > 50 ? requestNote.substring(0, 50) + '...' : requestNote;
        
        // ì‚­ì œ ë²„íŠ¼
        const deleteBtn = `
          <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ìŠ¤ì¼€ì¥´ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) deleteSchedule(${schedule.id})" 
                  style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(231, 76, 60, 0.25);">
            ğŸ—‘ï¸ ì‚­ì œ
          </button>
        `;
        
        tr.innerHTML = `
          <td>${escapeHtml(schedule.company_name || '')}</td>
          <td>${escapeHtml(schedule.title || '')}</td>
          <td>${startDate}</td>
          <td>${endDate}</td>
          <td style="max-width: 300px; word-wrap: break-word;" title="${escapeHtml(eventDescription)}">${escapeHtml(eventDescriptionShort)}</td>
          <td style="max-width: 200px; word-wrap: break-word;" title="${escapeHtml(requestNote)}">${escapeHtml(requestNoteShort || '-')}</td>
          <td>${createdAt}</td>
          <td style="text-align: center;">${deleteBtn}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    window.renderScheduleListTable = renderScheduleListTable;
    
    // ìŠ¤ì¼€ì¥´ ëª¨ë‹¬ í‘œì‹œ
    function showScheduleModal(date, schedulesJson) {
      const dateObj = new Date(date);
      const dateStr = `${dateObj.getFullYear()}ë…„ ${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;
      
      // JSON ë¬¸ìì—´ì„ íŒŒì‹±
      let schedules = [];
      try {
        schedules = JSON.parse(schedulesJson.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
      } catch (e) {
        console.error('ìŠ¤ì¼€ì¥´ íŒŒì‹± ì˜¤ë¥˜:', e);
        schedules = [];
      }
      
      let modalHtml = `
        <div id="scheduleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeScheduleModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 22px; font-weight: 700;">${dateStr} ìŠ¤ì¼€ì¥´</h3>
              <button onclick="closeScheduleModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
            </div>
      `;
      
      if (!schedules || schedules.length === 0) {
        modalHtml += `
          <div style="text-align: center; padding: 40px; color: #636e72;">
            ì´ ë‚ ì§œì—ëŠ” ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        `;
      } else {
        schedules.forEach((schedule, idx) => {
          const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '';
          const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '';
          const color = getCompanyColor(schedule.company_name);
          
          modalHtml += `
            <div style="background: #fff9e6; border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <h4 style="margin: 0; color: #ff6b35; font-size: 18px; font-weight: 700;">${escapeHtml(schedule.title || '')}</h4>
                <span style="background: linear-gradient(135deg, ${color.start} 0%, ${color.end} 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">${escapeHtml(schedule.company_name || '')}</span>
              </div>
              <div style="margin-bottom: 8px; color: #2d3436; font-size: 14px;">
                <strong>ê¸°ê°„:</strong> ${startDate} ~ ${endDate}
              </div>
              <div style="margin-bottom: 8px; color: #2d3436; font-size: 14px;">
                <strong>í–‰ì‚¬ ë‚´ìš©:</strong><br>
                <div style="margin-top: 4px; padding: 8px; background: white; border-radius: 8px; white-space: pre-wrap;">${escapeHtml(schedule.event_description || '')}</div>
              </div>
              ${schedule.request_note ? `
                <div style="color: #2d3436; font-size: 14px;">
                  <strong>ìš”ì²­ì‚¬í•­:</strong><br>
                  <div style="margin-top: 4px; padding: 8px; background: white; border-radius: 8px; white-space: pre-wrap;">${escapeHtml(schedule.request_note)}</div>
                </div>
              ` : ''}
            </div>
          `;
        });
      }
      
      modalHtml += `
          </div>
        </div>
      `;
      
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('scheduleModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    window.showScheduleModal = showScheduleModal;
    
    // ìŠ¤ì¼€ì¥´ ëª¨ë‹¬ ë‹«ê¸°
    function closeScheduleModal(event) {
      if (event && event.target.id !== 'scheduleModal' && !event.target.closest('#scheduleModal > div')) {
        return;
      }
      const modal = document.getElementById('scheduleModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeScheduleModal = closeScheduleModal;
    
    // ========== í™”ì£¼ì‚¬ ì •ë³´ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ì‚¬ì—…ì ì •ë³´ í•„ìˆ˜ íŒì—… ëª¨ë‹¬ í‘œì‹œ
    function showBusinessInfoRequiredModal() {
      // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
      const existingModal = document.getElementById('businessInfoRequiredModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="businessInfoRequiredModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 20000; display: flex; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;">
          <div style="background: linear-gradient(135deg, #ffffff 0%, #fff9e6 100%); border-radius: 20px; padding: 40px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button onclick="closeBusinessInfoRequiredModal()" style="position: absolute; top: 20px; right: 20px; background: #e74c3c; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">Ã—</button>
            
            <!-- ì œëª© -->
            <div style="text-align: center; margin-bottom: 30px;">
              <div style="font-size: 64px; margin-bottom: 20px;">âš ï¸</div>
              <h2 style="margin: 0; color: #e74c3c; font-weight: 700; font-size: 32px; line-height: 1.3;">ì‚¬ì—…ì ì •ë³´ ì…ë ¥ í•„ìš”</h2>
              <p style="margin: 15px 0 0 0; color: #2d3436; font-size: 18px; line-height: 1.6;">ë°˜í’ˆ ë‚´ì—­ì„ ì¡°íšŒí•˜ë ¤ë©´ ì‚¬ì—…ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            
            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #ffc107;">
              <div style="display: flex; align-items: flex-start; gap: 12px;">
                <div style="font-size: 24px;">â„¹ï¸</div>
                <div style="flex: 1;">
                  <h4 style="margin: 0 0 10px 0; color: #856404; font-weight: 600; font-size: 16px;">ì‚¬ì—…ì ì •ë³´ ì…ë ¥ ì•ˆë‚´</h4>
                  <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 14px; line-height: 1.8;">
                    <li>ë°˜í’ˆ ë‚´ì—­ ì¡°íšŒë¥¼ ìœ„í•´ ì‚¬ì—…ì ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
                    <li>ì•„ë˜ í¼ì— ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>
                    <li>ì •ë³´ ì…ë ¥ í›„ ì €ì¥í•˜ë©´ ë°˜í’ˆ ë‚´ì—­ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- ì‚¬ì—…ì ì •ë³´ ì…ë ¥ í¼ -->
            <form id="businessInfoRequiredForm" onsubmit="saveBusinessInfoFromModal(event); return false;" style="margin-bottom: 20px;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‚¬ì—…ìë²ˆí˜¸ *</label>
                  <input type="text" id="modalBusinessNumber" class="request-input" style="min-height: auto;" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ëŒ€í‘œëª… *</label>
                  <input type="text" id="modalBusinessName" class="request-input" style="min-height: auto;" placeholder="ëŒ€í‘œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div style="grid-column: 1 / -1;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì£¼ì†Œ *</label>
                  <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input type="text" id="modalPostcode" class="request-input" style="min-height: auto; width: 120px;" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button type="button" onclick="openPostcodeSearchForModal()" class="save-btn" style="padding: 10px 20px; font-size: 14px; white-space: nowrap;">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
                  </div>
                  <input type="text" id="modalBusinessAddress" class="request-input" style="min-height: auto; margin-bottom: 8px;" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly required>
                  <input type="text" id="modalBusinessAddressDetail" class="request-input" style="min-height: auto;" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „í™”ë²ˆí˜¸ *</label>
                  <input type="tel" id="modalBusinessTel" class="request-input" style="min-height: auto;" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ *</label>
                  <input type="email" id="modalBusinessEmail" class="request-input" style="min-height: auto;" placeholder="ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
              </div>
              
              <div style="margin-top: 30px; display: flex; gap: 12px; justify-content: center;">
                <button type="submit" class="save-btn" style="padding: 14px 40px; font-size: 18px; font-weight: 600;">ğŸ’¾ ì •ë³´ ì €ì¥</button>
                <button type="button" onclick="closeBusinessInfoRequiredModal()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%); padding: 14px 40px; font-size: 18px; font-weight: 600;">ì·¨ì†Œ</button>
              </div>
              <div id="businessInfoRequiredMessage" style="margin-top: 20px; text-align: center;"></div>
            </form>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // ê¸°ì¡´ í™”ì£¼ì‚¬ ì •ë³´ê°€ ìˆìœ¼ë©´ í¼ì— ì±„ìš°ê¸°
      loadCompanyInfoToModal();
    }
    window.showBusinessInfoRequiredModal = showBusinessInfoRequiredModal;
    
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeBusinessInfoRequiredModal() {
      const modal = document.getElementById('businessInfoRequiredModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeBusinessInfoRequiredModal = closeBusinessInfoRequiredModal;
    
    // ëª¨ë‹¬ì— í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
    async function loadCompanyInfoToModal() {
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          document.getElementById('modalBusinessNumber').value = data.business_number || '';
          document.getElementById('modalBusinessName').value = data.business_name || '';
          
          // ì£¼ì†Œ íŒŒì‹± (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹)
          const fullAddress = data.business_address || '';
          const addressParts = fullAddress.split('|');
          if (addressParts.length >= 3) {
            document.getElementById('modalPostcode').value = addressParts[0] || '';
            document.getElementById('modalBusinessAddress').value = addressParts[1] || '';
            document.getElementById('modalBusinessAddressDetail').value = addressParts[2] || '';
          } else if (fullAddress) {
            // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
            document.getElementById('modalPostcode').value = '';
            document.getElementById('modalBusinessAddress').value = fullAddress;
            document.getElementById('modalBusinessAddressDetail').value = '';
          } else {
            document.getElementById('modalPostcode').value = '';
            document.getElementById('modalBusinessAddress').value = '';
            document.getElementById('modalBusinessAddressDetail').value = '';
          }
          
          document.getElementById('modalBusinessTel').value = data.business_tel || '';
          document.getElementById('modalBusinessEmail').value = data.business_email || '';
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // ëª¨ë‹¬ì—ì„œ ì‚¬ì—…ì ì •ë³´ ì €ì¥
    async function saveBusinessInfoFromModal(event) {
      event.preventDefault();
      
      const messageDiv = document.getElementById('businessInfoRequiredMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      const businessNumber = document.getElementById('modalBusinessNumber').value.trim();
      const businessName = document.getElementById('modalBusinessName').value.trim();
      const postcode = document.getElementById('modalPostcode').value.trim();
      const businessAddress = document.getElementById('modalBusinessAddress').value.trim();
      const businessAddressDetail = document.getElementById('modalBusinessAddressDetail').value.trim();
      const businessTel = document.getElementById('modalBusinessTel').value.trim();
      const businessEmail = document.getElementById('modalBusinessEmail').value.trim();
      
      // ì£¼ì†Œ í˜•ì‹: postcode|address|addressDetail
      const fullAddress = postcode || businessAddress || businessAddressDetail 
        ? `${postcode}|${businessAddress}|${businessAddressDetail}` 
        : '';
      
      if (!businessNumber || !businessName || !businessAddress || !businessTel || !businessEmail) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: currentUsername,
            business_number: businessNumber,
            business_name: businessName,
            business_address: fullAddress,
            business_tel: businessTel,
            business_email: businessEmail
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… ì‚¬ì—…ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë°˜í’ˆ ë‚´ì—­ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>';
          }
          
          // ëª¨ë‹¬ ë‹«ê¸°
          setTimeout(() => {
            closeBusinessInfoRequiredModal();
            // ë°˜í’ˆ ë‚´ì—­ ë‹¤ì‹œ ë¡œë“œ
            loadData();
          }, 1500);
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ' + (result.message || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.') + '</span>';
          }
        }
      } catch (error) {
        console.error('ì‚¬ì—…ì ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</span>';
        }
      }
    }
    window.saveBusinessInfoFromModal = saveBusinessInfoFromModal;
    
    // ëª¨ë‹¬ìš© ì£¼ì†Œ ê²€ìƒ‰
    function openPostcodeSearchForModal() {
      new daum.Postcode({
        oncomplete: function(data) {
          // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.
          // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
          let addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
          let extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
          if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
            addr = data.roadAddress;
          } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
            addr = data.jibunAddress;
          }
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
          if(data.userSelectedType === 'R'){
            // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
            // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
            if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
              extraAddr += data.bname;
            }
            // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
            if(data.buildingName !== '' && data.apartment === 'Y'){
              extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
            }
            // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
            if(extraAddr !== ''){
              extraAddr = ' (' + extraAddr + ')';
            }
            // ì¡°í•©ëœ ì°¸ê³ í•­ëª©ì„ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
            addr += extraAddr;
          }
          
          // ëª¨ë‹¬ì˜ input í•„ë“œì— ê°’ ì…ë ¥
          document.getElementById('modalPostcode').value = data.zonecode;
          document.getElementById('modalBusinessAddress').value = addr;
          // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
          document.getElementById('modalBusinessAddressDetail').focus();
        },
        width: '100%',
        height: '100%',
        maxSuggestItems: 5
      }).open();
    }
    window.openPostcodeSearchForModal = openPostcodeSearchForModal;
    
    // ì‚¬ì—…ì ì •ë³´ ì™„ì„±ë„ í™•ì¸
    function checkBusinessInfoComplete(data) {
      if (!data) return false;
      
      const businessNumber = (data.business_number || '').trim();
      const businessName = (data.business_name || '').trim();
      const businessAddress = (data.business_address || '').trim();
      const businessTel = (data.business_tel || '').trim();
      const businessEmail = (data.business_email || '').trim();
      
      // ì£¼ì†Œ ê²€ì¦ (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹ì´ê±°ë‚˜ ê¸°ì¡´ í˜•ì‹)
      let hasValidAddress = false;
      if (businessAddress) {
        const addressParts = businessAddress.split('|');
        if (addressParts.length >= 3) {
          // ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹ì¸ ê²½ìš°, ê¸°ë³¸ì£¼ì†Œê°€ ìˆì–´ì•¼ í•¨
          hasValidAddress = addressParts[1] && addressParts[1].trim().length > 0;
        } else {
          // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
          hasValidAddress = businessAddress.length > 0;
        }
      }
      
      // ëª¨ë“  í•„ë“œê°€ ì…ë ¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      return businessNumber && businessName && hasValidAddress && businessTel && businessEmail;
    }
    window.checkBusinessInfoComplete = checkBusinessInfoComplete;
    
    // ì‚¬ì—…ì ì •ë³´ ë°°ë„ˆ í‘œì‹œ/ìˆ¨ê¹€
    function updateBusinessInfoBanner(data) {
      const banner = document.getElementById('companyInfoBanner');
      if (!banner) return;
      
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      // ê´€ë¦¬ì ëª¨ë“œì—ì„œëŠ” ë°°ë„ˆ í‘œì‹œ ì•ˆ í•¨
      if (isAdmin) {
        banner.style.display = 'none';
        return;
      }
      
      // í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œ ì‚¬ì—…ì ì •ë³´ê°€ ì™„ì„±ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë°°ë„ˆ í‘œì‹œ
      if (!checkBusinessInfoComplete(data)) {
        banner.style.display = 'block';
      } else {
        banner.style.display = 'none';
      }
    }
    window.updateBusinessInfoBanner = updateBusinessInfoBanner;
    
    // í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
    async function loadCompanyInfo() {
      const messageDiv = document.getElementById('companyInfoMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ë¡œë”© ì¤‘...</span>';
      }
      
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          
          // ê¸°ë³¸ ì •ë³´ (ì½ê¸° ì „ìš©)
          document.getElementById('companyInfoName').value = data.company_name || '';
          document.getElementById('companyInfoUsername').value = data.username || '';
          document.getElementById('companyInfoRole').value = data.role || 'í™”ì£¼ì‚¬';
          
          // ì‚¬ì—…ì ì •ë³´ (ìˆ˜ì • ê°€ëŠ¥)
          document.getElementById('companyInfoBusinessNumber').value = data.business_number || '';
          document.getElementById('companyInfoBusinessName').value = data.business_name || '';
          
          // ì£¼ì†Œ íŒŒì‹± (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹)
          const fullAddress = data.business_address || '';
          const addressParts = fullAddress.split('|');
          if (addressParts.length >= 3) {
            document.getElementById('companyInfoPostcode').value = addressParts[0] || '';
            document.getElementById('companyInfoBusinessAddress').value = addressParts[1] || '';
            document.getElementById('companyInfoBusinessAddressDetail').value = addressParts[2] || '';
          } else if (fullAddress) {
            // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
            document.getElementById('companyInfoPostcode').value = '';
            document.getElementById('companyInfoBusinessAddress').value = fullAddress;
            document.getElementById('companyInfoBusinessAddressDetail').value = '';
          } else {
            document.getElementById('companyInfoPostcode').value = '';
            document.getElementById('companyInfoBusinessAddress').value = '';
            document.getElementById('companyInfoBusinessAddressDetail').value = '';
          }
          
          document.getElementById('companyInfoBusinessTel').value = data.business_tel || '';
          document.getElementById('companyInfoBusinessEmail').value = data.business_email || '';
          
          // ì‚¬ì—…ì ì •ë³´ ë°°ë„ˆ ì—…ë°ì´íŠ¸
          updateBusinessInfoBanner(data);
          
          if (messageDiv) {
            messageDiv.innerHTML = '';
          }
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'í™”ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">í™”ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.loadCompanyInfo = loadCompanyInfo;
    
    // í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥
    async function saveCompanyInfo(event) {
      event.preventDefault();
      const messageDiv = document.getElementById('companyInfoMessage');
      
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: currentUsername,
            business_number: document.getElementById('companyInfoBusinessNumber').value.trim() || null,
            business_name: document.getElementById('companyInfoBusinessName').value.trim() || null,
            business_address: (() => {
              const postcode = document.getElementById('companyInfoPostcode').value.trim();
              const address = document.getElementById('companyInfoBusinessAddress').value.trim();
              const addressDetail = document.getElementById('companyInfoBusinessAddressDetail').value.trim();
              if (postcode || address || addressDetail) {
                return `${postcode}|${address}|${addressDetail}`;
              }
              return null;
            })(),
            business_tel: document.getElementById('companyInfoBusinessTel').value.trim() || null,
            business_email: document.getElementById('companyInfoBusinessEmail').value.trim() || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… í™”ì£¼ì‚¬ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          // ì •ë³´ ë‹¤ì‹œ ë¡œë“œ (ë°°ë„ˆ ì—…ë°ì´íŠ¸ í¬í•¨)
          setTimeout(() => {
            loadCompanyInfo();
          }, 1000);
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.saveCompanyInfo = saveCompanyInfo;
    
    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    async function changePassword(event) {
      event.preventDefault();
      const messageDiv = document.getElementById('passwordChangeMessage');
      
      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const newPasswordConfirm = document.getElementById('newPasswordConfirm').value.trim();
      
      if (!currentPassword || !newPassword || !newPasswordConfirm) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      if (newPassword !== newPasswordConfirm) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (newPassword.length < 4) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘...</span>';
      }
      
      try {
        const response = await fetch('/api/auth/change-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: currentUsername,
            old_password: currentPassword,
            new_password: newPassword
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          resetPasswordForm();
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.changePassword = changePassword;
    
    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼ ì´ˆê¸°í™”
    function resetPasswordForm() {
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('newPasswordConfirm').value = '';
      const messageDiv = document.getElementById('passwordChangeMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '';
      }
    }
    window.resetPasswordForm = resetPasswordForm;
    
    // ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰
    function openPostcodeSearch() {
      new daum.Postcode({
        oncomplete: function(data) {
          // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.
          // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
          let addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
          let extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
          if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
            addr = data.roadAddress;
          } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
            addr = data.jibunAddress;
          }
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
          if(data.userSelectedType === 'R'){
            // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
            // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
            if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
              extraAddr += data.bname;
            }
            // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
            if(data.buildingName !== '' && data.apartment === 'Y'){
              extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
            }
            // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
            if(extraAddr !== ''){
              extraAddr = ' (' + extraAddr + ')';
            }
          }
          
          // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
          document.getElementById('companyInfoPostcode').value = data.zonecode;
          document.getElementById('companyInfoBusinessAddress').value = addr + extraAddr;
          // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
          document.getElementById('companyInfoBusinessAddressDetail').focus();
        },
        width: '100%',
        height: '100%',
        maxSuggestItems: 5
      }).open({
        q: document.getElementById('companyInfoPostcode').value || '',
        left: (window.screen.width / 2) - (500 / 2),
        top: (window.screen.height / 2) - (600 / 2)
      });
    }
    window.openPostcodeSearch = openPostcodeSearch;
    
    // ========== ê²Œì‹œíŒ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ììš©)
    async function loadCategories() {
      const tbody = document.getElementById('categoryTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="4" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="no-data">ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(category => {
            const tr = document.createElement('tr');
            const createdAt = category.created_at ? new Date(category.created_at).toLocaleDateString('ko-KR') : '-';
            
            tr.innerHTML = `
              <td>${escapeHtml(category.name || '')}</td>
              <td>${category.display_order || 0}</td>
              <td>${createdAt}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="editCategory(${category.id}, '${escapeHtml(category.name || '')}', ${category.display_order || 0})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\ní•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ê²Œì‹œê¸€ì´ ì‚­ì œë©ë‹ˆë‹¤.')) deleteCategory(${category.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="4" class="no-data">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="4" class="no-data">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadCategories = loadCategories;
    
    // ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleCategoryManagement() {
      const content = document.getElementById('categoryManagementContent');
      const icon = document.getElementById('categoryManagementIcon');
      if (content && icon) {
        const isHidden = content.style.display === 'none';
        content.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
        if (isHidden) {
          // í¼ì¹  ë•Œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ
          loadCategories();
        }
      }
    }
    window.toggleCategoryManagement = toggleCategoryManagement;
    
    // ì¹´í…Œê³ ë¦¬ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleCategoryForm() {
      const form = document.getElementById('categoryForm');
      if (form) {
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        if (form.style.display === 'block') {
          document.getElementById('categoryName').value = '';
          document.getElementById('categoryOrder').value = '0';
          document.getElementById('categoryMessage').innerHTML = '';
        }
      }
    }
    window.toggleCategoryForm = toggleCategoryForm;
    
    // ì¹´í…Œê³ ë¦¬ ì €ì¥
    async function saveCategory() {
      const name = document.getElementById('categoryName').value.trim();
      const order = parseInt(document.getElementById('categoryOrder').value) || 0;
      const messageDiv = document.getElementById('categoryMessage');
      
      if (!name) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/board/categories', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            display_order: order
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ì¹´í…Œê³ ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          toggleCategoryForm();
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ì¹´í…Œê³ ë¦¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ìƒì„± ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveCategory = saveCategory;
    
    // ì¹´í…Œê³ ë¦¬ ìˆ˜ì •
    function editCategory(categoryId, name, order) {
      document.getElementById('categoryName').value = name;
      document.getElementById('categoryOrder').value = order;
      document.getElementById('categoryForm').style.display = 'block';
      
      // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
      const saveBtn = document.querySelector('#categoryForm .save-btn');
      if (saveBtn) {
        saveBtn.onclick = () => updateCategory(categoryId);
      }
    }
    window.editCategory = editCategory;
    
    // ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
    async function updateCategory(categoryId) {
      const name = document.getElementById('categoryName').value.trim();
      const order = parseInt(document.getElementById('categoryOrder').value) || 0;
      const messageDiv = document.getElementById('categoryMessage');
      
      if (!name) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/board/categories/${categoryId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            display_order: order
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ì¹´í…Œê³ ë¦¬ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          toggleCategoryForm();
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#categoryForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveCategory;
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ì¹´í…Œê³ ë¦¬ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateCategory = updateCategory;
    
    // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
    async function deleteCategory(categoryId) {
      try {
        const response = await fetch(`/api/board/categories/${categoryId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
        } else {
          alert(result.message || 'ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteCategory = deleteCategory;
    
    // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ììš©)
    async function loadBoards() {
      const tbody = document.getElementById('boardTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const categoryFilter = document.getElementById('boardCategoryFilter');
        const categoryId = categoryFilter ? categoryFilter.value : '';
        
        let url = '/api/board/posts';
        if (categoryId) {
          url += `?category_id=${categoryId}`;
        }
        
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(post => {
            const tr = document.createElement('tr');
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            const isPinned = post.is_pinned || (post.is_pinned === 1);
            
            tr.innerHTML = `
              <td>${escapeHtml(post.category_name || '')}</td>
              <td style="${isPinned ? 'font-weight: 700; color: #ff6b35;' : ''}; cursor: pointer;" onclick="showBoardDetail(${post.id})" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°">
                ${isPinned ? 'ğŸ“Œ ' : ''}${escapeHtml(post.title || '')}
              </td>
              <td>${escapeHtml(post.author_name || '')}</td>
              <td>${post.view_count || 0}</td>
              <td>${createdAt}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="event.stopPropagation(); editBoard(${post.id})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="event.stopPropagation(); if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) deleteBoard(${post.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadBoards = loadBoards;
    
    // ê²Œì‹œê¸€ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleBoardForm() {
      const form = document.getElementById('boardForm');
      if (form) {
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        if (form.style.display === 'block') {
          resetBoardForm();
          loadCategoriesForBoard();
        }
      }
    }
    window.toggleBoardForm = toggleBoardForm;
    
    // ê²Œì‹œê¸€ í¼ ì´ˆê¸°í™”
    function resetBoardForm() {
      document.getElementById('boardCategoryId').value = '';
      document.getElementById('boardTitle').value = '';
      document.getElementById('boardContent').value = '';
      document.getElementById('boardIsPinned').checked = false;
      document.getElementById('boardFileList').innerHTML = '';
      document.getElementById('boardMessage').innerHTML = '';
      boardFiles = [];
    }
    window.resetBoardForm = resetBoardForm;
    
    // ê²Œì‹œê¸€ ì‘ì„±ìš© ì¹´í…Œê³ ë¦¬ ë¡œë“œ
    async function loadCategoriesForBoard() {
      const select = document.getElementById('boardCategoryId');
      const filterSelect = document.getElementById('boardCategoryFilter');
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          // ê²Œì‹œê¸€ ì‘ì„±ìš© ì…€ë ‰íŠ¸
          if (select) {
            while (select.options.length > 1) {
              select.remove(1);
            }
            result.data.forEach(category => {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = category.name;
              select.appendChild(option);
            });
          }
          
          // í•„í„°ìš© ì…€ë ‰íŠ¸
          if (filterSelect) {
            while (filterSelect.options.length > 1) {
              filterSelect.remove(1);
            }
            result.data.forEach(category => {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = category.name;
              filterSelect.appendChild(option);
            });
          }
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCategoriesForBoard = loadCategoriesForBoard;
    
    // ê²Œì‹œê¸€ ì²¨ë¶€íŒŒì¼ ê´€ë¦¬
    let boardFiles = [];
    
    function handleBoardFileSelect(event) {
      const files = Array.from(event.target.files);
      if (files.length === 0) return;
      
      const fileList = document.getElementById('boardFileList');
      fileList.innerHTML = '';
      
      files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
        
        fileItem.innerHTML = `
          <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.name)}</span>
          <button type="button" onclick="removeBoardFile(${index})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
        `;
        fileList.appendChild(fileItem);
        
        // íŒŒì¼ ì—…ë¡œë“œ
        uploadBoardFile(file, index);
      });
    }
    window.handleBoardFileSelect = handleBoardFileSelect;
    
    async function uploadBoardFile(file, index) {
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        const response = await fetch('/api/board/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success && result.data) {
          boardFiles[index] = result.data;
        } else {
          alert(`íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ${file.name}`);
        }
      } catch (error) {
        console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert(`íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ${file.name}`);
      }
    }
    window.uploadBoardFile = uploadBoardFile;
    
    function removeBoardFile(index) {
      boardFiles.splice(index, 1);
      const fileList = document.getElementById('boardFileList');
      fileList.innerHTML = '';
      boardFiles.forEach((file, idx) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
        fileItem.innerHTML = `
          <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.file_name)}</span>
          <button type="button" onclick="removeBoardFile(${idx})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
        `;
        fileList.appendChild(fileItem);
      });
    }
    window.removeBoardFile = removeBoardFile;
    
    // ê²Œì‹œê¸€ ì €ì¥
    async function saveBoard() {
      const categoryId = document.getElementById('boardCategoryId').value;
      const title = document.getElementById('boardTitle').value.trim();
      const content = document.getElementById('boardContent').value.trim();
      const isPinned = document.getElementById('boardIsPinned').checked;
      const messageDiv = document.getElementById('boardMessage');
      
      if (!categoryId || !title || !content) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬, ì œëª©, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/board/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            category_id: parseInt(categoryId),
            title: title,
            content: content,
            author_name: currentCompany,
            author_role: currentRole || 'ê´€ë¦¬ì',
            is_pinned: isPinned,
            files: boardFiles
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetBoardForm();
          toggleBoardForm();
          loadBoards();
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ê²Œì‹œê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveBoard = saveBoard;
    
    // ê²Œì‹œê¸€ ìˆ˜ì •
    async function editBoard(boardId) {
      try {
        const response = await fetch(`/api/board/posts/${boardId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const post = result.data;
          document.getElementById('boardCategoryId').value = post.category_id;
          document.getElementById('boardTitle').value = post.title || '';
          document.getElementById('boardContent').value = post.content || '';
          document.getElementById('boardIsPinned').checked = post.is_pinned || (post.is_pinned === 1);
          
          // ì²¨ë¶€íŒŒì¼ í‘œì‹œ
          boardFiles = post.files || [];
          const fileList = document.getElementById('boardFileList');
          fileList.innerHTML = '';
          boardFiles.forEach((file, idx) => {
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
            fileItem.innerHTML = `
              <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.file_name)}</span>
              <button type="button" onclick="removeBoardFile(${idx})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
            `;
            fileList.appendChild(fileItem);
          });
          
          // í¼ í‘œì‹œ
          document.getElementById('boardForm').style.display = 'block';
          loadCategoriesForBoard();
          
          // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
          const saveBtn = document.querySelector('#boardForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = () => updateBoard(boardId);
            saveBtn.textContent = 'ìˆ˜ì •';
          }
          
          // ìŠ¤í¬ë¡¤
          document.getElementById('boardTab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          alert('ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editBoard = editBoard;
    
    // ê²Œì‹œê¸€ ì—…ë°ì´íŠ¸
    async function updateBoard(boardId) {
      const categoryId = document.getElementById('boardCategoryId').value;
      const title = document.getElementById('boardTitle').value.trim();
      const content = document.getElementById('boardContent').value.trim();
      const isPinned = document.getElementById('boardIsPinned').checked;
      const messageDiv = document.getElementById('boardMessage');
      
      if (!categoryId || !title || !content) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬, ì œëª©, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/board/posts/${boardId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            category_id: parseInt(categoryId),
            title: title,
            content: content,
            is_pinned: isPinned,
            files: boardFiles
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetBoardForm();
          toggleBoardForm();
          loadBoards();
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#boardForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveBoard;
            saveBtn.textContent = 'ì €ì¥';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ê²Œì‹œê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ê²Œì‹œê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateBoard = updateBoard;
    
    // ê²Œì‹œê¸€ ì‚­ì œ
    async function deleteBoard(boardId) {
      try {
        const response = await fetch(`/api/board/posts/${boardId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadBoards();
        } else {
          alert(result.message || 'ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteBoard = deleteBoard;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë°•ìŠ¤ ë¡œë“œ
    async function loadBoardCategoriesForSelect() {
      const menuBox = document.getElementById('boardCategoryMenuBox');
      if (!menuBox) return;
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          // ê¸°ì¡´ ë²„íŠ¼ ì œê±° (ì „ì²´ ë²„íŠ¼ ì œì™¸)
          const existingButtons = menuBox.querySelectorAll('.category-menu-btn:not([data-category-id=""])');
          existingButtons.forEach(btn => btn.remove());
          
          result.data.forEach(category => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'category-menu-btn';
            btn.setAttribute('data-category-id', category.id);
            btn.textContent = category.name;
            btn.onclick = () => selectBoardCategory(category.id);
            btn.style.cssText = 'padding: 10px 20px; background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); color: #2d3436; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1);';
            btn.onmouseover = function() { 
              if (!this.classList.contains('active')) {
                this.style.background = 'linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%)';
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 4px 12px rgba(255, 152, 0, 0.2)';
              }
            };
            btn.onmouseout = function() { 
              if (!this.classList.contains('active')) {
                this.style.background = 'linear-gradient(135deg, #ffffff 0%, #fffef9 100%)';
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 2px 8px rgba(255, 152, 0, 0.1)';
              }
            };
            menuBox.appendChild(btn);
          });
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadBoardCategoriesForSelect = loadBoardCategoriesForSelect;
    
    // ì¹´í…Œê³ ë¦¬ ì„ íƒ í•¨ìˆ˜
    function selectBoardCategory(categoryId) {
      // ëª¨ë“  ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±° ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      const allButtons = document.querySelectorAll('.category-menu-btn');
      allButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = 'linear-gradient(135deg, #ffffff 0%, #fffef9 100%)';
        btn.style.color = '#2d3436';
        btn.style.border = '2px solid #ffeaa7';
        btn.style.boxShadow = '0 2px 8px rgba(255, 152, 0, 0.1)';
        btn.style.transform = 'translateY(0)';
      });
      
      // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€ ë° ìŠ¤íƒ€ì¼ ì ìš©
      const selectedBtn = document.querySelector(`.category-menu-btn[data-category-id="${categoryId}"]`);
      if (selectedBtn) {
        selectedBtn.classList.add('active');
        selectedBtn.style.background = 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)';
        selectedBtn.style.color = 'white';
        selectedBtn.style.border = 'none';
        selectedBtn.style.boxShadow = '0 3px 10px rgba(255, 107, 53, 0.25)';
      }
      
      // ê²Œì‹œê¸€ ë¡œë“œ
      loadBoardPostsByCategoryFilter(categoryId);
    }
    window.selectBoardCategory = selectBoardCategory;
    
    /* ========== íŒì—… ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ (ê´€ë¦¬ì ëª¨ë“œ) ========== */
    
    // íŒì—… ëª©ë¡ ë¡œë“œ
    async function loadPopups() {
      const tbody = document.getElementById('popupListTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/popups/');
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ íŒì—…ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(popup => {
            const row = document.createElement('tr');
            // PostgreSQLì€ boolean, SQLiteëŠ” 1/0
            const isActive = typeof popup.is_active === 'boolean' ? popup.is_active : popup.is_active === 1;
            const statusText = isActive ? 'í™œì„±' : 'ë¹„í™œì„±';
            const statusClass = isActive ? 'success' : 'error';
            const startDate = popup.start_date ? popup.start_date.split('T')[0] : '';
            const endDate = popup.end_date ? popup.end_date.split('T')[0] : '';
            const createdDate = popup.created_at ? popup.created_at.split('T')[0] : '';
            
            row.innerHTML = `
              <td>${escapeHtml(popup.title || '')}</td>
              <td>${startDate}</td>
              <td>${endDate}</td>
              <td><span class="${statusClass}">${statusText}</span></td>
              <td>${createdDate}</td>
              <td>
                <button class="edit-btn" onclick="editPopup(${popup.id})" style="margin-right: 8px;">ìˆ˜ì •</button>
                <button class="delete-btn" onclick="deletePopup(${popup.id})">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">íŒì—…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('íŒì—… ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">íŒì—…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadPopups = loadPopups;
    
    // íŒì—… í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function togglePopupForm() {
      const form = document.getElementById('popupForm');
      const icon = document.getElementById('addPopupIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none' || !form.style.display;
        form.style.display = isHidden ? 'block' : 'none';
        icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
        
        if (isHidden) {
          // í¼ ì—´ ë•Œ ì´ˆê¸°í™”
          resetPopupForm();
        }
      }
    }
    window.togglePopupForm = togglePopupForm;
    
    // íŒì—… í¼ ì´ˆê¸°í™”
    function resetPopupForm() {
      document.getElementById('popupId').value = '';
      document.getElementById('popupTitleInput').value = '';
      document.getElementById('popupContentText').value = '';
      document.getElementById('popupStartDate').value = '';
      document.getElementById('popupEndDate').value = '';
      document.getElementById('popupIsActive').checked = true;
      document.getElementById('popupImageUrl').value = '';
      document.getElementById('popupWidth').value = '600';
      document.getElementById('popupHeight').value = '400';
      removePopupImage();
      const message = document.getElementById('popupMessage');
      if (message) {
        message.textContent = '';
        message.className = '';
      }
    }
    window.resetPopupForm = resetPopupForm;
    
    // íŒì—… ì´ë¯¸ì§€ ì„ íƒ ì²˜ë¦¬
    async function handlePopupImageSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        alert('ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      const formData = new FormData();
      formData.append('file', file);
      
      try {
        const response = await fetch('/api/board/upload', {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        
        if (result.success && result.data) {
          const imageUrl = result.data.file_url;
          document.getElementById('popupImageUrl').value = imageUrl;
          document.getElementById('popupImagePreviewImg').src = imageUrl;
          document.getElementById('popupImagePreview').style.display = 'block';
          document.getElementById('removePopupImageBtn').style.display = 'inline-block';
        } else {
          alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (error) {
        console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.handlePopupImageSelect = handlePopupImageSelect;
    
    // íŒì—… ì´ë¯¸ì§€ ì œê±°
    function removePopupImage() {
      document.getElementById('popupImageUrl').value = '';
      document.getElementById('popupImageInput').value = '';
      document.getElementById('popupImagePreview').style.display = 'none';
      document.getElementById('removePopupImageBtn').style.display = 'none';
    }
    window.removePopupImage = removePopupImage;
    
    // íŒì—… ì €ì¥
    async function savePopup() {
      const popupId = document.getElementById('popupId');
      const titleEl = document.getElementById('popupTitleInput');
      const contentEl = document.getElementById('popupContentText');
      const startDateEl = document.getElementById('popupStartDate');
      const endDateEl = document.getElementById('popupEndDate');
      const imageUrlEl = document.getElementById('popupImageUrl');
      const widthEl = document.getElementById('popupWidth');
      const heightEl = document.getElementById('popupHeight');
      const isActiveEl = document.getElementById('popupIsActive');
      const message = document.getElementById('popupMessage');
      
      if (!popupId || !titleEl || !contentEl || !startDateEl || !endDateEl) {
        console.error('í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        if (message) {
          message.textContent = 'âŒ í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.';
          message.className = 'error';
        }
        return;
      }
      
      const popupIdValue = popupId.value;
      const title = titleEl.value.trim();
      const content = contentEl.value.trim();
      const startDate = startDateEl.value;
      const endDate = endDateEl.value;
      const imageUrl = imageUrlEl ? imageUrlEl.value.trim() : '';
      const width = widthEl ? (parseInt(widthEl.value) || 600) : 600;
      const height = heightEl ? (parseInt(heightEl.value) || 400) : 400;
      const isActive = isActiveEl ? isActiveEl.checked : true;
      
      console.log('íŒì—… ì €ì¥ ì‹œë„:', { popupIdValue, title, content, startDate, endDate, imageUrl, width, height, isActive });
      
      if (!title || !content || !startDate || !endDate) {
        console.error('í•„ìˆ˜ í•„ë“œ ëˆ„ë½:', { title: !!title, content: !!content, startDate: !!startDate, endDate: !!endDate });
        if (message) {
          message.textContent = 'âŒ ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
          message.className = 'error';
        }
        return;
      }
      
      if (new Date(startDate) > new Date(endDate)) {
        if (message) {
          message.textContent = 'âŒ ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.';
          message.className = 'error';
        }
        return;
      }
      
      const data = {
        title,
        content,
        start_date: startDate,
        end_date: endDate,
        image_url: imageUrl || null,
        width: width,
        height: height,
        is_active: isActive
      };
      
      console.log('íŒì—… ì €ì¥ ë°ì´í„°:', data);
      
      try {
        let response;
        if (popupIdValue) {
          // ìˆ˜ì •
          console.log('íŒì—… ìˆ˜ì • ìš”ì²­:', popupIdValue);
          response = await fetch(`/api/popups/${popupIdValue}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        } else {
          // ìƒì„±
          console.log('íŒì—… ìƒì„± ìš”ì²­');
          response = await fetch('/api/popups/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        }
        
        console.log('íŒì—… ì €ì¥ ì‘ë‹µ ìƒíƒœ:', response.status);
        const result = await response.json();
        console.log('íŒì—… ì €ì¥ ì‘ë‹µ ë°ì´í„°:', result);
        
        if (result.success) {
          if (message) {
            message.textContent = 'âœ… ' + result.message;
            message.className = 'success';
          }
          setTimeout(() => {
            resetPopupForm();
            togglePopupForm();
            loadPopups();
          }, 500);
        } else {
          if (message) {
            message.textContent = 'âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨');
            message.className = 'error';
          }
        }
      } catch (error) {
        console.error('íŒì—… ì €ì¥ ì˜¤ë¥˜:', error);
        if (message) {
          message.textContent = 'âŒ íŒì—… ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
          message.className = 'error';
        }
      }
    }
    window.savePopup = savePopup;
    
    // íŒì—… ìˆ˜ì •
    async function editPopup(popupId) {
      try {
        const response = await fetch(`/api/popups/${popupId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const popup = result.data;
          document.getElementById('popupId').value = popup.id;
          document.getElementById('popupTitleInput').value = popup.title || '';
          document.getElementById('popupContentText').value = popup.content || '';
          document.getElementById('popupStartDate').value = popup.start_date ? popup.start_date.split('T')[0] : '';
          document.getElementById('popupEndDate').value = popup.end_date ? popup.end_date.split('T')[0] : '';
          document.getElementById('popupWidth').value = popup.width || 600;
          document.getElementById('popupHeight').value = popup.height || 400;
          // PostgreSQLì€ boolean, SQLiteëŠ” 1/0
          const isActive = typeof popup.is_active === 'boolean' ? popup.is_active : popup.is_active === 1;
          document.getElementById('popupIsActive').checked = isActive;
          
          // ì´ë¯¸ì§€ ì„¤ì •
          if (popup.image_url) {
            document.getElementById('popupImageUrl').value = popup.image_url;
            document.getElementById('popupImagePreviewImg').src = popup.image_url;
            document.getElementById('popupImagePreview').style.display = 'block';
            document.getElementById('removePopupImageBtn').style.display = 'inline-block';
          } else {
            removePopupImage();
          }
          
          // í¼ ì—´ê¸°
          const form = document.getElementById('popupForm');
          const icon = document.getElementById('addPopupIcon');
          if (form && icon) {
            form.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
          }
        } else {
          alert('íŒì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('íŒì—… ìˆ˜ì • ì˜¤ë¥˜:', error);
        alert('íŒì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editPopup = editPopup;
    
    // íŒì—… ì‚­ì œ
    async function deletePopup(popupId) {
      if (!confirm('ì •ë§ë¡œ ì´ íŒì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/popups/${popupId}`, {
          method: 'DELETE'
        });
        const result = await response.json();
        
        if (result.success) {
          alert('âœ… ' + result.message);
          loadPopups();
        } else {
          alert('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'));
        }
      } catch (error) {
        console.error('íŒì—… ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('âŒ íŒì—… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deletePopup = deletePopup;
    
    /* ========== íŒì—… í‘œì‹œ ê´€ë ¨ í•¨ìˆ˜ (ì‚¬ìš©ììš©) ========== */
    
    // í™œì„± íŒì—… í™•ì¸ ë° í‘œì‹œ
    async function checkAndShowPopup() {
      // ì´ë¯¸ ë‹«ì€ íŒì—…ì¸ì§€ í™•ì¸ (localStorage - í•˜ë£¨ ë™ì•ˆ í‘œì‹œ ì•ˆ í•¨)
      const closedPopupData = localStorage.getItem('closedPopupData');
      let closedPopupInfo = null;
      
      if (closedPopupData) {
        try {
          closedPopupInfo = JSON.parse(closedPopupData);
          // ì˜¤ëŠ˜ ë‚ ì§œì™€ ë¹„êµ
          const today = new Date().toISOString().split('T')[0];
          if (closedPopupInfo.date !== today) {
            // í•˜ë£¨ê°€ ì§€ë‚¬ìœ¼ë©´ ì‚­ì œ
            localStorage.removeItem('closedPopupData');
            closedPopupInfo = null;
          }
        } catch (e) {
          // íŒŒì‹± ì˜¤ë¥˜ ì‹œ ì‚­ì œ
          localStorage.removeItem('closedPopupData');
        }
      }
      
      try {
        const response = await fetch('/api/popups/active');
        const result = await response.json();
        
        if (result.success && result.data) {
          const popup = result.data;
          
          // ì´ë¯¸ ë‹«ì€ íŒì—…ì´ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ (í•˜ë£¨ ë™ì•ˆ)
          if (closedPopupInfo && closedPopupInfo.popupId === popup.id) {
            return;
          }
          
          // íŒì—… í‘œì‹œ
          showPopup(popup);
        }
      } catch (error) {
        console.error('í™œì„± íŒì—… í™•ì¸ ì˜¤ë¥˜:', error);
      }
    }
    window.checkAndShowPopup = checkAndShowPopup;
    
    // íŒì—… í‘œì‹œ
    function showPopup(popup) {
      const layer = document.getElementById('popupLayer');
      const popupContentDiv = document.getElementById('popupContent');
      const title = document.getElementById('popupTitle');
      const body = document.getElementById('popupBody');
      
      if (layer && popupContentDiv && title && body) {
        title.textContent = popup.title || '';
        
        // ì´ë¯¸ì§€ í‘œì‹œ
        const imageUrl = popup.image_url;
        let bodyContent = '';
        if (imageUrl) {
          bodyContent = `<img src="${escapeHtml(imageUrl)}" alt="íŒì—… ì´ë¯¸ì§€" style="max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 15px; display: block;">`;
        }
        bodyContent += `<div style="white-space: pre-wrap;">${escapeHtml(popup.content || '')}</div>`;
        body.innerHTML = bodyContent;
        
        // ì‚¬ì´ì¦ˆ ì„¤ì •
        const width = popup.width || 600;
        const height = popup.height || 400;
        popupContentDiv.style.width = width + 'px';
        popupContentDiv.style.maxWidth = width + 'px';
        popupContentDiv.style.maxHeight = height + 'px';
        
        layer.style.display = 'flex';
        
        // íŒì—… IDë¥¼ data ì†ì„±ì— ì €ì¥ (ë‹«ì„ ë•Œ ì‚¬ìš©)
        layer.setAttribute('data-popup-id', popup.id);
      }
    }
    window.showPopup = showPopup;
    
    // íŒì—… ë‹«ê¸° (ì¼ì‹œì ìœ¼ë¡œë§Œ ë‹«ê¸°)
    function closePopup() {
      const layer = document.getElementById('popupLayer');
      if (layer) {
        layer.style.display = 'none';
      }
    }
    window.closePopup = closePopup;
    
    // íŒì—… ë‹«ê¸° (í•˜ë£¨ ë™ì•ˆ í‘œì‹œ ì•ˆ í•¨)
    function closePopupForToday() {
      const layer = document.getElementById('popupLayer');
      if (layer) {
        const popupId = layer.getAttribute('data-popup-id');
        if (popupId) {
          // ë‹«ì€ íŒì—… ì •ë³´ë¥¼ localStorageì— ì €ì¥ (ì˜¤ëŠ˜ ë‚ ì§œì™€ í•¨ê»˜ ì €ì¥í•˜ì—¬ í•˜ë£¨ ë™ì•ˆ ë‹¤ì‹œ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
          const today = new Date().toISOString().split('T')[0];
          const closedPopupData = {
            popupId: parseInt(popupId),
            date: today
          };
          localStorage.setItem('closedPopupData', JSON.stringify(closedPopupData));
        }
        layer.style.display = 'none';
      }
    }
    window.closePopupForToday = closePopupForToday;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ì¹´í…Œê³ ë¦¬ í•„í„°ë¡œ ê²Œì‹œê¸€ ë¡œë“œ
    async function loadBoardPostsByCategoryFilter(categoryId = null) {
      // categoryIdê°€ ì œê³µë˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì„ íƒëœ ë²„íŠ¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°
      if (categoryId === null) {
        const activeBtn = document.querySelector('.category-menu-btn.active');
        categoryId = activeBtn ? activeBtn.getAttribute('data-category-id') || '' : '';
      }
      
      const tbody = document.getElementById('boardPostList');
      
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="5" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        let url = '/api/board/posts';
        if (categoryId) {
          url += `?category_id=${categoryId}`;
        }
        
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="no-data">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach((post, index) => {
            const isPinned = post.is_pinned || (post.is_pinned === 1);
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            const tr = document.createElement('tr');
            tr.style.cursor = 'pointer';
            tr.onclick = () => showBoardDetail(post.id);
            tr.onmouseover = function() { this.style.backgroundColor = '#fff9e6'; };
            tr.onmouseout = function() { this.style.backgroundColor = ''; };
            
            tr.innerHTML = `
              <td style="text-align: center;">${result.data.length - index}</td>
              <td style="text-align: center;">
                <span style="font-size: 12px; color: #636e72; background: #fff9e6; padding: 4px 8px; border-radius: 4px;">${escapeHtml(post.category_name || '')}</span>
              </td>
              <td style="${isPinned ? 'font-weight: 700; color: #ff6b35;' : ''}">
                ${isPinned ? 'ğŸ“Œ ' : ''}${escapeHtml(post.title || '')}
              </td>
              <td style="text-align: center;">${escapeHtml(post.author_name || '')}</td>
              <td style="text-align: center;">${createdAt}</td>
            `;
            
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="5" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="5" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadBoardPostsByCategoryFilter = loadBoardPostsByCategoryFilter;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ë¡œë“œ
    let currentBoardCategoryId = null;
    
    async function loadBoardPostsByCategory(categoryId) {
      currentBoardCategoryId = categoryId;
      const container = document.getElementById('boardPostList');
      const title = document.getElementById('boardCategoryTitle');
      
      if (!container) return;
      
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const response = await fetch(`/api/board/posts?category_id=${categoryId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          // ì¹´í…Œê³ ë¦¬ëª… ê°€ì ¸ì˜¤ê¸°
          const categoryResponse = await fetch('/api/board/categories');
          const categoryResult = await categoryResponse.json();
          const category = categoryResult.data.find(c => c.id == categoryId);
          if (title && category) {
            title.textContent = `ğŸ“‹ ${category.name}`;
          }
          
          if (result.data.length === 0) {
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
          }
          
          container.innerHTML = '';
          result.data.forEach(post => {
            const isPinned = post.is_pinned || (post.is_pinned === 1);
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            
            const postCard = document.createElement('div');
            postCard.style.cssText = 'background: ' + (isPinned ? '#fff9e6' : '#ffffff') + '; border: 2px solid ' + (isPinned ? '#ff6b35' : '#ffeaa7') + '; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s;';
            postCard.onclick = () => showBoardDetail(post.id);
            postCard.onmouseover = function() { this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 4px 12px rgba(255, 107, 53, 0.2)'; };
            postCard.onmouseout = function() { this.style.transform = 'translateY(0)'; this.style.boxShadow = 'none'; };
            
            postCard.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <h4 style="margin: 0; color: #ff6b35; font-size: 18px; font-weight: ${isPinned ? '700' : '600'};">
                  ${isPinned ? 'ğŸ“Œ ' : ''}${escapeHtml(post.title || '')}
                </h4>
                <span style="font-size: 12px; color: #636e72;">ì¡°íšŒìˆ˜: ${post.view_count || 0}</span>
              </div>
              <div style="color: #636e72; font-size: 13px; margin-bottom: 12px;">
                ì‘ì„±ì: ${escapeHtml(post.author_name || '')} | ì‘ì„±ì¼: ${createdAt}
              </div>
              <div style="color: #2d3436; font-size: 14px; line-height: 1.6; max-height: 60px; overflow: hidden; text-overflow: ellipsis;">
                ${escapeHtml((post.content || '').substring(0, 100))}${(post.content || '').length > 100 ? '...' : ''}
              </div>
            `;
            
            container.appendChild(postCard);
          });
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    window.loadBoardPostsByCategory = loadBoardPostsByCategory;
    
    // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
    async function showBoardDetail(boardId) {
      try {
        const response = await fetch(`/api/board/posts/${boardId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const post = result.data;
          const isPinned = post.is_pinned || (post.is_pinned === 1);
          const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
          const updatedAt = post.updated_at ? new Date(post.updated_at).toLocaleDateString('ko-KR') : '-';
          
          let modalHtml = `
            <div id="boardDetailModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeBoardDetailModal(event)">
              <div style="background: white; border-radius: 16px; padding: 30px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                  <div style="flex: 1;">
                    <h3 style="margin: 0 0 8px 0; color: #ff6b35; font-size: 22px; font-weight: ${isPinned ? '700' : '600'};">
                      ${isPinned ? 'ğŸ“Œ ' : ''}${escapeHtml(post.title || '')}
                    </h3>
                    <div style="color: #636e72; font-size: 13px;">
                      ì‘ì„±ì: ${escapeHtml(post.author_name || '')} | ì‘ì„±ì¼: ${createdAt}
                      ${updatedAt !== createdAt ? ' | ìˆ˜ì •ì¼: ' + updatedAt : ''}
                    </div>
                  </div>
                  <button onclick="closeBoardDetailModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
                </div>
                <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; white-space: pre-wrap; line-height: 1.8; color: #2d3436; font-size: 14px;">
                  ${escapeHtml(post.content || '')}
                </div>
          `;
          
          // ì²¨ë¶€íŒŒì¼ í‘œì‹œ
          if (post.files && post.files.length > 0) {
            modalHtml += `
              <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                <h4 style="margin: 0 0 12px 0; color: #2d3436; font-size: 16px; font-weight: 600;">ì²¨ë¶€íŒŒì¼</h4>
                <div style="display: flex; flex-direction: column; gap: 8px;">
            `;
            post.files.forEach(file => {
              modalHtml += `
                <a href="${escapeHtml(file.file_url)}" target="_blank" style="display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: #fff9e6; border: 1px solid #ffeaa7; border-radius: 8px; text-decoration: none; color: #2d3436; transition: all 0.2s;" onmouseover="this.style.background='#ffeaa7'" onmouseout="this.style.background='#fff9e6'">
                  <span style="font-size: 18px;">ğŸ“</span>
                  <span style="flex: 1; font-size: 14px;">${escapeHtml(file.file_name)}</span>
                  <span style="font-size: 12px; color: #636e72;">${file.file_size ? (file.file_size / 1024).toFixed(1) + ' KB' : ''}</span>
                </a>
              `;
            });
            modalHtml += `
                </div>
              </div>
            `;
          }
          
          modalHtml += `
              </div>
            </div>
          `;
          
          // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
          const existingModal = document.getElementById('boardDetailModal');
          if (existingModal) {
            existingModal.remove();
          }
          
          document.body.insertAdjacentHTML('beforeend', modalHtml);
        } else {
          alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.showBoardDetail = showBoardDetail;
    
    // ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeBoardDetailModal(event) {
      if (event && event.target.id !== 'boardDetailModal' && !event.target.closest('#boardDetailModal > div')) {
        return;
      }
      const modal = document.getElementById('boardDetailModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeBoardDetailModal = closeBoardDetailModal;
    
    // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (í™”ì£¼ì‚¬ ëª¨ë“œ)
    async function loadBoardPosts() {
      loadBoardPostsByCategoryFilter();
    }
    window.loadBoardPosts = loadBoardPosts;
    
    // í—¤ë” hover ì´ë²¤íŠ¸ ì™„ì „íˆ ì°¨ë‹¨
    function disableHeaderHover() {
      const headerCells = document.querySelectorAll('thead th');
      const thead = document.querySelector('thead');
      
      // thead ìì²´ì—ë„ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
      if (thead) {
        const theadRow = thead.querySelector('tr');
        if (theadRow) {
          theadRow.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          theadRow.style.setProperty('background-color', '#ff9500', 'important');
        }
        const forceTheadStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          const row = this.querySelector('tr');
          if (row) {
            row.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
            row.style.setProperty('background-color', '#ff9500', 'important');
          }
        };
        forceTheadStyle.call(thead);
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout'].forEach(eventType => {
          thead.addEventListener(eventType, forceTheadStyle, true);
        });
      }
      
      headerCells.forEach(th => {
        // ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜
        const forceStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          this.style.setProperty('cursor', 'default', 'important');
          this.style.setProperty('transition', 'none', 'important');
          this.style.setProperty('opacity', '1', 'important');
          this.style.setProperty('text-align', 'center', 'important');
          this.style.setProperty('border', 'none', 'important');
          this.style.setProperty('margin', '0', 'important');
          // ëª¨ë“  ìì‹ ìš”ì†Œì—ë„ ì ìš©
          const children = this.querySelectorAll('*');
          children.forEach(child => {
            child.style.setProperty('background', 'transparent', 'important');
            child.style.setProperty('background-color', 'transparent', 'important');
            child.style.setProperty('color', 'white', 'important');
          });
        };
        
        // ëª¨ë“  ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì—ì„œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© (ìº¡ì²˜ ë‹¨ê³„ì—ì„œ)
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout', 'mousemove'].forEach(eventType => {
          th.addEventListener(eventType, function(e) {
            e.stopPropagation();
            forceStyle.call(this);
          }, true); // ìº¡ì²˜ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬
        });
        
        // ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
        forceStyle.call(th);
        
        // requestAnimationFrameì„ ì‚¬ìš©í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ìŠ¤íƒ€ì¼ í™•ì¸
        function checkAndForceStyle() {
          const computedStyle = window.getComputedStyle(th);
          const bg = computedStyle.backgroundColor;
          const color = computedStyle.color;
          const textAlign = computedStyle.textAlign;
          // ìƒ‰ìƒì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (rgb(255, 149, 0) = #ff9500 ì£¼í™©ìƒ‰, rgb(255, 255, 255) = white)
          // ì£¼í™©ìƒ‰ ê³„ì—´ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê°•ì œ ì ìš© (rgb(255, 149, 0) ë˜ëŠ” rgb(255, 165, 2))
          const isOrange = bg.includes('rgb(255, 149') || bg.includes('rgb(255, 165') || bg.includes('255, 149') || bg.includes('255, 165');
          if (!isOrange || color !== 'rgb(255, 255, 255)' || textAlign !== 'center') {
            forceStyle.call(th);
          }
          requestAnimationFrame(checkAndForceStyle);
        }
        checkAndForceStyle();
      });
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ì–¸ì œë“ ì§€ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡
    window.disableHeaderHover = disableHeaderHover;
    
    /* ========== ê´€ë¦¬ì íƒ­ ì „í™˜ ========== */
    function switchAdminTab(tabName) {
      console.log('=== switchAdminTab í˜¸ì¶œ ===', tabName);
      
      // ëª¨ë“  íƒ­ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
      const returnsTab = document.getElementById('returnsTab');
      const registerTab = document.getElementById('registerTab');
      const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
      const boardTab = document.getElementById('boardTab');
      const popupTab = document.getElementById('popupTab');
      const passwordTab = document.getElementById('passwordTab');
      
      console.log('íƒ­ ìš”ì†Œ í™•ì¸:', {
        returnsTab: returnsTab ? 'ì¡´ì¬' : 'ì—†ìŒ',
        registerTab: registerTab ? 'ì¡´ì¬' : 'ì—†ìŒ',
        scheduleCalendarTab: scheduleCalendarTab ? 'ì¡´ì¬' : 'ì—†ìŒ',
        passwordTab: passwordTab ? 'ì¡´ì¬' : 'ì—†ìŒ'
      });
      
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°
      const tabButtons = document.querySelectorAll('#adminTabs .tab-btn');
      console.log('íƒ­ ë²„íŠ¼ ê°œìˆ˜:', tabButtons.length);
      
      // 1. ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      tabButtons.forEach((btn, index) => {
        btn.classList.remove('active');
      });
      
      // 2. ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸° (ê°•ì œë¡œ)
      const allTabs = [
        {tab: returnsTab, name: 'returnsTab'},
        {tab: registerTab, name: 'registerTab'},
        {tab: scheduleCalendarTab, name: 'scheduleCalendarTab'},
        {tab: boardTab, name: 'boardTab'},
        {tab: popupTab, name: 'popupTab'}
      ];
      
      // passwordTabë„ ìˆ¨ê¸°ê¸° (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
      if (passwordTab) {
        passwordTab.classList.add('hidden');
        passwordTab.style.setProperty('display', 'none', 'important');
        passwordTab.style.setProperty('visibility', 'hidden', 'important');
        passwordTab.style.setProperty('opacity', '0', 'important');
      }
      
      allTabs.forEach((item) => {
        if (item.tab) {
          item.tab.classList.add('hidden');
          item.tab.style.setProperty('display', 'none', 'important');
          item.tab.style.setProperty('visibility', 'hidden', 'important');
          item.tab.style.setProperty('opacity', '0', 'important');
          console.log(`${item.name} ìˆ¨ê¹€`);
        }
      });
      
      // 3. ì„ íƒëœ íƒ­ í‘œì‹œ
      let selectedTab = null;
      let selectedButtonIndex = -1;
      
      if (tabName === 'returns' && returnsTab) {
        selectedTab = returnsTab;
        selectedButtonIndex = 0;
      } else if (tabName === 'scheduleCalendar' && scheduleCalendarTab) {
        selectedTab = scheduleCalendarTab;
        selectedButtonIndex = 1;
        // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ë° ë‹¬ë ¥ ë¡œë“œ
        loadCompaniesForSchedule();
        loadCalendarSchedules();
      } else if (tabName === 'board' && boardTab) {
        selectedTab = boardTab;
        selectedButtonIndex = 2;
        // ì¹´í…Œê³ ë¦¬ ë° ê²Œì‹œê¸€ ë¡œë“œ
        loadCategories();
        loadBoards();
      } else if (tabName === 'popup' && popupTab) {
        selectedTab = popupTab;
        selectedButtonIndex = 3;
        // íŒì—… ëª©ë¡ ë¡œë“œ
        loadPopups();
      } else if (tabName === 'register' && registerTab) {
        selectedTab = registerTab;
        selectedButtonIndex = 4;
      }
      
      // í˜„ì¬ í™œì„± íƒ­ì„ localStorageì— ì €ì¥ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ ë³µì›ìš©)
      localStorage.setItem('activeAdminTab', tabName);
      // password íƒ­ ì œê±°ë¨
      
      if (selectedTab) {
        // ì„ íƒëœ íƒ­ í‘œì‹œ (ê°•ì œë¡œ)
        selectedTab.classList.remove('hidden');
        selectedTab.style.removeProperty('display');
        selectedTab.style.removeProperty('visibility');
        selectedTab.style.removeProperty('opacity');
        selectedTab.style.setProperty('display', 'block', 'important');
        selectedTab.style.setProperty('visibility', 'visible', 'important');
        selectedTab.style.setProperty('opacity', '1', 'important');
        
        console.log('ì„ íƒëœ íƒ­ í‘œì‹œ:', selectedTab.id);
        console.log('ì¸ë¼ì¸ ìŠ¤íƒ€ì¼:', {
          display: selectedTab.style.display,
          visibility: selectedTab.style.visibility,
          opacity: selectedTab.style.opacity,
          hasHidden: selectedTab.classList.contains('hidden')
        });
        
        // ì„ íƒëœ íƒ­ì˜ ì‹¤ì œ í‘œì‹œ ìƒíƒœ í™•ì¸
        setTimeout(() => {
          const computedStyle = window.getComputedStyle(selectedTab);
          console.log('ê³„ì‚°ëœ ìŠ¤íƒ€ì¼:', {
            display: computedStyle.display,
            visibility: computedStyle.visibility,
            opacity: computedStyle.opacity
          });
        }, 50);
      } else {
        console.error('ì„ íƒëœ íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', tabName);
      }
      
      // 4. ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
      if (selectedButtonIndex >= 0 && tabButtons[selectedButtonIndex]) {
        tabButtons[selectedButtonIndex].classList.add('active');
        console.log('íƒ­ ë²„íŠ¼ í™œì„±í™”:', selectedButtonIndex);
      }
      
      // 5. í˜„ì¬ í™œì„±í™”ëœ íƒ­ì„ localStorageì— ì €ì¥ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì§€)
      localStorage.setItem('activeAdminTab', tabName);
      
      // 6. í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ ì„ íƒë˜ë©´ í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
      if (tabName === 'register') {
        setTimeout(() => {
          try {
            if (typeof loadCompanies === 'function') {
              console.log('loadCompanies í•¨ìˆ˜ í˜¸ì¶œ');
              loadCompanies();
            } else {
              console.error('loadCompanies í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          } catch (error) {
            console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            console.error(error.stack);
          }
        }, 300);
      }
      
      // 7. ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ ì„ íƒë˜ë©´ ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ (ì›”ì´ ì„ íƒë˜ì–´ ìˆì„ ë•Œë§Œ)
      if (tabName === 'returns') {
        setTimeout(() => {
          const monthSelect = document.getElementById('monthSelect');
          if (monthSelect) {
            // ì›”ì´ ì„ íƒë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì›”ë¡œ ì„¤ì •
            if (!monthSelect.value) {
              const today = new Date();
              const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
              monthSelect.value = currentMonth;
            }
            // ë°ì´í„° ë¡œë“œ
            if (monthSelect.value) {
              try {
                if (typeof refreshReturnsData === 'function') {
                  console.log('ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ');
                  refreshReturnsData();
                }
              } catch (error) {
                console.error('ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
              }
            }
          }
        }, 300);
      }
      
      console.log('=== switchAdminTab ì™„ë£Œ ===');
    }
    window.switchAdminTab = switchAdminTab;
    
    /* ========== í™”ì£¼ì‚¬ ë“±ë¡ í¼ ì ‘ì´ì‹ ========== */
    function toggleAddCompanyForm() {
      const form = document.getElementById('addCompanyForm');
      const icon = document.getElementById('addCompanyIcon');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        icon.textContent = 'â–²';
        icon.style.transform = 'rotate(0deg)';
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¼';
        icon.style.transform = 'rotate(0deg)';
        const form = document.getElementById('adminRegisterForm');
        if (form) {
          form.reset();
        }
        const statusEl = document.getElementById('adminRegisterStatus');
        if (statusEl) {
          statusEl.className = 'admin-status';
          statusEl.textContent = '';
          statusEl.style.display = 'none';
        }
      }
    }
    window.toggleAddCompanyForm = toggleAddCompanyForm;
    
    /* ========== í™”ì£¼ì‚¬ ë“±ë¡ ========== */
    function registerCompany() {
      console.log('=== registerCompany í•¨ìˆ˜ í˜¸ì¶œ ===');
      
      const btn = document.getElementById('adminRegisterBtn');
      const status = document.getElementById('adminRegisterStatus');
      
      if (!btn || !status) {
        console.error('âŒ ë²„íŠ¼ ë˜ëŠ” ìƒíƒœ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        alert('í™”ì£¼ì‚¬ ë“±ë¡ í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸°
      const companyNameEl = document.getElementById('adminRegCompanyName');
      const usernameEl = document.getElementById('adminRegUsername');
      const passwordEl = document.getElementById('adminRegPassword');
      const roleEl = document.getElementById('adminRegRole');
      const businessNumberEl = document.getElementById('adminRegBusinessNumber');
      const businessNameEl = document.getElementById('adminRegBusinessName');
      const businessAddressEl = document.getElementById('adminRegBusinessAddress');
      const businessTelEl = document.getElementById('adminRegBusinessTel');
      const businessEmailEl = document.getElementById('adminRegBusinessEmail');
      
      if (!companyNameEl || !usernameEl || !passwordEl || !roleEl) {
        console.error('âŒ í•„ìˆ˜ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        alert('í™”ì£¼ì‚¬ ë“±ë¡ í¼ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const companyName = companyNameEl.value.trim();
      const username = usernameEl.value.trim();
      const password = passwordEl.value.trim();
      const role = roleEl.value.trim();
      const businessNumber = businessNumberEl ? businessNumberEl.value.trim() : '';
      const businessName = businessNameEl ? businessNameEl.value.trim() : '';
      const businessAddress = businessAddressEl ? businessAddressEl.value.trim() : '';
      const businessTel = businessTelEl ? businessTelEl.value.trim() : '';
      const businessEmail = businessEmailEl ? businessEmailEl.value.trim() : '';

      console.log('ì…ë ¥ëœ ë°ì´í„°:', { companyName, username, password: '***', role });

      if (!companyName || !username || !password || !role) {
        status.className = 'admin-status error';
        status.textContent = 'í™”ì£¼ì‚¬ëª…, ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ê¶Œí•œì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        console.error('âŒ í•„ìˆ˜ ì…ë ¥ í•­ëª© ëˆ„ë½');
        return;
      }
      
      if (role !== 'í™”ì£¼ì‚¬' && role !== 'ê´€ë¦¬ì') {
        status.className = 'admin-status error';
        status.textContent = 'ê¶Œí•œì€ í™”ì£¼ì‚¬ ë˜ëŠ” ê´€ë¦¬ì ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.';
        console.error('âŒ ì˜ëª»ëœ ê¶Œí•œ:', role);
        return;
      }

      btn.disabled = true;
      btn.textContent = 'ë“±ë¡ ì¤‘...';
      status.className = 'admin-status loading';
      status.textContent = 'í™”ì£¼ì‚¬ ë“±ë¡ ì¤‘...';
      
      const data = {
        company_name: companyName,
        username: username,
        password: password,
        role: role,
        business_number: businessNumber || undefined,
        business_name: businessName || undefined,
        business_address: businessAddress || undefined,
        business_tel: businessTel || undefined,
        business_email: businessEmail || undefined
      };

      console.log('í™”ì£¼ì‚¬ ë“±ë¡ ìš”ì²­ ë°ì´í„°:', { ...data, password: '***' });
      console.log('API_BASE_URL:', API_BASE_URL);
      console.log('API URL:', `${API_BASE_URL}/api/auth/register`);
      
      // ë²„íŠ¼ ë¹„í™œì„±í™”
      btn.disabled = true;
      btn.textContent = 'ë“±ë¡ ì¤‘...';
      status.className = 'admin-status loading';
      status.textContent = 'í™”ì£¼ì‚¬ ë“±ë¡ ì¤‘...';
      status.style.display = 'block';
      
      fetch(`${API_BASE_URL}/api/auth/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => {
        console.log('í™”ì£¼ì‚¬ ë“±ë¡ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        console.log('ì‘ë‹µ í—¤ë”:', response.headers);
        
        // ì‘ë‹µ ë³¸ë¬¸ ì½ê¸°
        return response.text().then(text => {
          console.log('ì‘ë‹µ ë³¸ë¬¸ (ì›ë³¸):', text);
          try {
            const json = JSON.parse(text);
            return { status: response.status, ok: response.ok, data: json };
          } catch (e) {
            console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
            return { status: response.status, ok: response.ok, data: { success: false, message: 'ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' } };
          }
        });
      })
      .then(result => {
        console.log('í™”ì£¼ì‚¬ ë“±ë¡ ì‘ë‹µ ë°ì´í„°:', result);
        
        if (result.ok && result.data.success) {
          status.className = 'admin-status success';
          status.textContent = result.data.message || 'í™”ì£¼ì‚¬ ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.';
          status.style.display = 'block';
          
          // í¼ ì´ˆê¸°í™”
          const form = document.getElementById('adminRegisterForm');
          if (form) {
            form.reset();
          }
          
          // í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          if (typeof loadCompanies === 'function') {
            console.log('í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ í˜¸ì¶œ');
            loadCompanies();
          } else {
            console.warn('âš ï¸ loadCompanies í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
          
          // í¼ ë‹«ê¸° (1.5ì´ˆ í›„)
          setTimeout(() => {
            if (typeof toggleAddCompanyForm === 'function') {
              toggleAddCompanyForm();
            }
          }, 1500);
        } else {
          status.className = 'admin-status error';
          status.textContent = result.data.message || 'í™”ì£¼ì‚¬ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          status.style.display = 'block';
          console.error('í™”ì£¼ì‚¬ ë“±ë¡ ì‹¤íŒ¨:', result.data);
        }
        
        btn.disabled = false;
        btn.textContent = 'ë“±ë¡í•˜ê¸°';
      })
      .catch(error => {
        console.error('í™”ì£¼ì‚¬ ë“±ë¡ ì˜¤ë¥˜:', error);
        console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
        status.className = 'admin-status error';
        status.textContent = 'í™”ì£¼ì‚¬ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error);
        status.style.display = 'block';
        btn.disabled = false;
        btn.textContent = 'ë“±ë¡í•˜ê¸°';
      });
    }
    window.registerCompany = registerCompany;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ========== */
    function refreshCompaniesData() {
      console.log('í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨');
      // í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const registerTab = document.getElementById('registerTab');
      if (registerTab && !registerTab.classList.contains('hidden') && registerTab.style.display !== 'none') {
        loadCompanies();
      } else {
        console.log('í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      }
    }
    window.refreshCompaniesData = refreshCompaniesData;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ========== */
    function loadCompanies() {
      try {
        const tbody = document.getElementById('companiesTableBody');
        if (!tbody) {
          console.error('companiesTableBody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        tbody.innerHTML = '<tr><td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
        
        fetch('/api/auth/companies', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.companies) {
            // í†µê³„ í‘œì‹œ
            if (data.statistics) {
              const statsEl = document.getElementById('companiesStatistics');
              if (statsEl) {
                statsEl.textContent = `(ê´€ë¦¬ì: ${data.statistics.admin_count}, í™”ì£¼ì‚¬: ${data.statistics.company_count})`;
              }
            }
            renderCompaniesTable(data.companies);
          } else {
            tbody.innerHTML = '<tr><td colspan="12" class="no-data">í™”ì£¼ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          }
        })
        .catch(error => {
          console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          if (tbody) {
            tbody.innerHTML = '<tr><td colspan="12" class="no-data">í™”ì£¼ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</td></tr>';
          }
        });
      } catch (error) {
        console.error('loadCompanies í•¨ìˆ˜ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCompanies = loadCompanies;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸” ë Œë”ë§ ========== */
    function renderCompaniesTable(companies) {
      const tbody = document.getElementById('companiesTableBody');
      tbody.innerHTML = '';
      
      if (!companies || companies.length === 0) {
        tbody.innerHTML = '<tr><td colspan="13" class="no-data">ë“±ë¡ëœ í™”ì£¼ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      companies.forEach(company => {
        const tr = document.createElement('tr');
        
        // ë‚ ì§œ í¬ë§·íŒ…
        const createdAt = company.created_at ? new Date(company.created_at).toLocaleDateString('ko-KR') : '-';
        
        // ìµœê·¼ ë¡œê·¸ì¸ ë‚ ì§œ í¬ë§·íŒ…
        let lastLogin = '-';
        if (company.last_login) {
          const lastLoginDate = new Date(company.last_login);
          const now = new Date();
          const diffMs = now - lastLoginDate;
          const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
          const diffMinutes = Math.floor(diffMs / (1000 * 60));
          
          if (diffMinutes < 1) {
            lastLogin = 'ë°©ê¸ˆ ì „';
          } else if (diffMinutes < 60) {
            lastLogin = `${diffMinutes}ë¶„ ì „`;
          } else if (diffHours < 24) {
            lastLogin = `${diffHours}ì‹œê°„ ì „`;
          } else if (diffDays < 7) {
            lastLogin = `${diffDays}ì¼ ì „`;
          } else {
            lastLogin = lastLoginDate.toLocaleDateString('ko-KR');
          }
        }
        
        // ê¶Œí•œ í‘œì‹œ (ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„)
        const role = company.role || 'í™”ì£¼ì‚¬';
        const roleColor = role === 'ê´€ë¦¬ì' ? '#ff6b35' : '#feca57';
        const roleBg = role === 'ê´€ë¦¬ì' ? 'linear-gradient(135deg, #ff6b35 0%, #ff5722 100%)' : 'linear-gradient(135deg, #feca57 0%, #ffa502 100%)';
        const roleHtml = `<span style="background: ${roleBg}; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700; font-size: 13px;">${escapeHtml(role)}</span>`;
        
        // ì‚¬ì—…ì ë“±ë¡ì¦ ë²„íŠ¼
        const certificateUrl = company.business_certificate_url || '';
        let certificateHtml = '';
        if (certificateUrl) {
          certificateHtml = `<button class="save-btn" onclick="viewCertificate(${company.id}, '${escapeHtml(certificateUrl)}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%); color: #ff6b35; border: 2px solid #ffa502; padding: 5px 10px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(255, 165, 2, 0.2); transition: all 0.3s ease; white-space: nowrap;">ğŸ“„ ë³´ê¸°</button>`;
        } else {
          certificateHtml = `<button class="save-btn" onclick="uploadCertificate(${company.id})" style="background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%); color: #ff6b35; border: 2px solid #ffeaa7; padding: 5px 10px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(255, 152, 0, 0.15); transition: all 0.3s ease; white-space: nowrap;">ğŸ“¤ ì—…ë¡œë“œ</button>`;
        }
        
        // íƒœê·¸ í‘œì‹œ
        const searchKeywords = company.search_keywords || '';
        const tags = searchKeywords ? searchKeywords.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
        let tagsHtml = '';
        if (tags.length > 0) {
          tagsHtml = tags.map(tag => 
            `<span style="display: inline-block; background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; margin: 2px; box-shadow: 0 2px 4px rgba(116, 185, 255, 0.3);">${escapeHtml(tag)}</span>`
          ).join('');
        } else {
          tagsHtml = '<span style="color: #999; font-size: 12px;">íƒœê·¸ ì—†ìŒ</span>';
        }
        
        // ê´€ë¦¬ ë²„íŠ¼ (ë°˜ì‘í˜• - 1ì—´ ìœ ì§€)
        const manageHtml = `
          <div style="display: flex; gap: 4px; justify-content: center; align-items: center; flex-wrap: nowrap; min-width: 200px;">
            <button class="save-btn" onclick="openTagModal(${company.id}, '${escapeHtml(company.username || '')}', '${escapeHtml(company.company_name || '')}', '${escapeHtml(searchKeywords)}')" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(116, 185, 255, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ğŸ·ï¸ íƒœê·¸</button>
            <button class="save-btn" onclick="changeCompanyPassword(${company.id}, '${escapeHtml(company.username || '')}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%); color: #ff6b35; border: 2px solid #ffa502; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(255, 165, 2, 0.2); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ğŸ”’ ë¹„ë°€ë²ˆí˜¸</button>
            <button class="save-btn" onclick="deleteCompany(${company.id}, '${escapeHtml(company.company_name || '')}')" style="background: linear-gradient(135deg, #ee5a6f 0%, #ff6b35 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(238, 90, 111, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        `;
        
        tr.innerHTML = `
          <td>${escapeHtml(company.company_name || '-')}</td>
          <td>${escapeHtml(company.username || '-')}</td>
          <td>${roleHtml}</td>
          <td style="max-width: 200px; word-wrap: break-word;">${tagsHtml}</td>
          <td>${escapeHtml(company.business_number || '-')}</td>
          <td>${escapeHtml(company.business_name || '-')}</td>
          <td>${escapeHtml(company.business_address || '-')}</td>
          <td>${escapeHtml(company.business_tel || '-')}</td>
          <td>${escapeHtml(company.business_email || '-')}</td>
          <td style="text-align: center; white-space: nowrap;">${certificateHtml}</td>
          <td>${lastLogin}</td>
          <td>${createdAt}</td>
          <td style="text-align: center; white-space: nowrap; min-width: 200px;">${manageHtml}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    window.renderCompaniesTable = renderCompaniesTable;
    
    /* ========== í™”ì£¼ì‚¬ ì‚­ì œ ========== */
    function deleteCompany(companyId, companyName) {
      if (!confirm(`ì •ë§ë¡œ "${companyName}" í™”ì£¼ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('í™”ì£¼ì‚¬ ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ í™”ì£¼ì‚¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.deleteCompany = deleteCompany;
    
    /* ========== í™”ì£¼ì‚¬ íƒœê·¸ ê´€ë¦¬ ========== */
    function openTagModal(companyId, username, companyName, currentTags) {
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('tagModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      // ëª¨ë‹¬ HTML ìƒì„±
      const modalHtml = `
        <div id="tagModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeTagModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 22px; font-weight: 700;">ğŸ·ï¸ íƒœê·¸ ê´€ë¦¬</h3>
              <button onclick="closeTagModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
              <p style="margin: 0 0 10px 0; color: #333; font-size: 14px; font-weight: 600;">í™”ì£¼ì‚¬: <span style="color: #ff6b35;">${escapeHtml(companyName)}</span></p>
              <p style="margin: 0; color: #666; font-size: 12px;">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
              <p style="margin: 5px 0 0 0; color: #999; font-size: 11px;">ì˜ˆ: tks, TKSì»´í¼ë‹ˆ, í‹°ì¼€ì´ì—ìŠ¤</p>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-size: 14px; font-weight: 600;">íƒœê·¸ ì…ë ¥</label>
              <textarea id="tagInput" placeholder="íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: tks, TKSì»´í¼ë‹ˆ)" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 80px; box-sizing: border-box;" onfocus="this.style.borderColor='#74b9ff'" onblur="this.style.borderColor='#e0e0e0'">${escapeHtml(currentTags || '')}</textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button onclick="closeTagModal()" style="background: #e0e0e0; color: #333; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#d0d0d0'" onmouseout="this.style.background='#e0e0e0'">ì·¨ì†Œ</button>
              <button onclick="saveCompanyTags(${companyId}, '${escapeHtml(username)}')" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(116, 185, 255, 0.25);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(116, 185, 255, 0.35)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(116, 185, 255, 0.25)'">ì €ì¥</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
      setTimeout(() => {
        const tagInput = document.getElementById('tagInput');
        if (tagInput) {
          tagInput.focus();
          tagInput.setSelectionRange(tagInput.value.length, tagInput.value.length);
        }
      }, 100);
    }
    window.openTagModal = openTagModal;
    
    // íƒœê·¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeTagModal(event) {
      if (event && event.target.id !== 'tagModal' && !event.target.closest('#tagModal > div')) {
        return;
      }
      const modal = document.getElementById('tagModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeTagModal = closeTagModal;
    
    // íƒœê·¸ ì €ì¥
    async function saveCompanyTags(companyId, username) {
      const tagInput = document.getElementById('tagInput');
      if (!tagInput) {
        showMessage('âŒ íƒœê·¸ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      const tags = tagInput.value.trim();
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: username,
            search_keywords: tags
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showMessage('âœ… íƒœê·¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          closeTagModal();
          loadCompanies(); // í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
          showMessage('âŒ ' + (data.message || 'íƒœê·¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'), 'error');
        }
      } catch (error) {
        console.error('íƒœê·¸ ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ íƒœê·¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      }
    }
    window.saveCompanyTags = saveCompanyTags;
    
    /* ========== í™”ì£¼ì‚¬ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ========== */
    function changeCompanyPassword(companyId, username) {
      const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, '');
      
      if (!newPassword) {
        return;
      }
      
      if (newPassword.length < 4) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`ì •ë§ë¡œ "${username}"ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}/password`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          new_password: newPassword
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
        } else {
          showMessage('âŒ ' + (data.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.changeCompanyPassword = changeCompanyPassword;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ========== */
    function uploadCertificate(companyId) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*,.pdf';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ì œí•œ)
        if (file.size > 10 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        
        // íŒŒì¼ì„ Base64ë¡œ ë³€í™˜
        const reader = new FileReader();
        reader.onload = function(event) {
          const base64Data = event.target.result;
          
          // Cloudinaryì— ì—…ë¡œë“œ
          uploadCertificateToCloudinary(companyId, base64Data, file.name);
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    window.uploadCertificate = uploadCertificate;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ Cloudinary ì—…ë¡œë“œ ========== */
    function uploadCertificateToCloudinary(companyId, base64Data, fileName) {
      showMessage('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘...', 'success');
      
      // Base64 ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
      const blob = dataURLtoBlob(base64Data);
      
      // FormData ìƒì„±
      const formData = new FormData();
      formData.append('file', blob, fileName);
      
      // ì„œë²„ë¥¼ í†µí•´ Cloudinaryì— ì—…ë¡œë“œ
      fetch('/api/uploads/certificate', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success && data.url) {
          // ì—…ë¡œë“œëœ URLì„ ì„œë²„ì— ì €ì¥
          return fetch(`/api/auth/company/${companyId}/certificate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              certificate_url: data.url
            })
          });
        } else {
          throw new Error(data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ì‚¬ì—…ì ë“±ë¡ì¦ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.uploadCertificateToCloudinary = uploadCertificateToCloudinary;
    
    /* ========== Base64ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ ========== */
    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], { type: mime });
    }
    window.dataURLtoBlob = dataURLtoBlob;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ë³´ê¸° ========== */
    function viewCertificate(companyId, certificateUrl) {
      // ìƒˆ ì°½ì—ì„œ ì‚¬ì—…ì ë“±ë¡ì¦ ì—´ê¸°
      window.open(certificateUrl, '_blank');
    }
    window.viewCertificate = viewCertificate;
    
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', function() {
      // ìë™ ë¡œê·¸ì¸ í™•ì¸
      const savedCompany = localStorage.getItem('client_company');
      const savedUsername = localStorage.getItem('client_username');
      const savedRole = localStorage.getItem('client_role');
      const loginTime = localStorage.getItem('client_loginTime');
      
      if (savedCompany && savedUsername && loginTime) {
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
          currentCompany = savedCompany;
          currentUsername = savedUsername;
          currentRole = (savedRole || '').toString().trim();
          console.log('ìë™ ë¡œê·¸ì¸ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole); // ë””ë²„ê¹…ìš©
          console.log('ìë™ ë¡œê·¸ì¸ - ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          showDashboard();
          // í—¤ë” hover ì°¨ë‹¨ ì ìš©
          setTimeout(() => {
            disableHeaderHover();
            // í™œì„± íŒì—… í™•ì¸
            checkAndShowPopup();
          }, 100);
          return;
        } else {
          localStorage.removeItem('client_company');
          localStorage.removeItem('client_username');
          localStorage.removeItem('client_role');
          localStorage.removeItem('client_loginTime');
        }
      }
      
      // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('dashboardSection').style.display = 'none';
      
      // ë¡œê³  URL ì„¤ì • (Cloudinary)
      const logoUrl = 'https://res.cloudinary.com/dokk81rjh/image/upload/v1762922695/logo_srff9i.png';
      const fallbackLogoUrl = '/static/logo.png'; // ë¡œì»¬ íŒŒì¼ ê²½ë¡œ (ë°±ì—…)
      const loginLogo = document.getElementById('loginLogo');
      if (loginLogo) {
        loginLogo.src = logoUrl || fallbackLogoUrl;
      }
      
      // ì—”í„°í‚¤ ì´ë²¤íŠ¸
      document.getElementById('username').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          document.getElementById('password').focus();
        }
      });
      
      document.getElementById('password').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          doLogin();
        }
      });
      
      // ê´€ë¦¬ì í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©)
      document.addEventListener('submit', function(e) {
        if (e.target && e.target.id === 'adminRegisterForm') {
          e.preventDefault();
          e.stopPropagation();
          console.log('í¼ ì œì¶œ ì´ë²¤íŠ¸ ê°ì§€');
          if (typeof registerCompany === 'function') {
            registerCompany();
          } else {
            console.error('registerCompany í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        }
      });
      
      // ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë„ ì¶”ê°€ (ì´ì¤‘ ë³´ì•ˆ)
      document.addEventListener('click', function(e) {
        if (e.target && (e.target.id === 'adminRegisterBtn' || e.target.closest('#adminRegisterBtn'))) {
          const btn = e.target.id === 'adminRegisterBtn' ? e.target : e.target.closest('#adminRegisterBtn');
          if (btn && btn.type !== 'submit') {
            e.preventDefault();
            e.stopPropagation();
            console.log('ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ê°ì§€');
            if (typeof registerCompany === 'function') {
              registerCompany();
            } else {
              console.error('registerCompany í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          }
        }
      });
      
    });
  </script>
</body>
</html>

