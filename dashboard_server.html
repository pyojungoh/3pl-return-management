<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JJAY 3PL ì¢…í•© ë¬¼ë¥˜ - í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 50%, #ffeaa7 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ë¡œê·¸ì¸ ì„¹ì…˜ */
    .login-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
    }
    
    .login-form {
      background: #ffffff;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(255, 152, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.08);
      border: none;
      width: 100%;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .login-form h1 {
      text-align: center;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .login-form input {
      padding: 14px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 15px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .login-form input::placeholder {
      color: #b2bec3;
    }
    
    .login-form input:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .login-form button {
      padding: 14px 30px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
    }
    
    .login-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .login-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    /* ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ */
    .dashboard-section {
      display: none;
    }
    
    .dashboard-section.show {
      display: block;
    }
    
    /* ë¡œê³  ìŠ¤íƒ€ì¼ */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-letters {
      display: flex;
      align-items: center;
      position: relative;
      height: 32px;
    }
    
    .logo-j {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #ff6b35 0%, #ff5722 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      z-index: 2;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-c {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #feca57 0%, #ffa502 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      margin-left: -20px;
      z-index: 1;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-text {
      font-size: 11px;
      font-weight: 500;
      color: #636e72;
      letter-spacing: 3px;
      margin-top: 4px;
    }
    
    .header {
      background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 1;
      flex: 1;
    }
    
    .header-logo {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .header h1 {
      color: #ff6b35;
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.3px;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      border-left: 2px solid #ffeaa7;
      padding-left: 15px;
    }
    
    .header .subtitle {
      color: #636e72;
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header .creator {
      color: #b2bec3;
      font-size: 10px;
      font-style: italic;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-center {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    
    .company-info {
      color: #2d3436;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
      border: 2px solid #ffa502;
      line-height: 1.3;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(255, 165, 2, 0.15);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    
    .logout-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      background: #ffffff;
      padding: 6px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 6px;
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      border-radius: 10px;
      color: #636e72;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
      background: #fff9e6;
      color: #ff6b35;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .tab-content {
      display: block;
      visibility: visible;
      opacity: 1;
    }
    
    .tab-content.hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
    
    /* í™”ì£¼ì‚¬ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
    .admin-form {
      background: #ffffff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
    }
    
    .admin-form h3 {
      margin: 0 0 24px;
      color: #ff6b35;
      font-size: 22px;
      font-weight: 700;
    }
    
    .admin-form .form-group {
      margin-bottom: 20px;
    }
    
    .admin-form label {
      display: block;
      margin-bottom: 10px;
      color: #2d3436;
      font-weight: 600;
      font-size: 14px;
    }
    
    .admin-form input,
    .admin-form textarea,
    .admin-form select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .admin-form input::placeholder,
    .admin-form textarea::placeholder {
      color: #b2bec3;
    }
    
    .admin-form input:focus,
    .admin-form textarea:focus,
    .admin-form select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .admin-form textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .admin-form button {
      padding: 14px 32px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .admin-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    .admin-form .form-section {
      margin-top: 30px;
      padding-top: 24px;
      border-top: 2px solid #ffeaa7;
    }
    
    .admin-form .form-section h4 {
      margin: 0 0 18px;
      color: #636e72;
      font-size: 16px;
      font-weight: 600;
    }
    
    .admin-status {
      margin-top: 18px;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .admin-status.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(0, 184, 148, 0.25);
    }
    
    .admin-status.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-status.loading {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%);
      color: #ff6b35;
      border: 2px solid #ffa502;
      display: block;
    }
    
    .filters {
      background: #ffffff;
      padding: 20px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filters label {
      font-weight: 600;
      color: #2d3436;
    }
    
    .filters select {
      padding: 12px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filters select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
    }
    
    .refresh-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .refresh-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .stats {
      background: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
      padding: 20px 24px;
      border-radius: 14px;
      min-width: 120px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #ffeaa7;
      background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%);
    }
    
    .stat-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2);
      border-color: #ffa502;
    }
    
    .stat-item.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      border-color: #ff6b35;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      transform: translateY(-3px);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 800;
      color: #ff6b35;
      user-select: none;
    }
    
    .stat-item.active .stat-number {
      color: white;
    }
    
    .stat-label {
      font-size: 13px;
      color: #636e72;
      margin-top: 8px;
      user-select: none;
    }
    
    .stat-item.active .stat-label {
      color: white;
      font-weight: 600;
    }
    
    .table-container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      overflow-x: auto;
      overflow-y: hidden;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
    }
    
    thead {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead tr {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      border: none !important;
      margin: 0 !important;
    }
    
    thead,
    thead:hover,
    thead:active,
    thead:focus,
    thead:visited {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead *,
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    th {
      padding: 12px 10px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      white-space: nowrap;
      cursor: default !important;
      transition: none !important;
      -webkit-transition: none !important;
      -moz-transition: none !important;
      -o-transition: none !important;
      pointer-events: auto;
      user-select: none;
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      border: none !important;
      margin: 0 !important;
      border-spacing: 0 !important;
    }
    
    thead tr:first-child th:first-child {
      border-top-left-radius: 12px;
    }
    
    thead tr:first-child th:last-child {
      border-top-right-radius: 12px;
    }
    
    /* í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì œê±° - ëª¨ë“  ê°€ëŠ¥í•œ ìƒíƒœì™€ ì¡°í•© */
    th,
    th:hover,
    th:active,
    th:focus,
    th:visited,
    th:link,
    th::before,
    th::after {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      outline: none !important;
      box-shadow: none !important;
      transform: none !important;
      border: none !important;
      opacity: 1 !important;
    }
    
    thead th,
    thead th:hover,
    thead th:active,
    thead th:focus,
    thead th:visited,
    thead th:link,
    thead:hover th,
    thead:active th,
    thead:focus th,
    thead:hover th:hover,
    thead:active th:active {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      border: none !important;
    }
    
    /* ëª¨ë“  th ìì‹ ìš”ì†Œì—ë„ ì ìš© */
    th *,
    th *:hover,
    th *:active,
    th *:focus {
      background: transparent !important;
      background-color: transparent !important;
      color: white !important;
    }
    
    /* theadì˜ ëª¨ë“  ìš”ì†Œì— hover íš¨ê³¼ ì—†ìŒ */
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    /* í…Œì´ë¸” í—¤ë”ì˜ ëª¨ë“  ìƒíƒœì—ì„œ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ìœ ì§€ - ëª¨ë“  ì¡°í•© */
    table thead,
    table thead:hover,
    table thead:active,
    table thead th,
    table thead th:hover,
    table thead th:active,
    table thead th:focus,
    table thead:hover th,
    table thead:hover th:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    /* ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë³´ë‹¤ ìš°ì„ ìˆœìœ„ ë†’ì´ê¸° */
    thead[style],
    th[style] {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead[style]:hover,
    th[style]:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #e0e0e0;
      border-left: none !important;
      border-right: none !important;
      border-top: none !important;
      font-size: 12px;
      color: #2d3436;
      background: #ffffff;
      vertical-align: middle;
      line-height: 1.4;
    }
    
    /* thì™€ td ì‚¬ì´ì˜ ì„¸ë¡œ ê²½ê³„ì„  ì œê±° */
    th + th,
    td + td {
      border-left: none !important;
    }
    
    /* í…Œì´ë¸” ì…€ ê°„ ê°„ê²© ì œê±° */
    table th,
    table td {
      border-collapse: collapse;
    }
    
    tr:hover {
      background: #fff9e6;
    }
    
    tr {
      background: #ffffff;
      transition: background 0.2s ease;
    }
    
    tr:last-child td:first-child {
      border-bottom-left-radius: 12px;
    }
    
    tr:last-child td:last-child {
      border-bottom-right-radius: 12px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      border: none;
      line-height: 1.2;
    }
    
    .status-completed {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: none;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
    }
    
    .request-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 13px;
      resize: vertical;
      min-height: 60px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .request-input:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .save-btn {
      padding: 4px 8px;
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      margin: 0;
      transition: all 0.2s ease;
      box-shadow: none;
      display: inline-block;
      line-height: 1.2;
      height: auto;
    }
    
    .save-btn:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ff8800 100%);
      transform: none;
      box-shadow: none;
    }
    
    /* ìˆ˜ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .edit-btn {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%) !important;
      color: #ff6b35 !important;
      border: 2px solid #ffa502 !important;
    }
    
    .edit-btn:hover {
      background: linear-gradient(135deg, #ffa502 0%, #ffeaa7 100%) !important;
      color: white !important;
      border-color: #ff6b35 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 165, 2, 0.3);
    }
    
    .edit-btn:disabled {
      background: #ddd !important;
      color: #999 !important;
      border-color: #ddd !important;
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
      box-shadow: none;
    }
    
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      border: none;
      font-weight: 600;
      z-index: 1000;
      display: none;
      background: #ffffff;
      animation: slideInRight 0.3s ease;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .message.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }
    
    .message.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
    }
    
    .no-data {
      text-align: center;
      padding: 60px 40px;
      color: #b2bec3;
      font-size: 15px;
    }
    
    .admin-only {
      display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€, JavaScriptë¡œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´ */
    }
    
    #loginMessage {
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* ë¹„ê³  íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .memo-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      max-width: 300px;
      z-index: 10000;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .memo-tooltip::before {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 5px solid rgba(0, 0, 0, 0.9);
    }
    
    /* ì œí’ˆëª… ì…€ ìŠ¤íƒ€ì¼ */
    table th:nth-child(3) {
      text-align: center;
      min-width: 120px;
      max-width: 150px;
    }
    
    table td:nth-child(3) {
      text-align: center;
      min-width: 120px;
      max-width: 150px;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      padding: 10px 8px !important;
      vertical-align: middle !important;
    }
    
    .product-cell {
      text-align: center !important;
      font-weight: normal;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      display: table-cell !important;
      max-width: 100% !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
    }
    
    .product-cell.has-memo {
      color: #e74c3c !important;
      font-weight: 700 !important;
      text-decoration: none !important;
      background: transparent !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
    }
    
    /* ì‚¬ì§„ ë§í¬ ìŠ¤íƒ€ì¼ */
    .photo-links {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      align-items: center;
      line-height: 1.4;
    }
    
    .photo-link {
      color: #4a90e2;
      text-decoration: underline;
      font-size: 11px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    
    .photo-link:hover {
      color: #357abd;
    }
    
    /* ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ - ì‘ì€ ê·¸ë¼ë””ì–¸íŠ¸ ë°•ìŠ¤ì— ì²´í¬ì™€ ì´ë¦„ */
    .status-completed-circle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      padding: 3px 8px;
      border: none;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      box-shadow: none;
      line-height: 1.2;
    }
    
    .status-completed-circle::before {
      content: 'âœ“';
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      background: rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 14px;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* ì ‘ì´ì‹ ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #addReturnBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
    
    #addCompanyBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="loginSection" class="login-section">
      <div class="login-form">
        <h1>JJAY 3PL ì¢…í•© ë¬¼ë¥˜</h1>
        <p style="text-align: center; color: #636e72; margin-top: 10px; margin-bottom: 5px; font-size: 14px; font-weight: 500;">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        <p style="text-align: center; color: #b2bec3; margin-bottom: 20px; font-size: 12px; font-style: italic;">Developed by pyojungoh</p>
        <input type="text" id="username" placeholder="ì•„ì´ë””" autocomplete="username">
        <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password">
        <button id="loginBtn" type="button" onclick="doLogin(); return false;">ë¡œê·¸ì¸</button>
        <div id="loginMessage"></div>
      </div>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboardSection" class="dashboard-section">
      <!-- í—¤ë” -->
      <div class="header">
        <div class="header-left">
          <div class="header-logo">
            <div class="logo-container">
              <div class="logo-letters">
                <span class="logo-j">J</span>
                <span class="logo-c">C</span>
              </div>
            </div>
            <div class="logo-text">JAY JAY</div>
          </div>
          <div class="header-info">
            <div class="subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div class="creator">Developed by pyojungoh</div>
          </div>
        </div>
        <div class="header-center">
          <div class="company-info" id="companyInfo"></div>
        </div>
        <div class="header-right">
          <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
      
      <!-- ê´€ë¦¬ì ì „ìš© íƒ­ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
      <div id="adminTabs" style="display: none;">
        <div class="tabs">
          <button type="button" class="tab-btn active" onclick="switchAdminTab('returns')">ğŸ“¦ ë°˜í’ˆ ë‚´ì—­</button>
          <button type="button" class="tab-btn" onclick="switchAdminTab('register')">ğŸ¢ í™”ì£¼ì‚¬ ë“±ë¡</button>
        </div>
      </div>
      
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ -->
      <div id="returnsTab" class="tab-content">
      <!-- í•„í„° -->
      <div class="filters">
        <label for="monthSelect">ğŸ“… ì¡°íšŒ ì›”:</label>
        <select id="monthSelect">
          <option value="">ë¡œë”© ì¤‘...</option>
        </select>
        <button class="refresh-btn" onclick="refreshReturnsData()" id="refreshReturnsBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      </div>
      
      <!-- ë°˜í’ˆ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
      <div id="addReturnSection" style="display: none; margin-bottom: 20px;">
        <button id="addReturnBtn" class="refresh-btn" onclick="toggleAddForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
          <span>â• ë°˜í’ˆ ë“±ë¡</span>
          <span id="addReturnIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
        </button>
        
        <!-- ë°˜í’ˆ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
        <div id="addReturnForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ë°˜í’ˆ ë‚´ì—­ ë“±ë¡</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ ì ‘ìˆ˜ì¼ (ì¼ìë§Œ):</label>
              <input type="number" id="newReturnDate" class="request-input" style="min-height: auto;" placeholder="ì¼ì (1-31)" min="1" max="31">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ëª…:</label>
              <input type="text" id="newCompanyName" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ëª…">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œí’ˆ:</label>
              <input type="text" id="newProduct" class="request-input" style="min-height: auto;" placeholder="ì œí’ˆëª…">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê³ ê°ëª…:</label>
              <input type="text" id="newCustomerName" class="request-input" style="min-height: auto;" placeholder="ê³ ê°ëª…" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì†¡ì¥ë²ˆí˜¸:</label>
              <input type="text" id="newTrackingNumber" class="request-input" style="min-height: auto;" placeholder="ì†¡ì¥ë²ˆí˜¸" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡:</label>
              <select id="newReturnType" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ë°˜í’ˆ">ë°˜í’ˆ</option>
                <option value="êµí™˜">êµí™˜</option>
                <option value="ì˜¤ë°°ì†¡">ì˜¤ë°°ì†¡</option>
                <option value="ëˆ„ë½">ëˆ„ë½</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¬ê³ ìƒíƒœ:</label>
              <select id="newStockStatus" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ì •ìƒ">ì •ìƒ</option>
                <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë¹„ê³ :</label>
              <textarea id="newMemo" class="request-input" style="min-height: 60px;" placeholder="ë¹„ê³ "></textarea>
            </div>
          </div>
          <div style="margin-top: 20px; display: flex; gap: 12px;">
            <button class="save-btn" onclick="addReturn()">ì €ì¥</button>
            <button class="save-btn" onclick="toggleAddForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
      
      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-item active" id="filterAll" onclick="filterByStatus('all')">
          <div class="stat-number" id="totalCount">0</div>
          <div class="stat-label">ì „ì²´ ë°˜í’ˆ ê±´</div>
        </div>
        <div class="stat-item" id="filterCompleted" onclick="filterByStatus('completed')">
          <div class="stat-number" id="completedCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ì™„ë£Œ</div>
        </div>
        <div class="stat-item" id="filterPending" onclick="filterByStatus('pending')">
          <div class="stat-number" id="pendingCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
        </div>
      </div>
      
      <!-- í…Œì´ë¸” -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>ì ‘ìˆ˜ì¼</th>
              <th class="admin-only" style="display: none;">í™”ì£¼ì‚¬</th>
              <th>ì œí’ˆ</th>
              <th>ê³ ê°ëª…</th>
              <th>ì†¡ì¥ë²ˆí˜¸</th>
              <th>ë°˜í’ˆ/êµí™˜</th>
              <th>ì¬ê³ ìƒíƒœ</th>
              <th>ì²˜ë¦¬ì™„ë£Œ</th>
              <th>ì‚¬ì§„</th>
              <th class="admin-only" style="display: none;">ë¹„ê³ </th>
              <th>í™”ì£¼ì‚¬ ìš”ì²­ì‚¬í•­</th>
              <th class="admin-only" style="display: none;">QR</th>
              <th class="admin-only" style="display: none;">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
            </tr>
          </tbody>
        </table>
      </div>
      </div>
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ ë -->
      
      <!-- í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ -->
      <div id="registerTab" class="tab-content hidden">
        <!-- í™”ì£¼ì‚¬ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ -->
        <div style="margin-bottom: 20px;">
          <button id="addCompanyBtn" class="refresh-btn" onclick="toggleAddCompanyForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• í™”ì£¼ì‚¬ ë“±ë¡</span>
            <span id="addCompanyIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- í™”ì£¼ì‚¬ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addCompanyForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">í™”ì£¼ì‚¬ ë“±ë¡</h3>
            <form id="adminRegisterForm">
              <!-- í•„ìˆ˜ ì •ë³´ -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">í™”ì£¼ì‚¬ëª… *</label>
                  <input type="text" id="adminRegCompanyName" placeholder="í™”ì£¼ì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì•„ì´ë”” *</label>
                  <input type="text" id="adminRegUsername" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="adminRegPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ê¶Œí•œ *</label>
                  <select id="adminRegRole" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                    <option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="í™”ì£¼ì‚¬">í™”ì£¼ì‚¬</option>
                    <option value="ê´€ë¦¬ì">ê´€ë¦¬ì</option>
                  </select>
                </div>
              </div>

              <!-- ì‚¬ì—…ì ì •ë³´ (ì„ íƒ) -->
              <div style="margin-top: 30px; padding-top: 24px; border-top: 2px solid #ffeaa7;">
                <h4 style="margin: 0 0 18px; color: #636e72; font-size: 16px; font-weight: 600;">ì‚¬ì—…ì ì •ë³´ (ì„ íƒì‚¬í•­)</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìë²ˆí˜¸</label>
                    <input type="text" id="adminRegBusinessNumber" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìëª…</label>
                    <input type="text" id="adminRegBusinessName" placeholder="ì‚¬ì—…ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì£¼ì†Œ</label>
                    <input type="text" id="adminRegBusinessAddress" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="adminRegBusinessTel" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì´ë©”ì¼</label>
                    <input type="email" id="adminRegBusinessEmail" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                </div>
              </div>

              <div style="margin-top: 24px; display: flex; gap: 12px;">
                <button type="submit" id="adminRegisterBtn" style="padding: 14px 32px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);">ë“±ë¡í•˜ê¸°</button>
                <button type="button" onclick="toggleAddCompanyForm()" style="padding: 14px 32px; background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="adminRegisterStatus" class="admin-status" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
        
        <!-- í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸” -->
        <div class="table-container">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0; color: #333; font-size: 18px; display: inline-block; margin-right: 15px;">ë“±ë¡ëœ í™”ì£¼ì‚¬ ëª©ë¡</h3>
              <span id="companiesStatistics" style="color: #666; font-size: 14px;">(ê´€ë¦¬ì: 0, í™”ì£¼ì‚¬: 0)</span>
            </div>
            <button class="refresh-btn" onclick="refreshCompaniesData()" id="refreshCompaniesBtn" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>í™”ì£¼ì‚¬ëª…</th>
                <th>ì•„ì´ë””</th>
                <th>ê¶Œí•œ</th>
                <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                <th>ì‚¬ì—…ìëª…</th>
                <th>ì£¼ì†Œ</th>
                <th>ì „í™”ë²ˆí˜¸</th>
                <th>ì´ë©”ì¼</th>
                <th>ì‚¬ì—…ì ë“±ë¡ì¦</th>
                <th>ìµœê·¼ ë¡œê·¸ì¸</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="companiesTableBody">
              <tr>
                <td colspan="12" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ë©”ì‹œì§€ -->
  <div id="message" class="message"></div>
  
  <script>
    // API ê¸°ë³¸ URL (ì„œë²„ ì£¼ì†Œ)
    const API_BASE_URL = window.location.origin; // í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš©
    
    // ì „ì—­ ë³€ìˆ˜
    let currentCompany = '';
    let currentUsername = '';
    let currentRole = '';
    let currentData = [];
    let currentFilter = 'all'; // 'all', 'completed', 'pending'
    
    // ë¡œê·¸ì¸ ë©”ì‹œì§€ í‘œì‹œ
    function showLoginMessage(text, type) {
      const div = document.getElementById('loginMessage');
      if (!div) return;
      
      let bgColor = '#d1ecf1';
      let textColor = '#0c5460';
      
      if (type === 'success') {
        bgColor = '#d4edda';
        textColor = '#155724';
      } else if (type === 'error') {
        bgColor = '#f8d7da';
        textColor = '#721c24';
      }
      
      div.innerHTML = `<div style="padding: 10px 15px; border-radius: 8px; background: ${bgColor}; color: ${textColor}; font-weight: 600;">${text}</div>`;
      
      if (type !== 'loading') {
        setTimeout(() => { div.innerHTML = ''; }, 5000);
      }
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = 'message ' + type;
      messageDiv.style.display = 'block';
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }
    
    // ë¡œê·¸ì¸ í•¨ìˆ˜
    window.doLogin = function doLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');
      
      if (!username || !password) {
        showLoginMessage('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return false;
      }
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = 'ë¡œê·¸ì¸ ì¤‘...';
      showLoginMessage('ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...', 'loading');
      
      // ì„œë²„ API í˜¸ì¶œ
      fetch(`${API_BASE_URL}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      })
      .then(response => response.json())
      .then(result => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        
        if (result.success) {
          currentCompany = result.company;
          currentUsername = result.username;
          currentRole = (result.role || '').toString().trim();
          
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - result:', result); // ë””ë²„ê¹…ìš©
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole, 'ê¸¸ì´:', currentRole.length); // ë””ë²„ê¹…ìš©
          console.log('ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          
          localStorage.setItem('client_company', result.company);
          localStorage.setItem('client_username', result.username);
          localStorage.setItem('client_role', currentRole);
          localStorage.setItem('client_loginTime', new Date().toISOString());
          
          showLoginMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
          setTimeout(() => {
            showDashboard();
          }, 500);
        } else {
          showLoginMessage('âŒ ' + (result.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        showLoginMessage('âŒ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
      
      return false;
    }
    
    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      localStorage.removeItem('client_company');
      localStorage.removeItem('client_username');
      localStorage.removeItem('client_role');
      localStorage.removeItem('client_loginTime');
      
      currentCompany = '';
      currentUsername = '';
      currentRole = '';
      
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginMessage').innerHTML = '';
    }
    
    // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
    function showDashboard() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'block';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('showDashboard - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const roleText = isAdmin ? ' [ê´€ë¦¬ì]' : '';
      document.getElementById('companyInfo').textContent = `${currentCompany}${roleText} (${currentUsername})`;
      
      // ê´€ë¦¬ì íƒ­ í‘œì‹œ/ìˆ¨ê¸°ê¸°
      const adminTabs = document.getElementById('adminTabs');
      if (adminTabs) {
        adminTabs.style.display = isAdmin ? 'block' : 'none';
      }
      
      // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë°˜í’ˆ ë‚´ì—­ íƒ­ë§Œ í‘œì‹œ
      if (!isAdmin) {
        document.getElementById('returnsTab').classList.remove('hidden');
        document.getElementById('registerTab').classList.add('hidden');
        document.getElementById('passwordTab').classList.add('hidden');
        // í™”ì£¼ì‚¬ëŠ” í•­ìƒ ë°˜í’ˆ ë‚´ì—­ íƒ­ë§Œ ë³´ì´ë¯€ë¡œ localStorageì— ì €ì¥í•  í•„ìš” ì—†ìŒ
      } else {
        // ê´€ë¦¬ìë©´ ì €ì¥ëœ íƒ­ ì •ë³´ í™•ì¸ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì§€)
        const savedTab = localStorage.getItem('activeAdminTab');
        const activeTab = savedTab && ['returns', 'register'].includes(savedTab) ? savedTab : 'returns';
        console.log('ì €ì¥ëœ íƒ­:', savedTab, 'í™œì„±í™”í•  íƒ­:', activeTab);
        switchAdminTab(activeTab);
      }
      
          // ê´€ë¦¬ì ì ‘ì´ì‹ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¸°ê¸°
          const addReturnSection = document.getElementById('addReturnSection');
          if (addReturnSection) {
            addReturnSection.style.display = isAdmin ? 'block' : 'none';
            console.log('ë°˜í’ˆ ë“±ë¡ ì„¹ì…˜ í‘œì‹œ:', isAdmin, 'ì„¹ì…˜ ìš”ì†Œ:', addReturnSection); // ë””ë²„ê¹…ìš©
          }
          const addReturnForm = document.getElementById('addReturnForm');
          if (addReturnForm && !isAdmin) {
            addReturnForm.style.display = 'none';
          }
      
      // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° (ì´ˆê¸°í™” - í…Œì´ë¸” í—¤ë”)
      updateAdminColumns();
      
      // í—¤ë” hover íš¨ê³¼ ì°¨ë‹¨ (í…Œì´ë¸”ì´ ìˆì„ ë•Œ)
      setTimeout(() => {
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 500);
      
      // ì›” ëª©ë¡ ë¡œë“œ
      loadAvailableMonths();
    }
    
    // ì‚¬ìš© ê°€ëŠ¥í•œ ì›” ëª©ë¡ ë¡œë“œ
    function loadAvailableMonths() {
      fetch(`${API_BASE_URL}/api/auth/months`)
        .then(response => response.json())
        .then(result => {
          const monthSelect = document.getElementById('monthSelect');
          monthSelect.innerHTML = '';
          
          if (result.success && result.months && result.months.length > 0) {
            // ë…„ë„ë³„ë¡œ ê·¸ë£¹í™”
            const monthsByYear = {};
            result.months.forEach(monthStr => {
              try {
                const year = monthStr.split('ë…„')[0];
                if (!monthsByYear[year]) {
                  monthsByYear[year] = [];
                }
                monthsByYear[year].push(monthStr);
              } catch (e) {
                // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê·¸ëƒ¥ ì¶”ê°€
                if (!monthsByYear['ê¸°íƒ€']) {
                  monthsByYear['ê¸°íƒ€'] = [];
                }
                monthsByYear['ê¸°íƒ€'].push(monthStr);
              }
            });
            
            // ë…„ë„ë³„ë¡œ ì •ë ¬ (ìµœì‹  ë…„ë„ê°€ ë¨¼ì €)
            const years = Object.keys(monthsByYear).sort((a, b) => {
              if (a === 'ê¸°íƒ€') return 1;
              if (b === 'ê¸°íƒ€') return -1;
              return parseInt(b) - parseInt(a);
            });
            
            // ì˜µì…˜ ê·¸ë£¹ìœ¼ë¡œ ë…„ë„ë³„ í‘œì‹œ
            years.forEach(year => {
              const optgroup = document.createElement('optgroup');
              optgroup.label = `${year}ë…„`;
              monthsByYear[year].forEach(monthStr => {
                const option = document.createElement('option');
                option.value = monthStr;
                option.textContent = monthStr;
                optgroup.appendChild(option);
              });
              monthSelect.appendChild(optgroup);
            });
            
            // í˜„ì¬ ì›” ì„ íƒ (ê¸°ë³¸ê°’)
            const currentMonth = result.current_month || '';
            if (currentMonth) {
              monthSelect.value = currentMonth;
            } else if (result.months.length > 0) {
              monthSelect.value = result.months[0];
            }
            
            // ë°ì´í„° ë¡œë“œ
            loadData();
          } else {
            // í˜„ì¬ ì›” ì¶”ê°€ (ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
            const option = document.createElement('option');
            option.value = currentMonth;
            option.textContent = currentMonth;
            monthSelect.appendChild(option);
            monthSelect.value = currentMonth;
          }
        })
        .catch(error => {
          console.error('ì›” ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          // ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì •
          const monthSelect = document.getElementById('monthSelect');
          const today = new Date();
          const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
          monthSelect.innerHTML = `<option value="${currentMonth}">${currentMonth}</option>`;
          monthSelect.value = currentMonth;
          showMessage('âš ï¸ ì›” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ í˜„ì¬ ì›”ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      
      // ì›” ë³€ê²½ ì´ë²¤íŠ¸
      const monthSelect = document.getElementById('monthSelect');
      if (monthSelect) {
        monthSelect.onchange = function() {
          // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë¡œë“œ
          refreshReturnsData();
        };
      }
    }
    
    /* ========== ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨ ========== */
    function refreshReturnsData() {
      console.log('ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨');
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && !returnsTab.classList.contains('hidden') && returnsTab.style.display !== 'none') {
        loadData();
      } else {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      }
    }
    window.refreshReturnsData = refreshReturnsData;
    
    // ë°ì´í„° ë¡œë“œ
    function loadData() {
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && (returnsTab.classList.contains('hidden') || returnsTab.style.display === 'none')) {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ë°ì´í„° ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!selectedMonth) {
        return;
      }
      
      showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'success');
      
      const url = `${API_BASE_URL}/api/returns/data?company=${encodeURIComponent(currentCompany)}&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}`;
      
      fetch(url)
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            currentData = result.data || [];
            // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
            updateStats(currentData);
            // í•„í„° ì ìš© (í˜„ì¬ ì„ íƒëœ í•„í„°ì— ë”°ë¼)
            applyFilter();
            showMessage(`âœ… ${result.count}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
          } else {
            showMessage('âŒ ' + (result.message || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'), 'error');
            const isAdmin = ((currentRole || '').toString().trim() === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            setTimeout(() => {
              updateAdminColumns();
              // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
              if (typeof disableHeaderHover === 'function') {
                disableHeaderHover();
              }
            }, 150);
          }
        })
        .catch(error => {
          console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('renderTable - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const colspan = isAdmin ? 13 : 9;
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${colspan}" class="no-data">ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        // ë¹ˆ ë°ì´í„°ì¼ ë•Œë„ ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
        updateAdminColumns();
        return;
      }
      
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        const isCompleted = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
        const isConfirmed = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] && row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'].toString().trim();
        const memoText = row['ë¹„ê³ '] || '';
        
        // ì‚¬ì§„ ë§í¬ ì²˜ë¦¬
        let photoHtml = '-';
        if (row['ì‚¬ì§„'] && Array.isArray(row['ì‚¬ì§„']) && row['ì‚¬ì§„'].length > 0) {
          photoHtml = '<div class="photo-links">';
          row['ì‚¬ì§„'].forEach(photo => {
            if (photo.url) {
              photoHtml += `<a href="${photo.url}" target="_blank" class="photo-link">${photo.text || 'ì‚¬ì§„'}</a>`;
            }
          });
          photoHtml += '</div>';
        }
        
        // ìš”ì²­ì‚¬í•­ ì²˜ë¦¬
        const requestValue = row['í™”ì£¼ì‚¬ìš”ì²­'] || '';
        let requestHtml = '';
        
        if (isAdmin) {
          // ê´€ë¦¬ì: ì½ê¸° ì „ìš©
          if (requestValue) {
            requestHtml = `<textarea class="request-input" readonly>${requestValue}</textarea>`;
          } else {
            requestHtml = '<div style="color: #999; text-align: center; padding: 20px;">ìš”ì²­ì‚¬í•­ ì—†ìŒ</div>';
          }
        } else {
          // í™”ì£¼ì‚¬: ì…ë ¥ ë° ì €ì¥ ê°€ëŠ¥ (ì €ì¥ í›„ì—ë„ ìˆ˜ì • ê°€ëŠ¥)
          // ì €ì¥ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ "ìˆ˜ì •" ë²„íŠ¼, ì—†ìœ¼ë©´ "ì €ì¥" ë²„íŠ¼
          const buttonText = requestValue ? 'ìˆ˜ì •' : 'ì €ì¥';
          const buttonClass = requestValue ? 'save-btn edit-btn' : 'save-btn';
          requestHtml = `
            <textarea class="request-input" id="request_${index}" placeholder="ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”">${escapeHtml(requestValue)}</textarea>
            <button class="${buttonClass}" onclick="saveRequest(${index}, ${row.rowIndex})">${buttonText}</button>
          `;
        }
        
        // ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ (ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ)
        let statusHtml = '';
        const confirmedText = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] || '';
        let completedName = row['ì²˜ë¦¬ì™„ë£Œ'] || '';
        
        // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ì—ì„œ ì´ë¦„ë§Œ ì¶”ì¶œ
        if (completedName) {
          // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ ì²˜ë¦¬
          if (completedName.includes('(') && completedName.includes(')')) {
            const match = completedName.match(/\(([^)]+)\)/);
            if (match && match[1]) {
              completedName = match[1].trim();
            }
          }
          // "ì™„ë£Œ ì´ë¦„" í˜•ì‹ ì²˜ë¦¬ (ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬)
          else if (completedName.includes('ì™„ë£Œ')) {
            completedName = completedName.replace(/ì™„ë£Œ\s*/g, '').trim();
          }
        }
        
        if (isCompleted && completedName) {
          // ì²˜ë¦¬ì™„ë£Œì¼ ë•Œ ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ í‘œì‹œ
          statusHtml = `<span class="status-completed-circle">${escapeHtml(completedName)}</span>`;
        } else if (isConfirmed || confirmedText) {
          // í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œê°€ ìˆìœ¼ë©´ ê´€ë¦¬ì ì´ë¦„ í‘œì‹œ
          statusHtml = `<span class="status-badge" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; border-radius: 12px; padding: 3px 8px; font-size: 10px;">â³ ${escapeHtml(confirmedText) || 'ìš”ì²­ì™„ë£Œ'}</span>`;
        } else {
          statusHtml = '<span class="status-badge status-pending">â³ ëŒ€ê¸°ì¤‘</span>';
        }
        
        // ê´€ë¦¬ì ì „ìš© ì…€ (í•­ìƒ ìƒì„±, updateAdminColumnsì—ì„œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´)
        const companyCell = `<td class="admin-only">${row['í™”ì£¼ëª…'] || ''}</td>`;
        const memoTextSafe = escapeHtml(memoText || '').replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
        const memoCell = `
          <td class="admin-only" style="text-align: center; min-width: 80px;">
            <button class="save-btn" onclick="editMemo(${index}, ${row.rowIndex}, '${memoTextSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">
              ${memoText ? 'ğŸ“ ë¹„ê³ ' : 'ğŸ“ ì¶”ê°€'}
            </button>
          </td>
        `;
        const trackingNumber = row['ì†¡ì¥ë²ˆí˜¸'] ? row['ì†¡ì¥ë²ˆí˜¸'].toString().trim() : '';
        const trackingNumberSafe = escapeHtml(trackingNumber).replace(/'/g, "\\'").replace(/"/g, '&quot;');
        const qrCell = `
          <td class="admin-only" style="text-align: center; min-width: 70px;">
            ${trackingNumber ? 
              `<button class="save-btn" onclick="showQRCode('${trackingNumberSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">ğŸ“± QR</button>` :
              '<span style="color: #b2bec3; font-size: 10px;">ë¯¸ìƒì„±</span>'}
          </td>
        `;
        
        // ê´€ë¦¬ ì…€ (ì‚­ì œ ë²„íŠ¼ì„ ì˜†ìœ¼ë¡œ ë°°ì¹˜í•˜ì—¬ ì‹¤ìˆ˜ í´ë¦­ ë°©ì§€)
        const hasCompleted = isCompleted && completedName;
        const manageCell = `
          <td class="admin-only" style="text-align: center; min-width: 140px;">
            <div style="display: flex; flex-direction: row; gap: 4px; align-items: center; justify-content: center;">
              ${hasCompleted ? 
                `<span style="color: #00b894; font-size: 11px; font-weight: 600; flex: 1; text-align: center;">ì™„ë£Œ</span>` : 
                `<button class="save-btn" onclick="completeReturn(${index}, ${row.rowIndex})" style="background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%); color: white; border: none; padding: 3px 8px; font-size: 10px; flex: 1; border-radius: 4px; box-shadow: none;">ì²˜ë¦¬ì™„ë£Œ</button>`}
              <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) deleteReturn(${index}, ${row.rowIndex})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 3px 6px; font-size: 9px; min-width: 28px; border-radius: 4px; box-shadow: none;" title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
          </td>
        `;
        
        // ìƒí’ˆëª… ì…€ì— ë¹„ê³  íˆ´íŒ ì¶”ê°€ (ë¹„ê³ ê°€ ìˆì„ ë•Œë§Œ, ë¹¨ê°„ìƒ‰ ë‘ê»ê²Œ)
        const productName = escapeHtml(row['ì œí’ˆ'] || '');
        const hasMemo = memoText && memoText.trim() !== '';
        const productCellClass = hasMemo ? 'product-cell has-memo' : 'product-cell';
        const productCellAttributes = hasMemo 
          ? `class="${productCellClass}" style="text-align: center; position: relative; cursor: help;" 
             data-memo="${escapeHtml(memoText || '')}" 
             title="${escapeHtml(memoText || '')}"
             onmouseenter="showMemoTooltip(event, '${memoTextSafe.replace(/'/g, "\\'")}')" 
             onmouseleave="hideMemoTooltip()"`
          : `class="${productCellClass}" style="text-align: center;"`;
        const productCell = `
          <td ${productCellAttributes}>
            ${productName}
          </td>
        `;
        
        tr.innerHTML = `
          <td>${row['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || ''}</td>
          ${companyCell}
          ${productCell}
          <td>${row['ê³ ê°ëª…'] || ''}</td>
          <td>${row['ì†¡ì¥ë²ˆí˜¸'] || ''}</td>
          <td>${row['ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡'] || ''}</td>
          <td>${row['ì¬ê³ ìƒíƒœ'] || ''}</td>
          <td>${statusHtml}</td>
          <td>${photoHtml}</td>
          ${memoCell}
          <td style="min-width: 250px;">${requestHtml}</td>
          ${qrCell}
          ${manageCell}
        `;
        
        tbody.appendChild(tr);
      });
      
      // í…Œì´ë¸” ë Œë”ë§ í›„ ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸
      // DOM ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
      setTimeout(() => {
        if (typeof updateAdminColumns === 'function') {
          updateAdminColumns();
        }
        // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    window.updateAdminColumns = function updateAdminColumns() {
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('=== updateAdminColumns í˜¸ì¶œ ===');
      console.log('currentRole:', JSON.stringify(currentRole));
      console.log('roleNormalized:', JSON.stringify(roleNormalized));
      console.log('isAdmin:', isAdmin);
      
      // í…Œì´ë¸” í—¤ë”ì™€ ë³¸ë¬¸ì˜ ëª¨ë“  admin-only ìš”ì†Œ ì°¾ê¸°
      const adminElements = document.querySelectorAll('.admin-only');
      console.log('ê´€ë¦¬ì ìš”ì†Œ ê°œìˆ˜:', adminElements.length);
      
      if (adminElements.length === 0) {
        console.warn('âš ï¸ admin-only ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! í…Œì´ë¸”ì´ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        // í…Œì´ë¸”ì´ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
        setTimeout(() => {
          console.log('ì¬ì‹œë„: updateAdminColumns');
          updateAdminColumns();
        }, 300);
        return;
      }
      
      const displayValue = isAdmin ? 'table-cell' : 'none';
      let updatedCount = 0;
      
      adminElements.forEach((cell, index) => {
        cell.style.display = displayValue;
        updatedCount++;
        if (index < 15) { // ì²˜ìŒ 15ê°œë§Œ ìƒì„¸ ë¡œê·¸
          const text = (cell.textContent || cell.innerText || cell.innerHTML || '').substring(0, 40).replace(/\s+/g, ' ');
          console.log(`ìš”ì†Œ ${index}:`, cell.tagName, text, 'â†’ display:', displayValue);
        }
      });
      
      console.log(`âœ… ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸ ì™„ë£Œ - ${updatedCount}ê°œ ìš”ì†Œ, í‘œì‹œ: ${isAdmin}`);
      console.log('=== updateAdminColumns ì™„ë£Œ ===');
    };
    
    // í•„í„°ë§ í•¨ìˆ˜
    function filterByStatus(status) {
      currentFilter = status;
      
      // í™œì„±í™”ëœ í•„í„° í‘œì‹œ
      document.querySelectorAll('.stat-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (status === 'all') {
        document.getElementById('filterAll').classList.add('active');
      } else if (status === 'completed') {
        document.getElementById('filterCompleted').classList.add('active');
      } else if (status === 'pending') {
        document.getElementById('filterPending').classList.add('active');
      }
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      applyFilter();
    }
    
    // í•„í„° ì ìš© í•¨ìˆ˜
    function applyFilter() {
      if (!currentData || currentData.length === 0) {
        return;
      }
      
      let filteredData = [];
      
      if (currentFilter === 'all') {
        filteredData = [...currentData];
      } else if (currentFilter === 'completed') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return completed && completed.length > 0;
        });
      } else if (currentFilter === 'pending') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return !completed || completed.length === 0;
        });
      }
      
      // ë‚ ì§œ ìµœì‹ ìˆœ ì •ë ¬ (ì¼ì ê¸°ì¤€, ë‚´ë¦¼ì°¨ìˆœ)
      filteredData.sort((a, b) => {
        const dateA = a['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        const dateB = b['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        
        // ì¼ì ìˆ«ì ì¶”ì¶œ
        const getDayNumber = (dateStr) => {
          if (!dateStr) return 0;
          const str = dateStr.toString().trim();
          if (str.includes('-')) {
            const parts = str.split('-');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.includes('/')) {
            const parts = str.split('/');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.match(/^\d+$/)) {
            return parseInt(str) || 0;
          }
          return 0;
        };
        
        const dayA = getDayNumber(dateA);
        const dayB = getDayNumber(dateB);
        
        // ì¼ìê°€ ê°™ìœ¼ë©´ IDë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
        if (dayA === dayB) {
          return (b.id || b.rowIndex || 0) - (a.id || a.rowIndex || 0);
        }
        
        // ì¼ì ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)
        return dayB - dayA;
      });
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë Œë”ë§
      renderTable(filteredData);
      
      // ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
      setTimeout(() => {
        updateAdminColumns();
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
    window.filterByStatus = filterByStatus;
    
    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats(data) {
      const total = data.length;
      const completed = data.filter(row => row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim()).length;
      const pending = total - completed;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('pendingCount').textContent = pending;
    }
    
    // ìš”ì²­ì‚¬í•­ ì €ì¥
    function saveRequest(dataIndex, rowIndex) {
      const requestText = document.getElementById(`request_${dataIndex}`).value.trim();
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!requestText) {
        alert('ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì €ì¥ ë°©ì§€)
      const textarea = document.getElementById(`request_${dataIndex}`);
      const saveButton = textarea ? textarea.nextElementSibling : null;
      if (saveButton && saveButton.tagName === 'BUTTON') {
        saveButton.disabled = true;
        saveButton.textContent = 'ì €ì¥ ì¤‘...';
      }
      
      fetch(`${API_BASE_URL}/api/returns/save-request`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: rowIndex,
          month: selectedMonth,
          requestText: requestText
        })
      })
      .then(response => response.json())
      .then(result => {
        // ì €ì¥ ë²„íŠ¼ ì°¾ê¸° (textarea ë‹¤ìŒ ìš”ì†Œ)
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        
        if (result.success) {
          // ì›ë³¸ ë°ì´í„°ì—ì„œ í•´ë‹¹ í•­ëª© ì°¾ê¸° (rowIndex ê¸°ì¤€)
          const dataItem = currentData.find(item => 
            item.rowIndex === rowIndex || item.id === rowIndex
          );
          
          if (dataItem) {
            dataItem['í™”ì£¼ì‚¬ìš”ì²­'] = requestText;
          }
          
          // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
          updateStats(currentData);
          // í•„í„° ì¬ì ìš© (í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€, ë²„íŠ¼ ìƒíƒœë„ ìœ ì§€ë¨)
          applyFilter();
        } else {
          // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
          if (saveBtn && saveBtn.tagName === 'BUTTON') {
            saveBtn.disabled = false;
            const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
            if (currentText) {
              saveBtn.textContent = 'ìˆ˜ì •';
              saveBtn.classList.add('edit-btn');
            } else {
              saveBtn.textContent = 'ì €ì¥';
              saveBtn.classList.remove('edit-btn');
            }
          }
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        if (saveBtn && saveBtn.tagName === 'BUTTON') {
          saveBtn.disabled = false;
          const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
          if (currentText) {
            saveBtn.textContent = 'ìˆ˜ì •';
            saveBtn.classList.add('edit-btn');
          } else {
            saveBtn.textContent = 'ì €ì¥';
            saveBtn.classList.remove('edit-btn');
          }
        }
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    
    // ì²˜ë¦¬ì™„ë£Œ í‘œì‹œ (ê´€ë¦¬ì)
    window.completeReturn = function completeReturn(dataIndex, rowIndex) {
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì²˜ë¦¬ì™„ë£Œë¡œ í‘œì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      const managerName = currentCompany; // í™”ì£¼ëª… ì‚¬ìš©
      
      fetch(`${API_BASE_URL}/api/returns/mark-completed`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: rowIndex,
          month: selectedMonth,
          managerName: managerName
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ' + result.message, 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì²˜ë¦¬ì™„ë£Œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // QR ì½”ë“œ í‘œì‹œ
    window.showQRCode = function showQRCode(trackingNumber) {
      if (!trackingNumber) {
        alert('ì†¡ì¥ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(trackingNumber)}`;
      const modal = document.createElement('div');
      modal.id = 'qrModal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
      modal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
          <h3 style="margin-bottom: 20px;">ğŸ“± QR ì½”ë“œ</h3>
          <img src="${qrUrl}" alt="QR Code" style="margin: 20px 0; max-width: 100%; border: 2px solid #e0e0e0; padding: 10px; border-radius: 8px;">
          <p style="margin: 15px 0; font-size: 14px; color: #666;">ì†¡ì¥ë²ˆí˜¸: <strong>${trackingNumber}</strong></p>
          <button onclick="document.getElementById('qrModal').remove()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹«ê¸°</button>
        </div>
      `;
      document.body.appendChild(modal);
    };
    
    // ë¹„ê³  ìˆ˜ì •
    window.editMemo = function editMemo(dataIndex, returnId, currentMemo) {
      const memoText = prompt('ë¹„ê³ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', currentMemo || '');
      if (memoText === null) return; // ì·¨ì†Œ
      
      fetch(`${API_BASE_URL}/api/returns/update-memo`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId,
          memo: memoText
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë¹„ê³ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ê³  ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë°˜í’ˆ ì‚­ì œ
    window.deleteReturn = function deleteReturn(dataIndex, returnId) {
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      fetch(`${API_BASE_URL}/api/returns/delete`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ê±´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë¹„ê³  íˆ´íŒ í‘œì‹œ
    window.showMemoTooltip = function showMemoTooltip(event, memoText) {
      if (!memoText || memoText.trim() === '' || memoText === 'undefined') {
        return; // ë¹„ê³ ê°€ ì—†ìœ¼ë©´ íˆ´íŒ í‘œì‹œ ì•ˆ í•¨
      }
      
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      hideMemoTooltip();
      
      // íˆ´íŒ ìƒì„±
      const tooltip = document.createElement('div');
      tooltip.id = 'memoTooltip';
      tooltip.className = 'memo-tooltip';
      tooltip.textContent = memoText.replace(/\\n/g, '\n');
      document.body.appendChild(tooltip);
      
      // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì— íˆ´íŒ í‘œì‹œ
      updateTooltipPosition(event, tooltip);
    };
    
    // ë¹„ê³  íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ë§ˆìš°ìŠ¤ ë”°ë¼ë‹¤ë‹ˆê¸°)
    function updateTooltipPosition(event, tooltip) {
      if (!tooltip) return;
      
      const x = event.clientX + 15;
      const y = event.clientY + 15;
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // ì•½ê°„ì˜ ì§€ì—° í›„ í™”ë©´ ë°– ì²´í¬ (ë Œë”ë§ ì™„ë£Œ í›„)
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth - 10) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight - 10) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 10) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 10) {
          tooltip.style.top = '15px';
        }
      }, 10);
    }
    
    // ë¹„ê³  íˆ´íŒ ìˆ¨ê¸°ê¸°
    window.hideMemoTooltip = function hideMemoTooltip() {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    };
    
    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    document.addEventListener('mousemove', function(event) {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        updateTooltipPosition(event, tooltip);
      }
    });
    
    // ë°˜í’ˆ ë“±ë¡ í¼ í† ê¸€ (ì ‘ì´ì‹)
    function toggleAddForm() {
      const form = document.getElementById('addReturnForm');
      const icon = document.getElementById('addReturnIcon');
      const btn = document.getElementById('addReturnBtn');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        icon.textContent = 'â–²';
        btn.style.borderRadius = '12px 12px 0 0';
        // ì˜¤ëŠ˜ ì¼ìë¡œ ê¸°ë³¸ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
        // í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì • (ì›” ì„ íƒì´ ì—†ìœ¼ë©´ í˜„ì¬ ì›”ë¡œ ì„¤ì •)
        const monthSelect = document.getElementById('monthSelect');
        if (!monthSelect.value) {
          const now = new Date();
          const currentMonth = `${now.getFullYear()}ë…„${now.getMonth() + 1}ì›”`;
          monthSelect.value = currentMonth;
        }
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¼';
        btn.style.borderRadius = '12px';
        // í¼ ì´ˆê¸°í™”
        document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
          if (el.id !== 'newReturnDate') el.value = '';
        });
        // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
      }
    }
    window.toggleAddForm = toggleAddForm;
    
    // ë°˜í’ˆ ë“±ë¡
    function addReturn() {
      const selectedMonth = document.getElementById('monthSelect').value;
      if (!selectedMonth) {
        alert('ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì¼ìë§Œ ì…ë ¥ë°›ìŒ (1-31)
      const dayInput = document.getElementById('newReturnDate').value.trim();
      const day = parseInt(dayInput);
      if (!dayInput || isNaN(day) || day < 1 || day > 31) {
        alert('ì¼ìë¥¼ 1-31 ì‚¬ì´ì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const companyName = document.getElementById('newCompanyName').value.trim();
      const product = document.getElementById('newProduct').value.trim();
      const customerName = document.getElementById('newCustomerName').value.trim();
      const trackingNumber = document.getElementById('newTrackingNumber').value.trim();
      
      if (!customerName || !trackingNumber) {
        alert('ê³ ê°ëª…ê³¼ ì†¡ì¥ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }
      
      // ì¼ìë§Œ ì €ì¥ (ë¬¸ìì—´ë¡œ ì €ì¥í•˜ì—¬ ì •ë ¬ì´ ì˜ ë˜ë„ë¡)
      const returnData = {
        return_date: String(day),  // ì¼ìë§Œ ì €ì¥
        company_name: companyName,
        product: product,
        customer_name: customerName,
        tracking_number: trackingNumber,
        return_type: document.getElementById('newReturnType').value,
        stock_status: document.getElementById('newStockStatus').value,
        inspection: '',  // ê²€í’ˆìœ ë¬´ ì œê±°
        completed: '',
        memo: document.getElementById('newMemo').value.trim(),
        photo_links: '',
        other_courier: '',  // ë‹¤ë¥¸ì™¸ë¶€íƒë°°ì‚¬ ì œê±°
        shipping_fee: '',  // ë°°ì†¡ë¹„ ì œê±°
        client_request: '',
        client_confirmed: '',
        month: selectedMonth
      };
      
      fetch(`${API_BASE_URL}/api/returns/create`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(returnData)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ë‚´ì—­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          // í¼ ì ‘ê¸° ë° ì´ˆê¸°í™”
          const form = document.getElementById('addReturnForm');
          const icon = document.getElementById('addReturnIcon');
          const btn = document.getElementById('addReturnBtn');
          if (form && icon && btn) {
            form.style.display = 'none';
            icon.textContent = 'â–¼';
            btn.style.borderRadius = '12px';
            // í¼ ì´ˆê¸°í™”
            document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
              if (el.id !== 'newReturnDate') el.value = '';
            });
            // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
            const today = new Date().getDate();
            document.getElementById('newReturnDate').value = today;
          }
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ë“±ë¡ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.addReturn = addReturn;
    
    // í—¤ë” hover ì´ë²¤íŠ¸ ì™„ì „íˆ ì°¨ë‹¨
    function disableHeaderHover() {
      const headerCells = document.querySelectorAll('thead th');
      const thead = document.querySelector('thead');
      
      // thead ìì²´ì—ë„ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
      if (thead) {
        const theadRow = thead.querySelector('tr');
        if (theadRow) {
          theadRow.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          theadRow.style.setProperty('background-color', '#ff9500', 'important');
        }
        const forceTheadStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          const row = this.querySelector('tr');
          if (row) {
            row.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
            row.style.setProperty('background-color', '#ff9500', 'important');
          }
        };
        forceTheadStyle.call(thead);
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout'].forEach(eventType => {
          thead.addEventListener(eventType, forceTheadStyle, true);
        });
      }
      
      headerCells.forEach(th => {
        // ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜
        const forceStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          this.style.setProperty('cursor', 'default', 'important');
          this.style.setProperty('transition', 'none', 'important');
          this.style.setProperty('opacity', '1', 'important');
          this.style.setProperty('text-align', 'center', 'important');
          this.style.setProperty('border', 'none', 'important');
          this.style.setProperty('margin', '0', 'important');
          // ëª¨ë“  ìì‹ ìš”ì†Œì—ë„ ì ìš©
          const children = this.querySelectorAll('*');
          children.forEach(child => {
            child.style.setProperty('background', 'transparent', 'important');
            child.style.setProperty('background-color', 'transparent', 'important');
            child.style.setProperty('color', 'white', 'important');
          });
        };
        
        // ëª¨ë“  ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì—ì„œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© (ìº¡ì²˜ ë‹¨ê³„ì—ì„œ)
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout', 'mousemove'].forEach(eventType => {
          th.addEventListener(eventType, function(e) {
            e.stopPropagation();
            forceStyle.call(this);
          }, true); // ìº¡ì²˜ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬
        });
        
        // ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
        forceStyle.call(th);
        
        // requestAnimationFrameì„ ì‚¬ìš©í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ìŠ¤íƒ€ì¼ í™•ì¸
        function checkAndForceStyle() {
          const computedStyle = window.getComputedStyle(th);
          const bg = computedStyle.backgroundColor;
          const color = computedStyle.color;
          const textAlign = computedStyle.textAlign;
          // ìƒ‰ìƒì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (rgb(255, 149, 0) = #ff9500 ì£¼í™©ìƒ‰, rgb(255, 255, 255) = white)
          // ì£¼í™©ìƒ‰ ê³„ì—´ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê°•ì œ ì ìš© (rgb(255, 149, 0) ë˜ëŠ” rgb(255, 165, 2))
          const isOrange = bg.includes('rgb(255, 149') || bg.includes('rgb(255, 165') || bg.includes('255, 149') || bg.includes('255, 165');
          if (!isOrange || color !== 'rgb(255, 255, 255)' || textAlign !== 'center') {
            forceStyle.call(th);
          }
          requestAnimationFrame(checkAndForceStyle);
        }
        checkAndForceStyle();
      });
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ì–¸ì œë“ ì§€ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡
    window.disableHeaderHover = disableHeaderHover;
    
    /* ========== ê´€ë¦¬ì íƒ­ ì „í™˜ ========== */
    function switchAdminTab(tabName) {
      console.log('=== switchAdminTab í˜¸ì¶œ ===', tabName);
      
      // ëª¨ë“  íƒ­ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
      const returnsTab = document.getElementById('returnsTab');
      const registerTab = document.getElementById('registerTab');
      const passwordTab = document.getElementById('passwordTab');
      
      console.log('íƒ­ ìš”ì†Œ í™•ì¸:', {
        returnsTab: returnsTab ? 'ì¡´ì¬' : 'ì—†ìŒ',
        registerTab: registerTab ? 'ì¡´ì¬' : 'ì—†ìŒ',
        passwordTab: passwordTab ? 'ì¡´ì¬' : 'ì—†ìŒ'
      });
      
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ê°€ì ¸ì˜¤ê¸°
      const tabButtons = document.querySelectorAll('#adminTabs .tab-btn');
      console.log('íƒ­ ë²„íŠ¼ ê°œìˆ˜:', tabButtons.length);
      
      // 1. ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      tabButtons.forEach((btn, index) => {
        btn.classList.remove('active');
      });
      
      // 2. ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸° (ê°•ì œë¡œ)
      const allTabs = [
        {tab: returnsTab, name: 'returnsTab'},
        {tab: registerTab, name: 'registerTab'}
      ];
      
      // passwordTabë„ ìˆ¨ê¸°ê¸° (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
      if (passwordTab) {
        passwordTab.classList.add('hidden');
        passwordTab.style.setProperty('display', 'none', 'important');
        passwordTab.style.setProperty('visibility', 'hidden', 'important');
        passwordTab.style.setProperty('opacity', '0', 'important');
      }
      
      allTabs.forEach((item) => {
        if (item.tab) {
          item.tab.classList.add('hidden');
          item.tab.style.setProperty('display', 'none', 'important');
          item.tab.style.setProperty('visibility', 'hidden', 'important');
          item.tab.style.setProperty('opacity', '0', 'important');
          console.log(`${item.name} ìˆ¨ê¹€`);
        }
      });
      
      // 3. ì„ íƒëœ íƒ­ í‘œì‹œ
      let selectedTab = null;
      let selectedButtonIndex = -1;
      
      if (tabName === 'returns' && returnsTab) {
        selectedTab = returnsTab;
        selectedButtonIndex = 0;
      } else if (tabName === 'register' && registerTab) {
        selectedTab = registerTab;
        selectedButtonIndex = 1;
      }
      // password íƒ­ ì œê±°ë¨
      
      if (selectedTab) {
        // ì„ íƒëœ íƒ­ í‘œì‹œ (ê°•ì œë¡œ)
        selectedTab.classList.remove('hidden');
        selectedTab.style.removeProperty('display');
        selectedTab.style.removeProperty('visibility');
        selectedTab.style.removeProperty('opacity');
        selectedTab.style.setProperty('display', 'block', 'important');
        selectedTab.style.setProperty('visibility', 'visible', 'important');
        selectedTab.style.setProperty('opacity', '1', 'important');
        
        console.log('ì„ íƒëœ íƒ­ í‘œì‹œ:', selectedTab.id);
        console.log('ì¸ë¼ì¸ ìŠ¤íƒ€ì¼:', {
          display: selectedTab.style.display,
          visibility: selectedTab.style.visibility,
          opacity: selectedTab.style.opacity,
          hasHidden: selectedTab.classList.contains('hidden')
        });
        
        // ì„ íƒëœ íƒ­ì˜ ì‹¤ì œ í‘œì‹œ ìƒíƒœ í™•ì¸
        setTimeout(() => {
          const computedStyle = window.getComputedStyle(selectedTab);
          console.log('ê³„ì‚°ëœ ìŠ¤íƒ€ì¼:', {
            display: computedStyle.display,
            visibility: computedStyle.visibility,
            opacity: computedStyle.opacity
          });
        }, 50);
      } else {
        console.error('ì„ íƒëœ íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', tabName);
      }
      
      // 4. ì„ íƒëœ íƒ­ ë²„íŠ¼ í™œì„±í™”
      if (selectedButtonIndex >= 0 && tabButtons[selectedButtonIndex]) {
        tabButtons[selectedButtonIndex].classList.add('active');
        console.log('íƒ­ ë²„íŠ¼ í™œì„±í™”:', selectedButtonIndex);
      }
      
      // 5. í˜„ì¬ í™œì„±í™”ëœ íƒ­ì„ localStorageì— ì €ì¥ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì§€)
      localStorage.setItem('activeAdminTab', tabName);
      
      // 6. í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ ì„ íƒë˜ë©´ í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
      if (tabName === 'register') {
        setTimeout(() => {
          try {
            if (typeof loadCompanies === 'function') {
              console.log('loadCompanies í•¨ìˆ˜ í˜¸ì¶œ');
              loadCompanies();
            } else {
              console.error('loadCompanies í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          } catch (error) {
            console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
            console.error(error.stack);
          }
        }, 300);
      }
      
      // 7. ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ ì„ íƒë˜ë©´ ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ (ì›”ì´ ì„ íƒë˜ì–´ ìˆì„ ë•Œë§Œ)
      if (tabName === 'returns') {
        setTimeout(() => {
          const monthSelect = document.getElementById('monthSelect');
          if (monthSelect) {
            // ì›”ì´ ì„ íƒë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì›”ë¡œ ì„¤ì •
            if (!monthSelect.value) {
              const today = new Date();
              const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
              monthSelect.value = currentMonth;
            }
            // ë°ì´í„° ë¡œë“œ
            if (monthSelect.value) {
              try {
                if (typeof refreshReturnsData === 'function') {
                  console.log('ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ');
                  refreshReturnsData();
                }
              } catch (error) {
                console.error('ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
              }
            }
          }
        }, 300);
      }
      
      console.log('=== switchAdminTab ì™„ë£Œ ===');
    }
    window.switchAdminTab = switchAdminTab;
    
    /* ========== í™”ì£¼ì‚¬ ë“±ë¡ í¼ ì ‘ì´ì‹ ========== */
    function toggleAddCompanyForm() {
      const form = document.getElementById('addCompanyForm');
      const icon = document.getElementById('addCompanyIcon');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        icon.textContent = 'â–²';
        icon.style.transform = 'rotate(0deg)';
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¼';
        icon.style.transform = 'rotate(0deg)';
        document.getElementById('adminRegisterForm').reset();
        document.getElementById('adminRegisterStatus').className = 'admin-status';
        document.getElementById('adminRegisterStatus').textContent = '';
      }
    }
    window.toggleAddCompanyForm = toggleAddCompanyForm;
    
    /* ========== í™”ì£¼ì‚¬ ë“±ë¡ ========== */
    function registerCompany() {
      const btn = document.getElementById('adminRegisterBtn');
      const status = document.getElementById('adminRegisterStatus');
      
      const companyName = document.getElementById('adminRegCompanyName').value.trim();
      const username = document.getElementById('adminRegUsername').value.trim();
      const password = document.getElementById('adminRegPassword').value.trim();
      const role = document.getElementById('adminRegRole').value.trim();
      const businessNumber = document.getElementById('adminRegBusinessNumber').value.trim();
      const businessName = document.getElementById('adminRegBusinessName').value.trim();
      const businessAddress = document.getElementById('adminRegBusinessAddress').value.trim();
      const businessTel = document.getElementById('adminRegBusinessTel').value.trim();
      const businessEmail = document.getElementById('adminRegBusinessEmail').value.trim();

      if (!companyName || !username || !password || !role) {
        status.className = 'admin-status error';
        status.textContent = 'í™”ì£¼ì‚¬ëª…, ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ê¶Œí•œì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.';
        return;
      }
      
      if (role !== 'í™”ì£¼ì‚¬' && role !== 'ê´€ë¦¬ì') {
        status.className = 'admin-status error';
        status.textContent = 'ê¶Œí•œì€ í™”ì£¼ì‚¬ ë˜ëŠ” ê´€ë¦¬ì ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'ë“±ë¡ ì¤‘...';
      status.className = 'admin-status loading';
      status.textContent = 'í™”ì£¼ì‚¬ ë“±ë¡ ì¤‘...';
      
      const data = {
        company_name: companyName,
        username: username,
        password: password,
        role: role,
        business_number: businessNumber || null,
        business_name: businessName || null,
        business_address: businessAddress || null,
        business_tel: businessTel || null,
        business_email: businessEmail || null
      };

      fetch('/api/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          status.className = 'admin-status success';
          status.textContent = data.message || 'í™”ì£¼ì‚¬ ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.';
          document.getElementById('adminRegisterForm').reset();
          // í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          loadCompanies();
          // í¼ ë‹«ê¸°
          setTimeout(() => {
            toggleAddCompanyForm();
          }, 1500);
        } else {
          status.className = 'admin-status error';
          status.textContent = data.message || 'í™”ì£¼ì‚¬ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        }
        btn.disabled = false;
        btn.textContent = 'ë“±ë¡í•˜ê¸°';
      })
      .catch(error => {
        console.error('í™”ì£¼ì‚¬ ë“±ë¡ ì˜¤ë¥˜:', error);
        status.className = 'admin-status error';
        status.textContent = 'í™”ì£¼ì‚¬ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
        btn.disabled = false;
        btn.textContent = 'ë“±ë¡í•˜ê¸°';
      });
    }
    window.registerCompany = registerCompany;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ========== */
    function refreshCompaniesData() {
      console.log('í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨');
      // í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const registerTab = document.getElementById('registerTab');
      if (registerTab && !registerTab.classList.contains('hidden') && registerTab.style.display !== 'none') {
        loadCompanies();
      } else {
        console.log('í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      }
    }
    window.refreshCompaniesData = refreshCompaniesData;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ========== */
    function loadCompanies() {
      try {
        const tbody = document.getElementById('companiesTableBody');
        if (!tbody) {
          console.error('companiesTableBody ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        tbody.innerHTML = '<tr><td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
        
        fetch('/api/auth/companies', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.companies) {
            // í†µê³„ í‘œì‹œ
            if (data.statistics) {
              const statsEl = document.getElementById('companiesStatistics');
              if (statsEl) {
                statsEl.textContent = `(ê´€ë¦¬ì: ${data.statistics.admin_count}, í™”ì£¼ì‚¬: ${data.statistics.company_count})`;
              }
            }
            renderCompaniesTable(data.companies);
          } else {
            tbody.innerHTML = '<tr><td colspan="12" class="no-data">í™”ì£¼ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          }
        })
        .catch(error => {
          console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          if (tbody) {
            tbody.innerHTML = '<tr><td colspan="12" class="no-data">í™”ì£¼ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</td></tr>';
          }
        });
      } catch (error) {
        console.error('loadCompanies í•¨ìˆ˜ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCompanies = loadCompanies;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸” ë Œë”ë§ ========== */
    function renderCompaniesTable(companies) {
      const tbody = document.getElementById('companiesTableBody');
      tbody.innerHTML = '';
      
      if (!companies || companies.length === 0) {
        tbody.innerHTML = '<tr><td colspan="12" class="no-data">ë“±ë¡ëœ í™”ì£¼ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      companies.forEach(company => {
        const tr = document.createElement('tr');
        
        // ë‚ ì§œ í¬ë§·íŒ…
        const createdAt = company.created_at ? new Date(company.created_at).toLocaleDateString('ko-KR') : '-';
        
        // ìµœê·¼ ë¡œê·¸ì¸ ë‚ ì§œ í¬ë§·íŒ…
        let lastLogin = '-';
        if (company.last_login) {
          const lastLoginDate = new Date(company.last_login);
          const now = new Date();
          const diffMs = now - lastLoginDate;
          const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
          const diffMinutes = Math.floor(diffMs / (1000 * 60));
          
          if (diffMinutes < 1) {
            lastLogin = 'ë°©ê¸ˆ ì „';
          } else if (diffMinutes < 60) {
            lastLogin = `${diffMinutes}ë¶„ ì „`;
          } else if (diffHours < 24) {
            lastLogin = `${diffHours}ì‹œê°„ ì „`;
          } else if (diffDays < 7) {
            lastLogin = `${diffDays}ì¼ ì „`;
          } else {
            lastLogin = lastLoginDate.toLocaleDateString('ko-KR');
          }
        }
        
        // ê¶Œí•œ í‘œì‹œ (ìƒ‰ìƒìœ¼ë¡œ êµ¬ë¶„)
        const role = company.role || 'í™”ì£¼ì‚¬';
        const roleColor = role === 'ê´€ë¦¬ì' ? '#ff6b35' : '#feca57';
        const roleBg = role === 'ê´€ë¦¬ì' ? 'linear-gradient(135deg, #ff6b35 0%, #ff5722 100%)' : 'linear-gradient(135deg, #feca57 0%, #ffa502 100%)';
        const roleHtml = `<span style="background: ${roleBg}; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 700; font-size: 13px;">${escapeHtml(role)}</span>`;
        
        // ì‚¬ì—…ì ë“±ë¡ì¦ ë²„íŠ¼
        const certificateUrl = company.business_certificate_url || '';
        let certificateHtml = '';
        if (certificateUrl) {
          certificateHtml = `<button class="save-btn" onclick="viewCertificate(${company.id}, '${escapeHtml(certificateUrl)}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%); color: #ff6b35; border: 2px solid #ffa502; padding: 6px 12px; font-size: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(255, 165, 2, 0.2); transition: all 0.3s ease;">ğŸ“„ ë³´ê¸°</button>`;
        } else {
          certificateHtml = `<button class="save-btn" onclick="uploadCertificate(${company.id})" style="background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%); color: #ff6b35; border: 2px solid #ffeaa7; padding: 6px 12px; font-size: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(255, 152, 0, 0.15); transition: all 0.3s ease;">ğŸ“¤ ì—…ë¡œë“œ</button>`;
        }
        
        // ê´€ë¦¬ ë²„íŠ¼
        const manageHtml = `
          <div style="display: flex; gap: 6px; justify-content: center;">
            <button class="save-btn" onclick="changeCompanyPassword(${company.id}, '${escapeHtml(company.username || '')}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%); color: #ff6b35; border: 2px solid #ffa502; padding: 6px 12px; font-size: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(255, 165, 2, 0.2); transition: all 0.3s ease;">ğŸ”’ ë¹„ë°€ë²ˆí˜¸</button>
            <button class="save-btn" onclick="deleteCompany(${company.id}, '${escapeHtml(company.company_name || '')}')" style="background: linear-gradient(135deg, #ee5a6f 0%, #ff6b35 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(238, 90, 111, 0.25); transition: all 0.3s ease;">ğŸ—‘ï¸ ì‚­ì œ</button>
          </div>
        `;
        
        tr.innerHTML = `
          <td>${escapeHtml(company.company_name || '-')}</td>
          <td>${escapeHtml(company.username || '-')}</td>
          <td>${roleHtml}</td>
          <td>${escapeHtml(company.business_number || '-')}</td>
          <td>${escapeHtml(company.business_name || '-')}</td>
          <td>${escapeHtml(company.business_address || '-')}</td>
          <td>${escapeHtml(company.business_tel || '-')}</td>
          <td>${escapeHtml(company.business_email || '-')}</td>
          <td style="text-align: center;">${certificateHtml}</td>
          <td>${lastLogin}</td>
          <td>${createdAt}</td>
          <td style="text-align: center;">${manageHtml}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    window.renderCompaniesTable = renderCompaniesTable;
    
    /* ========== í™”ì£¼ì‚¬ ì‚­ì œ ========== */
    function deleteCompany(companyId, companyName) {
      if (!confirm(`ì •ë§ë¡œ "${companyName}" í™”ì£¼ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('í™”ì£¼ì‚¬ ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ í™”ì£¼ì‚¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.deleteCompany = deleteCompany;
    
    /* ========== í™”ì£¼ì‚¬ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ========== */
    function changeCompanyPassword(companyId, username) {
      const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, '');
      
      if (!newPassword) {
        return;
      }
      
      if (newPassword.length < 4) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`ì •ë§ë¡œ "${username}"ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}/password`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          new_password: newPassword
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
        } else {
          showMessage('âŒ ' + (data.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.changeCompanyPassword = changeCompanyPassword;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ========== */
    function uploadCertificate(companyId) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*,.pdf';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ì œí•œ)
        if (file.size > 10 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        
        // íŒŒì¼ì„ Base64ë¡œ ë³€í™˜
        const reader = new FileReader();
        reader.onload = function(event) {
          const base64Data = event.target.result;
          
          // Cloudinaryì— ì—…ë¡œë“œ
          uploadCertificateToCloudinary(companyId, base64Data, file.name);
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    window.uploadCertificate = uploadCertificate;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ Cloudinary ì—…ë¡œë“œ ========== */
    function uploadCertificateToCloudinary(companyId, base64Data, fileName) {
      showMessage('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘...', 'success');
      
      // Base64 ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
      const blob = dataURLtoBlob(base64Data);
      
      // FormData ìƒì„±
      const formData = new FormData();
      formData.append('file', blob, fileName);
      
      // ì„œë²„ë¥¼ í†µí•´ Cloudinaryì— ì—…ë¡œë“œ
      fetch('/api/uploads/certificate', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success && data.url) {
          // ì—…ë¡œë“œëœ URLì„ ì„œë²„ì— ì €ì¥
          return fetch(`/api/auth/company/${companyId}/certificate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              certificate_url: data.url
            })
          });
        } else {
          throw new Error(data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ì‚¬ì—…ì ë“±ë¡ì¦ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.uploadCertificateToCloudinary = uploadCertificateToCloudinary;
    
    /* ========== Base64ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ ========== */
    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], { type: mime });
    }
    window.dataURLtoBlob = dataURLtoBlob;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ë³´ê¸° ========== */
    function viewCertificate(companyId, certificateUrl) {
      // ìƒˆ ì°½ì—ì„œ ì‚¬ì—…ì ë“±ë¡ì¦ ì—´ê¸°
      window.open(certificateUrl, '_blank');
    }
    window.viewCertificate = viewCertificate;
    
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', function() {
      // ìë™ ë¡œê·¸ì¸ í™•ì¸
      const savedCompany = localStorage.getItem('client_company');
      const savedUsername = localStorage.getItem('client_username');
      const savedRole = localStorage.getItem('client_role');
      const loginTime = localStorage.getItem('client_loginTime');
      
      if (savedCompany && savedUsername && loginTime) {
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
          currentCompany = savedCompany;
          currentUsername = savedUsername;
          currentRole = (savedRole || '').toString().trim();
          console.log('ìë™ ë¡œê·¸ì¸ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole); // ë””ë²„ê¹…ìš©
          console.log('ìë™ ë¡œê·¸ì¸ - ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          showDashboard();
          // í—¤ë” hover ì°¨ë‹¨ ì ìš©
          setTimeout(disableHeaderHover, 100);
          return;
        } else {
          localStorage.removeItem('client_company');
          localStorage.removeItem('client_username');
          localStorage.removeItem('client_role');
          localStorage.removeItem('client_loginTime');
        }
      }
      
      // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('dashboardSection').style.display = 'none';
      
      // ì—”í„°í‚¤ ì´ë²¤íŠ¸
      document.getElementById('username').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          document.getElementById('password').focus();
        }
      });
      
      document.getElementById('password').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          doLogin();
        }
      });
      
      // ê´€ë¦¬ì í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const adminRegisterForm = document.getElementById('adminRegisterForm');
      if (adminRegisterForm) {
        adminRegisterForm.addEventListener('submit', function(e) {
          e.preventDefault();
          registerCompany();
        });
      }
      
    });
  </script>
</body>
</html>

