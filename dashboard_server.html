<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JJAY 3PL ì¢…í•© ë¬¼ë¥˜ - í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <!-- íŒŒë¹„ì½˜ -->
  <link rel="icon" type="image/png" href="https://res.cloudinary.com/dokk81rjh/image/upload/v1763517440/jayjay_favicon_512_sxrfoo.png">
  <link rel="alternate icon" href="https://res.cloudinary.com/dokk81rjh/image/upload/v1763517440/jayjay_favicon_512_sxrfoo.png">
  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <!-- jQuery (Summernote ì˜ì¡´ì„±) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Summernote ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° -->
  <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
  <!-- QR ì½”ë“œ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- Chart.js (íŒŒë ˆíŠ¸ ê´€ë¦¬ - ì›”ë³„ ìˆ˜ì… í˜„í™©ìš©) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 50%, #ffeaa7 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ë¡œê·¸ì¸ ì„¹ì…˜ */
    .login-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 50%, #ffa502 100%);
      position: relative;
      overflow: hidden;
    }
    
    .login-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @keyframes hbMarquee {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    
    @keyframes hbMarqueeLeft {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-50%);
      }
    }
    
    @keyframes hbMarqueeLeftOnce {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    
    @keyframes hbBlink {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.3;
      }
    }
    
    @keyframes hbSlideUp {
      0% {
        transform: translateY(100%);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes hbSparkle {
      0%, 100% {
        opacity: 0.3;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.1);
      }
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .login-form {
      background: rgba(255, 255, 255, 0.98);
      padding: 50px 40px;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 8px 24px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      width: 100%;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(10px);
    }
    
    .login-logo {
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      border: 4px solid rgba(255, 255, 255, 0.9);
      overflow: hidden;
    }
    
    .login-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      padding: 15px;
    }
    
    .login-form h1 {
      text-align: center;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      font-size: 32px;
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    
    .login-form .subtitle {
      text-align: center;
      color: #636e72;
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .footer-info {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 107, 53, 0.1);
    }
    
    .version-info {
      text-align: center;
      margin-bottom: 16px;
    }
    
    .version-text {
      font-size: 11px;
      color: #b2bec3;
      font-weight: 500;
      letter-spacing: 1px;
      padding: 4px 12px;
      background: rgba(255, 107, 53, 0.05);
      border-radius: 12px;
      display: inline-block;
    }
    
    .creator-credit {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
      padding: 0;
    }
    
    .creator-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.2), transparent);
    }
    
    .creator-text {
      font-size: 11px;
      color: #95a5a6;
      font-weight: 400;
      white-space: nowrap;
      letter-spacing: 0.5px;
    }
    
    .creator-text strong {
      color: #ff6b35;
      font-weight: 600;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .login-form .input-group {
      position: relative;
      margin-bottom: 4px;
    }
    
    .login-form .input-group i {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #ff6b35;
      font-size: 18px;
      z-index: 1;
    }
    
    .login-form input {
      width: 100%;
      padding: 16px 18px 16px 50px;
      border: 2px solid #ffeaa7;
      border-radius: 14px;
      font-size: 15px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .login-form input::placeholder {
      color: #b2bec3;
    }
    
    .login-form input:focus {
      outline: none;
      border-color: #ff6b35;
      box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
      background: #fffef9;
    }
    
    .login-form .remember-forgot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 14px;
    }
    
    .login-form .remember-forgot label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #636e72;
      cursor: pointer;
    }
    
    .login-form .remember-forgot input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #ff6b35;
    }
    
    .login-form .remember-forgot a {
      color: #ff6b35;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    
    .login-form .remember-forgot a:hover {
      color: #ff5722;
      text-decoration: underline;
    }
    
    .login-form button {
      padding: 16px 30px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 8px;
    }
    
    .login-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 107, 53, 0.5);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .login-form button:active {
      transform: translateY(0);
    }
    
    .login-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    /* ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ */
    .dashboard-section {
      display: none;
      position: relative;
    }
    
    .dashboard-section.show {
      display: block;
    }
    
    /* ë¡œê³  ìŠ¤íƒ€ì¼ */
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-letters {
      display: flex;
      align-items: center;
      position: relative;
      height: 32px;
    }
    
    .logo-j {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #ff6b35 0%, #ff5722 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      z-index: 2;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-c {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #feca57 0%, #ffa502 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      margin-left: -20px;
      z-index: 1;
      font-family: 'Arial', sans-serif;
      letter-spacing: -3px;
    }
    
    .logo-text {
      font-size: 11px;
      font-weight: 500;
      color: #636e72;
      letter-spacing: 3px;
      margin-top: 4px;
    }
    
    .header {
      background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 1;
      flex: 1;
    }
    
    .header-logo {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    
    .header h1 {
      color: #ff6b35;
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.3px;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      border-left: 2px solid #ffeaa7;
      padding-left: 15px;
    }
    
    .header .subtitle {
      color: #636e72;
      font-size: 12px;
      font-weight: 500;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header .creator {
      color: #b2bec3;
      font-size: 10px;
      font-style: italic;
      line-height: 1.2;
      white-space: nowrap;
    }
    
    .header-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
      width: auto;
    }
    
    .company-info {
      color: #2d3436;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
      padding: 8px 16px;
      border-radius: 20px;
      display: inline-block;
      border: 2px solid #ffa502;
      line-height: 1.3;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(255, 165, 2, 0.15);
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }
    
    .logout-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .logout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    /* ë©”ë‰´ë°” ìŠ¤íƒ€ì¼ */
    .menu-bar {
      background: #ffffff;
      padding: 12px 20px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .menu-item {
      padding: 10px 20px;
      border: none;
      background: transparent;
      border-radius: 10px;
      color: #636e72;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    /* ìŠ¤ì¼€ì¥´ - ê²€ìƒ‰í˜• ë“œë¡­ë‹¤ìš´ */
    .sc-searchable-select {
      position: relative;
      width: 100%;
    }

    .sc-searchable-select input[type="text"] {
      width: 100%;
      padding-right: 32px;
    }

    .sc-dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #ffffff;
      border: 2px solid #ffeaa7;
      border-radius: 10px;
      max-height: 220px;
      overflow-y: auto;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      z-index: 50;
      display: none;
      margin-top: 4px;
    }

    .sc-dropdown-list.show {
      display: block;
    }

    .sc-dropdown-item {
      padding: 10px 14px;
      cursor: pointer;
      border-bottom: 1px solid #f5f5f5;
      transition: background-color 0.2s ease;
    }

    .sc-dropdown-item:last-child {
      border-bottom: none;
    }

    .sc-dropdown-item:hover {
      background: #fff9e6;
    }

    .sc-helper-text {
      margin-top: 6px;
      font-size: 12px;
      color: #999;
    }

    /* ìŠ¤ì¼€ì¥´ íƒ€ì… ê´€ë¦¬ */
    .sc-type-select {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .sc-type-manage-btn {
      padding: 10px 14px;
      border: 2px solid #ffeaa7;
      border-radius: 10px;
      background: #fff9e6;
      color: #ff6b35;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 120px;
    }

    .sc-type-manage-btn:hover {
      background: #ffecd9;
    }

    .sc-type-manager {
      margin-top: 12px;
      background: #fff9e6;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      padding: 16px;
      display: none;
    }

    .sc-type-add-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }

    .sc-type-add-row input {
      flex: 1;
      padding: 10px 14px;
      border: 2px solid #ffeaa7;
      border-radius: 8px;
    }

    .sc-type-add-row button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: #ffffff;
      font-weight: 600;
      cursor: pointer;
    }

    .sc-type-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .sc-type-chip {
      padding: 6px 10px;
      border-radius: 999px;
      background: #ffffff;
      border: 2px solid #ffeaa7;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #2d3436;
    }

    .sc-type-chip button {
      border: none;
      background: transparent;
      color: #e74c3c;
      font-weight: 700;
      cursor: pointer;
    }

    /* ë©”ë‰´ ìˆœì„œ ê³ ì • (í™”ì£¼/ê´€ë¦¬ì ë™ì¼ ìˆœì„œ ìœ ì§€) */
    #companyInfoMenuBtn { order: 0; }
    #returnsMenuBtn { order: 1; }
    #csMenuBtn { order: 2; }
    #specialWorksMenuBtn { order: 3; }
    #palletsMenuBtn { order: 4; }
    #scheduleMenuBtn { order: 5; }
    #boardMenuBtn { order: 6; }
    
    .menu-item:hover {
      background: #fff9e6;
      color: #ff6b35;
    }
    
    .menu-item.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      background: #ffffff;
      padding: 6px;
      border-radius: 14px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 6px;
    }
    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      background: transparent;
      border-radius: 10px;
      color: #636e72;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
      background: #fff9e6;
      color: #ff6b35;
    }

    /* ê´€ë¦¬ì íƒ­ ìˆœì„œ ê³ ì • */
    #returnsTabBtn { order: 0; }
    #csTabBtn { order: 1; }
    #specialWorksTabBtn { order: 2; }
    #scheduleCalendarTabBtn { order: 3; }
    #boardTabBtn { order: 4; }
    #popupTabBtn { order: 5; }
    #registerTabBtn { order: 6; }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
    }
    
    .tab-content {
      display: block;
      visibility: visible;
      opacity: 1;
    }
    
    .tab-content.hidden {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
    
    /* í™”ì£¼ì‚¬ ë“±ë¡ í¼ ìŠ¤íƒ€ì¼ */
    .admin-form {
      background: #ffffff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      margin-bottom: 20px;
    }
    
    .admin-form h3 {
      margin: 0 0 24px;
      color: #ff6b35;
      font-size: 22px;
      font-weight: 700;
    }
    
    .admin-form .form-group {
      margin-bottom: 20px;
    }
    
    .admin-form label {
      display: block;
      margin-bottom: 10px;
      color: #2d3436;
      font-weight: 600;
      font-size: 14px;
    }
    
    .admin-form input,
    .admin-form textarea,
    .admin-form select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .admin-form input::placeholder,
    .admin-form textarea::placeholder {
      color: #b2bec3;
    }
    
    .admin-form input:focus,
    .admin-form textarea:focus,
    .admin-form select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .admin-form textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .admin-form button {
      padding: 14px 32px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .admin-form button:disabled {
      background: #ddd;
      color: #999;
      cursor: not-allowed;
      border: none;
      box-shadow: none;
      transform: none;
    }
    
    .admin-form .form-section {
      margin-top: 30px;
      padding-top: 24px;
      border-top: 2px solid #ffeaa7;
    }
    
    .admin-form .form-section h4 {
      margin: 0 0 18px;
      color: #636e72;
      font-size: 16px;
      font-weight: 600;
    }
    
    .admin-status {
      margin-top: 18px;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .admin-status.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(0, 184, 148, 0.25);
    }
    
    .admin-status.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      display: block;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .admin-status.loading {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%);
      color: #ff6b35;
      border: 2px solid #ffa502;
      display: block;
    }
    
    .filters {
      background: #ffffff;
      padding: 20px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .filters label {
      font-weight: 600;
      color: #2d3436;
    }
    
    .filters select {
      padding: 12px 18px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 14px;
      background: #ffffff;
      color: #2d3436;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filters select:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
    }
    
    .refresh-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);
    }
    
    .refresh-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 107, 53, 0.35);
      background: linear-gradient(135deg, #ff5722 0%, #ffb74d 100%);
    }
    
    .stats {
      background: #ffffff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.05);
      border: none;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
      padding: 20px 24px;
      border-radius: 14px;
      min-width: 120px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #ffeaa7;
      background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%);
    }
    
    .stat-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2);
      border-color: #ffa502;
    }
    
    .stat-item.active {
      background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%);
      border-color: #ff6b35;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      transform: translateY(-3px);
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 800;
      color: #ff6b35;
      user-select: none;
    }
    
    .stat-item.active .stat-number {
      color: white;
    }
    
    .stat-label {
      font-size: 13px;
      color: #636e72;
      margin-top: 8px;
      user-select: none;
    }
    
    .stat-item.active .stat-label {
      color: white;
      font-weight: 600;
    }
    
    .table-container {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(255, 152, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.06);
      border: none;
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 20px 20px 60px 20px;
      margin-bottom: 40px;
      min-height: 200px;
    }
    
    /* í…Œì´ë¸” ìŠ¤í¬ë¡¤ ì˜ì—­ */
    .table-container > table,
    .table-container > div:last-child > table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      border-spacing: 0;
      display: table;
    }
    
    /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ í…Œì´ë¸” ë˜í¼ */
    .table-scroll-wrapper {
      overflow-x: scroll;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      margin: 0 -20px;
      padding: 0 20px 100px 20px;
      margin-top: 15px;
      margin-bottom: 20px;
      flex: 1;
      min-height: 0;
      position: relative;
    }
    
    /* í…Œì´ë¸”ì— í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ */
    .table-scroll-wrapper > table {
      margin-bottom: 30px;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ ê°œì„  */
    .table-scroll-wrapper::-webkit-scrollbar,
    .table-container::-webkit-scrollbar {
      height: 12px;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-track,
    .table-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
      margin: 0 4px;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-thumb,
    .table-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%);
      border-radius: 10px;
      border: 2px solid #f1f1f1;
    }
    
    .table-scroll-wrapper::-webkit-scrollbar-thumb:hover,
    .table-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #ff6b35 0%, #ff9500 100%);
    }
    
    .table-container > table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      border-spacing: 0;
      display: table;
    }
    
    /* í™”ì£¼ì‚¬ ëª©ë¡ í…Œì´ë¸”ì€ ì»¬ëŸ¼ì´ ë§ì•„ì„œ ë” í° ìµœì†Œ ë„ˆë¹„ í•„ìš” */
    .table-container:has(#companiesTableBody) > table,
    .table-container table:has(#companiesTableBody) {
      min-width: 1200px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
    }
    
    thead {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead tr {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      border: none !important;
      margin: 0 !important;
    }
    
    thead,
    thead:hover,
    thead:active,
    thead:focus,
    thead:visited {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead *,
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    th {
      padding: 12px 10px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      white-space: nowrap;
      cursor: default !important;
      transition: none !important;
      -webkit-transition: none !important;
      -moz-transition: none !important;
      -o-transition: none !important;
      pointer-events: auto;
      user-select: none;
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      border: none !important;
      margin: 0 !important;
      border-spacing: 0 !important;
    }
    
    thead tr:first-child th:first-child {
      border-top-left-radius: 12px;
    }
    
    thead tr:first-child th:last-child {
      border-top-right-radius: 12px;
    }
    
    /* í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì œê±° - ëª¨ë“  ê°€ëŠ¥í•œ ìƒíƒœì™€ ì¡°í•© */
    th,
    th:hover,
    th:active,
    th:focus,
    th:visited,
    th:link,
    th::before,
    th::after {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      outline: none !important;
      box-shadow: none !important;
      transform: none !important;
      border: none !important;
      opacity: 1 !important;
    }
    
    thead th,
    thead th:hover,
    thead th:active,
    thead th:focus,
    thead th:visited,
    thead th:link,
    thead:hover th,
    thead:active th,
    thead:focus th,
    thead:hover th:hover,
    thead:active th:active {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
      cursor: default !important;
      border: none !important;
    }
    
    /* ëª¨ë“  th ìì‹ ìš”ì†Œì—ë„ ì ìš© */
    th *,
    th *:hover,
    th *:active,
    th *:focus {
      background: transparent !important;
      background-color: transparent !important;
      color: white !important;
    }
    
    /* theadì˜ ëª¨ë“  ìš”ì†Œì— hover íš¨ê³¼ ì—†ìŒ */
    thead *:hover,
    thead *:active,
    thead *:focus {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    /* í…Œì´ë¸” í—¤ë”ì˜ ëª¨ë“  ìƒíƒœì—ì„œ ë™ì¼í•œ ìŠ¤íƒ€ì¼ ìœ ì§€ - ëª¨ë“  ì¡°í•© */
    table thead,
    table thead:hover,
    table thead:active,
    table thead th,
    table thead th:hover,
    table thead th:active,
    table thead th:focus,
    table thead:hover th,
    table thead:hover th:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    /* ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë³´ë‹¤ ìš°ì„ ìˆœìœ„ ë†’ì´ê¸° */
    thead[style],
    th[style] {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    thead[style]:hover,
    th[style]:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ffa502 100%) !important;
      background-color: #ff9500 !important;
      color: white !important;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #e0e0e0;
      border-left: none !important;
      border-right: none !important;
      border-top: none !important;
      font-size: 12px;
      color: #2d3436;
      background: #ffffff;
      vertical-align: middle;
      line-height: 1.4;
    }
    
    /* thì™€ td ì‚¬ì´ì˜ ì„¸ë¡œ ê²½ê³„ì„  ì œê±° */
    th + th,
    td + td {
      border-left: none !important;
    }
    
    /* í…Œì´ë¸” ì…€ ê°„ ê°„ê²© ì œê±° */
    table th,
    table td {
      border-collapse: collapse;
    }
    
    tr:hover {
      background: #fff9e6;
    }
    
    tr {
      background: #ffffff;
      transition: background 0.2s ease;
    }
    
    tr:last-child td:first-child {
      border-bottom-left-radius: 12px;
    }
    
    tr:last-child td:last-child {
      border-bottom-right-radius: 12px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      border: none;
      line-height: 1.2;
    }
    
    .status-completed {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: none;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
    }
    
    .request-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      font-size: 13px;
      resize: vertical;
      min-height: 60px;
      background: #ffffff;
      color: #2d3436;
      transition: all 0.3s ease;
    }
    
    .request-input:focus {
      outline: none;
      border-color: #ffa502;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.1);
      background: #fffef9;
    }
    
    .save-btn {
      padding: 4px 8px;
      background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      margin: 0;
      transition: all 0.2s ease;
      box-shadow: none;
      display: inline-block;
      line-height: 1.2;
      height: auto;
    }
    
    .save-btn:hover {
      background: linear-gradient(135deg, #ff9500 0%, #ff8800 100%);
      transform: none;
      box-shadow: none;
    }

    #addReturnForm .form-action-row {
      margin-top: 24px;
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    #addReturnForm .form-action-row .save-btn {
      flex: 1 1 180px;
      padding: 16px 20px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 12px;
      min-height: 54px;
      box-shadow: 0 6px 16px rgba(255, 149, 0, 0.25);
      line-height: 1.3;
    }

    #addReturnForm .form-action-row .save-btn.secondary-action {
      background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%);
      box-shadow: 0 6px 16px rgba(149, 165, 166, 0.25);
    }

    .company-search-wrapper {
      position: relative;
      width: 100%;
    }

    .company-input-shell {
      display: flex;
      align-items: stretch;
      gap: 8px;
    }

    .company-search-input {
      flex: 1;
      min-height: 56px;
    }

    .company-combo-toggle {
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
      color: #ff6b35;
      font-weight: 700;
      font-size: 18px;
      padding: 0 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 54px;
    }

    .company-combo-toggle:hover,
    .company-combo-toggle:focus {
      outline: none;
      border-color: #ffb347;
      box-shadow: 0 0 0 4px rgba(255, 165, 2, 0.18);
      background: linear-gradient(135deg, #ffe5c4 0%, #ffd59e 100%);
    }

    .company-dropdown-list {
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      right: 0;
      background: #ffffff;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      box-shadow: 0 14px 30px rgba(255, 165, 2, 0.18);
      max-height: 260px;
      overflow-y: auto;
      display: none;
      z-index: 50;
    }

    .company-dropdown-list.open {
      display: block;
    }

    .company-dropdown-item {
      width: 100%;
      text-align: left;
      padding: 10px 16px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #2d3436;
      font-family: inherit;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .company-dropdown-item:hover,
    .company-dropdown-item.active {
      background: #fff6e8;
      color: #ff6b35;
    }

    .company-dropdown-empty {
      padding: 12px 16px;
      font-size: 13px;
      color: #999;
    }

    .company-search-hint {
      display: block;
      margin-top: 6px;
      font-size: 12px;
      color: #999;
    }

    
    /* ìˆ˜ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .edit-btn {
      background: linear-gradient(135deg, #ffeaa7 0%, #fff9e6 100%) !important;
      color: #ff6b35 !important;
      border: 2px solid #ffa502 !important;
    }
    
    .edit-btn:hover {
      background: linear-gradient(135deg, #ffa502 0%, #ffeaa7 100%) !important;
      color: white !important;
      border-color: #ff6b35 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 165, 2, 0.3);
    }
    
    .edit-btn:disabled {
      background: #ddd !important;
      color: #999 !important;
      border-color: #ddd !important;
      cursor: not-allowed;
      opacity: 0.7;
      transform: none;
      box-shadow: none;
    }
    
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      border: none;
      font-weight: 600;
      z-index: 1000;
      display: none;
      background: #ffffff;
      animation: slideInRight 0.3s ease;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .message.success {
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }
    
    .message.error {
      background: linear-gradient(135deg, #ff6b35 0%, #ee5a6f 100%);
      color: white;
      border: none;
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
    }
    
    .no-data {
      text-align: center;
      padding: 60px 40px;
      color: #b2bec3;
      font-size: 15px;
    }
    
    .admin-only {
      display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€, JavaScriptë¡œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´ */
    }
    
    /* ìŠ¤ì¼€ì¤„ ë©”ëª¨ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .schedule-memo-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
      border-color: #ffa502;
    }
    
    .schedule-memo-card-empty:hover {
      background: #fff9e6;
      border-color: #ffa502;
      transform: translateY(-2px);
    }
    
    #loginMessage {
      margin-top: 15px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* ë¹„ê³  íˆ´íŒ ìŠ¤íƒ€ì¼ */
    .download-tooltip {
      position: fixed;
      background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
      color: white;
      padding: 16px 20px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.6;
      z-index: 10000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      max-width: 350px;
      pointer-events: none;
      white-space: normal;
      word-wrap: break-word;
    }
    
    .download-tooltip::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 20px;
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 8px solid #2d3436;
    }
    
    .download-tooltip strong {
      color: #ffeaa7;
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .download-tooltip ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
    }
    
    .download-tooltip li {
      margin: 4px 0;
    }
    
    .memo-tooltip {
      position: fixed;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      max-width: 300px;
      z-index: 10000;
      pointer-events: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .memo-tooltip::before {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 5px solid rgba(0, 0, 0, 0.9);
    }
    
    /* ì œí’ˆëª… ì…€ ìŠ¤íƒ€ì¼ */
    table th:nth-child(3) {
      text-align: center;
      width: 150px !important;
      min-width: 120px !important;
      max-width: 150px !important;
      box-sizing: border-box !important;
    }
    
    table td:nth-child(3) {
      text-align: center;
      width: 150px !important;
      min-width: 120px !important;
      max-width: 150px !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      padding: 10px 8px !important;
      vertical-align: middle !important;
      box-sizing: border-box !important;
    }
    
    .product-cell {
      text-align: center !important;
      font-weight: normal;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      display: table-cell !important;
      width: 150px !important;
      max-width: 150px !important;
      min-width: 120px !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
      box-sizing: border-box !important;
    }
    
    .product-cell.has-memo {
      color: #e74c3c !important;
      font-weight: 700 !important;
      text-decoration: none !important;
      background: transparent !important;
      vertical-align: middle !important;
      line-height: 1.4 !important;
    }
    
    /* ì‚¬ì§„ ë§í¬ ìŠ¤íƒ€ì¼ */
    .photo-links {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      align-items: center;
      line-height: 1.4;
    }
    
    .photo-link {
      color: #4a90e2;
      text-decoration: underline;
      font-size: 11px;
      cursor: pointer;
      transition: color 0.2s ease;
    }
    
    .photo-link:hover {
      color: #357abd;
    }
    
    /* ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ - ì‘ì€ ê·¸ë¼ë””ì–¸íŠ¸ ë°•ìŠ¤ì— ì²´í¬ì™€ ì´ë¦„ */
    .status-completed-circle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
      color: white;
      padding: 3px 8px;
      border: none;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      box-shadow: none;
      line-height: 1.2;
    }
    
    .status-completed-circle::before {
      content: 'âœ“';
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      background: rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 14px;
      font-size: 10px;
      font-weight: bold;
    }
    
    /* ì ‘ì´ì‹ ë²„íŠ¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #addReturnBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
    
    #addCompanyBtn:hover {
      background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%) !important;
      border-color: #ffa502 !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.2) !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
    <div id="loginSection" class="login-section">
      <div class="login-form">
        <!-- ë¡œê³  ì˜ì—­ -->
        <div class="login-logo">
          <img id="loginLogo" src="" alt="JJAY ë¡œê³ " onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'font-size:48px; font-weight:800; color:white;\'>JJ</div>';">
        </div>
        
        <h1>JJAY 3PL ì¢…í•© ë¬¼ë¥˜</h1>
        <p class="subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        
        <div class="input-group">
          <i>ğŸ‘¤</i>
          <input type="text" id="username" placeholder="ì•„ì´ë””" autocomplete="username">
        </div>
        
        <div class="input-group">
          <i>ğŸ”’</i>
          <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password">
        </div>
        
        <div class="remember-forgot">
          <label>
            <input type="checkbox" id="rememberMe">
            <span>ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
          </label>
          <a href="#" onclick="alert('ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.'); return false;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>
        
        <button id="loginBtn" type="button" onclick="doLogin(); return false;">ë¡œê·¸ì¸</button>
        <div id="loginMessage"></div>
        
        <!-- ë²„ì „ ë° ë§Œë“ ì´ ì •ë³´ -->
        <div class="footer-info">
          <div class="version-info">
            <span class="version-text">v4.0</span>
          </div>
          <div class="creator-credit">
            <div class="creator-line"></div>
            <span class="creator-text">Made with â¤ï¸ by <strong>Pyojungoh</strong></span>
            <div class="creator-line"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
    <div id="dashboardSection" class="dashboard-section">
      <!-- í—¤ë” -->
      <div class="header">
        <div class="header-left">
          <div class="header-logo" onclick="goToHome()" style="cursor: pointer;">
            <img id="headerLogo" src="https://res.cloudinary.com/dokk81rjh/image/upload/v1762922695/logo_srff9i.png" alt="JJAY Logo" style="width: 50px; height: 50px; object-fit: contain; margin-right: 12px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="logo-container" style="display: none;">
              <div class="logo-letters">
                <span class="logo-j">J</span>
                <span class="logo-c">C</span>
              </div>
            </div>
            <div class="logo-text" style="display: none;">JAY JAY</div>
          </div>
          <div class="header-info" onclick="goToHome()" style="cursor: pointer;">
            <div class="subtitle">í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div class="creator">Developed by pyojungoh</div>
          </div>
        </div>
        <div class="header-center">
          <!-- í—¤ë” ë°°ë„ˆ ì˜ì—­ (ì¤‘ì•™ì— í¬ê²Œ ë°°ì¹˜) -->
          <div id="hbBannerContainer" style="display: none; width: 600px; max-width: 800px; min-width: 500px; overflow: hidden; position: relative; height: 48px; border-radius: 12px; background: #fff9e6; border: 3px solid #ffa502; flex-shrink: 0; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); margin: 0;">
            <div id="hbBannerWrapper" style="display: block; height: 100%; position: relative; overflow: hidden;">
              <!-- ë°°ë„ˆ ì•„ì´í…œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
            </div>
          </div>
        </div>
        <div class="header-right">
          <!-- ì‚¬ìš©ì ì •ë³´ -->
          <div class="company-info" id="companyInfo"></div>
          <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>
      
      <!-- ì‚¬ì—…ì ì •ë³´ ë¯¸ì…ë ¥ ë°°ë„ˆ (ì‚¬ì´ë“œì—ì„œ íŠ€ì–´ë‚˜ì˜´, ìŠ¤í¬ë¡¤ ê³ ì •) -->
      <div id="companyInfoBanner" style="display: none; position: fixed; top: 80px; right: 20px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; padding: 14px 28px; border-radius: 12px; font-weight: 700; font-size: 16px; text-align: center; box-shadow: 0 6px 20px rgba(255, 107, 53, 0.5); animation: blink 1.5s infinite; z-index: 1000; white-space: nowrap; transform: translateX(0); transition: transform 0.3s ease;">
        âš ï¸ í™”ì£¼ì‚¬ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
      </div>
      
      <!-- íŒì—… ë ˆì´ì–´ -->
      <div id="popupLayer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div id="popupContent" style="background: white; padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;">
          <button id="popupCloseBtn" onclick="closePopup()" style="position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">Ã—</button>
          <h2 id="popupTitle" style="margin: 0 0 20px 0; color: #ff6b35; font-size: 24px; font-weight: 700;"></h2>
          <div id="popupBody" style="color: #2d3436; font-size: 16px; line-height: 1.6; white-space: pre-wrap;"></div>
          <div style="margin-top: 20px; text-align: center; display: flex; gap: 10px; justify-content: center;">
            <button onclick="closePopup()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);">ë‹«ê¸°</button>
            <button onclick="closePopupForToday()" class="save-btn" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">í•˜ë£¨ ë™ì•ˆ ë³´ì§€ ì•Šê¸°</button>
          </div>
        </div>
      </div>
      
      <!-- ë©”ë‰´ë°” (í™”ì£¼ì‚¬ ëª¨ë“œë§Œ í‘œì‹œ) -->
      <div class="menu-bar" id="menuBar" style="display: none;">
        <button type="button" class="menu-item" id="companyInfoMenuBtn" onclick="switchMenu('companyInfo')">ğŸ‘¤ í™”ì£¼ì‚¬ ì •ë³´</button>
        <button type="button" class="menu-item" id="returnsMenuBtn" onclick="switchMenu('returns')">ğŸ“¦ ë°˜í’ˆê´€ë¦¬</button>
        <button type="button" class="menu-item" id="csMenuBtn" onclick="switchMenu('cs')">ğŸ“ C/S</button>
        <button type="button" class="menu-item" id="specialWorksMenuBtn" onclick="switchMenu('specialWorks')">ğŸ”§ íŠ¹ìˆ˜ì‘ì—…</button>
        <button type="button" class="menu-item" id="palletsMenuBtn" onclick="switchMenu('pallets')">ğŸ“¦ íŒŒë ˆíŠ¸ ê´€ë¦¬</button>
        <button type="button" class="menu-item" id="scheduleMenuBtn" onclick="switchMenu('schedule')">ğŸ“… ìŠ¤ì¼€ì¥´</button>
        <button type="button" class="menu-item" id="boardMenuBtn" onclick="switchMenu('board')">ğŸ“‹ ê²Œì‹œíŒ</button>
      </div>
      
      <!-- ê´€ë¦¬ì ì „ìš© íƒ­ (ê´€ë¦¬ìë§Œ í‘œì‹œ) -->
      <div id="adminTabs" style="display: none;">
        <div class="tabs">
          <button type="button" class="tab-btn active" id="returnsTabBtn" onclick="switchAdminTab('returns')">ğŸ“¦ ë°˜í’ˆ ë‚´ì—­</button>
          <button type="button" class="tab-btn" id="csTabBtn" onclick="switchAdminTab('cs')">ğŸ“ C/S ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="specialWorksTabBtn" onclick="switchAdminTab('specialWorks')">ğŸ”§ íŠ¹ìˆ˜ì‘ì—…</button>
          <button type="button" class="tab-btn" id="palletsTabBtn" onclick="switchAdminTab('pallets')">ğŸ“¦ íŒŒë ˆíŠ¸ ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="scheduleCalendarTabBtn" onclick="switchAdminTab('scheduleCalendar')">ğŸ“… ìŠ¤ì¼€ì¥´ ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="boardTabBtn" onclick="switchAdminTab('board')">ğŸ“‹ ê²Œì‹œíŒ ê´€ë¦¬</button>
          <button type="button" class="tab-btn" id="popupTabBtn" onclick="switchAdminTab('popup')">ğŸ”” íŒì—… ê´€ë¦¬</button>
          <button type="button" class="tab-btn admin-only-tab" id="registerTabBtn" onclick="switchAdminTab('register')" style="display: none;">ğŸ¢ í™”ì£¼ì‚¬ ë“±ë¡</button>
        </div>
      </div>
      
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ -->
      <div id="returnsTab" class="tab-content">
      <!-- í•„í„° -->
      <div class="filters">
        <label for="monthSelect">ğŸ“… ì¡°íšŒ ì›”:</label>
        <select id="monthSelect">
          <option value="">ë¡œë”© ì¤‘...</option>
        </select>
        <button class="refresh-btn" onclick="refreshReturnsData()" id="refreshReturnsBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="refresh-btn" onclick="loadPreviousMonthReturns()" id="previousMonthReturnsBtn" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);">ğŸ“… ì „ë‹¬ì¡°íšŒ</button>
        <button class="refresh-btn admin-only-btn" id="downloadTemplateBtn" onclick="downloadCsvTemplate()" onmouseenter="showDownloadTooltip(event)" onmouseleave="hideDownloadTooltip()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); position: relative; display: none;">ğŸ“¥ ì„œì‹ ë‹¤ìš´ë¡œë“œ</button>
        <label for="csvUploadInput" class="admin-only-btn" style="cursor: pointer; display: none;">
          <span class="refresh-btn" style="display: inline-block; margin: 0;">ğŸ“¤ CSV ì—…ë¡œë“œ</span>
          <input type="file" id="csvUploadInput" accept=".csv" style="display: none;" onchange="handleCsvUpload(event)">
        </label>
      </div>
      
      <!-- ë°˜í’ˆ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
      <div id="addReturnSection" style="display: none; margin-bottom: 20px;">
        <button id="addReturnBtn" class="refresh-btn" onclick="toggleAddForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
          <span>â• ë°˜í’ˆ ë“±ë¡</span>
          <span id="addReturnIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
        </button>
        
        <!-- ë°˜í’ˆ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
        <div id="addReturnForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ë°˜í’ˆ ë‚´ì—­ ë“±ë¡</h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ ì ‘ìˆ˜ì¼ (ì¼ìë§Œ):</label>
              <input type="number" id="newReturnDate" class="request-input" style="min-height: auto;" placeholder="ì¼ì (1-31)" min="1" max="31">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ëª…:</label>
              <div class="company-search-wrapper" id="returnCompanyCombo">
                <div class="company-input-shell">
                  <input type="text" id="newCompanyName" class="request-input company-search-input" style="min-height: auto;" placeholder="í™”ì£¼ëª…ì„ ê²€ìƒ‰í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”" autocomplete="off">
                  <button type="button" id="companyDropdownToggle" class="company-combo-toggle" aria-haspopup="listbox" aria-expanded="false">â–¼</button>
                </div>
                <div id="companyDropdownList" class="company-dropdown-list" role="listbox" aria-label="í™”ì£¼ì‚¬ ê²€ìƒ‰ ê²°ê³¼"></div>
              </div>
              <small class="company-search-hint">ê²€ìƒ‰ê³¼ ëª©ë¡ ì„ íƒì„ ë™ì‹œì— ì§€ì›í•©ë‹ˆë‹¤. í•œê¸€ìë§Œ ì…ë ¥í•´ë„ ì‹¤ì‹œê°„ìœ¼ë¡œ í•„í„°ë§ë¼ìš”.</small>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œí’ˆ:</label>
              <input type="text" id="newProduct" class="request-input" style="min-height: auto;" placeholder="ì œí’ˆëª…">
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê³ ê°ëª…:</label>
              <input type="text" id="newCustomerName" class="request-input" style="min-height: auto;" placeholder="ê³ ê°ëª…" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì†¡ì¥ë²ˆí˜¸:</label>
              <input type="text" id="newTrackingNumber" class="request-input" style="min-height: auto;" placeholder="ì†¡ì¥ë²ˆí˜¸" required>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡:</label>
              <select id="newReturnType" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ë°˜í’ˆ">ë°˜í’ˆ</option>
                <option value="êµí™˜">êµí™˜</option>
                <option value="ì˜¤ë°°ì†¡">ì˜¤ë°°ì†¡</option>
                <option value="ëˆ„ë½">ëˆ„ë½</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¬ê³ ìƒíƒœ:</label>
              <select id="newStockStatus" class="request-input" style="min-height: auto;">
                <option value="">ì„ íƒ</option>
                <option value="ì •ìƒ">ì •ìƒ</option>
                <option value="ë¶ˆëŸ‰">ë¶ˆëŸ‰</option>
              </select>
            </div>
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë¹„ê³ :</label>
              <textarea id="newMemo" class="request-input" style="min-height: 60px;" placeholder="ë¹„ê³ "></textarea>
            </div>
          </div>
          
          <!-- ì™¸ë¶€ íƒë°° ì°©ë¶ˆ ì •ë³´ (ì„ íƒì‚¬í•­) -->
          <div style="margin-top: 20px; padding: 20px; background: #fff9e6; border-radius: 12px; border: 2px solid #ffeaa7;">
            <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 15px;">ğŸšš ì™¸ë¶€ íƒë°° ì°©ë¶ˆ ì •ë³´ (ì„ íƒì‚¬í•­)</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">íƒë°°ì‚¬:</label>
                <select id="newOtherCourier" class="request-input" style="min-height: auto;" onchange="toggleCourierCustomInput()">
                  <option value="í•œì§„íƒë°°" selected>í•œì§„íƒë°°</option>
                  <option value="CJëŒ€í•œí†µìš´">CJëŒ€í•œí†µìš´</option>
                  <option value="ë¡œì  íƒë°°">ë¡œì  íƒë°°</option>
                  <option value="ë¡¯ë°íƒë°°">ë¡¯ë°íƒë°°</option>
                  <option value="ì¿ íŒ¡">ì¿ íŒ¡</option>
                  <option value="ë„¤ì´ë²„">ë„¤ì´ë²„</option>
                  <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ì…ë ¥)</option>
                </select>
                <input type="text" id="newOtherCourierCustom" class="request-input" style="min-height: auto; margin-top: 8px; display: none;" placeholder="íƒë°°ì‚¬ëª…ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê¸ˆì•¡ íƒ€ì…:</label>
                <select id="newShippingFeeType" class="request-input" style="min-height: auto;">
                  <option value="ì‹ ìš©" selected>ì‹ ìš©</option>
                  <option value="ì°©ë¶ˆ">ì°©ë¶ˆ</option>
                  <option value="ì—†ìŒ">ì—†ìŒ</option>
                </select>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê¸ˆì•¡ (ì›):</label>
                <input type="number" id="newShippingFee" class="request-input" style="min-height: auto;" placeholder="ê¸ˆì•¡ ì…ë ¥ (ì„ íƒì‚¬í•­)" min="0" step="100">
              </div>
            </div>
          </div>
          
          <div class="form-action-row">
            <button class="save-btn" onclick="addReturn()">ì €ì¥</button>
            <button class="save-btn secondary-action" onclick="toggleAddForm()">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
      
      <!-- í†µê³„ -->
      <div class="stats">
        <div class="stat-item active" id="filterAll" onclick="filterByStatus('all')">
          <div class="stat-number" id="totalCount">0</div>
          <div class="stat-label">ì „ì²´ ë°˜í’ˆ ê±´</div>
        </div>
        <div class="stat-item" id="filterCompleted" onclick="filterByStatus('completed')">
          <div class="stat-number" id="completedCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ì™„ë£Œ</div>
        </div>
        <div class="stat-item" id="filterPending" onclick="filterByStatus('pending')">
          <div class="stat-number" id="pendingCount">0</div>
          <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
        </div>
      </div>
      
      <!-- í…Œì´ë¸” -->
      <div class="table-container">
        <div class="table-scroll-wrapper">
          <table>
            <thead>
              <tr>
                <th>ì ‘ìˆ˜ì¼</th>
                <th class="admin-only" style="display: none;">í™”ì£¼ì‚¬</th>
                <th>ì œí’ˆ</th>
                <th>ê³ ê°ëª…</th>
                <th>ì†¡ì¥ë²ˆí˜¸</th>
              <th>ë°˜í’ˆ/êµí™˜</th>
              <th>ì¬ê³ ìƒíƒœ</th>
              <th>ì²˜ë¦¬ì™„ë£Œ</th>
              <th>ì‚¬ì§„</th>
              <th class="admin-only" style="display: none;">ë¹„ê³ </th>
              <th>í™”ì£¼ì‚¬ ìš”ì²­ì‚¬í•­</th>
              <th class="admin-only" style="display: none;">QR</th>
              <th class="admin-only" style="display: none;">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
            </tr>
          </tbody>
        </table>
        </div>
      </div>
      </div>
      <!-- ë°˜í’ˆ ë‚´ì—­ íƒ­ ë -->
      
      <!-- í™”ì£¼ì‚¬ ì •ë³´ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="companyInfoTab" class="tab-content hidden">
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ‘¤ í™”ì£¼ì‚¬ ì •ë³´</h3>
            <button class="refresh-btn" onclick="loadCompanyInfo()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          
          <!-- í™”ì£¼ì‚¬ ì •ë³´ í¼ -->
          <form id="companyInfoForm" onsubmit="saveCompanyInfo(event); return false;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
              <!-- ê¸°ë³¸ ì •ë³´ -->
              <div style="grid-column: 1 / -1;">
                <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px; padding-bottom: 10px; border-bottom: 2px solid #ffeaa7;">ê¸°ë³¸ ì •ë³´</h4>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ëª… *</label>
                <input type="text" id="companyInfoName" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì•„ì´ë”” *</label>
                <input type="text" id="companyInfoUsername" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê¶Œí•œ</label>
                <input type="text" id="companyInfoRole" class="request-input" style="min-height: auto;" readonly disabled>
              </div>
              
              <!-- ì‚¬ì—…ì ì •ë³´ -->
              <div style="grid-column: 1 / -1; margin-top: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px; padding-bottom: 10px; border-bottom: 2px solid #ffeaa7;">ì‚¬ì—…ì ì •ë³´</h4>
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‚¬ì—…ìë²ˆí˜¸</label>
                <input type="text" id="companyInfoBusinessNumber" class="request-input" style="min-height: auto;" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ëŒ€í‘œëª…</label>
                <input type="text" id="companyInfoBusinessName" class="request-input" style="min-height: auto;" placeholder="ëŒ€í‘œëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì£¼ì†Œ</label>
                <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                  <input type="text" id="companyInfoPostcode" class="request-input" style="min-height: auto; width: 120px;" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                  <button type="button" onclick="openPostcodeSearch()" class="save-btn" style="padding: 10px 20px; font-size: 14px; white-space: nowrap;">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
                <input type="text" id="companyInfoBusinessAddress" class="request-input" style="min-height: auto; margin-bottom: 8px;" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly>
                <input type="text" id="companyInfoBusinessAddressDetail" class="request-input" style="min-height: auto;" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="companyInfoBusinessTel" class="request-input" style="min-height: auto;" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
              </div>
              
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼</label>
                <input type="email" id="companyInfoBusinessEmail" class="request-input" style="min-height: auto;" placeholder="ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
              </div>
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button type="submit" class="save-btn">ğŸ’¾ ì •ë³´ ì €ì¥</button>
              <button type="button" class="save-btn" onclick="loadCompanyInfo()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ğŸ”„ ì´ˆê¸°í™”</button>
            </div>
            <div id="companyInfoMessage" style="margin-top: 15px;"></div>
          </form>
          
          <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„¹ì…˜ -->
          <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #ffeaa7;">
            <h4 style="margin: 0 0 15px 0; color: #ff6b35; font-weight: 600; font-size: 16px;">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h4>
            <form id="changePasswordForm" onsubmit="changePassword(event); return false;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="currentPassword" class="request-input" style="min-height: auto;" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="newPassword" class="request-input" style="min-height: auto;" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                  <input type="password" id="newPasswordConfirm" class="request-input" style="min-height: auto;" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
              </div>
              <div style="margin-top: 15px; display: flex; gap: 12px;">
                <button type="submit" class="save-btn">ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                <button type="button" class="save-btn" onclick="resetPasswordForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì´ˆê¸°í™”</button>
              </div>
              <div id="passwordChangeMessage" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
      </div>
      <!-- í™”ì£¼ì‚¬ ì •ë³´ íƒ­ ë -->
      
      <!-- C/S íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ ë° ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="csTab" class="tab-content hidden">
        <!-- í•„í„° -->
        <div class="filters">
          <label for="csMonthSelect">ğŸ“… ì¡°íšŒ ì›”:</label>
          <select id="csMonthSelect">
            <option value="">ë¡œë”© ì¤‘...</option>
          </select>
          <label for="csCompanySelect" id="csCompanyLabel" style="display: none;">ğŸ¢ í™”ì£¼ì‚¬:</label>
          <select id="csCompanySelect" style="display: none;" onchange="loadCsData()">
            <option value="">ì „ì²´</option>
          </select>
          <button class="refresh-btn" onclick="refreshCsData()" id="refreshCsBtn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          <button class="refresh-btn" onclick="loadPreviousMonthCs()" id="previousMonthCsBtn" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);">ğŸ“… ì „ë‹¬ì¡°íšŒ</button>
          <button class="refresh-btn" onclick="exportCsData()" id="exportCsBtn" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
          <button class="refresh-btn admin-only-btn" onclick="openCsIssueTypesManager()" id="csIssueTypesManagerBtn" style="display: none; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">âš™ï¸ C/S ì¢…ë¥˜ ê´€ë¦¬</button>
          <button class="refresh-btn" onclick="testTelegram()" id="testTelegramBtn" style="display:none; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">ğŸ“± í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <!-- í™”ì£¼ì‚¬ë³„ í†µê³„ (ê´€ë¦¬ì ì „ìš©) -->
        <div id="csAdminCompanyStatsSection" class="admin-only-btn" style="display: none; margin-bottom: 20px;">
          <div class="stats" id="csAdminCompanyStatsContainer" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <!-- í™”ì£¼ì‚¬ë³„ í†µê³„ ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
        
        <!-- í†µê³„ -->
        <div class="stats" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
          <span id="csFilterAll" onclick="filterCsByStatus('all')" onmouseover="if(!this.classList.contains('active')) this.style.transform='scale(1.05)'" onmouseout="if(!this.classList.contains('active')) this.style.transform='scale(1)'" style="padding: 8px 12px; border-radius: 8px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; cursor: pointer; font-size: 13px; font-weight: 600; border: 2px solid #ff6b35; transition: all 0.3s ease; white-space: nowrap;">
            ì´ C/S ê±´ <strong id="csTotalCount">0</strong>
          </span>
          <span id="csFilterCompleted" onclick="filterCsByStatus('completed')" onmouseover="if(this.style.background.includes('fffef9')) this.style.transform='scale(1.05)'; this.style.borderColor='#ffa502'" onmouseout="if(this.style.background.includes('fffef9')) this.style.transform='scale(1)'; this.style.borderColor='#ffeaa7'" style="padding: 8px 12px; border-radius: 8px; background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%); color: #636e72; cursor: pointer; font-size: 13px; font-weight: 600; border: 2px solid #ffeaa7; transition: all 0.3s ease; white-space: nowrap;">
            ì²˜ë¦¬ì™„ë£Œ <strong id="csCompletedCount">0</strong>
          </span>
          <span id="csFilterPending" onclick="filterCsByStatus('pending')" onmouseover="if(this.style.background.includes('fffef9')) this.style.transform='scale(1.05)'; this.style.borderColor='#ffa502'" onmouseout="if(this.style.background.includes('fffef9')) this.style.transform='scale(1)'; this.style.borderColor='#ffeaa7'" style="padding: 8px 12px; border-radius: 8px; background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%); color: #636e72; cursor: pointer; font-size: 13px; font-weight: 600; border: 2px solid #ffeaa7; transition: all 0.3s ease; white-space: nowrap;">
            ë¯¸ì²˜ë¦¬ <strong id="csPendingCount">0</strong>
          </span>
          <span id="csFilterMissing" onclick="filterCsByType('ëˆ„ë½')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #e74c3c; transition: all 0.3s ease; white-space: nowrap;">
            ëˆ„ë½ <strong id="csMissingCount">0</strong>
          </span>
          <span id="csFilterWrongDelivery" onclick="filterCsByType('ì˜¤ë°°ì†¡')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #f39c12; transition: all 0.3s ease; white-space: nowrap;">
            ì˜¤ë°°ì†¡ <strong id="csWrongDeliveryCount">0</strong>
          </span>
          <span id="csFilterExchange" onclick="filterCsByType('êµí™˜')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #3498db; transition: all 0.3s ease; white-space: nowrap;">
            êµí™˜ <strong id="csExchangeCount">0</strong>
          </span>
          <span id="csFilterReturn" onclick="filterCsByType('ë°˜í’ˆ')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #9b59b6; transition: all 0.3s ease; white-space: nowrap;">
            ë°˜í’ˆ <strong id="csReturnCount">0</strong>
          </span>
          <span id="csFilterCancel" onclick="filterCsByType('ì·¨ì†Œ')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #95a5a6; transition: all 0.3s ease; white-space: nowrap;">
            ì·¨ì†Œ <strong id="csCancelCount">0</strong>
          </span>
          <span id="csFilterOther" onclick="filterCsByType('ê¸°íƒ€')" onmouseover="if(!this.classList.contains('active')) { this.style.transform='scale(1.05)'; this.style.opacity='0.9'; }" onmouseout="if(!this.classList.contains('active')) { this.style.transform='scale(1)'; this.style.opacity='1'; }" style="padding: 6px 10px; border-radius: 6px; background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); color: white; cursor: pointer; font-size: 11px; font-weight: 600; border: 2px solid #1abc9c; transition: all 0.3s ease; white-space: nowrap;">
            ê¸°íƒ€ <strong id="csOtherCount">0</strong>
          </span>
        </div>
        
        <!-- C/S ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œë§Œ í‘œì‹œ) -->
        <div id="csRegisterSection" style="margin-bottom: 20px;">
          <button id="addCsBtn" class="refresh-btn" onclick="toggleCsForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• C/S ë“±ë¡</span>
            <span id="addCsIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- C/S ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addCsForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">C/S ì ‘ìˆ˜ ë“±ë¡</h3>
            <form id="csForm" onsubmit="saveCs(event); return false;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div id="csCompanyNameField" style="display: none;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ëª… *</label>
                  <select id="csCompanyName" class="request-input" style="min-height: auto;">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  </select>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê´€ë¦¬ë²ˆí˜¸ *</label>
                  <input type="text" id="csManagementNumber" class="request-input" style="min-height: auto;" placeholder="ê´€ë¦¬ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê³ ê°ëª…</label>
                  <input type="text" id="csCustomerName" class="request-input" style="min-height: auto;" placeholder="ê³ ê°ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)">
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">C/S ì¢…ë¥˜ *</label>
                  <select id="csIssueType" class="request-input" style="min-height: auto;" required>
                    <option value="">ë¡œë”© ì¤‘...</option>
                  </select>
                </div>
                
                <div style="grid-column: 1 / -1;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">C/S ë‚´ìš© *</label>
                  <textarea id="csContent" class="request-input" style="min-height: 100px;" placeholder="C/S ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
                </div>
              </div>
              
              <div style="margin-top: 20px; display: flex; gap: 12px;">
                <button type="submit" class="save-btn">ğŸ’¾ ë“±ë¡</button>
                <button type="button" class="save-btn" onclick="resetCsForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ğŸ”„ ì´ˆê¸°í™”</button>
              </div>
              <div id="csFormMessage" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
        
        <!-- C/S ëª©ë¡ í…Œì´ë¸” -->
        <div class="table-container">
          <div class="table-scroll-wrapper">
            <table id="csTable" style="width: 100%; border-collapse: collapse; min-width: 1200px;">
              <thead>
                <tr style="background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white;">
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ìˆœë²ˆ</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ë‚ ì§œ</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600; width: 100px; min-width: 100px; max-width: 100px;">ê´€ë¦¬ë²ˆí˜¸</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600; width: 100px; min-width: 100px; max-width: 100px;">ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">í™”ì£¼ì‚¬ëª…</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ê³ ê°ëª…</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">C/S ì¢…ë¥˜</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">C/S ë‚´ìš©</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ì²˜ë¦¬ì—¬ë¶€</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ì²˜ë¦¬ì</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600;">ê´€ë¦¬ì ë©”ì‹œì§€</th>
                  <th id="csAdminActionsHeader" style="padding: 12px; text-align: center; font-weight: 600; display: none;">ê´€ë¦¬</th>
                  <th id="csResendHeader" style="padding: 12px; text-align: center; font-weight: 600; display: none;">ì¬ìš”ì²­</th>
                </tr>
              </thead>
              <tbody id="csTableBody">
                <tr>
                  <td colspan="12" class="no-data">ë¡œë”© ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- C/S íƒ­ ë -->
      <!-- ìŠ¤ì¼€ì¥´ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="scheduleTab" class="tab-content hidden">
        <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ -->
        <div style="margin-bottom: 20px;">
          <button id="addScheduleBtn" class="refresh-btn" onclick="toggleScheduleForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• ìŠ¤ì¼€ì¥´ ë“±ë¡</span>
            <span id="addScheduleIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¶</span>
          </button>
          
          <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="scheduleForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ìŠ¤ì¼€ì¥´ ë“±ë¡</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìŠ¤ì¼€ì¤„ íƒ€ì… *</label>
                <select id="scheduleType" class="request-input" style="min-height: auto;" required>
                  <option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="scheduleTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: 11ì›” ëŒ€í˜• í• ì¸í–‰ì‚¬" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                <input type="date" id="scheduleStartDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                <input type="date" id="scheduleEndDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í–‰ì‚¬ ë‚´ìš© *</label>
                <textarea id="scheduleEventDescription" class="request-input" style="min-height: 80px;" placeholder="í–‰ì‚¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                <textarea id="scheduleRequestNote" class="request-input" style="min-height: 60px;" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveSchedule()">ì €ì¥</button>
              <button class="save-btn" onclick="resetScheduleForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì´ˆê¸°í™”</button>
            </div>
            <div id="scheduleMessage" style="margin-top: 15px;"></div>
          </div>
        </div>
        
        <!-- ì•ˆë‚´ ì„¤ëª… ë°•ìŠ¤ -->
        <div style="background: linear-gradient(135deg, #fff9e6 0%, #fff5d6 100%); padding: 20px; border-radius: 14px; border: 2px solid #ffeaa7; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; align-items: flex-start; gap: 12px;">
            <div style="font-size: 24px; line-height: 1;">â„¹ï¸</div>
            <div style="flex: 1;">
              <h4 style="margin: 0 0 12px 0; color: #ff6b35; font-weight: 700; font-size: 16px;">ğŸ“‹ ìŠ¤ì¼€ì¥´ ë“±ë¡ ì•ˆë‚´</h4>
              <div style="color: #2d3436; font-size: 14px; line-height: 1.7;">
                <p style="margin: 0 0 10px 0;">
                  ì´ ë©”ë‰´ëŠ” í™”ì£¼ì‚¬ë‹˜ì˜ <strong>ì…ê³ , ì¶œê³ , íŒë§¤ ìŠ¤ì¼€ì¥´</strong>ì„ ì‚¬ì „ì— ë“±ë¡í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
                </p>
                <p style="margin: 0 0 10px 0;">
                  ëŒ€ëŸ‰ì˜ ë¬¼ëŸ‰ì´ ì˜ˆìƒë˜ëŠ” ê²½ìš°, ë°˜ë“œì‹œ <strong>ì‚¬ì „ì— ìŠ¤ì¼€ì¥´ì„ ë“±ë¡</strong>í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. 
                  ì‚¬ì „ ì‹ ì²­ ì—†ì´ ëŒ€ëŸ‰ì˜ ë¬¼ëŸ‰ì´ ê°‘ìê¸° ë“¤ì–´ì˜¬ ê²½ìš°, ë¬¼ë¥˜ ì²˜ë¦¬ ì‹œê°„ì´ ì§€ì—°ë  ìˆ˜ ìˆìœ¼ë©°, 
                  ì´ë¡œ ì¸í•œ ì±…ì„ì€ ì œì´ì œì´ì—ì„œ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </p>
                <p style="margin: 0; color: #e74c3c; font-weight: 600;">
                  âš ï¸ ì›í™œí•œ ë¬¼ë¥˜ ì²˜ë¦¬ë¥¼ ìœ„í•´ ê°€ëŠ¥í•œ í•œ ì¼ì° ìŠ¤ì¼€ì¥´ì„ ë“±ë¡í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¥´ ë‹¬ë ¥ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ìŠ¤ì¼€ì¥´ ë‹¬ë ¥</h3>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input type="month" id="consignorCalendarMonthSelect" style="padding: 8px 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px;" onchange="loadConsignorCalendarSchedules()">
              <button class="refresh-btn" onclick="loadConsignorCalendarSchedules()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
          </div>
          <div id="consignorCalendarContainer" style="min-height: 500px;">
            <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¥´ ëª©ë¡ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“‹ ë“±ë¡ëœ ìŠ¤ì¼€ì¥´</h3>
            <button class="refresh-btn" onclick="refreshSchedules()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‹œì‘ì¼</th>
                  <th>ì¢…ë£Œì¼</th>
                  <th>í–‰ì‚¬ ë‚´ìš©</th>
                  <th>ìš”ì²­ì‚¬í•­</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="scheduleTableBody">
                <tr>
                  <td colspan="6" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ìŠ¤ì¼€ì¥´ íƒ­ ë -->
      
      <!-- ê²Œì‹œíŒ íƒ­ (í™”ì£¼ì‚¬ ëª¨ë“œ) -->
      <div id="boardCategoryTab" class="tab-content hidden">
        <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë°•ìŠ¤ -->
        <div style="background: #ffffff; padding: 20px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“‹ ê²Œì‹œíŒ</h3>
            <button class="refresh-btn" onclick="loadBoardPostsByCategoryFilter()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="boardCategoryMenuBox" style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button type="button" class="category-menu-btn active" data-category-id="" onclick="selectBoardCategory('')" style="padding: 10px 20px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(255, 107, 53, 0.25);">ì „ì²´</button>
          </div>
        </div>
        
        <!-- ê²Œì‹œê¸€ ëª©ë¡ ë°•ìŠ¤ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
          <!-- ê²Œì‹œê¸€ ëª©ë¡ í…Œì´ë¸” -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th style="width: 80px;">ë²ˆí˜¸</th>
                  <th style="width: 120px;">ì¹´í…Œê³ ë¦¬</th>
                  <th>ì œëª©</th>
                  <th style="width: 120px;">ê¸€ì“´ì´</th>
                  <th style="width: 120px;">ì‘ì„±ë‚ ì§œ</th>
                </tr>
              </thead>
              <tbody id="boardPostList">
                <tr>
                  <td colspan="5" class="no-data">ë¡œë”© ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ê²Œì‹œíŒ íƒ­ ë -->
      
      <!-- ìŠ¤ì¼€ì¥´ ë‹¬ë ¥ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="scheduleCalendarTab" class="tab-content hidden">
        <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ (ê´€ë¦¬ììš©) -->
        <div style="margin-bottom: 20px;">
          <button id="addAdminScheduleBtn" class="refresh-btn" onclick="toggleAdminScheduleForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• ìŠ¤ì¼€ì¥´ ë“±ë¡ (ê´€ë¦¬ì)</span>
            <span id="addAdminScheduleIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addAdminScheduleForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ìŠ¤ì¼€ì¥´ ë“±ë¡ (ê´€ë¦¬ì)</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ ì„ íƒ *</label>
                <div class="sc-searchable-select">
                  <input type="text" id="adminScheduleCompanyInput" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ì‚¬ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”" autocomplete="off">
                  <input type="hidden" id="adminScheduleCompanyName" required>
                  <div class="sc-dropdown-list" id="adminScheduleCompanyDropdown"></div>
                </div>
                <div class="sc-helper-text">"ëª¨ë“  í™”ì£¼ì‚¬", "ì œì´ì œì´" ë“± ì›í•˜ëŠ” ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”.</div>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìŠ¤ì¼€ì¤„ íƒ€ì… *</label>
                <div class="sc-type-select">
                  <select id="adminScheduleType" class="request-input" style="min-height: auto; flex: 1;" required>
                    <option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  </select>
                  <button type="button" class="sc-type-manage-btn" onclick="toggleScheduleTypeManager()">âš™ íƒ€ì… ê´€ë¦¬</button>
                </div>
                <div id="scheduleTypeManager" class="sc-type-manager">
                  <div class="sc-type-add-row">
                    <input type="text" id="scheduleTypeInput" placeholder="ì¶”ê°€í•  ìŠ¤ì¼€ì¤„ íƒ€ì…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    <button type="button" onclick="addCustomScheduleType()">ì¶”ê°€</button>
                  </div>
                  <div class="sc-helper-text">ê¸°ë³¸ íƒ€ì… ì™¸ì— ìƒì‹œ ì‚¬ìš©í•˜ëŠ” ìŠ¤ì¼€ì¤„ íƒ€ì…ì„ ì§ì ‘ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                  <div id="scheduleTypeList" class="sc-type-list"></div>
                </div>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="adminScheduleTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: 11ì›” ëŒ€í˜• í• ì¸í–‰ì‚¬" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                <input type="date" id="adminScheduleStartDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                <input type="date" id="adminScheduleEndDate" class="request-input" style="min-height: auto;" required>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í–‰ì‚¬ ë‚´ìš© *</label>
                <textarea id="adminScheduleEventDescription" class="request-input" style="min-height: 80px;" placeholder="í–‰ì‚¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                <textarea id="adminScheduleRequestNote" class="request-input" style="min-height: 60px;" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”"></textarea>
              </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveAdminSchedule()">ì €ì¥</button>
              <button class="save-btn" onclick="toggleAdminScheduleForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
            </div>
            <div id="adminScheduleMessage" style="margin-top: 15px;"></div>
          </div>
        </div>
        
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px; box-sizing: border-box;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“… ì „ì²´ í™”ì£¼ì‚¬ ìŠ¤ì¼€ì¥´</h3>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input type="month" id="calendarMonthSelect" style="padding: 8px 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px;" onchange="loadCalendarSchedules()">
              <button class="refresh-btn" onclick="loadCalendarSchedules()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
          </div>
          <div id="calendarContainer" style="min-height: 500px;">
            <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¤„ ë©”ëª¨íŒ (ê´€ë¦¬ì ì „ìš©) -->
        <div id="scheduleMemoSection" class="admin-only" style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px; box-sizing: border-box;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“ ë©”ëª¨</h3>
            <button class="refresh-btn" onclick="loadScheduleMemos()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div id="scheduleMemoGrid" style="display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: 12px; width: 100%; max-width: 100%; box-sizing: border-box;">
            <!-- ë©”ëª¨ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
        
        <!-- ë©”ëª¨ ì‘ì„± ëª¨ë‹¬ -->
        <div id="scheduleMemoCreateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;">
          <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 14px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; color: #ff6b35; font-weight: 700;">ğŸ“ ë©”ëª¨ ì‘ì„±</h2>
              <button onclick="closeScheduleMemoCreateModal()" style="background: #e17055; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px;">Ã—</button>
            </div>
            <form id="scheduleMemoCreateForm" onsubmit="event.preventDefault(); return false;">
              <div style="margin-bottom: 20px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="scheduleMemoCreateTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: ì´ë²ˆë‹¬ ì¤‘ìˆœ ì…ê³  ì˜ˆì •" required>
              </div>
              <div style="margin-bottom: 20px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ (ì„ íƒì‚¬í•­)</label>
                <div class="sc-searchable-select">
                  <input type="text" id="scheduleMemoCreateCompanyInput" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ì‚¬ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”" autocomplete="off">
                  <input type="hidden" id="scheduleMemoCreateCompanyName">
                  <div class="sc-dropdown-list" id="scheduleMemoCreateCompanyDropdown"></div>
                </div>
              </div>
              <div style="margin-bottom: 20px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
                <textarea id="scheduleMemoCreateContent" class="request-input" style="min-height: 150px; width: 100%; resize: vertical;" placeholder="ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="margin-top: 20px; display: flex; gap: 12px;">
                <button type="button" class="save-btn" onclick="saveScheduleMemoCreate()">ğŸ’¾ ì €ì¥</button>
                <button type="button" class="save-btn" onclick="closeScheduleMemoCreateModal()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="scheduleMemoCreateMessage" style="margin-top: 15px; font-size: 14px;"></div>
            </form>
          </div>
        </div>
        
        <!-- ë©”ëª¨ ìƒì„¸ë³´ê¸°/ìˆ˜ì • ëª¨ë‹¬ -->
        <div id="scheduleMemoDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;">
          <div style="max-width: 600px; margin: 50px auto; background: white; border-radius: 14px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; color: #ff6b35; font-weight: 700;">ğŸ“ ë©”ëª¨ ìƒì„¸</h2>
              <button onclick="closeScheduleMemoDetailModal()" style="background: #e17055; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px;">Ã—</button>
            </div>
            <div id="scheduleMemoDetailView" style="display: block;">
              <div style="margin-bottom: 20px;">
                <label style="color: #636e72; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª©</label>
                <div id="scheduleMemoDetailTitle" style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 16px; font-weight: 600; color: #2d3436;"></div>
              </div>
              <div style="margin-bottom: 20px;">
                <label style="color: #636e72; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬</label>
                <div id="scheduleMemoDetailCompany" style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #2d3436;"></div>
              </div>
              <div style="margin-bottom: 20px;">
                <label style="color: #636e72; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš©</label>
                <div id="scheduleMemoDetailContent" style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 14px; color: #2d3436; white-space: pre-wrap; min-height: 100px;"></div>
              </div>
              <div style="margin-bottom: 20px; padding: 12px; background: #fff9e6; border-radius: 8px; font-size: 12px; color: #999;">
                <div id="scheduleMemoDetailInfo"></div>
              </div>
              <div style="margin-top: 20px; display: flex; gap: 12px;">
                <button type="button" class="save-btn" onclick="showScheduleMemoEditForm()">âœï¸ ìˆ˜ì •</button>
                <button type="button" class="save-btn" onclick="deleteScheduleMemo()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); box-shadow: 0 3px 10px rgba(231, 76, 60, 0.25);">ğŸ—‘ï¸ ì‚­ì œ</button>
                <button type="button" class="save-btn" onclick="closeScheduleMemoDetailModal()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ë‹«ê¸°</button>
              </div>
            </div>
            <div id="scheduleMemoEditView" style="display: none;">
              <form id="scheduleMemoEditForm" onsubmit="event.preventDefault(); return false;">
                <input type="hidden" id="scheduleMemoEditId">
                <div style="margin-bottom: 20px;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                  <input type="text" id="scheduleMemoEditTitle" class="request-input" style="min-height: auto;" required>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ (ì„ íƒì‚¬í•­)</label>
                  <div class="sc-searchable-select">
                    <input type="text" id="scheduleMemoEditCompanyInput" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ì‚¬ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”" autocomplete="off">
                    <input type="hidden" id="scheduleMemoEditCompanyName">
                    <div class="sc-dropdown-list" id="scheduleMemoEditCompanyDropdown"></div>
                  </div>
                </div>
                <div style="margin-bottom: 20px;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
                  <textarea id="scheduleMemoEditContent" class="request-input" style="min-height: 150px; width: 100%; resize: vertical;" required></textarea>
                </div>
                <div style="margin-top: 20px; display: flex; gap: 12px;">
                  <button type="button" class="save-btn" onclick="saveScheduleMemoEdit()">ğŸ’¾ ì €ì¥</button>
                  <button type="button" class="save-btn" onclick="showScheduleMemoDetailView()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
                </div>
                <div id="scheduleMemoEditMessage" style="margin-top: 15px; font-size: 14px;"></div>
              </form>
            </div>
          </div>
        </div>
        
        <!-- ìŠ¤ì¼€ì¥´ ëª©ë¡ í…Œì´ë¸” -->
        <div class="table-container" style="margin-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0; color: #333; font-size: 18px; display: inline-block; margin-right: 15px;">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ ëª©ë¡</h3>
              <span id="schedulesStatistics" style="color: #666; font-size: 14px;">(ì´ 0ê°œ)</span>
            </div>
            <button class="refresh-btn" onclick="loadCalendarSchedules()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>í™”ì£¼ì‚¬ëª…</th>
                <th>ì œëª©</th>
                <th>ì‹œì‘ì¼</th>
                <th>ì¢…ë£Œì¼</th>
                <th>í–‰ì‚¬ ë‚´ìš©</th>
                <th>ìš”ì²­ì‚¬í•­</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="scheduleListTableBody">
              <tr>
                <td colspan="8" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- ìŠ¤ì¼€ì¥´ ë‹¬ë ¥ íƒ­ ë -->
      
      <!-- ìŠ¤ì¼€ì¥´ ìˆ˜ì • ëª¨ë‹¬ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="editScheduleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 800px; margin: 50px auto; background: white; border-radius: 14px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2 style="margin: 0; color: #ff6b35; font-weight: 700;">ìŠ¤ì¼€ì¥´ ìˆ˜ì •</h2>
            <button onclick="closeEditScheduleModal()" style="background: #e17055; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px;">Ã—</button>
          </div>
          <form id="editScheduleForm" onsubmit="event.preventDefault(); return false;">
            <input type="hidden" id="editScheduleId">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í™”ì£¼ì‚¬ ì„ íƒ *</label>
                <div class="sc-searchable-select">
                  <input type="text" id="editScheduleCompanyInput" class="request-input" style="min-height: auto;" placeholder="í™”ì£¼ì‚¬ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”" autocomplete="off" required>
                  <input type="hidden" id="editScheduleCompanyName" required>
                  <div class="sc-dropdown-list" id="editScheduleCompanyDropdown"></div>
                </div>
                <div class="sc-helper-text">"ëª¨ë“  í™”ì£¼ì‚¬", "ì œì´ì œì´" ë“± ì›í•˜ëŠ” ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”.</div>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìŠ¤ì¼€ì¤„ íƒ€ì… *</label>
                <div class="sc-type-select">
                  <select id="editScheduleType" class="request-input" style="min-height: auto; flex: 1;" required onkeydown="if(event.key==='Enter'){event.preventDefault();return false;}">
                    <option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  </select>
                </div>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="editScheduleTitle" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: 11ì›” ëŒ€í˜• í• ì¸í–‰ì‚¬" required onkeydown="if(event.key==='Enter'){event.preventDefault();return false;}">
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                <input type="date" id="editScheduleStartDate" class="request-input" style="min-height: auto;" required onkeydown="if(event.key==='Enter'){event.preventDefault();return false;}">
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                <input type="date" id="editScheduleEndDate" class="request-input" style="min-height: auto;" required onkeydown="if(event.key==='Enter'){event.preventDefault();return false;}">
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í–‰ì‚¬ ë‚´ìš© *</label>
                <textarea id="editScheduleEventDescription" class="request-input" style="min-height: 80px;" placeholder="í–‰ì‚¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();return false;}"></textarea>
              </div>
              <div style="grid-column: 1 / -1;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìš”ì²­ì‚¬í•­ (ì„ íƒì‚¬í•­)</label>
                <textarea id="editScheduleRequestNote" class="request-input" style="min-height: 60px;" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì…ë ¥í•˜ì„¸ìš”" onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();return false;}"></textarea>
              </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 12px;">
              <button type="button" class="save-btn" onclick="saveEditSchedule()">ì €ì¥</button>
              <button type="button" class="save-btn" onclick="closeEditScheduleModal()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
            </div>
            <div id="editScheduleMessage" style="margin-top: 15px;"></div>
          </form>
        </div>
      </div>
      
      <!-- ê²Œì‹œíŒ ê´€ë¦¬ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="boardTab" class="tab-content hidden">
        <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ (ì ‘ì´ì‹) -->
        <div style="margin-bottom: 20px;">
          <button id="categoryManagementBtn" class="refresh-btn" onclick="toggleCategoryManagement()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>ğŸ“ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</span>
            <span id="categoryManagementIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¶</span>
          </button>
          
          <!-- ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ë‚´ìš© (ì ‘ì´ì‹) -->
          <div id="categoryManagementContent" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; animation: slideDown 0.3s ease; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h3>
              <button class="refresh-btn" onclick="toggleCategoryForm()">â• ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ì¶”ê°€ í¼ (ì ‘ì´ì‹) -->
            <div id="categoryForm" style="display: none; background: #fff9e6; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ffeaa7;">
              <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 12px; align-items: end;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¹´í…Œê³ ë¦¬ëª… *</label>
                  <input type="text" id="categoryName" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: í™”ì£¼ì‚¬êµìœ¡, ì¼ë°˜, ê³µì§€ì‚¬í•­" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í‘œì‹œ ìˆœì„œ</label>
                  <input type="number" id="categoryOrder" class="request-input" style="min-height: auto;" value="0" min="0">
                </div>
                <div style="display: flex; gap: 8px;">
                  <button class="save-btn" onclick="saveCategory()">ì €ì¥</button>
                  <button class="save-btn" onclick="toggleCategoryForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
                </div>
              </div>
              <div id="categoryMessage" style="margin-top: 12px;"></div>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ ëª©ë¡ -->
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ì¹´í…Œê³ ë¦¬ëª…</th>
                    <th>í‘œì‹œ ìˆœì„œ</th>
                    <th>ìƒì„±ì¼</th>
                    <th>ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody id="categoryTableBody">
                  <tr>
                    <td colspan="4" class="no-data">ë¡œë”© ì¤‘...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- ê²Œì‹œê¸€ ê´€ë¦¬ ì„¹ì…˜ -->
        <div style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #ff6b35; font-weight: 700; font-size: 20px;">ğŸ“ ê²Œì‹œê¸€ ê´€ë¦¬</h3>
            <button class="refresh-btn" onclick="toggleBoardForm()">â• ê²Œì‹œê¸€ ì‘ì„±</button>
          </div>
          
          <!-- ê²Œì‹œê¸€ ì‘ì„± í¼ (ì ‘ì´ì‹) -->
          <div id="boardForm" style="display: none; background: #fff9e6; padding: 24px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ffeaa7;">
            <h4 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ê²Œì‹œê¸€ ì‘ì„±</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¹´í…Œê³ ë¦¬ *</label>
                <select id="boardCategoryId" class="request-input" style="min-height: auto;" required>
                  <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
              </div>
              <div>
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                <input type="text" id="boardTitle" class="request-input" style="min-height: auto;" placeholder="ê²Œì‹œê¸€ ì œëª©" required>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; margin-top: 24px;">
                <input type="checkbox" id="boardIsPinned" style="width: 18px; height: 18px; cursor: pointer;">
                <label for="boardIsPinned" style="color: #2d3436; font-weight: 600; cursor: pointer;">ê³µì§€ì‚¬í•­ìœ¼ë¡œ ë“±ë¡</label>
              </div>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
              <textarea id="boardContent" class="request-input" style="min-height: 300px;" placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
            </div>
            <div style="margin-bottom: 15px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì²¨ë¶€íŒŒì¼</label>
              <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                <input type="file" id="boardFileInput" multiple style="display: none;" onchange="handleBoardFileSelect(event)">
                <button type="button" class="save-btn" onclick="document.getElementById('boardFileInput').click()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">ğŸ“ íŒŒì¼ ì„ íƒ</button>
                <div id="boardFileList" style="display: flex; gap: 8px; flex-wrap: wrap;"></div>
              </div>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="save-btn" onclick="saveBoard()">ì €ì¥</button>
              <button class="save-btn" onclick="toggleBoardForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
            </div>
            <div id="boardMessage" style="margin-top: 15px;"></div>
          </div>
          
          <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
          <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <div>
                <label for="boardCategoryFilter" style="color: #333; font-size: 14px; margin-right: 8px;">ì¹´í…Œê³ ë¦¬:</label>
                <select id="boardCategoryFilter" style="padding: 8px 12px; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px;" onchange="loadBoards()">
                  <option value="">ì „ì²´</option>
                </select>
              </div>
              <button class="refresh-btn" onclick="loadBoards()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì¹´í…Œê³ ë¦¬</th>
                  <th>ì œëª©</th>
                  <th>ì‘ì„±ì</th>
                  <th>ì¡°íšŒìˆ˜</th>
                  <th>ì‘ì„±ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="boardTableBody">
                <tr>
                  <td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- ê²Œì‹œíŒ ê´€ë¦¬ íƒ­ ë -->
      
      <!-- íŒì—… ê´€ë¦¬ íƒ­ (ê´€ë¦¬ì ëª¨ë“œ) -->
      <div id="popupTab" class="tab-content hidden">
        <div class="admin-form">
          <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ğŸ”” íŒì—… ê´€ë¦¬</h3>
          
          <!-- íŒì—… ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div style="margin-bottom: 20px;">
            <button id="addPopupBtn" class="refresh-btn" onclick="togglePopupForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
              <span>â• íŒì—… ë“±ë¡</span>
              <span id="addPopupIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
            </button>
            
            <div id="popupForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
              <input type="hidden" id="popupId">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì œëª© *</label>
                  <input type="text" id="popupTitleInput" class="request-input" style="min-height: auto;" placeholder="íŒì—… ì œëª©" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‹œì‘ì¼ *</label>
                  <input type="date" id="popupStartDate" class="request-input" style="min-height: auto;" required>
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë£Œì¼ *</label>
                  <input type="date" id="popupEndDate" class="request-input" style="min-height: auto;" required>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 24px;">
                  <input type="checkbox" id="popupIsActive" style="width: 18px; height: 18px; cursor: pointer;" checked>
                  <label for="popupIsActive" style="color: #2d3436; font-weight: 600; cursor: pointer;">í™œì„±í™”</label>
                </div>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë‚´ìš© *</label>
                <textarea id="popupContentText" class="request-input" style="min-height: 200px;" placeholder="íŒì—… ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required></textarea>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
                <div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                  <input type="file" id="popupImageInput" accept="image/*" style="display: none;" onchange="handlePopupImageSelect(event)">
                  <button type="button" class="save-btn" onclick="document.getElementById('popupImageInput').click()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">ğŸ“· ì´ë¯¸ì§€ ì„ íƒ</button>
                  <button type="button" class="save-btn" onclick="removePopupImage()" id="removePopupImageBtn" style="display: none; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">ğŸ—‘ï¸ ì´ë¯¸ì§€ ì œê±°</button>
                  <div id="popupImagePreview" style="display: none; max-width: 200px; max-height: 200px; margin-top: 10px;">
                    <img id="popupImagePreviewImg" src="" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 100%; max-height: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  </div>
                </div>
                <input type="hidden" id="popupImageUrl">
              </div>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">íŒì—… ë„ˆë¹„ (px)</label>
                  <input type="number" id="popupWidth" class="request-input" style="min-height: auto;" placeholder="600" value="600" min="300" max="1200">
                </div>
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">íŒì—… ë†’ì´ (px)</label>
                  <input type="number" id="popupHeight" class="request-input" style="min-height: auto;" placeholder="400" value="400" min="200" max="800">
                </div>
              </div>
              <div style="display: flex; gap: 12px;">
                <button class="save-btn" onclick="savePopup()">ì €ì¥</button>
                <button class="save-btn" onclick="togglePopupForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="popupMessage" style="margin-top: 15px;"></div>
            </div>
          </div>
          
          <!-- íŒì—… ëª©ë¡ -->
          <div class="table-container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h4 style="color: #333; font-size: 16px; font-weight: 600;">ë“±ë¡ëœ íŒì—… ëª©ë¡</h4>
              <button class="refresh-btn" onclick="loadPopups()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì œëª©</th>
                  <th>ì‹œì‘ì¼</th>
                  <th>ì¢…ë£Œì¼</th>
                  <th>ìƒíƒœ</th>
                  <th>ìƒì„±ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="popupListTableBody">
                <tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- í—¤ë” ë°°ë„ˆ ê´€ë¦¬ ì„¹ì…˜ -->
          <div style="margin-top: 40px; padding-top: 30px; border-top: 3px solid #ffeaa7;">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">ğŸ“¢ í—¤ë” ë°°ë„ˆ ê´€ë¦¬</h3>
            <p style="color: #636e72; font-size: 14px; margin-bottom: 20px;">í—¤ë” ìƒë‹¨ì— í‘œì‹œë  ë°°ë„ˆ ë©”ì‹œì§€ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ê°œì˜ ë°°ë„ˆë¥¼ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ìˆœí™˜ í‘œì‹œë©ë‹ˆë‹¤.</p>
            
            <!-- ë°°ë„ˆ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
            <div style="margin-bottom: 20px;">
              <button id="hbAddBannerBtn" class="refresh-btn" onclick="hbToggleBannerForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
                <span>â• ë°°ë„ˆ ì¶”ê°€</span>
                <span id="hbAddBannerIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
              </button>
              
              <div id="hbBannerForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
                <input type="hidden" id="hbBannerId">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                  <div style="grid-column: 1 / -1;">
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°°ë„ˆ ë¬¸êµ¬ *</label>
                    <input type="text" id="hbBannerText" class="request-input" style="min-height: auto;" placeholder="ë°°ë„ˆì— í‘œì‹œí•  ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                  </div>
                  <div>
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë§í¬ íƒ€ì…</label>
                    <select id="hbBannerLinkType" class="request-input" style="min-height: auto;" onchange="hbToggleBoardPostSelect()">
                      <option value="none">ë§í¬ ì—†ìŒ</option>
                      <option value="board_post">ê²Œì‹œê¸€ ë§í¬</option>
                    </select>
                  </div>
                  <div id="hbBoardPostSelectWrapper" style="display: none;">
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê²Œì‹œê¸€ ì„ íƒ</label>
                    <select id="hbBoardPostSelect" class="request-input" style="min-height: auto;">
                      <option value="">ë¡œë”© ì¤‘...</option>
                    </select>
                  </div>
                  <div>
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í‘œì‹œ ìˆœì„œ</label>
                    <input type="number" id="hbBannerDisplayOrder" class="request-input" style="min-height: auto;" placeholder="0" value="0" min="0">
                    <small style="color: #636e72; font-size: 12px;">ìˆ«ìê°€ ì‘ì„ìˆ˜ë¡ ë¨¼ì € í‘œì‹œë©ë‹ˆë‹¤</small>
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px; margin-top: 24px;">
                    <input type="checkbox" id="hbBannerIsActive" style="width: 18px; height: 18px; cursor: pointer;" checked>
                    <label for="hbBannerIsActive" style="color: #2d3436; font-weight: 600; cursor: pointer;">í™œì„±í™”</label>
                  </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                  <div>
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                    <input type="color" id="hbBannerTextColor" class="request-input" style="min-height: auto; height: 40px; padding: 4px;" value="#2d3436">
                  </div>
                  <div>
                    <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°°ê²½ ìƒ‰ìƒ</label>
                    <input type="color" id="hbBannerBgColor" class="request-input" style="min-height: auto; height: 40px; padding: 4px;" value="#fff9e6">
                  </div>
                </div>
                <div style="display: flex; gap: 12px;">
                  <button class="save-btn" onclick="hbSaveBanner()">ì €ì¥</button>
                  <button class="save-btn" onclick="hbToggleBannerForm()" style="background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
                </div>
                <div id="hbBannerMessage" style="margin-top: 15px;"></div>
              </div>
            </div>
            
            <!-- ë°°ë„ˆ ëª©ë¡ -->
            <div class="table-container">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="color: #333; font-size: 16px; font-weight: 600;">ë“±ë¡ëœ ë°°ë„ˆ ëª©ë¡</h4>
                <button class="refresh-btn" onclick="hbLoadBanners()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>ìˆœì„œ</th>
                    <th>ë°°ë„ˆ ë¬¸êµ¬</th>
                    <th>ë§í¬</th>
                    <th>ìƒíƒœ</th>
                    <th>ìƒì„±ì¼</th>
                    <th>ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody id="hbBannerListTableBody">
                  <tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- íŒì—… ê´€ë¦¬ íƒ­ ë -->
      <!-- í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ -->
      <div id="registerTab" class="tab-content hidden">
        <!-- í™”ì£¼ì‚¬ ë“±ë¡ ì ‘ì´ì‹ ë²„íŠ¼ -->
        <div style="margin-bottom: 20px;">
          <button id="addCompanyBtn" class="refresh-btn" onclick="toggleAddCompanyForm()" style="background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #ffeaa7; color: #ff6b35; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1);">
            <span>â• í™”ì£¼ì‚¬ ë“±ë¡</span>
            <span id="addCompanyIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¼</span>
          </button>
          
          <!-- í™”ì£¼ì‚¬ ë“±ë¡ í¼ (ì ‘ì´ì‹) -->
          <div id="addCompanyForm" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #ffeaa7; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1);">
            <h3 style="margin-bottom: 20px; color: #ff6b35; font-weight: 700;">í™”ì£¼ì‚¬ ë“±ë¡</h3>
            <form id="adminRegisterForm">
              <!-- í•„ìˆ˜ ì •ë³´ -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">í™”ì£¼ì‚¬ëª… *</label>
                  <input type="text" id="adminRegCompanyName" placeholder="í™”ì£¼ì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì•„ì´ë”” *</label>
                  <input type="text" id="adminRegUsername" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ë¹„ë°€ë²ˆí˜¸ *</label>
                  <input type="password" id="adminRegPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                </div>
                <div>
                  <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ê¶Œí•œ *</label>
                  <select id="adminRegRole" required style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                    <option value="">ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="í™”ì£¼ì‚¬">í™”ì£¼ì‚¬</option>
                    <option value="ê´€ë¦¬ì">ê´€ë¦¬ì</option>
                  </select>
                </div>
              </div>

              <!-- ì‚¬ì—…ì ì •ë³´ (ì„ íƒ) -->
              <div style="margin-top: 30px; padding-top: 24px; border-top: 2px solid #ffeaa7;">
                <h4 style="margin: 0 0 18px; color: #636e72; font-size: 16px; font-weight: 600;">ì‚¬ì—…ì ì •ë³´ (ì„ íƒì‚¬í•­)</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìë²ˆí˜¸</label>
                    <input type="text" id="adminRegBusinessNumber" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì‚¬ì—…ìëª…</label>
                    <input type="text" id="adminRegBusinessName" placeholder="ì‚¬ì—…ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì£¼ì†Œ</label>
                    <input type="text" id="adminRegBusinessAddress" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="adminRegBusinessTel" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 10px; color: #2d3436; font-weight: 600; font-size: 14px;">ì´ë©”ì¼</label>
                    <input type="email" id="adminRegBusinessEmail" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 14px 18px; border: 2px solid #ffeaa7; border-radius: 12px; font-size: 14px; background: #ffffff; color: #2d3436; transition: all 0.3s ease;">
                  </div>
                </div>
              </div>

              <div style="margin-top: 24px; display: flex; gap: 12px;">
                <button type="button" id="adminRegisterBtn" onclick="registerCompany()" style="padding: 14px 32px; background: linear-gradient(135deg, #ff6b35 0%, #feca57 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 107, 53, 0.25);">ë“±ë¡í•˜ê¸°</button>
                <button type="button" onclick="toggleAddCompanyForm()" style="padding: 14px 32px; background: linear-gradient(135deg, #b2bec3 0%, #95a5a6 100%); color: white; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(178, 190, 195, 0.25);">ì·¨ì†Œ</button>
              </div>
              <div id="adminRegisterStatus" class="admin-status" style="margin-top: 15px;"></div>
            </form>
          </div>
        </div>
        
        <!-- ê´€ë¦¬ì ëª©ë¡ ë°•ìŠ¤ (ì ‘ì´ì‹) -->
        <div style="margin-bottom: 30px;">
          <button id="toggleAdminListBtn" class="refresh-btn" onclick="toggleAdminList()" style="background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%); width: 100%; text-align: left; padding: 16px 24px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: space-between; border-radius: 14px; border: 2px solid #e74c3c; color: #e74c3c; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(231, 76, 60, 0.1);">
            <div>
              <span style="margin-right: 15px;">ğŸ‘‘ ê´€ë¦¬ì ëª©ë¡</span>
              <span id="adminStatistics" style="color: #666; font-size: 14px; font-weight: normal;">(0ëª…)</span>
            </div>
            <span id="adminListIcon" style="font-size: 14px; transition: transform 0.3s ease;">â–¶</span>
          </button>
          
          <div id="adminListContent" style="display: none; background: #ffffff; padding: 24px; border-radius: 0 0 14px 14px; border: 2px solid #e74c3c; border-top: none; margin-top: -2px; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.1);">
            <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
              <button class="refresh-btn" onclick="refreshCompaniesData()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <div class="table-scroll-wrapper">
              <table style="min-width: 1200px;">
              <thead>
                <tr style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">
                  <th>í™”ì£¼ì‚¬ëª…</th>
                  <th>ì•„ì´ë””</th>
                  <th>ê¶Œí•œ</th>
                  <th>íƒœê·¸</th>
                  <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                  <th>ì‚¬ì—…ìëª…</th>
                  <th>ì£¼ì†Œ</th>
                  <th>ì „í™”ë²ˆí˜¸</th>
                  <th>ì´ë©”ì¼</th>
                  <th>ì‚¬ì—…ì ë“±ë¡ì¦</th>
                  <th>ìµœê·¼ ë¡œê·¸ì¸</th>
                  <th>ë“±ë¡ì¼</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="adminTableBody">
                <tr>
                  <td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
                </tr>
              </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- í™”ì£¼ì‚¬ ëª©ë¡ ë°•ìŠ¤ -->
        <div class="table-container" style="background: #ffffff; padding: 24px; border-radius: 14px; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.1); border: 2px solid #3498db;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0; color: #3498db; font-size: 18px; font-weight: 700; display: inline-block; margin-right: 15px;">ğŸ¢ í™”ì£¼ì‚¬ ëª©ë¡</h3>
              <span id="consignorStatistics" style="color: #666; font-size: 14px;">(0ëª…)</span>
            </div>
            <button class="refresh-btn" onclick="refreshCompaniesData()" style="padding: 8px 15px; font-size: 14px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="table-scroll-wrapper">
            <table style="min-width: 1200px;">
            <thead>
              <tr style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white;">
                <th>í™”ì£¼ì‚¬ëª…</th>
                <th>ì•„ì´ë””</th>
                <th>ê¶Œí•œ</th>
                <th>íƒœê·¸</th>
                <th>ì‚¬ì—…ìë²ˆí˜¸</th>
                <th>ì‚¬ì—…ìëª…</th>
                <th>ì£¼ì†Œ</th>
                <th>ì „í™”ë²ˆí˜¸</th>
                <th>ì´ë©”ì¼</th>
                <th>ì‚¬ì—…ì ë“±ë¡ì¦</th>
                <th>ìµœê·¼ ë¡œê·¸ì¸</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody id="consignorTableBody">
              <tr>
                <td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
              </tr>
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ë©”ì‹œì§€ -->
  <div id="message" class="message"></div>
  
  <script>
    // API ê¸°ë³¸ URL (ì„œë²„ ì£¼ì†Œ)
    const API_BASE_URL = window.location.origin; // í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš©
    
    // ì „ì—­ ë³€ìˆ˜
    let currentCompany = '';
    let currentUsername = '';
    let currentRole = '';
    let currentData = [];
    let currentFilter = 'all'; // 'all', 'completed', 'pending'
    let currentCsData = [];
    let allCsDataForStats = []; // í™”ì£¼ì‚¬ë³„ í†µê³„ìš© ì „ì²´ ë°ì´í„°
    let currentCsFilter = 'all'; // 'all', 'completed', 'pending'
    let currentCsTypeFilter = null; // 'ëˆ„ë½', 'ì˜¤ë°°ì†¡', 'êµí™˜', 'ë°˜í’ˆ', 'ì·¨ì†Œ', 'ê¸°íƒ€' ë˜ëŠ” null
    
    // ë¡œê·¸ì¸ ë©”ì‹œì§€ í‘œì‹œ
    function showLoginMessage(text, type) {
      const div = document.getElementById('loginMessage');
      if (!div) return;
      
      let bgColor = '#d1ecf1';
      let textColor = '#0c5460';
      
      if (type === 'success') {
        bgColor = '#d4edda';
        textColor = '#155724';
      } else if (type === 'error') {
        bgColor = '#f8d7da';
        textColor = '#721c24';
      }
      
      div.innerHTML = `<div style="padding: 10px 15px; border-radius: 8px; background: ${bgColor}; color: ${textColor}; font-weight: 600;">${text}</div>`;
      
      if (type !== 'loading') {
        setTimeout(() => { div.innerHTML = ''; }, 5000);
      }
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
    // ë™ì˜ìƒ ë§í¬ë¥¼ iframeìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function convertVideoLinks(html) {
      if (!html) return '';
      
      console.log('ğŸ” ë™ì˜ìƒ ë§í¬ ë³€í™˜ ì‹œì‘ - ì›ë³¸ HTML:', html.substring(0, 200));
      
      // ì´ë¯¸ iframeì´ ìˆìœ¼ë©´ src í™•ì¸ ë° ìˆ˜ì •
      if (html.includes('<iframe')) {
        console.log('ğŸ” iframe íƒœê·¸ ë°œê²¬');
        // iframeì˜ src ì†ì„± í™•ì¸ ë° ìˆ˜ì •
        html = html.replace(/<iframe([^>]*?)>/gi, (match, attrs) => {
          console.log('ğŸ” iframe ì†ì„±:', attrs);
          // srcê°€ ì—†ê±°ë‚˜ ì˜ëª»ëœ ê²½ìš° ì²˜ë¦¬
          if (!attrs.includes('src=') || attrs.includes('src=""') || attrs.includes("src=''")) {
            // HTMLì—ì„œ YouTube ë§í¬ ì°¾ê¸°
            const youtubeMatch = html.match(/https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]+)/);
            if (youtubeMatch) {
              console.log('ğŸ” YouTube ë§í¬ ë°œê²¬:', youtubeMatch[1]);
              return `<iframe src="https://www.youtube.com/embed/${youtubeMatch[1]}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width: 100%; max-width: 100%; height: 400px; border: none;">`;
            }
          }
          // srcê°€ ìˆì§€ë§Œ YouTube embed í˜•ì‹ì´ ì•„ë‹Œ ê²½ìš° ë³€í™˜
          const srcMatch = attrs.match(/src=["']([^"']+)["']/);
          if (srcMatch) {
            const src = srcMatch[1];
            const youtubeMatch = src.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]+)/);
            if (youtubeMatch && !src.includes('youtube.com/embed')) {
              console.log('ğŸ” YouTube ë§í¬ë¥¼ embed í˜•ì‹ìœ¼ë¡œ ë³€í™˜:', youtubeMatch[1]);
              return `<iframe src="https://www.youtube.com/embed/${youtubeMatch[1]}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width: 100%; max-width: 100%; height: 400px; border: none;">`;
            }
          }
          return match;
        });
        console.log('ğŸ” iframe ì²˜ë¦¬ í›„ HTML:', html.substring(0, 200));
        return html;
      }
      
      // YouTube ë§í¬ ë³€í™˜ (ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›)
      // https://www.youtube.com/watch?v=VIDEO_ID
      // https://youtu.be/VIDEO_ID
      // https://www.youtube.com/embed/VIDEO_ID
      const youtubeRegex = /https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]+)/g;
      if (youtubeRegex.test(html)) {
        console.log('ğŸ” YouTube ë§í¬ íŒ¨í„´ ë°œê²¬');
        html = html.replace(youtubeRegex, (match, videoId) => {
          console.log('ğŸ” YouTube ë§í¬ ë³€í™˜:', videoId);
          return `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin: 20px 0; border-radius: 8px; overflow: hidden;">
          <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" 
                  src="https://www.youtube.com/embed/${videoId}" 
                  frameborder="0" 
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen>
          </iframe>
        </div>`;
        });
      }
      
      // Vimeo ë§í¬ ë³€í™˜
      // https://vimeo.com/VIDEO_ID
      // https://player.vimeo.com/video/VIDEO_ID
      html = html.replace(/https?:\/\/(?:www\.)?(?:vimeo\.com\/(?:video\/)?|player\.vimeo\.com\/video\/)(\d+)/g, (match, videoId) => {
        return `<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; margin: 20px 0; border-radius: 8px; overflow: hidden;">
          <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" 
                  src="https://player.vimeo.com/video/${videoId}" 
                  frameborder="0" 
                  allow="autoplay; fullscreen; picture-in-picture" 
                  allowfullscreen>
          </iframe>
        </div>`;
      });
      
      // ì¼ë°˜ ë™ì˜ìƒ ë§í¬ê°€ iframeì´ ì•„ë‹Œ ê²½ìš° ë³€í™˜ ì‹œë„
      if (!html.includes('<video')) {
        // ì¼ë°˜ ë™ì˜ìƒ URL íŒ¨í„´ (mp4, webm ë“±)
        html = html.replace(/(https?:\/\/[^\s<>"]+\.(?:mp4|webm|ogg|mov|avi|wmv|flv|mkv))/gi, (match, url) => {
          return `<video controls style="max-width: 100%; height: auto; margin: 20px 0; border-radius: 8px;">
            <source src="${url}" type="video/${url.split('.').pop().toLowerCase()}">
            ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </video>`;
        });
      }
      
      return html;
    }
    window.convertVideoLinks = convertVideoLinks;
    
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = 'message ' + type;
      messageDiv.style.display = 'block';
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }
    
    // ë¡œê·¸ì¸ í•¨ìˆ˜
    window.doLogin = function doLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');
      
      if (!username || !password) {
        showLoginMessage('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return false;
      }
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = 'ë¡œê·¸ì¸ ì¤‘...';
      showLoginMessage('ë¡œê·¸ì¸ ì¤‘ì…ë‹ˆë‹¤...', 'loading');
      
      // ì„œë²„ API í˜¸ì¶œ
      fetch(`${API_BASE_URL}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      })
      .then(response => response.json())
      .then(result => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        
        if (result.success) {
          currentCompany = result.company;
          currentUsername = result.username;
          currentRole = (result.role || '').toString().trim();
          
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - result:', result); // ë””ë²„ê¹…ìš©
          console.log('ë¡œê·¸ì¸ ì„±ê³µ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole, 'ê¸¸ì´:', currentRole.length); // ë””ë²„ê¹…ìš©
          console.log('ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          
          localStorage.setItem('client_company', result.company);
          localStorage.setItem('client_username', result.username);
          localStorage.setItem('client_role', currentRole);
          localStorage.setItem('client_loginTime', new Date().toISOString());
          
          showLoginMessage('âœ… ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
          setTimeout(() => {
            showDashboard();
            // ë¡œê·¸ì¸ í›„ í™œì„± íŒì—… í™•ì¸
            checkAndShowPopup();
            // í—¤ë” ë°°ë„ˆ ë¡œë“œ
            if (typeof hbLoadHeaderBanner === 'function') {
              hbLoadHeaderBanner();
            }
          }, 500);
        } else {
          showLoginMessage('âŒ ' + (result.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'ë¡œê·¸ì¸';
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        showLoginMessage('âŒ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
      
      return false;
    }
    
    // ë¡œê·¸ì•„ì›ƒ
    function logout() {
      localStorage.removeItem('client_company');
      localStorage.removeItem('client_username');
      localStorage.removeItem('client_role');
      localStorage.removeItem('client_loginTime');
      
      currentCompany = '';
      currentUsername = '';
      currentRole = '';
      
      document.getElementById('dashboardSection').style.display = 'none';
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginMessage').innerHTML = '';
    }
    
    // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
    function showDashboard() {
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('dashboardSection').style.display = 'block';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('showDashboard - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const roleText = isAdmin ? ' [ê´€ë¦¬ì]' : '';
      document.getElementById('companyInfo').textContent = `${currentCompany}${roleText} (${currentUsername})`;
      
      // ë©”ë‰´ë°” í‘œì‹œ/ìˆ¨ê¹€ (í™”ì£¼ì‚¬ ëª¨ë“œë§Œ í‘œì‹œ)
      const menuBar = document.getElementById('menuBar');
      if (menuBar) {
        menuBar.style.display = isAdmin ? 'none' : 'flex';
        // í™”ì£¼ì‚¬ ëª¨ë“œì¼ ë•Œ ì €ì¥ëœ ë©”ë‰´ ë³µì› ë˜ëŠ” ê¸°ë³¸ê°’
        if (!isAdmin) {
          // í™”ì£¼ì‚¬ ì •ë³´ í™•ì¸ í›„ ë©”ë‰´ ê²°ì •
          checkCompanyInfoAndNavigate();
        }
      }
      
      
      // ë‹¬ë ¥ ì›” ì„ íƒ ì´ˆê¸°í™” (ê´€ë¦¬ì ëª¨ë“œ)
      const calendarMonthSelect = document.getElementById('calendarMonthSelect');
      if (calendarMonthSelect) {
        const today = new Date();
        calendarMonthSelect.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      }
      
      // ë‹¬ë ¥ ì›” ì„ íƒ ì´ˆê¸°í™” (í™”ì£¼ì‚¬ ëª¨ë“œ)
      const consignorCalendarMonthSelect = document.getElementById('consignorCalendarMonthSelect');
      if (consignorCalendarMonthSelect) {
        const today = new Date();
        consignorCalendarMonthSelect.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      }
      
      // ê´€ë¦¬ì íƒ­ í‘œì‹œ/ìˆ¨ê¸°ê¸°
      const adminTabs = document.getElementById('adminTabs');
      if (adminTabs) {
        adminTabs.style.display = isAdmin ? 'block' : 'none';
      }
      
      // í™”ì£¼ì‚¬ ë“±ë¡ íƒ­ ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©)
      const registerTabBtn = document.getElementById('registerTabBtn');
      if (registerTabBtn) {
        registerTabBtn.style.display = isAdmin ? 'inline-block' : 'none';
      }
      
      // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë°˜í’ˆ ë‚´ì—­ íƒ­ë§Œ í‘œì‹œ (switchMenuì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°)
      if (!isAdmin) {
        // switchMenu í•¨ìˆ˜ê°€ ëª¨ë“  íƒ­ì„ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬í•¨
      } else {
        // ê´€ë¦¬ìë©´ ì €ì¥ëœ íƒ­ ì •ë³´ í™•ì¸ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ í˜„ì¬ íƒ­ ìœ ì§€)
        const savedTab = localStorage.getItem('activeAdminTab');
        const validTabs = ['returns', 'cs', 'scheduleCalendar', 'board', 'popup', 'specialWorks', 'pallets', 'register'];
        const activeTab = savedTab && validTabs.includes(savedTab) ? savedTab : 'returns';
        console.log('ì €ì¥ëœ íƒ­:', savedTab, 'í™œì„±í™”í•  íƒ­:', activeTab);
        // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  íƒ­ ì „í™˜ (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
        setTimeout(() => {
          switchAdminTab(activeTab);
        }, 100);
      }
      
          // ê´€ë¦¬ì ì ‘ì´ì‹ ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¸°ê¸° (í™”ì£¼ì‚¬ëŠ” ë°˜í’ˆ ë“±ë¡ ë¶ˆê°€)
          const addReturnSection = document.getElementById('addReturnSection');
          if (addReturnSection) {
            if (isAdmin) {
              addReturnSection.style.display = 'block';
            } else {
              addReturnSection.style.display = 'none';
              // í¼ë„ ê°•ì œë¡œ ìˆ¨ê¸°ê¸°
              const addReturnForm = document.getElementById('addReturnForm');
              if (addReturnForm) {
                addReturnForm.style.display = 'none';
              }
              const addReturnBtn = document.getElementById('addReturnBtn');
              if (addReturnBtn) {
                addReturnBtn.style.display = 'none';
              }
            }
            console.log('ë°˜í’ˆ ë“±ë¡ ì„¹ì…˜ í‘œì‹œ:', isAdmin, 'ì„¹ì…˜ ìš”ì†Œ:', addReturnSection); // ë””ë²„ê¹…ìš©
          }
          
          // C/S ë“±ë¡ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¸°ê¸° (í™”ì£¼ì‚¬ ë° ê´€ë¦¬ì ëª¨ë‘ í‘œì‹œ)
          const csRegisterSection = document.getElementById('csRegisterSection');
          if (csRegisterSection) {
            csRegisterSection.style.display = 'block';
            console.log('C/S ë“±ë¡ ì„¹ì…˜ í‘œì‹œ: true, ì„¹ì…˜ ìš”ì†Œ:', csRegisterSection); // ë””ë²„ê¹…ìš©
          }
          
          // ê´€ë¦¬ì ì „ìš© ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ (ì„œì‹ ë‹¤ìš´ë¡œë“œ, CSV ì—…ë¡œë“œ)
          const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
          const csvUploadLabel = document.querySelector('label[for="csvUploadInput"]');
          if (downloadTemplateBtn) {
            downloadTemplateBtn.style.display = isAdmin ? 'inline-block' : 'none';
          }
          if (csvUploadLabel) {
            csvUploadLabel.style.display = isAdmin ? 'inline-block' : 'none';
          }
          const testTelegramBtn = document.getElementById('testTelegramBtn');
          if (testTelegramBtn) {
            testTelegramBtn.style.display = isAdmin ? 'inline-flex' : 'none';
          }
          
          const addReturnForm = document.getElementById('addReturnForm');
          if (addReturnForm && !isAdmin) {
            addReturnForm.style.display = 'none';
          }
      
      // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° (ì´ˆê¸°í™” - í…Œì´ë¸” í—¤ë”)
      updateAdminColumns();
      
      // í—¤ë” hover íš¨ê³¼ ì°¨ë‹¨ (í…Œì´ë¸”ì´ ìˆì„ ë•Œ)
      setTimeout(() => {
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 500);
      
      // ì›” ëª©ë¡ ë¡œë“œ
      loadAvailableMonths();
      
      // í™”ì£¼ì‚¬ ëª¨ë“œì¼ ë•Œ ì‚¬ì—…ì ì •ë³´ í™•ì¸ ë° ë°°ë„ˆ í‘œì‹œ
      if (!isAdmin) {
        setTimeout(() => {
          checkAndShowBusinessInfoBanner();
        }, 500);
      }
      
      // í—¤ë” ë°°ë„ˆ ë¡œë“œ
      setTimeout(() => {
        if (typeof hbLoadHeaderBanner === 'function') {
          hbLoadHeaderBanner();
        }
      }, 300);
    }
    
    // ì‚¬ì—…ì ì •ë³´ í™•ì¸ ë° ë°°ë„ˆ í‘œì‹œ
    async function checkAndShowBusinessInfoBanner() {
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          updateBusinessInfoBanner(result.data);
        }
      } catch (error) {
        console.error('ì‚¬ì—…ì ì •ë³´ í™•ì¸ ì˜¤ë¥˜:', error);
      }
    }
    window.checkAndShowBusinessInfoBanner = checkAndShowBusinessInfoBanner;
    
    // ì‚¬ìš© ê°€ëŠ¥í•œ ì›” ëª©ë¡ ë¡œë“œ
    function loadAvailableMonths() {
      fetch(`${API_BASE_URL}/api/auth/months`)
        .then(response => response.json())
        .then(result => {
          const monthSelect = document.getElementById('monthSelect');
          monthSelect.innerHTML = '';
          
          if (result.success && result.months && result.months.length > 0) {
            // ë…„ë„ë³„ë¡œ ê·¸ë£¹í™”
            const monthsByYear = {};
            result.months.forEach(monthStr => {
              try {
                const year = monthStr.split('ë…„')[0];
                if (!monthsByYear[year]) {
                  monthsByYear[year] = [];
                }
                monthsByYear[year].push(monthStr);
              } catch (e) {
                // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê·¸ëƒ¥ ì¶”ê°€
                if (!monthsByYear['ê¸°íƒ€']) {
                  monthsByYear['ê¸°íƒ€'] = [];
                }
                monthsByYear['ê¸°íƒ€'].push(monthStr);
              }
            });
            
            // ë…„ë„ë³„ë¡œ ì •ë ¬ (ìµœì‹  ë…„ë„ê°€ ë¨¼ì €)
            const years = Object.keys(monthsByYear).sort((a, b) => {
              if (a === 'ê¸°íƒ€') return 1;
              if (b === 'ê¸°íƒ€') return -1;
              return parseInt(b) - parseInt(a);
            });
            
            // ì˜µì…˜ ê·¸ë£¹ìœ¼ë¡œ ë…„ë„ë³„ í‘œì‹œ
            years.forEach(year => {
              const optgroup = document.createElement('optgroup');
              optgroup.label = `${year}ë…„`;
              monthsByYear[year].forEach(monthStr => {
                const option = document.createElement('option');
                option.value = monthStr;
                option.textContent = monthStr;
                optgroup.appendChild(option);
              });
              monthSelect.appendChild(optgroup);
            });
            
            // í˜„ì¬ ì›” ì„ íƒ (ê¸°ë³¸ê°’)
            const currentMonth = result.current_month || '';
            if (currentMonth) {
              monthSelect.value = currentMonth;
            } else if (result.months.length > 0) {
              monthSelect.value = result.months[0];
            }
            
            // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë°ì´í„° ë¡œë“œ
            const returnsTab = document.getElementById('returnsTab');
            if (returnsTab && !returnsTab.classList.contains('hidden') && returnsTab.style.display !== 'none') {
              loadData();
            }
          } else {
            // í˜„ì¬ ì›” ì¶”ê°€ (ë°ì´í„°ê°€ ì—†ì„ ë•Œ)
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
            const option = document.createElement('option');
            option.value = currentMonth;
            option.textContent = currentMonth;
            monthSelect.appendChild(option);
            monthSelect.value = currentMonth;
          }
        })
        .catch(error => {
          console.error('ì›” ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          // ì˜¤ë¥˜ ë°œìƒ ì‹œ í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì •
          const monthSelect = document.getElementById('monthSelect');
          const today = new Date();
          const currentMonth = `${today.getFullYear()}ë…„${today.getMonth() + 1}ì›”`;
          monthSelect.innerHTML = `<option value="${currentMonth}">${currentMonth}</option>`;
          monthSelect.value = currentMonth;
          showMessage('âš ï¸ ì›” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ í˜„ì¬ ì›”ë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.', 'error');
        });
      
      // ì›” ë³€ê²½ ì´ë²¤íŠ¸
      const monthSelect = document.getElementById('monthSelect');
      if (monthSelect) {
        monthSelect.onchange = function() {
          // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë¡œë“œ
          refreshReturnsData();
        };
      }
    }
    
    /* ========== ë°˜í’ˆ ë‚´ì—­ ì „ë‹¬ ì¡°íšŒ ========== */
    function loadPreviousMonthReturns() {
      try {
        const monthSelect = document.getElementById('monthSelect');
        if (!monthSelect) {
          console.error('monthSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const today = new Date();
        let prevYear = today.getFullYear();
        let prevMonth = today.getMonth(); // 0-11 (í˜„ì¬ ì›” - 1)
        
        if (prevMonth === 0) {
          // 1ì›”ì´ë©´ ì „ë…„ë„ 12ì›”
          prevYear -= 1;
          prevMonth = 12;
        }
        
        const previousMonthStr = `${prevYear}ë…„${String(prevMonth).padStart(2, '0')}ì›”`;
        
        // ì „ë‹¬ ì›”ì´ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸ (optgroup ë‚´ë¶€ ì˜µì…˜ë„ í¬í•¨)
        let foundOption = null;
        for (let i = 0; i < monthSelect.options.length; i++) {
          const opt = monthSelect.options[i];
          if (opt.value === previousMonthStr) {
            foundOption = opt;
            break;
          }
        }
        
        if (foundOption) {
          monthSelect.value = previousMonthStr;
          // ì›” ë³€ê²½ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
          if (monthSelect.onchange) {
            monthSelect.onchange();
          } else {
            refreshReturnsData();
          }
        } else {
          // ì „ë‹¬ ì›”ì´ ëª©ë¡ì— ì—†ìœ¼ë©´ ì•Œë¦¼
          alert(`ì „ë‹¬(${previousMonthStr}) ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
        }
      } catch (error) {
        console.error('ì „ë‹¬ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ì „ë‹¬ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.loadPreviousMonthReturns = loadPreviousMonthReturns;
    
    /* ========== ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨ ========== */
    function refreshReturnsData() {
      console.log('ë°˜í’ˆ ë‚´ì—­ ìƒˆë¡œê³ ì¹¨');
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && !returnsTab.classList.contains('hidden') && returnsTab.style.display !== 'none') {
        loadData();
      } else {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
      }
    }
    window.refreshReturnsData = refreshReturnsData;
    /* ========== CSV íŒŒì¼ ì—…ë¡œë“œ ========== */
    function handleCsvUpload(event) {
      const file = event.target.files[0];
      if (!file) {
        return;
      }
      
      if (!file.name.endsWith('.csv')) {
        showMessage('âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
        event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
        return;
      }
      
      // íŒŒì¼ëª…ì—ì„œ ì›” ì¶”ì¶œ ì‹œë„
      let month = '';
      const filenameWithoutExt = file.name.replace('.csv', '').trim();
      if (filenameWithoutExt.includes('ë…„') && filenameWithoutExt.includes('ì›”')) {
        month = filenameWithoutExt;
      } else {
        // í˜„ì¬ ì„ íƒëœ ì›” ì‚¬ìš©
        const monthSelect = document.getElementById('monthSelect');
        if (monthSelect && monthSelect.value) {
          month = monthSelect.value;
        }
      }
      
      // ì›”ì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ì…ë ¥ ìš”ì²­
      if (!month) {
        const userMonth = prompt('ì›” ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 2025ë…„11ì›”)');
        if (!userMonth) {
          event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
          return;
        }
        month = userMonth;
      }
      
      // FormData ìƒì„±
      const formData = new FormData();
      formData.append('file', file);
      formData.append('month', month);
      formData.append('force', 'false');
      
      // ì—…ë¡œë“œ ì‹œì‘ ë©”ì‹œì§€
      showMessage('ğŸ“¤ CSV íŒŒì¼ ì—…ë¡œë“œ ì¤‘...', 'info');
      
      // API í˜¸ì¶œ
      fetch('/api/returns/upload-csv', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage(`âœ… ${data.message}`, 'success');
          // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
          event.target.value = '';
          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
          setTimeout(() => {
            refreshReturnsData();
          }, 500);
        } else {
          showMessage(`âŒ ${data.message}`, 'error');
          event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
        }
      })
      .catch(error => {
        console.error('CSV ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        showMessage(`âŒ CSV ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
        event.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
      });
    }
    
    window.handleCsvUpload = handleCsvUpload;
    
    /* ========== CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ========== */
    function downloadCsvTemplate() {
      console.log('CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì‹œì‘');
      // ì„œë²„ì—ì„œ UTF-8 BOM ì¸ì½”ë”©ìœ¼ë¡œ CSV ìƒì„±í•˜ì—¬ ë‹¤ìš´ë¡œë“œ
      fetch('/api/returns/download-template')
        .then(response => {
          console.log('ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
          if (!response.ok) {
            return response.text().then(text => {
              console.error('ì„œë²„ ì˜¤ë¥˜ ì‘ë‹µ:', text);
              throw new Error(`ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ${response.status} ${response.statusText}`);
            });
          }
          return response.blob();
        })
        .then(blob => {
          console.log('Blob ìƒì„± ì™„ë£Œ, í¬ê¸°:', blob.size, 'íƒ€ì…:', blob.type);
          if (blob.size === 0) {
            throw new Error('ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
          }
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = 'ë°˜í’ˆë‚´ì—­_ì„œì‹.csv';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);
          showMessage('âœ… CSV ì„œì‹ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤. (Excelì—ì„œ í•œê¸€ ì •ìƒ í‘œì‹œ)', 'success');
        })
        .catch(error => {
          console.error('CSV í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage(`âŒ CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
        });
    }
    
    window.downloadCsvTemplate = downloadCsvTemplate;
    
    /* ========== ì„œì‹ ë‹¤ìš´ë¡œë“œ íˆ´íŒ ========== */
    window.showDownloadTooltip = function showDownloadTooltip(event) {
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      hideDownloadTooltip();
      
      const tooltip = document.createElement('div');
      tooltip.id = 'downloadTooltip';
      tooltip.className = 'download-tooltip';
      tooltip.innerHTML = `
        <strong>ğŸ“¥ CSV ì„œì‹ ë‹¤ìš´ë¡œë“œ ì‚¬ìš© ë°©ë²•</strong>
        <ul>
          <li>1. ë²„íŠ¼ í´ë¦­í•˜ì—¬ ì„œì‹ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</li>
          <li>2. Excelì—ì„œ íŒŒì¼ ì—´ê¸° (í•œê¸€ ì •ìƒ í‘œì‹œ)</li>
          <li>3. <strong>ì†¡ì¥ë²ˆí˜¸ ì»¬ëŸ¼ ì„ íƒ</strong> â†’ ì…€ ì„œì‹ â†’ í…ìŠ¤íŠ¸ë¡œ ë³€ê²½</li>
          <li>4. ì˜ˆì‹œ ë°ì´í„° ì°¸ê³ í•˜ì—¬ ë°˜í’ˆ ë‚´ì—­ ì…ë ¥</li>
          <li>5. íŒŒì¼ëª…ì— ì›” ì •ë³´ í¬í•¨ (ì˜ˆ: 2025ë…„11ì›”.csv)</li>
          <li>6. CSV ì—…ë¡œë“œ ë²„íŠ¼ìœ¼ë¡œ íŒŒì¼ ì—…ë¡œë“œ</li>
        </ul>
        <div style="margin-top: 8px; font-size: 12px; color: #b2bec3;">
          ğŸ’¡ í•„ìˆ˜ ì»¬ëŸ¼: ê³ ê°ëª…, ì†¡ì¥ë²ˆí˜¸<br>
          ğŸ’¡ ì†¡ì¥ë²ˆí˜¸ ì»¬ëŸ¼ì„ í…ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ê³¼í•™ì  í‘œê¸°ë²• ë°©ì§€
        </div>
      `;
      document.body.appendChild(tooltip);
      
      // íˆ´íŒ ìœ„ì¹˜ ì„¤ì • (ë§ˆìš°ìŠ¤ ë°”ë¡œ ì•„ë˜)
      updateDownloadTooltipPosition(event, tooltip);
    };
    
    function updateDownloadTooltipPosition(event, tooltip) {
      if (!tooltip) return;
      
      const x = event.clientX;
      const y = event.clientY + 15; // ë§ˆìš°ìŠ¤ ë°”ë¡œ ì•„ë˜
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 0) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 0) {
          tooltip.style.top = '15px';
        }
      }, 0);
    }
    
    window.hideDownloadTooltip = function hideDownloadTooltip() {
      const tooltip = document.getElementById('downloadTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    };
    
    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    document.addEventListener('mousemove', function(event) {
      const tooltip = document.getElementById('downloadTooltip');
      if (tooltip) {
        updateDownloadTooltipPosition(event, tooltip);
      }
    });
    
    // ë°ì´í„° ë¡œë“œ
    function loadData() {
      // ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const returnsTab = document.getElementById('returnsTab');
      if (returnsTab && (returnsTab.classList.contains('hidden') || returnsTab.style.display === 'none')) {
        console.log('ë°˜í’ˆ ë‚´ì—­ íƒ­ì´ í™œì„±í™”ë˜ì§€ ì•Šì•„ ë°ì´í„° ë¡œë“œë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!selectedMonth) {
        return;
      }
      
      showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'success');
      
      // í™”ì£¼ì‚¬ì¸ ê²½ìš° ìì‹ ì˜ company_nameìœ¼ë¡œ í•„í„°ë§
      // ê´€ë¦¬ìì¸ ê²½ìš° ë¹ˆ ë¬¸ìì—´ë¡œ ëª¨ë“  ë°ì´í„° ì¡°íšŒ
      const companyFilter = (currentRole === 'ê´€ë¦¬ì') ? '' : currentCompany;
      
      console.log('ë°ì´í„° ë¡œë“œ - company:', companyFilter, 'month:', selectedMonth, 'role:', currentRole);
      
      // username íŒŒë¼ë¯¸í„° ì¶”ê°€ (í™”ì£¼ì‚¬ì¸ ê²½ìš°)
      const usernameParam = currentUsername ? `&username=${encodeURIComponent(currentUsername)}` : '';
      const url = `${API_BASE_URL}/api/returns/data?company=${encodeURIComponent(companyFilter)}&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}${usernameParam}`;
      
      console.log('API URL:', url);
      
      fetch(url)
        .then(response => response.json())
        .then(result => {
          // ì‚¬ì—…ì ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° í° íŒì—… í‘œì‹œ
          if (result.requires_business_info) {
            showBusinessInfoRequiredModal();
            const isAdmin = ((currentRole || '').toString().trim() === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ì‚¬ì—…ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</td></tr>`;
            return;
          }
          
          if (result.success) {
            currentData = result.data || [];
            // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
            updateStats(currentData);
            // í•„í„° ì ìš© (í˜„ì¬ ì„ íƒëœ í•„í„°ì— ë”°ë¼)
            applyFilter();
            showMessage(`âœ… ${result.count}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
          } else {
            showMessage('âŒ ' + (result.message || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨'), 'error');
            const isAdmin = ((currentRole || '').toString().trim() === 'ê´€ë¦¬ì');
            const colspan = isAdmin ? 13 : 9;
            document.getElementById('tableBody').innerHTML = 
              `<tr><td colspan="${colspan}" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            setTimeout(() => {
              updateAdminColumns();
              // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
              if (typeof disableHeaderHover === 'function') {
                disableHeaderHover();
              }
            }, 150);
          }
        })
        .catch(error => {
          console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // í…Œì´ë¸” ë Œë”ë§
    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      // ê´€ë¦¬ì ì—¬ë¶€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ, ê³µë°± ì œê±°)
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('renderTable - currentRole:', currentRole, 'roleNormalized:', roleNormalized, 'isAdmin:', isAdmin); // ë””ë²„ê¹…ìš©
      
      const colspan = isAdmin ? 13 : 9;
      
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${colspan}" class="no-data">ë°˜í’ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        // ë¹ˆ ë°ì´í„°ì¼ ë•Œë„ ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
        updateAdminColumns();
        return;
      }
      
      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        
        // ë°˜í’ˆ ID í™•ì¸ ë° ìƒì„±
        let returnId = row.id || row.rowIndex;
        if (!returnId || returnId === null || returnId === undefined || returnId === 'null' || returnId === 'undefined') {
          console.warn(`âš ï¸ ë°˜í’ˆ IDê°€ ì—†ìŠµë‹ˆë‹¤. row:`, row);
          // IDê°€ ì—†ìœ¼ë©´ ì„ì‹œ ID ìƒì„± (ì¸ë±ìŠ¤ ê¸°ë°˜, ë‚˜ì¤‘ì— ì‹¤ì œ IDë¡œ êµì²´ í•„ìš”)
          returnId = `temp_${Date.now()}_${index}`;
          console.warn(`   ì„ì‹œ ID ìƒì„±: ${returnId}`);
          // row ê°ì²´ì— ID ì¶”ê°€
          row.id = returnId;
          row.rowIndex = returnId;
        }
        
        // IDë¥¼ ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
        const numericId = parseInt(returnId);
        if (isNaN(numericId)) {
          console.warn(`âš ï¸ ë°˜í’ˆ IDê°€ ìˆ«ìê°€ ì•„ë‹™ë‹ˆë‹¤: ${returnId}`);
        }
        
        const isCompleted = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
        const isConfirmed = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] && row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'].toString().trim();
        const memoText = row['ë¹„ê³ '] || '';
        const memoUpdatedAt = row['ë¹„ê³ _ì‘ì„±ì‹œê°„'] || '';  // ë¹„ê³  ì‘ì„± ì‹œê°„
        
        // ì‚¬ì§„ ë§í¬ ì²˜ë¦¬
        let photoHtml = '-';
        if (row['ì‚¬ì§„']) {
          // ë°°ì—´ì¸ ê²½ìš°
          if (Array.isArray(row['ì‚¬ì§„']) && row['ì‚¬ì§„'].length > 0) {
            photoHtml = '<div class="photo-links">';
            row['ì‚¬ì§„'].forEach(photo => {
              if (photo && typeof photo === 'object') {
                // URLì´ ìˆìœ¼ë©´ ë§í¬ë¡œ í‘œì‹œ
                if (photo.url) {
                  photoHtml += `<a href="${photo.url}" target="_blank" class="photo-link">${photo.text || 'ì‚¬ì§„'}</a>`;
                } else if (photo.text) {
                  // URLì´ ì—†ìœ¼ë©´ í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ
                  photoHtml += `<span class="photo-link" style="cursor: default; text-decoration: none;">${photo.text}</span>`;
                }
              }
            });
            photoHtml += '</div>';
          }
          // ë¬¸ìì—´ì¸ ê²½ìš° (ì§ì ‘ í…ìŠ¤íŠ¸)
          else if (typeof row['ì‚¬ì§„'] === 'string' && row['ì‚¬ì§„'].trim()) {
            photoHtml = '<div class="photo-links">';
            photoHtml += `<span class="photo-link" style="cursor: default; text-decoration: none;">${row['ì‚¬ì§„']}</span>`;
            photoHtml += '</div>';
          }
        }
        
        // ìš”ì²­ì‚¬í•­ ì²˜ë¦¬
        const requestValue = row['í™”ì£¼ì‚¬ìš”ì²­'] || '';
        let requestHtml = '';
        
        if (isAdmin) {
          // ê´€ë¦¬ì: ì½ê¸° ì „ìš©
          if (requestValue) {
            requestHtml = `<textarea class="request-input" readonly>${requestValue}</textarea>`;
          } else {
            requestHtml = '<div style="color: #999; text-align: center; padding: 20px;">ìš”ì²­ì‚¬í•­ ì—†ìŒ</div>';
          }
        } else {
          // í™”ì£¼ì‚¬: ì…ë ¥ ë° ì €ì¥ ê°€ëŠ¥ (ì €ì¥ í›„ì—ë„ ìˆ˜ì • ê°€ëŠ¥)
          // ì €ì¥ëœ ë‚´ìš©ì´ ìˆìœ¼ë©´ "ìˆ˜ì •" ë²„íŠ¼, ì—†ìœ¼ë©´ "ì €ì¥" ë²„íŠ¼
          const buttonText = requestValue ? 'ìˆ˜ì •' : 'ì €ì¥';
          const buttonClass = requestValue ? 'save-btn edit-btn' : 'save-btn';
          requestHtml = `
            <textarea class="request-input" id="request_${index}" placeholder="ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”">${escapeHtml(requestValue)}</textarea>
            <button class="${buttonClass}" onclick="saveRequest(${index}, '${returnId}')">${buttonText}</button>
          `;
        }
        
        // ì²˜ë¦¬ì™„ë£Œ ìƒíƒœ (ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ)
        let statusHtml = '';
        const confirmedText = row['í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œ'] || '';
        let completedName = row['ì²˜ë¦¬ì™„ë£Œ'] || '';
        
        // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ì—ì„œ ì´ë¦„ë§Œ ì¶”ì¶œ
        if (completedName) {
          // "ì™„ë£Œ (ì´ë¦„)" í˜•ì‹ ì²˜ë¦¬
          if (completedName.includes('(') && completedName.includes(')')) {
            const match = completedName.match(/\(([^)]+)\)/);
            if (match && match[1]) {
              completedName = match[1].trim();
            }
          }
          // "ì™„ë£Œ ì´ë¦„" í˜•ì‹ ì²˜ë¦¬ (ê³µë°±ìœ¼ë¡œ ë¶„ë¦¬)
          else if (completedName.includes('ì™„ë£Œ')) {
            completedName = completedName.replace(/ì™„ë£Œ\s*/g, '').trim();
          }
        }
        
        if (isCompleted && completedName) {
          // ì²˜ë¦¬ì™„ë£Œì¼ ë•Œ ì´ˆë¡ìƒ‰ ë™ê·¸ë¼ë¯¸ì— ì²´í¬ì™€ ì´ë¦„ë§Œ í‘œì‹œ
          statusHtml = `<span class="status-completed-circle">${escapeHtml(completedName)}</span>`;
        } else if (isConfirmed || confirmedText) {
          // í™”ì£¼ì‚¬í™•ì¸ì™„ë£Œê°€ ìˆìœ¼ë©´ ê´€ë¦¬ì ì´ë¦„ í‘œì‹œ
          statusHtml = `<span class="status-badge" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; border-radius: 12px; padding: 3px 8px; font-size: 10px;">â³ ${escapeHtml(confirmedText) || 'ìš”ì²­ì™„ë£Œ'}</span>`;
        } else {
          statusHtml = '<span class="status-badge status-pending">â³ ëŒ€ê¸°ì¤‘</span>';
        }
        
        // ê´€ë¦¬ì ì „ìš© ì…€ (í•­ìƒ ìƒì„±, updateAdminColumnsì—ì„œ í‘œì‹œ/ìˆ¨ê¹€ ì œì–´)
        // ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        const companyNameRaw = row['í™”ì£¼ëª…'] || ''; // ì›ë³¸ ê°’ (ì´ìŠ¤ì¼€ì´í”„ ì „)
        const companyNameValue = escapeHtml(companyNameRaw); // í™”ë©´ í‘œì‹œìš© (ì´ìŠ¤ì¼€ì´í”„ í›„)
        const companyNameForAttr = companyNameRaw.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        const companyNameForJs = companyNameRaw.replace(/'/g, "\\'").replace(/"/g, '\\"');
        const companyCell = isAdmin ? 
          `<td class="admin-only editable-cell" data-field="company_name" data-id="${returnId}" data-original="${companyNameForAttr}" onclick="if(event.target.tagName !== 'INPUT') startEditCell(this, '${companyNameForJs}')" style="cursor: pointer; padding: 4px;">
            <span class="cell-content">${companyNameValue || '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ìˆ˜ì •</span>'}</span>
            <input type="text" class="cell-input" value="${companyNameRaw.replace(/"/g, '&quot;')}" style="display: none; width: 100%; padding: 4px; border: 2px solid #ff6b35; border-radius: 4px;" onblur="finishEditCell(this)" onkeydown="if(event.key === 'Enter') { event.target.blur(); }">
          </td>` :
          `<td class="admin-only">${companyNameValue}</td>`;
        
        const memoTextSafe = escapeHtml(memoText || '').replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/\n/g, '\\n');
        const memoUpdatedAtSafe = escapeHtml(memoUpdatedAt || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
        const memoCell = `
          <td class="admin-only" style="text-align: center; min-width: 80px;">
            <button class="save-btn" onclick="editMemo(${index}, '${returnId}', '${memoTextSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">
              ${memoText ? 'ğŸ“ ë¹„ê³ ' : 'ğŸ“ ì¶”ê°€'}
            </button>
          </td>
        `;
        const trackingNumber = row['ì†¡ì¥ë²ˆí˜¸'] ? row['ì†¡ì¥ë²ˆí˜¸'].toString().trim() : '';
        const trackingNumberSafe = escapeHtml(trackingNumber).replace(/'/g, "\\'").replace(/"/g, '&quot;');
        
        // ì™¸ë¶€ íƒë°° ì°©ë¶ˆ ì •ë³´ í™•ì¸
        const otherCourier = row['ë‹¤ë¥¸ì™¸ë¶€íƒë°°ì‚¬'] || '';
        const shippingFee = row['ë°°ì†¡ë¹„'] || '';
        const hasCourierInfo = otherCourier && otherCourier.trim() !== '';
        const hasShippingInfo = shippingFee && shippingFee.trim() !== '' && shippingFee.trim() !== 'ì—†ìŒ';
        
        // ì°©ë¶ˆ ì•„ì´ì½˜ ë° íˆ´íŒ ìƒì„±
        let courierIcon = '';
        let courierTooltip = '';
        if (hasCourierInfo || hasShippingInfo) {
          let tooltipText = '';
          if (hasCourierInfo) {
            tooltipText += `íƒë°°ì‚¬: ${escapeHtml(otherCourier)}`;
          }
          if (hasShippingInfo) {
            if (tooltipText) tooltipText += '\n';
            tooltipText += `ë°°ì†¡ë¹„: ${escapeHtml(shippingFee)}`;
          }
          courierTooltip = tooltipText;
          courierIcon = `<span class="courier-icon" style="margin-left: 5px; cursor: help; font-size: 14px;" title="${escapeHtml(tooltipText)}" onmouseenter="showCourierTooltip(event, '${escapeHtml(otherCourier).replace(/'/g, "\\'")}', '${escapeHtml(shippingFee).replace(/'/g, "\\'")}')" onmouseleave="hideCourierTooltip()">ğŸšš</span>`;
        }
        
        const qrCell = `
          <td class="admin-only" style="text-align: center; min-width: 70px;">
            ${trackingNumber ? 
              `<button class="save-btn" onclick="showQRCode('${trackingNumberSafe}')" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 3px 8px; font-size: 10px; border-radius: 4px; box-shadow: none;">ğŸ“± QR</button>` :
              '<span style="color: #b2bec3; font-size: 10px;">ë¯¸ìƒì„±</span>'}
          </td>
        `;
        
        // ìƒí’ˆëª… ì…€ì— ë¹„ê³  íˆ´íŒ ì¶”ê°€ (ë¹„ê³ ê°€ ìˆì„ ë•Œë§Œ, ë¹¨ê°„ìƒ‰ ë‘ê»ê²Œ)
        const productNameRaw = row['ì œí’ˆ'] || ''; // ì›ë³¸ ê°’ (ì´ìŠ¤ì¼€ì´í”„ ì „)
        const productName = escapeHtml(productNameRaw); // í™”ë©´ í‘œì‹œìš© (ì´ìŠ¤ì¼€ì´í”„ í›„)
        const hasMemo = memoText && memoText.trim() !== '';
        const productCellClass = hasMemo ? 'product-cell has-memo' : 'product-cell';
        const productCellAttributes = hasMemo 
          ? `class="${productCellClass}" style="text-align: center; position: relative; cursor: help;" 
             data-memo="${escapeHtml(memoText || '')}" 
             data-memo-updated-at="${escapeHtml(memoUpdatedAt || '')}"
             title="${escapeHtml(memoText || '')}"
             onmouseenter="showMemoTooltip(event, '${memoTextSafe.replace(/'/g, "\\'")}', '${memoUpdatedAtSafe.replace(/'/g, "\\'")}')" 
             onmouseleave="hideMemoTooltip()"`
          : `class="${productCellClass}" style="text-align: center;"`;
        
        // ê´€ë¦¬ì ëª¨ë“œì—ì„œ ì œí’ˆ ì…€ ìˆ˜ì • ê°€ëŠ¥
        // data-original ì†ì„±ì— ì›ë³¸ ê°’ì„ ë„£ë˜, HTML íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„
        const productNameForAttr = productNameRaw.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        const productNameForJs = productNameRaw.replace(/'/g, "\\'").replace(/"/g, '\\"');
        
        // ì œí’ˆ ì…€ ìŠ¤íƒ€ì¼ ì¡°ì • (ë¹„ê³ ê°€ ìˆì„ ë•Œì™€ ì—†ì„ ë•Œ ëª¨ë‘ ì²˜ë¦¬)
        let productCellStyle = 'text-align: center; cursor: pointer; padding: 4px;';
        if (hasMemo) {
          productCellStyle = 'text-align: center; position: relative; cursor: pointer; padding: 4px;';
        }
        
        // input valueëŠ” HTML ì†ì„±ì— ë„£ì„ ë•Œ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„í•˜ë¯€ë¡œ ì›ë³¸ ê°’ ì‚¬ìš©
        // í•˜ì§€ë§Œ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì—ì„œ íŠ¹ìˆ˜ ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„í•´ì•¼ í•¨
        const productNameForInputAttr = productNameRaw.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        
        const productCell = isAdmin ?
          `<td class="${productCellClass} editable-cell" style="${productCellStyle}" data-field="product" data-id="${returnId}" data-original="${productNameForAttr}" ${hasMemo ? `data-memo="${escapeHtml(memoText || '')}" data-memo-updated-at="${escapeHtml(memoUpdatedAt || '')}" title="${escapeHtml(memoText || '')}" onmouseenter="showMemoTooltip(event, '${memoTextSafe.replace(/'/g, "\\'")}', '${memoUpdatedAtSafe.replace(/'/g, "\\'")}')" onmouseleave="hideMemoTooltip()"` : ''} onclick="if(event.target.tagName !== 'INPUT' && event.target.tagName !== 'SPAN') startEditCell(this, '${productNameForJs}')">
            <span class="cell-content">${productName || '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ìˆ˜ì •</span>'}</span>
            <input type="text" class="cell-input" value="${productNameForInputAttr}" style="display: none; width: 100%; padding: 4px; border: 2px solid #ff6b35; border-radius: 4px;" onblur="finishEditCell(this)" onkeydown="if(event.key === 'Enter') { event.preventDefault(); event.target.blur(); }">
          </td>` :
          `<td ${productCellAttributes}>
            ${productName}
          </td>`;
        
        // ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡ ì…€ (ê´€ë¦¬ì ëª¨ë“œì—ì„œ ë“œë¡­ë‹¤ìš´)
        const returnTypeValue = row['ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡'] || '';
        const returnTypeCell = isAdmin ?
          `<td class="admin-only editable-cell" data-field="return_type" data-id="${returnId}" data-original="${returnTypeValue}" onclick="if(event.target.tagName !== 'SELECT') startEditSelect(this, 'return_type', '${returnTypeValue}')" style="cursor: pointer; padding: 4px;">
            <span class="cell-content">${returnTypeValue || '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ì„ íƒ</span>'}</span>
            <select class="cell-select" style="display: none; width: 100%; padding: 4px; border: 2px solid #ff6b35; border-radius: 4px;" onchange="saveSelectCell(this)">
              <option value="">ì„ íƒ</option>
              <option value="ë°˜í’ˆ" ${returnTypeValue === 'ë°˜í’ˆ' ? 'selected' : ''}>ë°˜í’ˆ</option>
              <option value="êµí™˜" ${returnTypeValue === 'êµí™˜' ? 'selected' : ''}>êµí™˜</option>
              <option value="ì˜¤ë°°ì†¡" ${returnTypeValue === 'ì˜¤ë°°ì†¡' ? 'selected' : ''}>ì˜¤ë°°ì†¡</option>
              <option value="ëˆ„ë½" ${returnTypeValue === 'ëˆ„ë½' ? 'selected' : ''}>ëˆ„ë½</option>
            </select>
          </td>` :
          `<td>${returnTypeValue}</td>`;
        
        // ì¬ê³ ìƒíƒœ ì…€ (ê´€ë¦¬ì ëª¨ë“œì—ì„œ ë“œë¡­ë‹¤ìš´)
        const stockStatusValue = row['ì¬ê³ ìƒíƒœ'] || '';
        const stockStatusCell = isAdmin ?
          `<td class="editable-cell" data-field="stock_status" data-id="${returnId}" data-original="${stockStatusValue}" onclick="if(event.target.tagName !== 'SELECT') startEditSelect(this, 'stock_status', '${stockStatusValue}')" style="cursor: pointer; padding: 4px;">
            <span class="cell-content">${stockStatusValue || '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ì„ íƒ</span>'}</span>
            <select class="cell-select" style="display: none; width: 100%; padding: 4px; border: 2px solid #ff6b35; border-radius: 4px;" onchange="saveSelectCell(this)">
              <option value="">ì„ íƒ</option>
              <option value="ì •ìƒ" ${stockStatusValue === 'ì •ìƒ' ? 'selected' : ''}>ì •ìƒ</option>
              <option value="ë¶ˆëŸ‰" ${stockStatusValue === 'ë¶ˆëŸ‰' ? 'selected' : ''}>ë¶ˆëŸ‰</option>
            </select>
          </td>` :
          `<td>${stockStatusValue}</td>`;
        
        // ê´€ë¦¬ ì…€ (ì‚­ì œ ë²„íŠ¼ ì˜†ì— ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€)
        const hasCompleted = isCompleted && completedName;
        const manageCell = `
          <td class="admin-only" style="text-align: center; min-width: 180px;">
            <div style="display: flex; flex-direction: row; gap: 4px; align-items: center; justify-content: center;">
              ${hasCompleted ? 
                `<span style="color: #00b894; font-size: 11px; font-weight: 600; flex: 1; text-align: center;">ì™„ë£Œ</span>` : 
                `<button class="save-btn" onclick="completeReturn(${index}, '${returnId}')" style="background: linear-gradient(135deg, #ffa502 0%, #ff9500 100%); color: white; border: none; padding: 3px 8px; font-size: 10px; flex: 1; border-radius: 4px; box-shadow: none;">ì²˜ë¦¬ì™„ë£Œ</button>`}
              <button class="save-btn" onclick="saveRowChanges('${returnId}', ${index})" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white; border: none; padding: 3px 6px; font-size: 9px; min-width: 28px; border-radius: 4px; box-shadow: none;" title="ìˆ˜ì • ì €ì¥">ğŸ’¾</button>
              <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) deleteReturn(${index}, '${returnId}')" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 3px 6px; font-size: 9px; min-width: 28px; border-radius: 4px; box-shadow: none;" title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
          </td>
        `;
        
        tr.innerHTML = `
          <td>${row['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || ''}</td>
          ${companyCell}
          ${productCell}
          <td>${row['ê³ ê°ëª…'] || ''}</td>
          <td style="position: relative;">
            ${row['ì†¡ì¥ë²ˆí˜¸'] || ''}
            ${courierIcon}
          </td>
          ${returnTypeCell}
          ${stockStatusCell}
          <td>${statusHtml}</td>
          <td>${photoHtml}</td>
          ${memoCell}
          <td style="min-width: 250px;">${requestHtml}</td>
          ${qrCell}
          ${manageCell}
        `;
        
        tbody.appendChild(tr);
      });
      
      // í…Œì´ë¸” ë Œë”ë§ í›„ ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸
      // DOM ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ì•½ê°„ì˜ ì§€ì—°
      setTimeout(() => {
        if (typeof updateAdminColumns === 'function') {
          updateAdminColumns();
        }
        // í—¤ë” hover íš¨ê³¼ ì™„ì „íˆ ì°¨ë‹¨
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¸°ê¸° ì—…ë°ì´íŠ¸ (ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ)
    window.updateAdminColumns = function updateAdminColumns() {
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      console.log('=== updateAdminColumns í˜¸ì¶œ ===');
      console.log('currentRole:', JSON.stringify(currentRole));
      console.log('roleNormalized:', JSON.stringify(roleNormalized));
      console.log('isAdmin:', isAdmin);
      
      // í…Œì´ë¸” í—¤ë”ì™€ ë³¸ë¬¸ì˜ ëª¨ë“  admin-only ìš”ì†Œ ì°¾ê¸°
      const adminElements = document.querySelectorAll('.admin-only');
      console.log('ê´€ë¦¬ì ìš”ì†Œ ê°œìˆ˜:', adminElements.length);
      
      if (adminElements.length === 0) {
        console.warn('âš ï¸ admin-only ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! í…Œì´ë¸”ì´ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        // í…Œì´ë¸”ì´ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
        setTimeout(() => {
          console.log('ì¬ì‹œë„: updateAdminColumns');
          updateAdminColumns();
        }, 300);
        return;
      }
      
      const displayValue = isAdmin ? 'table-cell' : 'none';
      let updatedCount = 0;
      
      adminElements.forEach((cell, index) => {
        cell.style.display = displayValue;
        updatedCount++;
        if (index < 15) { // ì²˜ìŒ 15ê°œë§Œ ìƒì„¸ ë¡œê·¸
          const text = (cell.textContent || cell.innerText || cell.innerHTML || '').substring(0, 40).replace(/\s+/g, ' ');
          console.log(`ìš”ì†Œ ${index}:`, cell.tagName, text, 'â†’ display:', displayValue);
        }
      });
      
      console.log(`âœ… ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸ ì™„ë£Œ - ${updatedCount}ê°œ ìš”ì†Œ, í‘œì‹œ: ${isAdmin}`);
      console.log('=== updateAdminColumns ì™„ë£Œ ===');
    };
    
    // í•„í„°ë§ í•¨ìˆ˜
    function filterByStatus(status) {
      currentFilter = status;
      
      // í™œì„±í™”ëœ í•„í„° í‘œì‹œ
      document.querySelectorAll('.stat-item').forEach(item => {
        item.classList.remove('active');
      });
      
      if (status === 'all') {
        document.getElementById('filterAll').classList.add('active');
      } else if (status === 'completed') {
        document.getElementById('filterCompleted').classList.add('active');
      } else if (status === 'pending') {
        document.getElementById('filterPending').classList.add('active');
      }
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      applyFilter();
    }
    // í•„í„° ì ìš© í•¨ìˆ˜
    function applyFilter() {
      if (!currentData || currentData.length === 0) {
        return;
      }
      
      let filteredData = [];
      
      if (currentFilter === 'all') {
        filteredData = [...currentData];
      } else if (currentFilter === 'completed') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return completed && completed.length > 0;
        });
      } else if (currentFilter === 'pending') {
        filteredData = currentData.filter(row => {
          const completed = row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim();
          return !completed || completed.length === 0;
        });
      }
      
      // ë‚ ì§œ ìµœì‹ ìˆœ ì •ë ¬ (ì¼ì ê¸°ì¤€, ë‚´ë¦¼ì°¨ìˆœ)
      filteredData.sort((a, b) => {
        const dateA = a['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        const dateB = b['ë°˜í’ˆ ì ‘ìˆ˜ì¼'] || '';
        
        // ì¼ì ìˆ«ì ì¶”ì¶œ
        const getDayNumber = (dateStr) => {
          if (!dateStr) return 0;
          const str = dateStr.toString().trim();
          if (str.includes('-')) {
            const parts = str.split('-');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.includes('/')) {
            const parts = str.split('/');
            return parseInt(parts[parts.length - 1]) || 0;
          } else if (str.match(/^\d+$/)) {
            return parseInt(str) || 0;
          }
          return 0;
        };
        
        const dayA = getDayNumber(dateA);
        const dayB = getDayNumber(dateB);
        
        // ì¼ìê°€ ê°™ìœ¼ë©´ IDë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
        if (dayA === dayB) {
          return (b.id || b.rowIndex || 0) - (a.id || a.rowIndex || 0);
        }
        
        // ì¼ì ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)
        return dayB - dayA;
      });
      
      // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë Œë”ë§
      renderTable(filteredData);
      
      // ê´€ë¦¬ì ì—´ ì—…ë°ì´íŠ¸
      setTimeout(() => {
        updateAdminColumns();
        if (typeof disableHeaderHover === 'function') {
          disableHeaderHover();
        }
      }, 150);
    }
    
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
    window.filterByStatus = filterByStatus;
    
    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats(data) {
      const total = data.length;
      const completed = data.filter(row => row['ì²˜ë¦¬ì™„ë£Œ'] && row['ì²˜ë¦¬ì™„ë£Œ'].toString().trim()).length;
      const pending = total - completed;
      
      document.getElementById('totalCount').textContent = total;
      document.getElementById('completedCount').textContent = completed;
      document.getElementById('pendingCount').textContent = pending;
    }
    
    // ìš”ì²­ì‚¬í•­ ì €ì¥
    function saveRequest(dataIndex, rowIndex) {
      // rowIndexê°€ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
      let returnId = rowIndex;
      if (typeof rowIndex === 'string' && rowIndex.startsWith('temp_')) {
        console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', rowIndex);
        showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
      const numericId = parseInt(rowIndex);
      if (isNaN(numericId)) {
        console.error('ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', rowIndex);
        showMessage('âŒ ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      returnId = numericId;
      
      const requestText = document.getElementById(`request_${dataIndex}`).value.trim();
      const selectedMonth = document.getElementById('monthSelect').value;
      
      if (!requestText) {
        alert('ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ì €ì¥ ë°©ì§€)
      const textarea = document.getElementById(`request_${dataIndex}`);
      const saveButton = textarea ? textarea.nextElementSibling : null;
      if (saveButton && saveButton.tagName === 'BUTTON') {
        saveButton.disabled = true;
        saveButton.textContent = 'ì €ì¥ ì¤‘...';
      }
      
      fetch(`${API_BASE_URL}/api/returns/save-request`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId,
          month: selectedMonth,
          requestText: requestText
        })
      })
      .then(response => response.json())
      .then(result => {
        // ì €ì¥ ë²„íŠ¼ ì°¾ê¸° (textarea ë‹¤ìŒ ìš”ì†Œ)
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        
        if (result.success) {
          // ì›ë³¸ ë°ì´í„°ì—ì„œ í•´ë‹¹ í•­ëª© ì°¾ê¸° (rowIndex ê¸°ì¤€)
          const dataItem = currentData.find(item => 
            item.rowIndex === rowIndex || item.id === rowIndex
          );
          
          if (dataItem) {
            dataItem['í™”ì£¼ì‚¬ìš”ì²­'] = requestText;
          }
          
          // í†µê³„ ì—…ë°ì´íŠ¸ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
          updateStats(currentData);
          // í•„í„° ì¬ì ìš© (í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€, ë²„íŠ¼ ìƒíƒœë„ ìœ ì§€ë¨)
          applyFilter();
        } else {
          // ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
          if (saveBtn && saveBtn.tagName === 'BUTTON') {
            saveBtn.disabled = false;
            const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
            if (currentText) {
              saveBtn.textContent = 'ìˆ˜ì •';
              saveBtn.classList.add('edit-btn');
            } else {
              saveBtn.textContent = 'ì €ì¥';
              saveBtn.classList.remove('edit-btn');
            }
          }
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ë²„íŠ¼ ì›ë˜ ìƒíƒœë¡œ ë³µì›
        const textareaEl = document.getElementById(`request_${dataIndex}`);
        const saveBtn = textareaEl ? textareaEl.nextElementSibling : null;
        if (saveBtn && saveBtn.tagName === 'BUTTON') {
          saveBtn.disabled = false;
          const currentText = document.getElementById(`request_${dataIndex}`).value.trim();
          if (currentText) {
            saveBtn.textContent = 'ìˆ˜ì •';
            saveBtn.classList.add('edit-btn');
          } else {
            saveBtn.textContent = 'ì €ì¥';
            saveBtn.classList.remove('edit-btn');
          }
        }
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    
    // ì²˜ë¦¬ì™„ë£Œ í‘œì‹œ (ê´€ë¦¬ì)
    window.completeReturn = function completeReturn(dataIndex, rowIndex) {
      // rowIndexê°€ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
      let returnId = rowIndex;
      if (typeof rowIndex === 'string' && rowIndex.startsWith('temp_')) {
        console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', rowIndex);
        showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
      const numericId = parseInt(rowIndex);
      if (isNaN(numericId)) {
        console.error('ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', rowIndex);
        showMessage('âŒ ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      returnId = numericId;
      
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì²˜ë¦¬ì™„ë£Œë¡œ í‘œì‹œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      const managerName = currentCompany; // í™”ì£¼ëª… ì‚¬ìš©
      
      fetch(`${API_BASE_URL}/api/returns/mark-completed`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: returnId,
          month: selectedMonth,
          managerName: managerName
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ' + result.message, 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì²˜ë¦¬ì™„ë£Œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // QR ì½”ë“œ í‘œì‹œ
    window.showQRCode = function showQRCode(trackingNumber) {
      if (!trackingNumber) {
        alert('ì†¡ì¥ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(trackingNumber)}`;
      const modal = document.createElement('div');
      modal.id = 'qrModal';
      modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;';
      modal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
          <h3 style="margin-bottom: 20px;">ğŸ“± QR ì½”ë“œ</h3>
          <img src="${qrUrl}" alt="QR Code" style="margin: 20px 0; max-width: 100%; border: 2px solid #e0e0e0; padding: 10px; border-radius: 8px;">
          <p style="margin: 15px 0; font-size: 14px; color: #666;">ì†¡ì¥ë²ˆí˜¸: <strong>${trackingNumber}</strong></p>
          <button onclick="closeQRModal()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: 600;">ë‹«ê¸°</button>
        </div>
      `;
      document.body.appendChild(modal);
    };
    
    // QR ëª¨ë‹¬ ë‹«ê¸° (ìƒˆë¡œê³ ì¹¨ ë° ë°˜í’ˆ ë©”ë‰´ ìƒíƒœ ìœ ì§€)
    window.closeQRModal = function closeQRModal() {
      const modal = document.getElementById('qrModal');
      if (modal) {
        modal.remove();
      }
      
      // ë°˜í’ˆ ë©”ë‰´ ìƒíƒœ ì €ì¥
      localStorage.setItem('activeAdminTab', 'returns');
      localStorage.setItem('activeConsignorMenu', 'returns');
      
      // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      location.reload();
    };
    
    // ë¹„ê³  ìˆ˜ì •
    window.editMemo = function editMemo(dataIndex, returnId, currentMemo) {
      // returnIdê°€ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
      let numericId = returnId;
      if (typeof returnId === 'string' && returnId.startsWith('temp_')) {
        console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', returnId);
        showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
      numericId = parseInt(returnId);
      if (isNaN(numericId)) {
        console.error('ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', returnId);
        showMessage('âŒ ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      const memoText = prompt('ë¹„ê³ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', currentMemo || '');
      if (memoText === null) return; // ì·¨ì†Œ
      
      fetch(`${API_BASE_URL}/api/returns/update-memo`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: numericId,
          memo: memoText
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë¹„ê³ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ê³  ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ========== ì…€ í¸ì§‘ ê¸°ëŠ¥ (ê´€ë¦¬ì ì „ìš©) ==========
    // ì…€ í¸ì§‘ ì‹œì‘ (í…ìŠ¤íŠ¸ ì…ë ¥)
    window.startEditCell = function startEditCell(cell, originalValue) {
      const content = cell.querySelector('.cell-content');
      const input = cell.querySelector('.cell-input');
      if (content && input) {
        content.style.display = 'none';
        input.style.display = 'block';
        input.focus();
        input.select();
      }
    };
    
    // ì…€ í¸ì§‘ ì™„ë£Œ (blur ì‹œ í˜¸ì¶œ, ê°’ì´ ë³€ê²½ë˜ì—ˆìœ¼ë©´ content ì—…ë°ì´íŠ¸)
    window.finishEditCell = function finishEditCell(input) {
      const cell = input.closest('.editable-cell');
      if (!cell) {
        console.error('finishEditCell: cellì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const content = cell.querySelector('.cell-content');
      if (!content) {
        console.error('finishEditCell: contentë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      // inputì˜ ì‹¤ì œ ê°’ì„ ê°€ì ¸ì˜´ (input.valueëŠ” í•­ìƒ ë””ì½”ë”©ëœ ê°’ì„ ë°˜í™˜)
      let newValue = input.value.trim();
      
      const field = cell.getAttribute('data-field');
      console.log(`finishEditCell: ${field} - ìƒˆ ê°’: "${newValue}"`);
      
      // contentë¥¼ í˜„ì¬ input ê°’ìœ¼ë¡œ ì—…ë°ì´íŠ¸ (data-originalì€ ìœ ì§€ - ì €ì¥ ì‹œ ë¹„êµìš©)
      if (newValue) {
        // contentê°€ HTMLì´ ì•„ë‹Œ ìˆœìˆ˜ í…ìŠ¤íŠ¸ë¡œ ì—…ë°ì´íŠ¸
        content.textContent = newValue;
      } else {
        content.innerHTML = '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ìˆ˜ì •</span>';
      }
      
      // í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ (inputì˜ ê°’ì€ ìœ ì§€ - ì €ì¥ ì‹œ ì½ê¸° ìœ„í•´)
      input.style.display = 'none';
      content.style.display = 'block';
      
      console.log(`finishEditCell: ${field} - í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ ì™„ë£Œ`);
    };
    
    // ì…€ í¸ì§‘ ì·¨ì†Œ (ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›)
    window.cancelEditCell = function cancelEditCell(inputOrSelect) {
      const cell = inputOrSelect.closest('.editable-cell');
      if (cell) {
        const content = cell.querySelector('.cell-content');
        const originalValue = cell.getAttribute('data-original') || '';
        if (content) {
          if (inputOrSelect.tagName === 'INPUT') {
            inputOrSelect.value = originalValue;
            inputOrSelect.style.display = 'none';
          } else if (inputOrSelect.tagName === 'SELECT') {
            inputOrSelect.value = originalValue;
            inputOrSelect.style.display = 'none';
          }
          content.style.display = 'block';
        }
      }
    };
    
    // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ í¸ì§‘ ëª¨ë“œ ì·¨ì†Œ (ë‹¤ë¥¸ í¸ì§‘ ê°€ëŠ¥í•œ ì…€ í´ë¦­ ì‹œì—ëŠ” ìœ ì§€)
    document.addEventListener('click', function(event) {
      // í´ë¦­í•œ ìš”ì†Œê°€ í¸ì§‘ ê°€ëŠ¥í•œ ì…€ì¸ì§€ í™•ì¸
      const clickedCell = event.target.closest('.editable-cell');
      const clickedInput = event.target.closest('.cell-input');
      const clickedSelect = event.target.closest('.cell-select');
      
      // í¸ì§‘ ê°€ëŠ¥í•œ ì…€ ë‚´ë¶€ë¥¼ í´ë¦­í•œ ê²½ìš°ëŠ” ì œì™¸
      if (clickedCell || clickedInput || clickedSelect) {
        return;
      }
      
      // ë²„íŠ¼ì´ë‚˜ ë‹¤ë¥¸ ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ í´ë¦­ ì‹œì—ë„ ì œì™¸
      if (event.target.tagName === 'BUTTON' || 
          event.target.closest('button') ||
          event.target.tagName === 'A' ||
          event.target.closest('a')) {
        return;
      }
      
      // ëª¨ë“  í¸ì§‘ ì¤‘ì¸ ì…€ ì¢…ë£Œ (ê°’ì€ ìœ ì§€)
      const editingCells = document.querySelectorAll('.editable-cell');
      editingCells.forEach(cell => {
        const input = cell.querySelector('.cell-input');
        const select = cell.querySelector('.cell-select');
        
        if (input && input.style.display !== 'none') {
          // finishEditCellë¡œ í¸ì§‘ ëª¨ë“œ ì¢…ë£Œ (ê°’ì€ ìœ ì§€)
          finishEditCell(input);
        } else if (select && select.style.display !== 'none') {
          // ì…€ë ‰íŠ¸ëŠ” ì´ë¯¸ saveSelectCellì—ì„œ ì²˜ë¦¬ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì·¨ì†Œí•˜ì§€ ì•ŠìŒ
          // finishEditCell(select);
        }
      });
    });
    
    // ì…€ë ‰íŠ¸ í¸ì§‘ ì‹œì‘
    window.startEditSelect = function startEditSelect(cell, field, originalValue) {
      const content = cell.querySelector('.cell-content');
      const select = cell.querySelector('.cell-select');
      if (content && select) {
        content.style.display = 'none';
        select.style.display = 'block';
        select.focus();
      }
    };
    
    // ì…€ë ‰íŠ¸ ì €ì¥ (ë³€ê²½ ì‹œ ì¦‰ì‹œ ì €ì¥í•˜ì§€ ì•Šê³  ê°’ë§Œ ì—…ë°ì´íŠ¸)
    window.saveSelectCell = function saveSelectCell(select) {
      const cell = select.closest('.editable-cell');
      if (cell) {
        const field = cell.getAttribute('data-field');
        const returnIdStr = cell.getAttribute('data-id');
        let returnId = returnIdStr;
        const newValue = select.value;
        const content = cell.querySelector('.cell-content');
        
        // ì„ì‹œ IDì¸ì§€ í™•ì¸
        if (returnIdStr && returnIdStr.startsWith('temp_')) {
          console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', returnIdStr);
          showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
          // ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›
          const originalValue = cell.getAttribute('data-original') || '';
          select.value = originalValue;
          return;
        }
        
        // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
        const numericId = parseInt(returnIdStr);
        if (isNaN(numericId)) {
          console.error('ë°˜í’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', returnIdStr, cell);
          showMessage('âŒ ë°˜í’ˆ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          // ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›
          const originalValue = cell.getAttribute('data-original') || '';
          select.value = originalValue;
          return;
        }
        
        returnId = numericId;
        
        // UIë§Œ ì—…ë°ì´íŠ¸í•˜ê³  ì¦‰ì‹œ ì €ì¥í•˜ì§€ ì•ŠìŒ (ìˆ˜ì • ë²„íŠ¼ìœ¼ë¡œ ì €ì¥)
        // data-originalì€ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ (ì €ì¥ ì‹œ ë³€ê²½ì‚¬í•­ ê°ì§€ìš©)
        if (content) {
          if (newValue) {
            content.textContent = newValue;
          } else {
            content.innerHTML = '<span style="color: #b2bec3;">í´ë¦­í•˜ì—¬ ì„ íƒ</span>';
          }
        }
        select.style.display = 'none';
        if (content) content.style.display = 'block';
        
        // data-originalì€ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ (saveRowChangesì—ì„œ ë³€ê²½ì‚¬í•­ ê°ì§€ìš©)
      }
    };
    
    // ì…€ ê°’ ì €ì¥ (ê°œë³„ í•„ë“œ)
    function saveCellValue(returnId, field, value, cell, content, inputOrSelect) {
      const updateData = {
        id: returnId,
        [field]: value
      };
      
      fetch(`${API_BASE_URL}/api/returns/update`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(updateData)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          // ì„±ê³µ ì‹œ UI ì—…ë°ì´íŠ¸
          if (content) {
            content.textContent = value || (field === 'company_name' ? 'í´ë¦­í•˜ì—¬ ìˆ˜ì •' : field === 'product' ? 'í´ë¦­í•˜ì—¬ ìˆ˜ì •' : 'í´ë¦­í•˜ì—¬ ì„ íƒ');
            if (!value) {
              content.innerHTML = '<span style="color: #b2bec3;">' + (field === 'company_name' ? 'í´ë¦­í•˜ì—¬ ìˆ˜ì •' : field === 'product' ? 'í´ë¦­í•˜ì—¬ ìˆ˜ì •' : 'í´ë¦­í•˜ì—¬ ì„ íƒ') + '</span>';
            }
          }
          if (inputOrSelect) {
            inputOrSelect.style.display = 'none';
            if (content) content.style.display = 'block';
          }
          // ì›ë³¸ ê°’ ì—…ë°ì´íŠ¸
          cell.setAttribute('data-original', value || '');
          // currentData ì—…ë°ì´íŠ¸
          updateCurrentData(returnId, field, value);
        } else {
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
          // ì‹¤íŒ¨ ì‹œ ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›
          if (inputOrSelect) {
            const originalValue = cell.getAttribute('data-original') || '';
            if (inputOrSelect.tagName === 'INPUT') {
              inputOrSelect.value = originalValue;
            } else {
              inputOrSelect.value = originalValue;
            }
          }
        }
      })
      .catch(error => {
        console.error('ì…€ ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›
        if (inputOrSelect) {
          const originalValue = cell.getAttribute('data-original') || '';
          if (inputOrSelect.tagName === 'INPUT') {
            inputOrSelect.value = originalValue;
          } else {
            inputOrSelect.value = originalValue;
          }
        }
      });
    }
    
    // currentData ì—…ë°ì´íŠ¸
    function updateCurrentData(returnId, field, value) {
      if (currentData && Array.isArray(currentData)) {
        const row = currentData.find(r => (r.id || r.rowIndex) === returnId);
        if (row) {
          // í•„ë“œëª… ë§¤í•‘
          const fieldMap = {
            'company_name': 'í™”ì£¼ëª…',
            'product': 'ì œí’ˆ',
            'return_type': 'ë°˜í’ˆ/êµí™˜/ì˜¤ë°°ì†¡',
            'stock_status': 'ì¬ê³ ìƒíƒœ'
          };
          const displayField = fieldMap[field] || field;
          row[displayField] = value;
        }
      }
    }
    
    // í–‰ ë³€ê²½ì‚¬í•­ ì €ì¥ (ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ)
    window.saveRowChanges = function saveRowChanges(returnId, dataIndex) {
      // ì„ì‹œ IDì¸ì§€ í™•ì¸
      if (returnId && returnId.toString().startsWith('temp_')) {
        console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', returnId);
        showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜
      const numericId = parseInt(returnId);
      if (isNaN(numericId)) {
        console.error('ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', returnId);
        showMessage('âŒ ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      // í•´ë‹¹ í–‰ì˜ ëª¨ë“  í¸ì§‘ ê°€ëŠ¥í•œ ì…€ì—ì„œ ë³€ê²½ì‚¬í•­ ìˆ˜ì§‘
      const row = document.querySelector(`tr:has([data-id="${returnId}"])`);
      if (!row) {
        showMessage('âŒ í–‰ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      const editableCells = row.querySelectorAll('.editable-cell');
      const updateData = { id: numericId };
      let hasChanges = false;
      
      console.log('ğŸ” ë³€ê²½ì‚¬í•­ í™•ì¸ ì‹œì‘ - returnId:', returnId);
      
      editableCells.forEach(cell => {
        const field = cell.getAttribute('data-field');
        const originalValue = cell.getAttribute('data-original') || '';
        let currentValue = '';
        
        // ì…ë ¥ í•„ë“œì¸ì§€ ì…€ë ‰íŠ¸ì¸ì§€ í™•ì¸
        const input = cell.querySelector('.cell-input');
        const select = cell.querySelector('.cell-select');
        const content = cell.querySelector('.cell-content');
        
        // inputì´ë‚˜ selectê°€ ìˆìœ¼ë©´ í•­ìƒ ê·¸ ê°’ì„ ì‚¬ìš© (í¸ì§‘ ëª¨ë“œê°€ ëë‚¬ì–´ë„ ê°’ì€ ìœ ì§€ë¨)
        if (input) {
          // input.valueëŠ” í•­ìƒ ë””ì½”ë”©ëœ ê°’ì„ ë°˜í™˜í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
          currentValue = input.value.trim();
          
          // data-originalë„ HTML ì—”í‹°í‹°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë””ì½”ë”©í•˜ì—¬ ë¹„êµ
          let decodedOriginal = originalValue;
          if (originalValue.includes('&')) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalValue;
            decodedOriginal = tempDiv.textContent || tempDiv.innerText || originalValue;
          }
          decodedOriginal = decodedOriginal.trim();
          
          console.log(`   ${field}: input.value = "${currentValue}", data-original = "${originalValue}" (ë””ì½”ë”©: "${decodedOriginal}")`);
          
          // inputì´ ìˆ¨ê²¨ì ¸ ìˆì–´ë„ ê°’ì€ ìœ ì§€ë˜ë¯€ë¡œ, contentì™€ ë¹„êµí•˜ì—¬ ì¼ê´€ì„± ì²´í¬
          if (content) {
            const contentValue = content.textContent.trim();
            if (contentValue.includes('í´ë¦­í•˜ì—¬')) {
              // contentê°€ ì•ˆë‚´ ë¬¸êµ¬ë©´ ë¬´ì‹œ
            } else if (contentValue !== currentValue) {
              console.log(`   âš ï¸ ${field}: inputê³¼ content ê°’ ë¶ˆì¼ì¹˜ - input: "${currentValue}", content: "${contentValue}"`);
              // input ê°’ì„ ìš°ì„  ì‚¬ìš©
            }
          }
          
          // ë””ì½”ë”©ëœ ì›ë³¸ ê°’ê³¼ ë¹„êµ
          if (currentValue !== decodedOriginal) {
            updateData[field] = currentValue;
            hasChanges = true;
            console.log(`   âœ… ë³€ê²½ ê°ì§€: ${field} = "${currentValue}" (ì›ë³¸: "${decodedOriginal}")`);
          } else {
            console.log(`   â­ï¸ ë³€ê²½ ì—†ìŒ: ${field} (í˜„ì¬: "${currentValue}", ì›ë³¸: "${decodedOriginal}")`);
          }
        } else if (select) {
          currentValue = select.value;
          
          // data-originalë„ HTML ì—”í‹°í‹°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë””ì½”ë”©í•˜ì—¬ ë¹„êµ
          let decodedOriginal = originalValue;
          if (originalValue.includes('&')) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalValue;
            decodedOriginal = tempDiv.textContent || tempDiv.innerText || originalValue;
          }
          decodedOriginal = decodedOriginal.trim();
          
          console.log(`   ${field}: select.value = "${currentValue}", data-original = "${originalValue}" (ë””ì½”ë”©: "${decodedOriginal}")`);
          
          // selectê°€ ìˆ¨ê²¨ì ¸ ìˆì–´ë„ ê°’ì€ ìœ ì§€ë˜ë¯€ë¡œ, contentì™€ ë¹„êµ
          if (content) {
            const contentValue = content.textContent.trim();
            if (contentValue.includes('í´ë¦­í•˜ì—¬')) {
              // contentê°€ ì•ˆë‚´ ë¬¸êµ¬ë©´ ë¬´ì‹œ
            } else if (contentValue !== currentValue) {
              console.log(`   âš ï¸ ${field}: selectì™€ content ê°’ ë¶ˆì¼ì¹˜ - select: "${currentValue}", content: "${contentValue}"`);
              // select ê°’ì„ ìš°ì„  ì‚¬ìš©
            }
          }
          
          // ë””ì½”ë”©ëœ ì›ë³¸ ê°’ê³¼ ë¹„êµ
          if (currentValue !== decodedOriginal) {
            updateData[field] = currentValue;
            hasChanges = true;
            console.log(`   âœ… ë³€ê²½ ê°ì§€: ${field} = "${currentValue}" (ì›ë³¸: "${decodedOriginal}")`);
          } else {
            console.log(`   â­ï¸ ë³€ê²½ ì—†ìŒ: ${field} (í˜„ì¬: "${currentValue}", ì›ë³¸: "${decodedOriginal}")`);
          }
        } else if (content) {
          // input/selectê°€ ì—†ìœ¼ë©´ contentì˜ í…ìŠ¤íŠ¸ ì‚¬ìš©
          currentValue = content.textContent.trim();
          // "í´ë¦­í•˜ì—¬ ìˆ˜ì •" ê°™ì€ ì•ˆë‚´ ë¬¸êµ¬ ì œê±°
          if (currentValue.includes('í´ë¦­í•˜ì—¬')) {
            currentValue = '';
          }
          
          // data-originalë„ HTML ì—”í‹°í‹°ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë””ì½”ë”©í•˜ì—¬ ë¹„êµ
          let decodedOriginal = originalValue;
          if (originalValue.includes('&')) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalValue;
            decodedOriginal = tempDiv.textContent || tempDiv.innerText || originalValue;
          }
          decodedOriginal = decodedOriginal.trim();
          
          console.log(`   ${field}: content ê°’ = "${currentValue}", data-original = "${originalValue}" (ë””ì½”ë”©: "${decodedOriginal}")`);
          
          // ë””ì½”ë”©ëœ ì›ë³¸ ê°’ê³¼ ë¹„êµ
          if (currentValue !== decodedOriginal) {
            updateData[field] = currentValue;
            hasChanges = true;
            console.log(`   âœ… ë³€ê²½ ê°ì§€: ${field} = "${currentValue}" (ì›ë³¸: "${decodedOriginal}")`);
          } else {
            console.log(`   â­ï¸ ë³€ê²½ ì—†ìŒ: ${field} (í˜„ì¬: "${currentValue}", ì›ë³¸: "${decodedOriginal}")`);
          }
        }
      });
      
      console.log('ğŸ“Š ë³€ê²½ì‚¬í•­ ìš”ì•½:', { hasChanges, updateData });
      
      if (!hasChanges) {
        showMessage('ğŸ’¡ ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'info');
        return;
      }
      
      console.log('ğŸ’¾ ì €ì¥í•  ë°ì´í„°:', updateData);
      
      // API í˜¸ì¶œ
      fetch(`${API_BASE_URL}/api/returns/update`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(updateData)
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(err => {
            throw new Error(err.message || `ì„œë²„ ì˜¤ë¥˜ (${response.status})`);
          });
        }
        return response.json();
      })
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          
          // ì €ì¥ ì„±ê³µ í›„ data-original ì—…ë°ì´íŠ¸ (ë‹¤ìŒ ë³€ê²½ì‚¬í•­ ê°ì§€ë¥¼ ìœ„í•´)
          editableCells.forEach(cell => {
            const field = cell.getAttribute('data-field');
            if (updateData[field] !== undefined) {
              const input = cell.querySelector('.cell-input');
              const select = cell.querySelector('.cell-select');
              const content = cell.querySelector('.cell-content');
              
              let savedValue = '';
              if (input) {
                savedValue = input.value.trim();
              } else if (select) {
                savedValue = select.value;
              } else if (content) {
                savedValue = content.textContent.trim();
                if (savedValue.includes('í´ë¦­í•˜ì—¬')) {
                  savedValue = '';
                }
              }
              
              // ì €ì¥ëœ ê°’ìœ¼ë¡œ ì›ë³¸ ì—…ë°ì´íŠ¸
              cell.setAttribute('data-original', savedValue || '');
            }
          });
          
          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
          refreshReturnsData();
        } else {
          showMessage('âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('í–‰ ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë°˜í’ˆ ì‚­ì œ
    window.deleteReturn = function deleteReturn(dataIndex, returnId) {
      // returnIdê°€ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
      let numericId = returnId;
      if (typeof returnId === 'string' && returnId.startsWith('temp_')) {
        console.warn('âš ï¸ ì„ì‹œ IDë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ IDê°€ í•„ìš”í•©ë‹ˆë‹¤:', returnId);
        showMessage('âš ï¸ ë°˜í’ˆ IDê°€ ì—†ì–´ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜ ì‹œë„
      numericId = parseInt(returnId);
      if (isNaN(numericId)) {
        console.error('ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', returnId);
        showMessage('âŒ ë°˜í’ˆ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      if (!confirm('ì´ ë°˜í’ˆ ê±´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      fetch(`${API_BASE_URL}/api/returns/delete`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          rowIndex: numericId
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ê±´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    };
    
    // ë¹„ê³  íˆ´íŒ í‘œì‹œ
    window.showMemoTooltip = function showMemoTooltip(event, memoText, memoUpdatedAt) {
      if (!memoText || memoText.trim() === '' || memoText === 'undefined') {
        return; // ë¹„ê³ ê°€ ì—†ìœ¼ë©´ íˆ´íŒ í‘œì‹œ ì•ˆ í•¨
      }
      
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      hideMemoTooltip();
      
      // íˆ´íŒ ìƒì„±
      const tooltip = document.createElement('div');
      tooltip.id = 'memoTooltip';
      tooltip.className = 'memo-tooltip';
      
      // ë¹„ê³  ë‚´ìš©
      const memoContent = document.createElement('div');
      memoContent.textContent = memoText.replace(/\\n/g, '\n');
      memoContent.style.marginBottom = memoUpdatedAt ? '8px' : '0';
      tooltip.appendChild(memoContent);
      
        // ì‘ì„± ì‹œê°„ í‘œì‹œ (ìˆì„ ê²½ìš°ë§Œ)
        if (memoUpdatedAt && memoUpdatedAt.trim() !== '' && memoUpdatedAt !== 'undefined') {
          const timeDiv = document.createElement('div');
          timeDiv.style.fontSize = '11px';
          timeDiv.style.color = '#b2bec3';
          timeDiv.style.marginTop = '8px';
          timeDiv.style.paddingTop = '8px';
          timeDiv.style.borderTop = '1px solid rgba(255, 255, 255, 0.2)';
          
          // ì‹œê°„ í¬ë§·íŒ… (í•œêµ­ í‘œì¤€ì‹œê°„ KSTë¡œ ë³€í™˜)
          try {
            const date = new Date(memoUpdatedAt);
            if (!isNaN(date.getTime())) {
              // í•œêµ­ í‘œì¤€ì‹œê°„(KST, UTC+9)ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í¬ë§·íŒ…
              const year = date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', year: 'numeric' });
              const month = String(date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', month: '2-digit' })).padStart(2, '0');
              const day = String(date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', day: '2-digit' })).padStart(2, '0');
              const hours = String(date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', hour: '2-digit', hour12: false })).padStart(2, '0');
              const minutes = String(date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', minute: '2-digit' })).padStart(2, '0');
              const seconds = String(date.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul', second: '2-digit' })).padStart(2, '0');
              
              timeDiv.textContent = `ì‘ì„±ì‹œê°„: ${year}-${month}-${day} ${hours}:${minutes}:${seconds} (KST)`;
            } else {
              // ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë³¸ í‘œì‹œ
              timeDiv.textContent = `ì‘ì„±ì‹œê°„: ${memoUpdatedAt}`;
            }
          } catch (e) {
            // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì›ë³¸ í‘œì‹œ
            timeDiv.textContent = `ì‘ì„±ì‹œê°„: ${memoUpdatedAt}`;
          }
          
          tooltip.appendChild(timeDiv);
        }
      
      document.body.appendChild(tooltip);
      
      // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì— íˆ´íŒ í‘œì‹œ
      updateTooltipPosition(event, tooltip);
    };
    
    // ë¹„ê³  íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ë§ˆìš°ìŠ¤ ë”°ë¼ë‹¤ë‹ˆê¸°)
    function updateTooltipPosition(event, tooltip) {
      if (!tooltip) return;
      
      const x = event.clientX + 15;
      const y = event.clientY + 15;
      
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // ì•½ê°„ì˜ ì§€ì—° í›„ í™”ë©´ ë°– ì²´í¬ (ë Œë”ë§ ì™„ë£Œ í›„)
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth - 10) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight - 10) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 10) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 10) {
          tooltip.style.top = '15px';
        }
      }, 10);
    }
    
    // ë¹„ê³  íˆ´íŒ ìˆ¨ê¸°ê¸°
    window.hideMemoTooltip = function hideMemoTooltip() {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    };
    
    // ë§ˆìš°ìŠ¤ ì´ë™ ì‹œ íˆ´íŒ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    document.addEventListener('mousemove', function(event) {
      const tooltip = document.getElementById('memoTooltip');
      if (tooltip) {
        updateTooltipPosition(event, tooltip);
      }
    });
    
    // ë°˜í’ˆ ë“±ë¡ í¼ í† ê¸€ (ì ‘ì´ì‹)
    function toggleAddForm() {
      const form = document.getElementById('addReturnForm');
      const icon = document.getElementById('addReturnIcon');
      const btn = document.getElementById('addReturnBtn');
      
      if (form.style.display === 'none') {
        form.style.display = 'block';
        icon.textContent = 'â–²';
        btn.style.borderRadius = '12px 12px 0 0';
        // ì˜¤ëŠ˜ ì¼ìë¡œ ê¸°ë³¸ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
        // í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì • (ì›” ì„ íƒì´ ì—†ìœ¼ë©´ í˜„ì¬ ì›”ë¡œ ì„¤ì •)
        const monthSelect = document.getElementById('monthSelect');
        if (!monthSelect.value) {
          const now = new Date();
          const currentMonth = `${now.getFullYear()}ë…„${now.getMonth() + 1}ì›”`;
          monthSelect.value = currentMonth;
        }
        setupReturnCompanyDropdown();
        loadReturnCompanyOptions();
      } else {
        form.style.display = 'none';
        icon.textContent = 'â–¼';
        btn.style.borderRadius = '12px';
        // í¼ ì´ˆê¸°í™”
        document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
          if (el.id !== 'newReturnDate' && el.id !== 'newOtherCourier' && el.id !== 'newShippingFeeType') {
            el.value = '';
          }
        });
        // ì™¸ë¶€ íƒë°° í•„ë“œ ì´ˆê¸°í™”
        const otherCourierSelect = document.getElementById('newOtherCourier');
        if (otherCourierSelect) {
          otherCourierSelect.value = 'í•œì§„íƒë°°';
          toggleCourierCustomInput();
        }
        const shippingFeeTypeSelect = document.getElementById('newShippingFeeType');
        if (shippingFeeTypeSelect) {
          shippingFeeTypeSelect.value = 'ì‹ ìš©';
        }
        // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
        const today = new Date().getDate();
        document.getElementById('newReturnDate').value = today;
      }
    }
    window.toggleAddForm = toggleAddForm;
    
    // íƒë°°ì‚¬ "ê¸°íƒ€" ì„ íƒ ì‹œ ì§ì ‘ ì…ë ¥ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
    function toggleCourierCustomInput() {
      const courierSelect = document.getElementById('newOtherCourier');
      const courierCustom = document.getElementById('newOtherCourierCustom');
      if (courierSelect && courierCustom) {
        if (courierSelect.value === 'ê¸°íƒ€') {
          courierCustom.style.display = 'block';
          courierCustom.required = false;
        } else {
          courierCustom.style.display = 'none';
          courierCustom.value = '';
        }
      }
    }
    window.toggleCourierCustomInput = toggleCourierCustomInput;
    
    // ì™¸ë¶€ íƒë°° ì°©ë¶ˆ íˆ´íŒ í‘œì‹œ
    function showCourierTooltip(event, courier, shippingFee) {
      if (!courier && !shippingFee) return;
      
      // ê¸°ì¡´ íˆ´íŒ ì œê±°
      const existingTooltip = document.getElementById('courierTooltip');
      if (existingTooltip) {
        existingTooltip.remove();
      }
      
      let tooltipText = '';
      if (courier && courier.trim() !== '') {
        tooltipText += `íƒë°°ì‚¬: ${courier}`;
      }
      if (shippingFee && shippingFee.trim() !== '' && shippingFee.trim() !== 'ì—†ìŒ') {
        if (tooltipText) tooltipText += '\n';
        tooltipText += `ë°°ì†¡ë¹„: ${shippingFee}`;
      }
      
      if (!tooltipText) return;
      
      const tooltip = document.createElement('div');
      tooltip.id = 'courierTooltip';
      tooltip.style.cssText = `
        position: fixed;
        background: #2d3436;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: pre-line;
        z-index: 10000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        max-width: 200px;
      `;
      tooltip.textContent = tooltipText;
      document.body.appendChild(tooltip);
      
      // íˆ´íŒ ìœ„ì¹˜ ì„¤ì •
      const x = event.clientX + 10;
      const y = event.clientY + 10;
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      
      // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
      setTimeout(() => {
        const rect = tooltip.getBoundingClientRect();
        if (rect.right > window.innerWidth - 10) {
          tooltip.style.left = (event.clientX - rect.width - 15) + 'px';
        }
        if (rect.bottom > window.innerHeight - 10) {
          tooltip.style.top = (event.clientY - rect.height - 15) + 'px';
        }
        if (rect.left < 10) {
          tooltip.style.left = '15px';
        }
        if (rect.top < 10) {
          tooltip.style.top = '15px';
        }
      }, 10);
    }
    window.showCourierTooltip = showCourierTooltip;
    
    // ì™¸ë¶€ íƒë°° ì°©ë¶ˆ íˆ´íŒ ìˆ¨ê¸°ê¸°
    function hideCourierTooltip() {
      const tooltip = document.getElementById('courierTooltip');
      if (tooltip) {
        tooltip.remove();
      }
    }
    window.hideCourierTooltip = hideCourierTooltip;

    const COMPANY_DROPDOWN_LIMIT = 200;
    let returnCompanyOptionsCache = [];
    let filteredReturnCompanyOptions = [];
    let companyDropdownOpen = false;
    let companyDropdownActiveIndex = -1;
    let companyDropdownLoadPromise = null;

    function setupReturnCompanyDropdown() {
      const input = document.getElementById('newCompanyName');
      const toggleBtn = document.getElementById('companyDropdownToggle');
      const wrapper = document.getElementById('returnCompanyCombo');

      if (!input || !toggleBtn || !wrapper) {
        return;
      }

      if (input.dataset.comboInitialized === 'true') {
        return;
      }

      input.dataset.comboInitialized = 'true';
      input.addEventListener('input', handleReturnCompanyInput);
      input.addEventListener('focus', handleReturnCompanyFocus);
      input.addEventListener('keydown', handleReturnCompanyKeydown);
      input.addEventListener('blur', handleReturnCompanyBlur);

      toggleBtn.addEventListener('click', function() {
        if (companyDropdownOpen) {
          hideReturnCompanyDropdown();
        } else {
          loadReturnCompanyOptions().then(() => {
            filterReturnCompanyOptions(input.value.trim());
            showReturnCompanyDropdown();
            toggleBtn.setAttribute('aria-expanded', 'true');
          });
        }
      });
      toggleBtn.addEventListener('blur', handleReturnCompanyBlur);

      loadReturnCompanyOptions();
    }

    function handleReturnCompanyInput(event) {
      const value = (event.target.value || '').trim();
      loadReturnCompanyOptions().then(() => {
        filterReturnCompanyOptions(value);
        showReturnCompanyDropdown();
      });
    }

    function handleReturnCompanyFocus() {
      const input = document.getElementById('newCompanyName');
      const value = input ? input.value.trim() : '';
      loadReturnCompanyOptions().then(() => {
        filterReturnCompanyOptions(value);
        showReturnCompanyDropdown();
      });
    }

    function handleReturnCompanyKeydown(event) {
      const visibleCount = getCompanyDropdownItemCount();
      if (event.key === 'ArrowDown') {
        event.preventDefault();
        if (!companyDropdownOpen) {
          handleReturnCompanyFocus();
        }
        if (visibleCount > 0) {
          setActiveCompanyDropdownIndex(companyDropdownActiveIndex + 1);
        }
      } else if (event.key === 'ArrowUp') {
        event.preventDefault();
        if (!companyDropdownOpen) {
          handleReturnCompanyFocus();
        }
        if (visibleCount > 0) {
          const targetIndex = companyDropdownActiveIndex <= 0 ? visibleCount - 1 : companyDropdownActiveIndex - 1;
          setActiveCompanyDropdownIndex(targetIndex);
        }
      } else if (event.key === 'Enter') {
        const dropdown = document.getElementById('companyDropdownList');
        const activeItem = dropdown ? dropdown.querySelector('.company-dropdown-item.active') : null;
        if (activeItem) {
          event.preventDefault();
          selectReturnCompany(activeItem.dataset.value);
        }
      } else if (event.key === 'Escape') {
        hideReturnCompanyDropdown();
      }
    }

    function handleReturnCompanyBlur() {
      setTimeout(() => {
        const wrapper = document.getElementById('returnCompanyCombo');
        if (!wrapper) return;
        if (!wrapper.contains(document.activeElement)) {
          hideReturnCompanyDropdown();
        }
      }, 120);
    }

    function showReturnCompanyDropdown() {
      const dropdown = document.getElementById('companyDropdownList');
      const toggleBtn = document.getElementById('companyDropdownToggle');
      if (dropdown) {
        dropdown.classList.add('open');
      }
      if (toggleBtn) {
        toggleBtn.setAttribute('aria-expanded', 'true');
      }
      companyDropdownOpen = true;
    }

    function hideReturnCompanyDropdown() {
      const dropdown = document.getElementById('companyDropdownList');
      const toggleBtn = document.getElementById('companyDropdownToggle');
      if (dropdown) {
        dropdown.classList.remove('open');
      }
      if (toggleBtn) {
        toggleBtn.setAttribute('aria-expanded', 'false');
      }
      companyDropdownOpen = false;
      companyDropdownActiveIndex = -1;
    }

    function filterReturnCompanyOptions(query = '') {
      const normalized = (query || '').trim().toLowerCase();
      if (!returnCompanyOptionsCache.length) {
        filteredReturnCompanyOptions = [];
        renderReturnCompanyDropdown([]);
        return;
      }
      filteredReturnCompanyOptions = normalized
        ? returnCompanyOptionsCache.filter(name => name.toLowerCase().includes(normalized))
        : [...returnCompanyOptionsCache];
      renderReturnCompanyDropdown(filteredReturnCompanyOptions);
    }

    function renderReturnCompanyDropdown(list) {
      const dropdown = document.getElementById('companyDropdownList');
      if (!dropdown) return;

      dropdown.innerHTML = '';

      if (!list || list.length === 0) {
        dropdown.innerHTML = '<div class="company-dropdown-empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        companyDropdownActiveIndex = -1;
        return;
      }

      list.slice(0, COMPANY_DROPDOWN_LIMIT).forEach((name, index) => {
        const item = document.createElement('button');
        item.type = 'button';
        item.className = 'company-dropdown-item';
        item.textContent = name;
        item.dataset.value = name;
        item.addEventListener('click', () => selectReturnCompany(name));
        dropdown.appendChild(item);
        if (index === 0) {
          companyDropdownActiveIndex = 0;
        }
      });

      setActiveCompanyDropdownIndex(companyDropdownActiveIndex);
    }

    function setActiveCompanyDropdownIndex(index) {
      const dropdown = document.getElementById('companyDropdownList');
      if (!dropdown) {
        companyDropdownActiveIndex = -1;
        return;
      }
      const items = dropdown.querySelectorAll('.company-dropdown-item');
      if (!items.length) {
        companyDropdownActiveIndex = -1;
        return;
      }
      let nextIndex = index;
      if (nextIndex < 0) {
        nextIndex = items.length - 1;
      } else if (nextIndex >= items.length) {
        nextIndex = 0;
      }
      items.forEach((item, idx) => {
        if (idx === nextIndex) {
          item.classList.add('active');
          item.scrollIntoView({ block: 'nearest' });
        } else {
          item.classList.remove('active');
        }
      });
      companyDropdownActiveIndex = nextIndex;
    }

    function getCompanyDropdownItemCount() {
      const dropdown = document.getElementById('companyDropdownList');
      if (!dropdown) return 0;
      return dropdown.querySelectorAll('.company-dropdown-item').length;
    }

    function selectReturnCompany(name) {
      const input = document.getElementById('newCompanyName');
      if (input) {
        input.value = name;
        input.focus();
      }
      hideReturnCompanyDropdown();
    }

    function loadReturnCompanyOptions(force = false) {
      if (!force && returnCompanyOptionsCache.length > 0) {
        return Promise.resolve(returnCompanyOptionsCache);
      }

      if (!force && companyDropdownLoadPromise) {
        return companyDropdownLoadPromise;
      }

      const dropdown = document.getElementById('companyDropdownList');
      if (dropdown && !dropdown.innerHTML) {
        dropdown.innerHTML = '<div class="company-dropdown-empty">í™”ì£¼ì‚¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
      }

      if (force) {
        returnCompanyOptionsCache = [];
      }

      companyDropdownLoadPromise = fetch('/api/auth/companies')
        .then(response => response.json())
        .then(result => {
          if (result.success && Array.isArray(result.companies)) {
            updateReturnCompanyOptionsList(result.companies, true);
          } else if (force) {
            updateReturnCompanyOptionsList([], true);
          }
          return returnCompanyOptionsCache;
        })
        .catch(error => {
          console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          return returnCompanyOptionsCache;
        })
        .finally(() => {
          companyDropdownLoadPromise = null;
        });

      return companyDropdownLoadPromise;
    }

    function updateReturnCompanyOptionsList(companies, replace = false) {
      let nextList = replace ? [] : [...returnCompanyOptionsCache];

      if (Array.isArray(companies) && companies.length > 0) {
        const names = companies
          .map(company => (company.company_name || company.company || company.username || '').trim())
          .filter(Boolean);
        nextList = replace ? names : nextList.concat(names);
      }

      const uniqueSorted = Array.from(new Set(nextList)).sort((a, b) => a.localeCompare(b, 'ko'));
      const changed =
        uniqueSorted.length !== returnCompanyOptionsCache.length ||
        uniqueSorted.some((name, idx) => name !== returnCompanyOptionsCache[idx]);

      if (changed || replace) {
        returnCompanyOptionsCache = uniqueSorted;
        const input = document.getElementById('newCompanyName');
        if (input && companyDropdownOpen) {
          filterReturnCompanyOptions(input.value.trim());
          showReturnCompanyDropdown();
        }
      }
    }

    function refreshReturnCompanyOptions() {
      loadReturnCompanyOptions(true).then(() => {
        const input = document.getElementById('newCompanyName');
        if (input && companyDropdownOpen) {
          filterReturnCompanyOptions(input.value.trim());
        }
      });
    }

    function handleReturnCompanyOutsideClick(event) {
      const wrapper = document.getElementById('returnCompanyCombo');
      if (!wrapper) return;
      if (!wrapper.contains(event.target)) {
        hideReturnCompanyDropdown();
      }
    }

    document.addEventListener('click', handleReturnCompanyOutsideClick);
    
    // ë°˜í’ˆ ë“±ë¡ (ê´€ë¦¬ì ì „ìš©)
    function addReturn() {
      // ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
      const isAdmin = (currentRole === 'ê´€ë¦¬ì');
      if (!isAdmin) {
        alert('ë°˜í’ˆ ë“±ë¡ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      const selectedMonth = document.getElementById('monthSelect').value;
      if (!selectedMonth) {
        alert('ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì¼ìë§Œ ì…ë ¥ë°›ìŒ (1-31)
      const dayInput = document.getElementById('newReturnDate').value.trim();
      const day = parseInt(dayInput);
      if (!dayInput || isNaN(day) || day < 1 || day > 31) {
        alert('ì¼ìë¥¼ 1-31 ì‚¬ì´ì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const companyName = document.getElementById('newCompanyName').value.trim();
      const product = document.getElementById('newProduct').value.trim();
      const customerName = document.getElementById('newCustomerName').value.trim();
      const trackingNumber = document.getElementById('newTrackingNumber').value.trim();
      
      if (!customerName || !trackingNumber) {
        alert('ê³ ê°ëª…ê³¼ ì†¡ì¥ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }
      
      if (!companyName) {
        alert('í™”ì£¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return;
      }
      
      // ì™¸ë¶€ íƒë°° ì°©ë¶ˆ ì •ë³´ ìˆ˜ì§‘
      const otherCourierSelect = document.getElementById('newOtherCourier');
      const otherCourierCustom = document.getElementById('newOtherCourierCustom');
      let otherCourier = '';
      if (otherCourierSelect) {
        const selectedCourier = otherCourierSelect.value;
        if (selectedCourier === 'ê¸°íƒ€' && otherCourierCustom && otherCourierCustom.value.trim()) {
          otherCourier = otherCourierCustom.value.trim();
        } else if (selectedCourier !== 'ê¸°íƒ€') {
          otherCourier = selectedCourier;
        }
      }
      
      const shippingFeeTypeSelect = document.getElementById('newShippingFeeType');
      const shippingFeeInput = document.getElementById('newShippingFee');
      let shippingFee = '';
      if (shippingFeeTypeSelect) {
        const feeType = shippingFeeTypeSelect.value;
        const feeAmount = shippingFeeInput ? shippingFeeInput.value.trim() : '';
        if (feeType === 'ì—†ìŒ') {
          shippingFee = 'ì—†ìŒ';
        } else if (feeAmount) {
          shippingFee = `${feeType} ${feeAmount}`;
        } else {
          shippingFee = feeType; // ê¸ˆì•¡ì´ ì—†ì–´ë„ íƒ€ì…ë§Œ ì €ì¥
        }
      }
      
      // ì¼ìë§Œ ì €ì¥ (ë¬¸ìì—´ë¡œ ì €ì¥í•˜ì—¬ ì •ë ¬ì´ ì˜ ë˜ë„ë¡)
      const returnData = {
        return_date: String(day),  // ì¼ìë§Œ ì €ì¥
        company_name: companyName,
        product: product,
        customer_name: customerName,
        tracking_number: trackingNumber,
        return_type: document.getElementById('newReturnType').value,
        stock_status: document.getElementById('newStockStatus').value,
        inspection: '',  // ê²€í’ˆìœ ë¬´ ì œê±°
        completed: '',
        memo: document.getElementById('newMemo').value.trim(),
        photo_links: '',
        other_courier: otherCourier,
        shipping_fee: shippingFee,
        client_request: '',
        client_confirmed: '',
        month: selectedMonth
      };
      
      fetch(`${API_BASE_URL}/api/returns/create`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(returnData)
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ë°˜í’ˆ ë‚´ì—­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          // í¼ ì ‘ê¸° ë° ì´ˆê¸°í™”
          const form = document.getElementById('addReturnForm');
          const icon = document.getElementById('addReturnIcon');
          const btn = document.getElementById('addReturnBtn');
          if (form && icon && btn) {
            form.style.display = 'none';
            icon.textContent = 'â–¼';
            btn.style.borderRadius = '12px';
            // í¼ ì´ˆê¸°í™”
            document.getElementById('addReturnForm').querySelectorAll('input, textarea, select').forEach(el => {
              if (el.id !== 'newReturnDate') el.value = '';
            });
            // ë‚ ì§œëŠ” ì˜¤ëŠ˜ ì¼ìë¡œ ë‹¤ì‹œ ì„¤ì •
            const today = new Date().getDate();
            document.getElementById('newReturnDate').value = today;
          }
          refreshReturnsData(); // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
        } else {
          showMessage('âŒ ' + (result.message || 'ë“±ë¡ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë“±ë¡ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.addReturn = addReturn;
    // ë©”ë‰´ ì „í™˜ í•¨ìˆ˜
    function switchMenu(menuName) {
      // ëª¨ë“  ë©”ë‰´ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        item.classList.remove('active');
      });
      
      // ì„ íƒëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
      const selectedMenu = document.getElementById(menuName + 'MenuBtn');
      if (selectedMenu) {
        selectedMenu.classList.add('active');
      }
      
      // íŠ¹ìˆ˜ì‘ì—… ì „ìš© ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€ (íŠ¹ìˆ˜ì‘ì—… ë©”ë‰´ê°€ ì•„ë‹ ë•Œ)
      const specialWorksContainer = document.getElementById('specialWorksTab');
      if (specialWorksContainer && menuName !== 'specialWorks') {
        specialWorksContainer.classList.add('hidden');
        specialWorksContainer.style.display = 'none';
      }
      
      // íŒŒë ˆíŠ¸ ê´€ë¦¬ ì „ìš© ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€ (íŒŒë ˆíŠ¸ ê´€ë¦¬ ë©”ë‰´ê°€ ì•„ë‹ ë•Œ)
      const palletsContainer = document.getElementById('palletsTab');
      if (palletsContainer && menuName !== 'pallets') {
        palletsContainer.classList.add('hidden');
        palletsContainer.style.display = 'none';
      }
      
      // ë©”ë‰´ë³„ ì½˜í…ì¸  í‘œì‹œ/ìˆ¨ê¹€ ì²˜ë¦¬ (í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ë§Œ ì²˜ë¦¬)
      // ê´€ë¦¬ì íƒ­ì€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ
      const consignorTabIds = ['companyInfoTab', 'returnsTab', 'csTab', 'scheduleTab', 'boardCategoryTab'];
      
      // ëª¨ë“  ë©”ë‰´ ì „í™˜ ì‹œ ê´€ë¦¬ì ëª¨ë“œ ê²Œì‹œíŒ íƒ­ ìˆ¨ê¸°ê¸°
      const adminBoardTab = document.getElementById('boardTab');
      if (adminBoardTab) {
        adminBoardTab.classList.add('hidden');
        adminBoardTab.style.display = 'none';
      }
      
      if (menuName === 'companyInfo') {
        // í™”ì£¼ì‚¬ ì •ë³´ ë©”ë‰´
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            if (tabId === 'companyInfoTab') {
              tab.classList.remove('hidden');
              tab.style.display = 'block';
            } else {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            }
          }
        });
        // í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
        loadCompanyInfo();
      } else if (menuName === 'returns') {
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            if (tabId === 'returnsTab') {
              tab.classList.remove('hidden');
              tab.style.display = 'block';
            } else {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            }
          }
        });
        // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ìë™ ë¡œë“œ
        refreshReturnsData();
      } else if (menuName === 'cs') {
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            if (tabId === 'csTab') {
              tab.classList.remove('hidden');
              tab.style.display = 'block';
            } else {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            }
          }
        });
        // C/S ë“±ë¡ ì„¹ì…˜ í‘œì‹œ (í™”ì£¼ì‚¬ ë° ê´€ë¦¬ì ëª¨ë‘)
        const csRegisterSection = document.getElementById('csRegisterSection');
        if (csRegisterSection) {
          csRegisterSection.style.display = 'block';
        }
        // í™”ì£¼ì‚¬ë³„ í†µê³„ ì„¹ì…˜ í‘œì‹œ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ)
        const csAdminCompanyStatsSection = document.getElementById('csAdminCompanyStatsSection');
        if (csAdminCompanyStatsSection) {
          csAdminCompanyStatsSection.style.display = (currentRole === 'ê´€ë¦¬ì') ? 'block' : 'none';
        }
        // C/S ì›” ëª©ë¡ ë¡œë“œ ë° ë°ì´í„° ë¡œë“œ
        loadCsAvailableMonths();
        loadCsIssueTypesForForm(); // C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ
      } else if (menuName === 'schedule') {
        // ëª¨ë“  í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ ìˆ¨ê¸°ê¸°
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            if (tabId === 'scheduleTab') {
              tab.classList.remove('hidden');
              tab.style.display = 'block';
            } else {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            }
          }
        });
        // ë‹¬ë ¥ ì›” ì„ íƒ ì´ˆê¸°í™” (ë©”ë‰´ ì „í™˜ ì‹œ)
        const consignorCalendarMonthSelect = document.getElementById('consignorCalendarMonthSelect');
        if (consignorCalendarMonthSelect && !consignorCalendarMonthSelect.value) {
          const today = new Date();
          consignorCalendarMonthSelect.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        }
        // ìŠ¤ì¼€ì¥´ ëª©ë¡ ë¡œë“œ
        refreshSchedules();
        // ë‹¬ë ¥ ë¡œë“œ
        if (typeof loadConsignorCalendarSchedules === 'function') {
          loadConsignorCalendarSchedules();
        }
        // ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ ë¡œë“œ (í™”ì£¼ì‚¬ ëª¨ë“œ)
        if (typeof loadScheduleTypesForConsignor === 'function') {
          loadScheduleTypesForConsignor();
        }
      } else if (menuName === 'board') {
        // ê²Œì‹œíŒ ë©”ë‰´
        // ëª¨ë“  í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ ìˆ¨ê¸°ê¸°
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            if (tabId === 'boardCategoryTab') {
              tab.classList.remove('hidden');
              tab.style.display = 'block';
            } else {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            }
          }
        });
        // ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ë° ê²Œì‹œê¸€ ë¡œë“œ
        loadBoardCategoriesForSelect();
        // ì „ì²´ ì¹´í…Œê³ ë¦¬ ì„ íƒ ë° ê²Œì‹œê¸€ ë¡œë“œ
        setTimeout(() => {
          selectBoardCategory('');
        }, 100);
      } else if (menuName === 'specialWorks') {
        // íŠ¹ìˆ˜ì‘ì—… ë©”ë‰´
        // ëª¨ë“  í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ ìˆ¨ê¸°ê¸°
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            tab.classList.add('hidden');
            tab.style.display = 'none';
          }
        });
        // íŠ¹ìˆ˜ì‘ì—… ì½˜í…ì¸  ë¡œë“œ
        loadSpecialWorksContent();
      } else if (menuName === 'pallets') {
        // íŒŒë ˆíŠ¸ ê´€ë¦¬ ë©”ë‰´
        // ëª¨ë“  í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ ìˆ¨ê¸°ê¸°
        consignorTabIds.forEach(tabId => {
          const tab = document.getElementById(tabId);
          if (tab) {
            tab.classList.add('hidden');
            tab.style.display = 'none';
          }
        });
        // íŒŒë ˆíŠ¸ ê´€ë¦¬ ì½˜í…ì¸  ë¡œë“œ
        loadPalletsContent();
      }
      
      // í˜„ì¬ í™œì„± ë©”ë‰´ë¥¼ localStorageì— ì €ì¥ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ ë³µì›ìš©)
      localStorage.setItem('activeConsignorMenu', menuName);
      
      console.log('ë©”ë‰´ ì „í™˜:', menuName);
    }
    window.switchMenu = switchMenu;
    
    // ê´€ë¦¬ì íƒ­ ì „í™˜ í•¨ìˆ˜
    function switchAdminTab(tabName) {
      // ëª¨ë“  íƒ­ ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
      const tabButtons = document.querySelectorAll('.tab-btn');
      tabButtons.forEach(btn => {
        btn.classList.remove('active');
      });
      
      // ì„ íƒëœ íƒ­ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
      const selectedTabBtn = document.getElementById(tabName + 'TabBtn');
      if (selectedTabBtn) {
        selectedTabBtn.classList.add('active');
      }
      
      // ê´€ë¦¬ì íƒ­ë§Œ ëª…ì‹œì ìœ¼ë¡œ ìˆ¨ê¸°ê¸° (í™”ì£¼ì‚¬ ëª¨ë“œ íƒ­ì— ì˜í–¥ ì£¼ì§€ ì•Šë„ë¡)
      const adminTabIds = ['returnsTab', 'csTab', 'specialWorksTab', 'palletsTab', 'scheduleCalendarTab', 'boardTab', 'boardCategoryTab', 'popupTab', 'registerTab'];
      adminTabIds.forEach(tabId => {
        const tab = document.getElementById(tabId);
        if (tab) {
          tab.classList.add('hidden');
          tab.style.display = 'none';
        }
      });
      
      // ì„ íƒëœ íƒ­ ì½˜í…ì¸  í‘œì‹œ
      if (tabName === 'returns') {
        const returnsTab = document.getElementById('returnsTab');
        if (returnsTab) {
          returnsTab.classList.remove('hidden');
          returnsTab.style.display = 'block';
        }
        // ë°˜í’ˆ ë‚´ì—­ ë°ì´í„° ë¡œë“œ
        refreshReturnsData();
      } else if (tabName === 'cs') {
        const csTab = document.getElementById('csTab');
        if (csTab) {
          csTab.classList.remove('hidden');
          csTab.style.display = 'block';
        }
        // C/S ë“±ë¡ ì„¹ì…˜ í‘œì‹œ (í™”ì£¼ì‚¬ ë° ê´€ë¦¬ì ëª¨ë‘)
        const csRegisterSection = document.getElementById('csRegisterSection');
        if (csRegisterSection) {
          csRegisterSection.style.display = 'block';
        }
        // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ)
        if (typeof loadCompaniesForCs === 'function') {
          loadCompaniesForCs();
        }
        // C/S ì¢…ë¥˜ ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ)
        const csIssueTypesManagerBtn = document.getElementById('csIssueTypesManagerBtn');
        if (csIssueTypesManagerBtn) {
          csIssueTypesManagerBtn.style.display = (currentRole === 'ê´€ë¦¬ì') ? 'inline-block' : 'none';
        }
        // í™”ì£¼ì‚¬ë³„ í†µê³„ ì„¹ì…˜ í‘œì‹œ (ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ)
        const csAdminCompanyStatsSection = document.getElementById('csAdminCompanyStatsSection');
        if (csAdminCompanyStatsSection) {
          csAdminCompanyStatsSection.style.display = (currentRole === 'ê´€ë¦¬ì') ? 'block' : 'none';
        }
        // C/S ì›” ëª©ë¡ ë¡œë“œ ë° ë°ì´í„° ë¡œë“œ
        loadCsAvailableMonths();
        loadCsIssueTypesForForm(); // C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ
      } else if (tabName === 'scheduleCalendar') {
        const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
        if (scheduleCalendarTab) {
          scheduleCalendarTab.classList.remove('hidden');
          scheduleCalendarTab.style.display = 'block';
        }
        // ë‹¬ë ¥ ì›” ì„ íƒ ì´ˆê¸°í™” (ë©”ë‰´ ì „í™˜ ì‹œ)
        const calendarMonthSelect = document.getElementById('calendarMonthSelect');
        if (calendarMonthSelect && !calendarMonthSelect.value) {
          const today = new Date();
          calendarMonthSelect.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        }
        // ìŠ¤ì¼€ì¥´ ìº˜ë¦°ë” ë¡œë“œ (ê´€ë¦¬ì ëª¨ë“œ)
        if (typeof loadCalendarSchedules === 'function') {
          loadCalendarSchedules();
        }
        // ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ ë¡œë“œ
        if (typeof loadScheduleTypes === 'function') {
          loadScheduleTypes();
        }
        // ìŠ¤ì¼€ì¤„ ë©”ëª¨ ë¡œë“œ (ê´€ë¦¬ì ì „ìš©)
        // íƒ­ì´ ì™„ì „íˆ ë Œë”ë§ëœ í›„ ë©”ëª¨ ì„¹ì…˜ ë„ˆë¹„ë¥¼ ì„¤ì •
        setTimeout(() => {
          if (typeof loadScheduleMemos === 'function') {
            // ìº˜ë¦°ë” ë°•ìŠ¤ì˜ ì‹¤ì œ ë„ˆë¹„ë¥¼ ì°¸ì¡°í•˜ì—¬ ë©”ëª¨ ì„¹ì…˜ ë„ˆë¹„ ì„¤ì •
            // ìº˜ë¦°ë” ë°•ìŠ¤ ì°¾ê¸° (ë©”ëª¨ ì„¹ì…˜ì´ ì•„ë‹Œ ì²« ë²ˆì§¸ í°ìƒ‰ ë°•ìŠ¤)
            const calendarBox = scheduleCalendarTab.querySelector('div[style*="background: #ffffff"]:not(#scheduleMemoSection)');
            const memoSection = document.getElementById('scheduleMemoSection');
            const memoGrid = document.getElementById('scheduleMemoGrid');
            
            if (scheduleCalendarTab && scheduleCalendarTab.offsetWidth > 0) {
              if (calendarBox && calendarBox.offsetWidth > 0 && memoSection) {
                const calendarComputedStyle = window.getComputedStyle(calendarBox);
                // ë©”ëª¨ ì„¹ì…˜ì— ìº˜ë¦°ë” ë°•ìŠ¤ì™€ ë™ì¼í•œ ë„ˆë¹„ ì ìš©
                memoSection.style.width = calendarComputedStyle.width;
                memoSection.style.maxWidth = calendarComputedStyle.maxWidth || 'none';
                memoSection.style.minWidth = '0';
                memoSection.style.boxSizing = 'border-box';
                // ê°•ì œë¡œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°
                void memoSection.offsetWidth;
              } else if (memoSection) {
                // ìº˜ë¦°ë” ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ íƒ­ ë„ˆë¹„ ì‚¬ìš©
                memoSection.style.width = scheduleCalendarTab.offsetWidth + 'px';
                memoSection.style.maxWidth = '100%';
                memoSection.style.boxSizing = 'border-box';
                memoSection.style.minWidth = '0';
                void memoSection.offsetWidth;
              }
            }
            
            if (memoGrid) {
              memoGrid.style.width = '100%';
              memoGrid.style.maxWidth = '100%';
              memoGrid.style.minWidth = '0';
              void memoGrid.offsetWidth;
            }
            
            loadScheduleMemos();
          }
        }, 150);
      } else if (tabName === 'board') {
        const boardTab = document.getElementById('boardTab');
        if (boardTab) {
          boardTab.classList.remove('hidden');
          boardTab.style.display = 'block';
        }
        // ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
        if (typeof loadBoardCategoriesForSelect === 'function') {
          loadBoardCategoriesForSelect();
        }
        // ê´€ë¦¬ì ëª¨ë“œ ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        if (typeof loadBoards === 'function') {
          loadBoards();
        }
        // ì¹´í…Œê³ ë¦¬ í•„í„° ë“œë¡­ë‹¤ìš´ ë¡œë“œ
        if (typeof loadCategoriesForBoard === 'function') {
          loadCategoriesForBoard();
        }
      } else if (tabName === 'popup') {
        const popupTab = document.getElementById('popupTab');
        if (popupTab) {
          popupTab.classList.remove('hidden');
          popupTab.style.display = 'block';
        }
        // íŒì—… ëª©ë¡ ë¡œë“œ
        if (typeof loadPopups === 'function') {
          loadPopups();
        }
        // ë°°ë„ˆ ëª©ë¡ ë¡œë“œ
        if (typeof hbLoadBanners === 'function') {
          hbLoadBanners();
        }
      } else if (tabName === 'register') {
        const registerTab = document.getElementById('registerTab');
        if (registerTab) {
          registerTab.classList.remove('hidden');
          registerTab.style.display = 'block';
        }
        // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
        if (typeof loadCompanies === 'function') {
          loadCompanies();
        }
      } else if (tabName === 'specialWorks') {
        // íŠ¹ìˆ˜ì‘ì—… íƒ­
        loadSpecialWorksContent();
      } else if (tabName === 'pallets') {
        // íŒŒë ˆíŠ¸ ê´€ë¦¬ íƒ­
        loadPalletsContent();
      }
      
      // í˜„ì¬ í™œì„± íƒ­ì„ localStorageì— ì €ì¥ (F5 ìƒˆë¡œê³ ì¹¨ ì‹œ ë³µì›ìš©)
      localStorage.setItem('activeAdminTab', tabName);
      
      console.log('ê´€ë¦¬ì íƒ­ ì „í™˜:', tabName);
    }
    window.switchAdminTab = switchAdminTab;
    
    // ========== í™ˆ ë²„íŠ¼ í•¨ìˆ˜ ==========
    function goToHome() {
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      if (isAdmin) {
        switchAdminTab('board');
      } else {
        switchMenu('board');
      }
    }
    window.goToHome = goToHome;
    
    // ========== í™”ì£¼ì‚¬ ì •ë³´ í™•ì¸ ë° ì´ˆê¸° ë©”ë‰´ ê²°ì • í•¨ìˆ˜ ==========
    async function checkCompanyInfoAndNavigate() {
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          const hasBusinessInfo = !!(data.business_number && data.business_name && data.business_address && data.business_tel && data.business_email);
          
          if (!hasBusinessInfo) {
            localStorage.setItem('activeConsignorMenu', 'companyInfo');
            setTimeout(() => switchMenu('companyInfo'), 100);
          } else {
            const savedMenu = localStorage.getItem('activeConsignorMenu');
            if (!savedMenu || savedMenu === 'returns') {
              localStorage.setItem('activeConsignorMenu', 'board');
              setTimeout(() => switchMenu('board'), 100);
            } else {
              setTimeout(() => switchMenu(savedMenu), 100);
            }
          }
        } else {
          localStorage.setItem('activeConsignorMenu', 'board');
          setTimeout(() => switchMenu('board'), 100);
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ í™•ì¸ ì˜¤ë¥˜:', error);
        localStorage.setItem('activeConsignorMenu', 'board');
        setTimeout(() => switchMenu('board'), 100);
      }
    }
    window.checkCompanyInfoAndNavigate = checkCompanyInfoAndNavigate;
    
    // ========== íŠ¹ìˆ˜ì‘ì—… ê´€ë ¨ í•¨ìˆ˜ ==========
    
    /**
     * íŠ¹ìˆ˜ì‘ì—… ì½˜í…ì¸  ë™ì  ë¡œë“œ
     */
    function loadSpecialWorksContent() {
      // íŠ¹ìˆ˜ì‘ì—… íƒ­ ì»¨í…Œì´ë„ˆ ì°¾ê¸° ë˜ëŠ” ìƒì„±
      let container = document.getElementById('specialWorksTab');
      if (!container) {
        // ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
        container = document.createElement('div');
        container.id = 'specialWorksTab';
        container.className = 'tab-content';
        // ê´€ë¦¬ì íƒ­ ì˜ì—­ì— ì¶”ê°€
        const adminTabs = document.getElementById('adminTabs');
        if (adminTabs && adminTabs.parentNode) {
          adminTabs.parentNode.insertBefore(container, adminTabs.nextSibling);
        } else {
          // adminTabsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ bodyì— ì¶”ê°€
          document.body.appendChild(container);
        }
      }
      
      // ì»¨í…Œì´ë„ˆ í‘œì‹œ
      container.classList.remove('hidden');
      container.style.display = 'block';
      
      // ë¡œë”© í‘œì‹œ
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      
      // special_works.html íŒŒì¼ ë¡œë“œ
      fetch('special_works.html')
        .then(response => {
          if (!response.ok) {
            throw new Error('íŠ¹ìˆ˜ì‘ì—… í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
          return response.text();
        })
        .then(html => {
          // HTML íŒŒì‹±
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // body ë‚´ìš© ì¶”ì¶œ
          const bodyContent = doc.body.innerHTML;
          const styleContent = doc.head.querySelector('style')?.innerHTML || '';
          
          // ì»¨í…Œì´ë„ˆì— ì‚½ì…
          container.innerHTML = `<style>${styleContent}</style>${bodyContent}`;
          
          // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (special_works.htmlì—ì„œ ì‚¬ìš©)
          // dashboard_server.htmlì˜ ì „ì—­ ë³€ìˆ˜ë¥¼ window ê°ì²´ì— ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •
          window.currentRole = typeof currentRole !== 'undefined' ? currentRole : '';
          window.currentCompany = typeof currentCompany !== 'undefined' ? currentCompany : '';
          window.currentUsername = typeof currentUsername !== 'undefined' ? currentUsername : '';
          
          // localStorageì—ì„œë„ ì½ì–´ì˜¤ê¸° (ë°±ì—…)
          if (!window.currentRole) {
            window.currentRole = localStorage.getItem('client_role') || '';
          }
          if (!window.currentCompany) {
            window.currentCompany = localStorage.getItem('client_company') || '';
          }
          if (!window.currentUsername) {
            window.currentUsername = localStorage.getItem('client_username') || '';
          }
          
          console.log('[SW] ì „ì—­ ë³€ìˆ˜ ì„¤ì •:', {
            role: window.currentRole,
            company: window.currentCompany,
            username: window.currentUsername
          });
          
          // ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
          const scripts = container.querySelectorAll('script');
          scripts.forEach(script => {
            const newScript = document.createElement('script');
            if (script.src) {
              newScript.src = script.src;
            } else {
              newScript.textContent = script.textContent;
            }
            document.body.appendChild(newScript);
            if (script.parentNode) {
              script.parentNode.removeChild(script);
            }
          });
          
          // ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ (ì•½ê°„ì˜ ì§€ì—° í›„)
          setTimeout(() => {
            if (typeof window.swCommonInit === 'function') {
              window.swCommonInit();
            }
          }, 100);
        })
        .catch(error => {
          console.error('íŠ¹ìˆ˜ì‘ì—… ì½˜í…ì¸  ë¡œë“œ ì˜¤ë¥˜:', error);
          container.innerHTML = `<div style="text-align: center; padding: 40px; color: #e74c3c;">âŒ íŠ¹ìˆ˜ì‘ì—… í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
        });
    }
    window.loadSpecialWorksContent = loadSpecialWorksContent;
    
    // ========== íŒŒë ˆíŠ¸ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    /**
     * íŒŒë ˆíŠ¸ ê´€ë¦¬ ì½˜í…ì¸  ë™ì  ë¡œë“œ (special_works.htmlê³¼ ì •í™•íˆ ë™ì¼í•œ ë°©ì‹)
     */
    function loadPalletsContent() {
      // íŒŒë ˆíŠ¸ ê´€ë¦¬ íƒ­ ì»¨í…Œì´ë„ˆ ì°¾ê¸° ë˜ëŠ” ìƒì„±
      let container = document.getElementById('palletsTab');
      if (!container) {
        // ì»¨í…Œì´ë„ˆê°€ ì—†ìœ¼ë©´ ìƒì„±
        container = document.createElement('div');
        container.id = 'palletsTab';
        container.className = 'tab-content';
        
        // í™”ì£¼ì‚¬ ëª¨ë“œì™€ ê´€ë¦¬ì ëª¨ë“œ ëª¨ë‘ ì§€ì›
        const roleNormalized = (currentRole || '').toString().trim();
        const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
        
        if (isAdmin) {
          // ê´€ë¦¬ì íƒ­ ì˜ì—­ì— ì¶”ê°€
          const adminTabs = document.getElementById('adminTabs');
          if (adminTabs && adminTabs.parentNode) {
            adminTabs.parentNode.insertBefore(container, adminTabs.nextSibling);
          } else {
            // adminTabsë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ bodyì— ì¶”ê°€
            document.body.appendChild(container);
          }
        } else {
          // í™”ì£¼ì‚¬ ëª¨ë“œ: contentAreaì— ì¶”ê°€
          const contentArea = document.getElementById('contentArea');
          if (contentArea) {
            // ê¸°ì¡´ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            const existingTabs = contentArea.querySelectorAll('.tab-content');
            existingTabs.forEach(tab => {
              tab.classList.add('hidden');
              tab.style.display = 'none';
            });
            contentArea.appendChild(container);
          } else {
            // contentAreaë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ bodyì— ì¶”ê°€
            document.body.appendChild(container);
          }
        }
      }
      
      // ì»¨í…Œì´ë„ˆ í‘œì‹œ
      container.classList.remove('hidden');
      container.style.display = 'block';
      
      // ë¡œë”© í‘œì‹œ
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      
      // pallets.html íŒŒì¼ ë¡œë“œ
      fetch('pallets.html')
        .then(response => {
          if (!response.ok) {
            throw new Error('íŒŒë ˆíŠ¸ ê´€ë¦¬ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
          return response.text();
        })
        .then(html => {
          
          // HTML íŒŒì‹±
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // body ë‚´ìš© ì¶”ì¶œ
          const bodyContent = doc.body.innerHTML;
          const styleContent = doc.head.querySelector('style')?.innerHTML || '';
          
          // ì»¨í…Œì´ë„ˆì— ì‚½ì…
          container.innerHTML = `<style>${styleContent}</style>${bodyContent}`;
          
          // ì „ì—­ ë³€ìˆ˜ ì„¤ì • (pallets.htmlì—ì„œ ì‚¬ìš©)
          // dashboard_server.htmlì˜ ì „ì—­ ë³€ìˆ˜ë¥¼ window ê°ì²´ì— ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •
          window.currentRole = typeof currentRole !== 'undefined' ? currentRole : '';
          window.currentCompany = typeof currentCompany !== 'undefined' ? currentCompany : '';
          window.currentUsername = typeof currentUsername !== 'undefined' ? currentUsername : '';
          
          // localStorageì—ì„œë„ ì½ì–´ì˜¤ê¸° (ë°±ì—…)
          if (!window.currentRole) {
            window.currentRole = localStorage.getItem('client_role') || '';
          }
          if (!window.currentCompany) {
            window.currentCompany = localStorage.getItem('client_company') || '';
          }
          if (!window.currentUsername) {
            window.currentUsername = localStorage.getItem('client_username') || '';
          }
          
          console.log('[PAL] ì „ì—­ ë³€ìˆ˜ ì„¤ì •:', {
            role: window.currentRole,
            company: window.currentCompany,
            username: window.currentUsername
          });
          
          // ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ì™€ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¶„ë¦¬)
          const scripts = container.querySelectorAll('script');
          const externalScripts = [];
          const inlineScripts = [];
          
          scripts.forEach(script => {
            if (script.src) {
              externalScripts.push(script);
            } else {
              inlineScripts.push(script);
            }
          });
          
          // ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ (Promiseë¡œ ìˆœì°¨ ì‹¤í–‰)
          const loadExternalScripts = externalScripts.reduce((promise, script) => {
            return promise.then(() => {
              return new Promise((resolve, reject) => {
                // Chart.jsëŠ” ì´ë¯¸ dashboard_server.htmlì— ë¡œë“œë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìŠ¤í‚µ
                if (script.src.includes('chart.js') || script.src.includes('chart.umd')) {
                  console.log('[PAL] Chart.jsëŠ” ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìŒ, ìŠ¤í‚µ');
                  resolve();
                  return;
                }
                
                const newScript = document.createElement('script');
                newScript.src = script.src;
                newScript.onload = () => {
                  console.log('[PAL] ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ:', script.src);
                  resolve();
                };
                newScript.onerror = () => {
                  console.error('[PAL] ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', script.src);
                  resolve(); // ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰
                };
                document.body.appendChild(newScript);
                if (script.parentNode) {
                  script.parentNode.removeChild(script);
                }
              });
            });
          }, Promise.resolve());
          
          // ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ í›„ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
          loadExternalScripts.then(() => {
            inlineScripts.forEach(script => {
              const newScript = document.createElement('script');
              newScript.textContent = script.textContent;
              document.body.appendChild(newScript);
              if (script.parentNode) {
                script.parentNode.removeChild(script);
              }
            });
            
            // Chart.js ë¡œë“œ í™•ì¸ í›„ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
            const checkChartJS = () => {
              if (typeof Chart !== 'undefined') {
                console.log('[PAL] Chart.js ë¡œë“œ í™•ì¸ ì™„ë£Œ');
                setTimeout(() => {
                  if (typeof window.palInit === 'function') {
                    window.palInit();
                  }
                }, 100);
              } else {
                console.warn('[PAL] Chart.js ë¡œë“œ ëŒ€ê¸° ì¤‘...');
                setTimeout(checkChartJS, 100);
              }
            };
            checkChartJS();
          });
        })
        .catch(error => {
          console.error('íŒŒë ˆíŠ¸ ê´€ë¦¬ ì½˜í…ì¸  ë¡œë“œ ì˜¤ë¥˜:', error);
          container.innerHTML = `<div style="text-align: center; padding: 40px; color: #e74c3c;">âŒ íŒŒë ˆíŠ¸ ê´€ë¦¬ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
        });
    }
    window.loadPalletsContent = loadPalletsContent;
    
    // ========== íŒë§¤ ìŠ¤ì¼€ì¥´ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleScheduleForm() {
      const form = document.getElementById('scheduleForm');
      const icon = document.getElementById('addScheduleIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none' || !form.style.display;
        form.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
        
        // í¼ì´ ì—´ë¦´ ë•Œ íƒ€ì… ëª©ë¡ ë¡œë“œ
        if (isHidden && typeof loadScheduleTypesForConsignor === 'function') {
          loadScheduleTypesForConsignor();
        }
      }
    }
    window.toggleScheduleForm = toggleScheduleForm;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œìš© ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ ë¡œë“œ (íƒ€ì… ì¶”ê°€ ë²„íŠ¼ ì—†ì´ ë“œë¡­ë‹¤ìš´ë§Œ)
    async function loadScheduleTypesForConsignor() {
      try {
        const response = await fetch('/api/schedules/types');
        const result = await response.json();
        
        if (result.success && result.data) {
          const select = document.getElementById('scheduleType');
          if (select) {
            select.innerHTML = '<option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>' +
              result.data.map(type => 
                `<option value="${escapeHtml(type.name)}">${escapeHtml(type.name)}</option>`
              ).join('');
          }
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¤„ íƒ€ì… ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadScheduleTypesForConsignor = loadScheduleTypesForConsignor;
    
    // ìŠ¤ì¼€ì¥´ ì €ì¥
    async function saveSchedule() {
      const scheduleType = document.getElementById('scheduleType').value.trim();
      const title = document.getElementById('scheduleTitle').value.trim();
      const startDate = document.getElementById('scheduleStartDate').value;
      const endDate = document.getElementById('scheduleEndDate').value;
      const eventDescription = document.getElementById('scheduleEventDescription').value.trim();
      const requestNote = document.getElementById('scheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('scheduleMessage');
      
      if (!scheduleType || !title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/schedules/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: currentCompany,
            schedule_type: scheduleType,
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetScheduleForm();
          refreshSchedules();
          // í¼ ì ‘ê¸°
          const form = document.getElementById('scheduleForm');
          const icon = document.getElementById('addScheduleIcon');
          if (form && icon) {
            form.style.display = 'none';
            icon.textContent = 'â–¶';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveSchedule = saveSchedule;
    
    // ìŠ¤ì¼€ì¥´ í¼ ì´ˆê¸°í™”
    function resetScheduleForm() {
      const scheduleTypeSelect = document.getElementById('scheduleType');
      if (scheduleTypeSelect) scheduleTypeSelect.value = '';
      document.getElementById('scheduleTitle').value = '';
      document.getElementById('scheduleStartDate').value = '';
      document.getElementById('scheduleEndDate').value = '';
      document.getElementById('scheduleEventDescription').value = '';
      document.getElementById('scheduleRequestNote').value = '';
      document.getElementById('scheduleMessage').innerHTML = '';
      
      // ì €ì¥ ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
      const saveBtn = document.querySelector('#scheduleTab .save-btn');
      if (saveBtn) {
        saveBtn.onclick = saveSchedule;
        saveBtn.textContent = 'ì €ì¥';
      }
    }
    window.resetScheduleForm = resetScheduleForm;
    
    // ìŠ¤ì¼€ì¥´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    async function refreshSchedules() {
      const tbody = document.getElementById('scheduleTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch(`/api/schedules/list?company=${encodeURIComponent(currentCompany)}&role=${encodeURIComponent(currentRole || 'í™”ì£¼ì‚¬')}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            // ë‹¬ë ¥ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
            loadConsignorCalendarSchedules();
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach((schedule, index) => {
            const row = document.createElement('tr');
            const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '';
            const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '';
            
            row.innerHTML = `
              <td>${escapeHtml(schedule.title || '')}</td>
              <td>${startDate}</td>
              <td>${endDate}</td>
              <td style="max-width: 300px; word-wrap: break-word;">${escapeHtml(schedule.event_description || '')}</td>
              <td style="max-width: 200px; word-wrap: break-word;">${escapeHtml(schedule.request_note || '-')}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="editSchedule(${schedule.id})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 4px 10px; font-size: 11px; border-radius: 4px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) deleteSchedule(${schedule.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 4px 10px; font-size: 11px; border-radius: 4px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          
          // ë‹¬ë ¥ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
          loadConsignorCalendarSchedules();
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.refreshSchedules = refreshSchedules;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ë¡œë“œ
    async function loadConsignorCalendarSchedules() {
      const container = document.getElementById('consignorCalendarContainer');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const monthInput = document.getElementById('consignorCalendarMonthSelect');
        // ì´ˆê¸°í™”: í˜„ì¬ ì›”ë¡œ ì„¤ì •
        if (monthInput && !monthInput.value) {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          monthInput.value = `${year}-${month}`;
        }
        const month = monthInput ? monthInput.value : '';
        
        // í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œëŠ” ìì‹ ì˜ ìŠ¤ì¼€ì¥´ë§Œ ì¡°íšŒ
        let url = `/api/schedules/list?company=${encodeURIComponent(currentCompany)}&role=${encodeURIComponent(currentRole || 'í™”ì£¼ì‚¬')}`;
        
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          // ì„ íƒëœ ì›”ì— í•´ë‹¹í•˜ëŠ” ìŠ¤ì¼€ì¥´ë§Œ í•„í„°ë§
          let filteredSchedules = result.data;
          if (month) {
            const [year, monthNum] = month.split('-');
            const startDate = `${year}-${monthNum}-01`;
            const nextMonth = parseInt(monthNum) === 12 ? 1 : parseInt(monthNum) + 1;
            const nextYear = parseInt(monthNum) === 12 ? parseInt(year) + 1 : parseInt(year);
            const endDate = `${nextYear}-${String(nextMonth).padStart(2, '0')}-01`;
            
            filteredSchedules = result.data.filter(schedule => {
              const scheduleStart = new Date(schedule.start_date);
              const scheduleEnd = new Date(schedule.end_date);
              const rangeStart = new Date(startDate);
              const rangeEnd = new Date(endDate);
              
              // ìŠ¤ì¼€ì¥´ì´ ì„ íƒëœ ì›”ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
              return (scheduleStart < rangeEnd && scheduleEnd >= rangeStart);
            });
          }
          
          renderConsignorCalendar(filteredSchedules, month);
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ì¡°íšŒ ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    window.loadConsignorCalendarSchedules = loadConsignorCalendarSchedules;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ ë‹¬ë ¥ ë Œë”ë§
    function renderConsignorCalendar(schedules, month) {
      const container = document.getElementById('consignorCalendarContainer');
      if (!container) return;
      
      // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
      if (!window.scheduleModalData) {
        window.scheduleModalData = {};
      }
      
      // ì›” ì„¤ì •
      let currentDate;
      if (month) {
        const [year, monthNum] = month.split('-');
        currentDate = new Date(parseInt(year), parseInt(monthNum) - 1, 1);
      } else {
        currentDate = new Date();
        currentDate.setDate(1);
      }
      
      const year = currentDate.getFullYear();
      const monthNum = currentDate.getMonth();
      const firstDay = new Date(year, monthNum, 1);
      const lastDay = new Date(year, monthNum + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      // ë‚ ì§œë³„ë¡œ ìŠ¤ì¼€ì¥´ ê·¸ë£¹í™”
      const schedulesByDate = {};
      
      schedules.forEach(schedule => {
        const start = new Date(schedule.start_date);
        const end = new Date(schedule.end_date);
        const current = new Date(start);
        
        while (current <= end) {
          const dateKey = current.toISOString().split('T')[0];
          if (!schedulesByDate[dateKey]) {
            schedulesByDate[dateKey] = [];
          }
          schedulesByDate[dateKey].push(schedule);
          current.setDate(current.getDate() + 1);
        }
      });
      
      // ë‹¬ë ¥ HTML ìƒì„±
      const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
      const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      
      let html = `
        <div style="background: #ffffff; border-radius: 14px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <h4 style="text-align: center; margin-bottom: 20px; color: #ff6b35; font-size: 24px; font-weight: 700;">
            ${year}ë…„ ${monthNames[monthNum]}
          </h4>
          <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
      `;
      
      // ìš”ì¼ í—¤ë”
      dayNames.forEach(day => {
        html += `
          <div style="text-align: center; padding: 12px; font-weight: 700; color: ${day === 'ì¼' ? '#e74c3c' : day === 'í† ' ? '#3498db' : '#2d3436'}; background: #fff9e6; border-radius: 8px;">
            ${day}
          </div>
        `;
      });
      
      // ë¹ˆ ì¹¸ (ì²« ì£¼ ì‹œì‘ì¼ ì „)
      for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div style="min-height: 100px; background: #f8f9fa; border-radius: 8px;"></div>';
      }
      
      // ë‚ ì§œ ì¹¸
      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${String(monthNum + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const daySchedules = schedulesByDate[dateKey] || [];
        const isToday = new Date().toDateString() === new Date(year, monthNum, day).toDateString();
        
        // ìŠ¤ì¼€ì¥´ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©)
        window.scheduleModalData[dateKey] = daySchedules;
        
        html += `
          <div style="min-height: 100px; background: ${isToday ? '#fff9e6' : '#ffffff'}; border: 2px solid ${isToday ? '#ff6b35' : '#ffeaa7'}; border-radius: 8px; padding: 8px; cursor: pointer; transition: all 0.2s;" 
               onclick="showScheduleModal('${dateKey}', '')">
            <div style="font-weight: 700; margin-bottom: 6px; color: ${isToday ? '#ff6b35' : '#2d3436'};">
              ${day}
            </div>
            <div style="display: flex; flex-direction: column; gap: 4px;">
        `;
        
        // ìŠ¤ì¼€ì¥´ í‘œì‹œ (ìµœëŒ€ 5ê°œ) - í™”ì£¼ì‚¬ ëª¨ë“œ: ìƒ‰ìƒ ì—†ì´ ê²€ì •ìƒ‰ í…ìŠ¤íŠ¸ë¡œ "- íƒ€ì…" í˜•ì‹
        daySchedules.slice(0, 5).forEach((schedule, idx) => {
          let scheduleType = escapeHtml(schedule.schedule_type || '');
          const title = escapeHtml(schedule.title || '');
          
          // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬-"ë¡œ ì‹œì‘í•˜ë©´ ì ‘ë‘ì‚¬ ì œê±°
          if (scheduleType.startsWith('ëª¨ë“ í™”ì£¼ì‚¬-')) {
            scheduleType = scheduleType.replace('ëª¨ë“ í™”ì£¼ì‚¬-', '');
          }
          
          // "- íƒ€ì…" í˜•ì‹ìœ¼ë¡œ í‘œì‹œ (í™”ì£¼ì‚¬ ëª¨ë“œ: ì—°í•œ ë°°ê²½ìƒ‰ + ì§„í•œ í…ìŠ¤íŠ¸ë¡œ ê°€ë…ì„± í–¥ìƒ)
          const displayText = scheduleType ? `- ${scheduleType}` : (title.length > 12 ? title.substring(0, 12) + '...' : title);
          html += `
            <div style="background: #f5f5f5; border: 1px solid #e0e0e0; color: #1a1a1a; padding: 4px 6px; font-size: 11px; font-weight: 600; border-radius: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                 title="${scheduleType ? scheduleType + ': ' : ''}${title}">
              ${displayText}
            </div>
          `;
        });
        
        if (daySchedules.length > 5) {
          html += `<div style="font-size: 10px; color: #636e72; text-align: center;">+${daySchedules.length - 5}ê°œ</div>`;
        }
        
        html += `
            </div>
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    window.renderConsignorCalendar = renderConsignorCalendar;
    
    // ìŠ¤ì¼€ì¥´ ìˆ˜ì •
    async function editSchedule(scheduleId) {
      try {
        const response = await fetch(`/api/schedules/${scheduleId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const schedule = result.data;
          document.getElementById('scheduleTitle').value = schedule.title || '';
          document.getElementById('scheduleStartDate').value = schedule.start_date || '';
          document.getElementById('scheduleEndDate').value = schedule.end_date || '';
          document.getElementById('scheduleEventDescription').value = schedule.event_description || '';
          document.getElementById('scheduleRequestNote').value = schedule.request_note || '';
          
          // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
          const saveBtn = document.querySelector('#scheduleTab .save-btn');
          if (saveBtn) {
            saveBtn.onclick = () => updateSchedule(scheduleId);
            saveBtn.textContent = 'ìˆ˜ì •';
          }
          
          // ìŠ¤í¬ë¡¤ì„ í¼ìœ¼ë¡œ ì´ë™
          document.getElementById('scheduleTab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editSchedule = editSchedule;
    
    // ìŠ¤ì¼€ì¥´ ì—…ë°ì´íŠ¸
    async function updateSchedule(scheduleId) {
      const title = document.getElementById('scheduleTitle').value.trim();
      const startDate = document.getElementById('scheduleStartDate').value;
      const endDate = document.getElementById('scheduleEndDate').value;
      const eventDescription = document.getElementById('scheduleEventDescription').value.trim();
      const requestNote = document.getElementById('scheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('scheduleMessage');
      
      if (!title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/schedules/update/${scheduleId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetScheduleForm();
          refreshSchedules();
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#scheduleTab .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveSchedule;
            saveBtn.textContent = 'ì €ì¥';
          }
          // í¼ ì ‘ê¸°
          const form = document.getElementById('scheduleForm');
          const icon = document.getElementById('addScheduleIcon');
          if (form && icon) {
            form.style.display = 'none';
            icon.textContent = 'â–¶';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateSchedule = updateSchedule;
    
    // ìŠ¤ì¼€ì¥´ ì‚­ì œ
    async function deleteSchedule(scheduleId) {
      // ID ìœ íš¨ì„± ê²€ì‚¬ (ë” ì™„í™”ëœ ê²€ì‚¬)
      if (scheduleId === null || scheduleId === undefined || scheduleId === '' || 
          String(scheduleId).toLowerCase() === 'null' || String(scheduleId).toLowerCase() === 'undefined' ||
          isNaN(Number(scheduleId))) {
        console.error('ìŠ¤ì¼€ì¥´ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', scheduleId, typeof scheduleId);
        alert(`ìŠ¤ì¼€ì¥´ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ID: ${scheduleId})`);
        return;
      }
      
      // ìˆ«ìë¡œ ë³€í™˜
      const id = Number(scheduleId);
      if (id <= 0) {
        console.error('ìŠ¤ì¼€ì¥´ IDê°€ 0 ì´í•˜ì…ë‹ˆë‹¤:', id);
        alert(`ìŠ¤ì¼€ì¥´ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ID: ${id})`);
        return;
      }
      
      try {
        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
        const userRole = typeof currentRole !== 'undefined' ? currentRole : 'ê´€ë¦¬ì';
        const userCompany = typeof currentCompany !== 'undefined' ? currentCompany : '';
        
        console.log('ìŠ¤ì¼€ì¥´ ì‚­ì œ ì‹œë„:', id, 'role:', userRole, 'company:', userCompany);
        
        // roleê³¼ companyë¥¼ query parameterë¡œ ì „ë‹¬
        let url = `/api/schedules/delete/${id}?role=${encodeURIComponent(userRole)}`;
        if (userCompany) {
          url += `&company=${encodeURIComponent(userCompany)}`;
        }
        
        const response = await fetch(url, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          console.log('âœ… ì‚­ì œ ì„±ê³µ ì‘ë‹µ ë°›ìŒ, ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
          // ê´€ë¦¬ì ëª¨ë“œì¸ì§€ í™”ì£¼ì‚¬ ëª¨ë“œì¸ì§€ í™•ì¸
          const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
          if (scheduleCalendarTab && !scheduleCalendarTab.classList.contains('hidden')) {
            // ê´€ë¦¬ì ëª¨ë“œ: ë‹¬ë ¥ê³¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            console.log('ê´€ë¦¬ì ëª¨ë“œ: ë‹¬ë ¥ê³¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨');
            // ì•½ê°„ì˜ ì§€ì—° í›„ ìƒˆë¡œê³ ì¹¨ (ì„œë²„ì—ì„œ ì‚­ì œê°€ ì™„ì „íˆ ì™„ë£Œë˜ë„ë¡)
            setTimeout(() => {
              if (typeof loadCalendarSchedules === 'function') {
                console.log('loadCalendarSchedules í•¨ìˆ˜ í˜¸ì¶œ');
                loadCalendarSchedules();
              } else {
                console.error('loadCalendarSchedules í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                location.reload();
              }
            }, 300);
          } else {
            // í™”ì£¼ì‚¬ ëª¨ë“œ: ìŠ¤ì¼€ì¥´ ëª©ë¡ ë° ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨
            console.log('í™”ì£¼ì‚¬ ëª¨ë“œ: ìŠ¤ì¼€ì¥´ ëª©ë¡ ë° ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨');
            setTimeout(() => {
              if (typeof refreshSchedules === 'function') {
                console.log('refreshSchedules í•¨ìˆ˜ í˜¸ì¶œ (ë‹¬ë ¥ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸ë¨)');
                refreshSchedules();
              } else {
                console.error('refreshSchedules í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                location.reload();
              }
            }, 300);
          }
          alert('ìŠ¤ì¼€ì¥´ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          console.error('âŒ ì‚­ì œ ì‹¤íŒ¨:', result.message);
          alert(result.message || 'ìŠ¤ì¼€ì¥´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¥´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    window.deleteSchedule = deleteSchedule;
    
    // ========== ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ìˆ˜ì • ê´€ë ¨ í•¨ìˆ˜ ==========
    
    /**
     * ìŠ¤ì¼€ì¥´ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
     */
    async function editSchedule(scheduleId) {
      try {
        // ìŠ¤ì¼€ì¥´ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const response = await fetch(`/api/schedules/${scheduleId}`);
        const result = await response.json();
        
        if (!result.success || !result.data) {
          alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const schedule = result.data;
        
        // ë‚ ì§œ í˜•ì‹ ë³€í™˜ (YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ)
        let startDate = schedule.start_date || '';
        let endDate = schedule.end_date || '';
        
        // ë‚ ì§œê°€ datetime í˜•ì‹ì´ë©´ YYYY-MM-DDë¡œ ë³€í™˜
        if (startDate) {
          if (typeof startDate === 'string') {
            if (startDate.includes('T')) {
              startDate = startDate.split('T')[0];
            } else if (startDate.includes(' ')) {
              startDate = startDate.split(' ')[0];
            }
          } else if (startDate instanceof Date) {
            // Date ê°ì²´ì¸ ê²½ìš°
            const year = startDate.getFullYear();
            const month = String(startDate.getMonth() + 1).padStart(2, '0');
            const day = String(startDate.getDate()).padStart(2, '0');
            startDate = `${year}-${month}-${day}`;
          }
        }
        
        if (endDate) {
          if (typeof endDate === 'string') {
            if (endDate.includes('T')) {
              endDate = endDate.split('T')[0];
            } else if (endDate.includes(' ')) {
              endDate = endDate.split(' ')[0];
            }
          } else if (endDate instanceof Date) {
            // Date ê°ì²´ì¸ ê²½ìš°
            const year = endDate.getFullYear();
            const month = String(endDate.getMonth() + 1).padStart(2, '0');
            const day = String(endDate.getDate()).padStart(2, '0');
            endDate = `${year}-${month}-${day}`;
          }
        }
        
        // ëª¨ë‹¬ì— ë°ì´í„° ì±„ìš°ê¸°
        document.getElementById('editScheduleId').value = schedule.id;
        document.getElementById('editScheduleCompanyInput').value = schedule.company_name || '';
        document.getElementById('editScheduleCompanyName').value = schedule.company_name || '';
        document.getElementById('editScheduleTitle').value = schedule.title || '';
        document.getElementById('editScheduleStartDate').value = startDate;
        document.getElementById('editScheduleEndDate').value = endDate;
        document.getElementById('editScheduleEventDescription').value = schedule.event_description || '';
        document.getElementById('editScheduleRequestNote').value = schedule.request_note || '';
        
        // ìŠ¤ì¼€ì¤„ íƒ€ì… ì„ íƒ (ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ì´ ë¡œë“œë˜ì–´ ìˆì–´ì•¼ í•¨)
        const scheduleTypeSelect = document.getElementById('editScheduleType');
        if (scheduleTypeSelect) {
          // ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ì´ ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
          if (typeof loadScheduleTypes === 'function') {
            await loadScheduleTypes();
          }
          // ìŠ¤ì¼€ì¤„ íƒ€ì… ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
          const typesResponse = await fetch('/api/schedules/types');
          const typesResult = await typesResponse.json();
          if (typesResult.success && typesResult.data) {
            scheduleTypeSelect.innerHTML = '<option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>' + 
              typesResult.data.map(type => 
                `<option value="${escapeHtml(type.name)}">${escapeHtml(type.name)}</option>`
              ).join('');
            
            // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬-"ë¡œ ì‹œì‘í•˜ë©´ ì ‘ë‘ì‚¬ ì œê±°
            let scheduleType = schedule.schedule_type || '';
            if (scheduleType.startsWith('ëª¨ë“ í™”ì£¼ì‚¬-')) {
              scheduleType = scheduleType.replace('ëª¨ë“ í™”ì£¼ì‚¬-', '');
            }
            scheduleTypeSelect.value = scheduleType;
          }
        }
        
        // í™”ì£¼ì‚¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        initEditScheduleCompanyDropdown();
        
        // ëª¨ë‹¬ ì—´ê¸°
        document.getElementById('editScheduleModal').style.display = 'block';
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¥´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editSchedule = editSchedule;
    
    /**
     * ìŠ¤ì¼€ì¥´ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeEditScheduleModal() {
      document.getElementById('editScheduleModal').style.display = 'none';
      document.getElementById('editScheduleForm').reset();
      document.getElementById('editScheduleMessage').innerHTML = '';
    }
    window.closeEditScheduleModal = closeEditScheduleModal;
    
    /**
     * ìˆ˜ì • ëª¨ë‹¬ í™”ì£¼ì‚¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
     */
    function initEditScheduleCompanyDropdown() {
      fetch('/api/auth/companies')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const companies = data.companies || [];
            const input = document.getElementById('editScheduleCompanyInput');
            const hidden = document.getElementById('editScheduleCompanyName');
            const dropdown = document.getElementById('editScheduleCompanyDropdown');
            
            if (input && hidden && dropdown) {
              function updateDropdown(filterText = '') {
                const filtered = companies.filter(company => 
                  company.company_name.toLowerCase().includes(filterText.toLowerCase())
                );
                
                if (filtered.length === 0) {
                  dropdown.innerHTML = '<div class="sc-dropdown-item" style="color: #999; cursor: default;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                } else {
                  dropdown.innerHTML = filtered.map(company => 
                    `<div class="sc-dropdown-item" data-value="${escapeHtml(company.company_name)}">${escapeHtml(company.company_name)}</div>`
                  ).join('');
                }
              }
              
              updateDropdown();
              
              let isDropdownOpen = false;
              let dropdownTimeout = null;
              
              const openDropdown = () => {
                if (dropdownTimeout) {
                  clearTimeout(dropdownTimeout);
                  dropdownTimeout = null;
                }
                updateDropdown(input.value);
                dropdown.classList.add('show');
                isDropdownOpen = true;
              };
              
              const closeDropdown = () => {
                if (dropdownTimeout) {
                  clearTimeout(dropdownTimeout);
                  dropdownTimeout = null;
                }
                dropdown.classList.remove('show');
                isDropdownOpen = false;
              };
              
              input.addEventListener('input', (e) => {
                const value = e.target.value;
                hidden.value = value;
                updateDropdown(value);
                if (!isDropdownOpen) {
                  openDropdown();
                }
              });
              
              input.addEventListener('focus', (e) => {
                e.stopPropagation();
                if (dropdownTimeout) {
                  clearTimeout(dropdownTimeout);
                }
                dropdownTimeout = setTimeout(() => {
                  openDropdown();
                }, 100);
              });
              
              input.addEventListener('click', (e) => {
                e.stopPropagation();
                if (dropdownTimeout) {
                  clearTimeout(dropdownTimeout);
                }
                dropdownTimeout = setTimeout(() => {
                  openDropdown();
                }, 100);
              });
              
              // ì—”í„° í‚¤ ì²˜ë¦¬: ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒë§Œ í•˜ê³  í¼ ì œì¶œ ë°©ì§€
              input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  
                  if (isDropdownOpen && dropdown.children.length > 0) {
                    const firstItem = dropdown.querySelector('.sc-dropdown-item[data-value]');
                    if (firstItem && firstItem.dataset.value) {
                      input.value = firstItem.dataset.value;
                      hidden.value = firstItem.dataset.value;
                      closeDropdown();
                      return;
                    }
                  }
                  
                  const inputValue = input.value.trim().toLowerCase();
                  if (inputValue) {
                    const matchedItem = Array.from(dropdown.querySelectorAll('.sc-dropdown-item[data-value]'))
                      .find(item => item.dataset.value.toLowerCase() === inputValue || 
                                    item.dataset.value.toLowerCase().includes(inputValue));
                    if (matchedItem && matchedItem.dataset.value) {
                      input.value = matchedItem.dataset.value;
                      hidden.value = matchedItem.dataset.value;
                      closeDropdown();
                      return;
                    }
                  }
                  
                  if (!isDropdownOpen) {
                    openDropdown();
                  }
                }
              });
              
              dropdown.addEventListener('click', (e) => {
                e.stopPropagation();
                const item = e.target.closest('.sc-dropdown-item');
                if (item && item.dataset.value) {
                  input.value = item.dataset.value;
                  hidden.value = item.dataset.value;
                  closeDropdown();
                }
              });
              
              const handleDocumentClick = (e) => {
                if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                  setTimeout(() => {
                    if (!input.contains(document.activeElement)) {
                      closeDropdown();
                    }
                  }, 150);
                }
              };
              
              document.addEventListener('mousedown', handleDocumentClick);
            }
          }
        })
        .catch(error => {
          console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        });
    }
    
    /**
     * ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì €ì¥
     */
    async function saveEditSchedule() {
      const scheduleId = document.getElementById('editScheduleId').value;
      if (!scheduleId) {
        alert('ìŠ¤ì¼€ì¥´ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const companyHidden = document.getElementById('editScheduleCompanyName');
      const companyInput = document.getElementById('editScheduleCompanyInput');
      const companyName = (companyHidden && companyHidden.value.trim()) || (companyInput && companyInput.value.trim()) || '';
      const scheduleType = document.getElementById('editScheduleType').value.trim();
      const title = document.getElementById('editScheduleTitle').value.trim();
      const startDate = document.getElementById('editScheduleStartDate').value;
      const endDate = document.getElementById('editScheduleEndDate').value;
      const eventDescription = document.getElementById('editScheduleEventDescription').value.trim();
      const requestNote = document.getElementById('editScheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('editScheduleMessage');
      
      if (!companyName || !scheduleType || !title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/schedules/update/${scheduleId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: companyName,
            schedule_type: scheduleType,
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          setTimeout(() => {
            closeEditScheduleModal();
            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            if (typeof loadCalendarSchedules === 'function') {
              loadCalendarSchedules();
            }
          }, 1000);
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveEditSchedule = saveEditSchedule;
    
    // ========== ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ì €ì¥
    async function saveAdminSchedule() {
      const companyHidden = document.getElementById('adminScheduleCompanyName');
      const companyInput = document.getElementById('adminScheduleCompanyInput');
      // hidden ë˜ëŠ” inputì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸° (hiddenì´ ìš°ì„ )
      const companyName = (companyHidden && companyHidden.value.trim()) || (companyInput && companyInput.value.trim()) || '';
      const scheduleType = document.getElementById('adminScheduleType').value.trim();
      const title = document.getElementById('adminScheduleTitle').value.trim();
      const startDate = document.getElementById('adminScheduleStartDate').value;
      const endDate = document.getElementById('adminScheduleEndDate').value;
      const eventDescription = document.getElementById('adminScheduleEventDescription').value.trim();
      const requestNote = document.getElementById('adminScheduleRequestNote').value.trim();
      const messageDiv = document.getElementById('adminScheduleMessage');
      
      if (!companyName || !scheduleType || !title || !startDate || !endDate || !eventDescription) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ëŠ¦ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/schedules/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: companyName,
            schedule_type: scheduleType,
            title: title,
            start_date: startDate,
            end_date: endDate,
            event_description: eventDescription,
            request_note: requestNote || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (result.count) {
            messageDiv.innerHTML = `<span style="color: #00b894;">${result.message || `${result.count}ê°œ í™”ì£¼ì‚¬ì—ê²Œ ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`}</span>`;
          } else {
            messageDiv.innerHTML = '<span style="color: #00b894;">ìŠ¤ì¼€ì¥´ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          resetAdminScheduleForm();
          toggleAdminScheduleForm(); // í¼ ì ‘ê¸°
          loadCalendarSchedules();
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ìŠ¤ì¼€ì¥´ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ìŠ¤ì¼€ì¥´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveAdminSchedule = saveAdminSchedule;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ í¼ ì´ˆê¸°í™”
    function resetAdminScheduleForm() {
      const companyInput = document.getElementById('adminScheduleCompanyInput');
      const companyHidden = document.getElementById('adminScheduleCompanyName');
      if (companyInput) companyInput.value = '';
      if (companyHidden) companyHidden.value = '';
      document.getElementById('adminScheduleType').value = '';
      document.getElementById('adminScheduleTitle').value = '';
      document.getElementById('adminScheduleStartDate').value = '';
      document.getElementById('adminScheduleEndDate').value = '';
      document.getElementById('adminScheduleEventDescription').value = '';
      document.getElementById('adminScheduleRequestNote').value = '';
      document.getElementById('adminScheduleMessage').innerHTML = '';
    }
    window.resetAdminScheduleForm = resetAdminScheduleForm;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ìš© í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ (ê²€ìƒ‰ ê°€ëŠ¥í•œ ë“œë¡­ë‹¤ìš´)
    async function loadCompaniesForSchedule() {
      const companyInput = document.getElementById('adminScheduleCompanyInput');
      const companyHidden = document.getElementById('adminScheduleCompanyName');
      const companyDropdown = document.getElementById('adminScheduleCompanyDropdown');
      
      if (!companyInput || !companyHidden || !companyDropdown) return;
      
      try {
        const response = await fetch('/api/auth/companies');
        const result = await response.json();
        
        if (result.success && result.companies) {
          // "ëª¨ë“  í™”ì£¼ì‚¬" ì¶”ê°€
          const allCompanies = [
            { company_name: 'ëª¨ë“  í™”ì£¼ì‚¬', role: 'special' },
            { company_name: 'ì œì´ì œì´', role: 'special' }
          ];
          
          // í™”ì£¼ì‚¬ë§Œ í•„í„°ë§ (ê´€ë¦¬ì ì œì™¸)
          const companies = result.companies.filter(company => company.role !== 'ê´€ë¦¬ì');
          const companyList = [...allCompanies, ...companies];
          
          // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
          function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
          }
          
          // ë“œë¡­ë‹¤ìš´ ì•„ì´í…œ ìƒì„± í•¨ìˆ˜
          function updateDropdown(filterText = '') {
            const filtered = companyList.filter(company => 
              company.company_name.toLowerCase().includes(filterText.toLowerCase())
            );
            
            if (filtered.length === 0) {
              companyDropdown.innerHTML = '<div class="sc-dropdown-item" style="color: #999; cursor: default;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            } else {
              companyDropdown.innerHTML = filtered.map(company => 
                `<div class="sc-dropdown-item" data-value="${escapeHtml(company.company_name)}">${escapeHtml(company.company_name)}</div>`
              ).join('');
            }
          }
          
          // ì´ˆê¸° ë“œë¡­ë‹¤ìš´ ìƒì„±
          updateDropdown();
          
          // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°ë¥¼ ìœ„í•´ í´ë¡ 
          const newInput = companyInput.cloneNode(true);
          companyInput.parentNode.replaceChild(newInput, companyInput);
          const newHidden = companyHidden.cloneNode(true);
          companyHidden.parentNode.replaceChild(newHidden, companyHidden);
          
          // ìƒˆë¡œìš´ ìš”ì†Œ ì°¸ì¡°
          const currentInput = document.getElementById('adminScheduleCompanyInput');
          const currentHidden = document.getElementById('adminScheduleCompanyName');
          const currentDropdown = document.getElementById('adminScheduleCompanyDropdown');
          
          // ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸° ìƒíƒœ ì¶”ì 
          let isDropdownOpen = false;
          let dropdownTimeout = null;
          
          // ë“œë¡­ë‹¤ìš´ ì—´ê¸° í•¨ìˆ˜
          const openDropdown = () => {
            if (dropdownTimeout) {
              clearTimeout(dropdownTimeout);
              dropdownTimeout = null;
            }
            updateDropdown(currentInput.value);
            currentDropdown.classList.add('show');
            isDropdownOpen = true;
          };
          
          // ë“œë¡­ë‹¤ìš´ ë‹«ê¸° í•¨ìˆ˜
          const closeDropdown = () => {
            if (dropdownTimeout) {
              clearTimeout(dropdownTimeout);
              dropdownTimeout = null;
            }
            currentDropdown.classList.remove('show');
            isDropdownOpen = false;
          };
          
          // ì…ë ¥ ì´ë²¤íŠ¸
          currentInput.addEventListener('input', (e) => {
            const value = e.target.value;
            currentHidden.value = value;
            updateDropdown(value);
            if (!isDropdownOpen) {
              openDropdown();
            }
          });
          
          // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸
          currentInput.addEventListener('focus', (e) => {
            e.stopPropagation();
            if (dropdownTimeout) {
              clearTimeout(dropdownTimeout);
            }
            dropdownTimeout = setTimeout(() => {
              openDropdown();
            }, 100);
          });
          
          // í´ë¦­ ì´ë²¤íŠ¸
          currentInput.addEventListener('click', (e) => {
            e.stopPropagation();
            if (dropdownTimeout) {
              clearTimeout(dropdownTimeout);
            }
            dropdownTimeout = setTimeout(() => {
              openDropdown();
            }, 100);
          });
          
          // ë“œë¡­ë‹¤ìš´ ì•„ì´í…œ í´ë¦­
          currentDropdown.addEventListener('click', (e) => {
            e.stopPropagation();
            const item = e.target.closest('.sc-dropdown-item');
            if (item && item.dataset.value) {
              currentInput.value = item.dataset.value;
              currentHidden.value = item.dataset.value;
              closeDropdown();
            }
          });
          
          // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
          const handleDocumentClick = (e) => {
            if (!currentInput.contains(e.target) && !currentDropdown.contains(e.target)) {
              setTimeout(() => {
                if (!currentInput.contains(document.activeElement)) {
                  closeDropdown();
                }
              }, 150);
            }
          };
          
          // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±°
          if (window.scheduleCompanyDropdownCloseHandler) {
            document.removeEventListener('mousedown', window.scheduleCompanyDropdownCloseHandler);
          }
          window.scheduleCompanyDropdownCloseHandler = handleDocumentClick;
          document.addEventListener('mousedown', handleDocumentClick);
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCompaniesForSchedule = loadCompaniesForSchedule;
    
    // ê´€ë¦¬ì ìŠ¤ì¼€ì¥´ ë“±ë¡ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleAdminScheduleForm() {
      const form = document.getElementById('addAdminScheduleForm');
      const icon = document.getElementById('addAdminScheduleIcon');
      
      if (form && icon) {
        if (form.style.display === 'none' || !form.style.display) {
          form.style.display = 'block';
          icon.textContent = 'â–²';
          // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
          loadCompaniesForSchedule();
        } else {
          form.style.display = 'none';
          icon.textContent = 'â–¼';
        }
      }
    }
    window.toggleAdminScheduleForm = toggleAdminScheduleForm;
    
    // ========== ìŠ¤ì¼€ì¤„ íƒ€ì… ê´€ë¦¬ í•¨ìˆ˜ë“¤ ==========
    
    // ìŠ¤ì¼€ì¤„ íƒ€ì… ê´€ë¦¬ì í† ê¸€
    function toggleScheduleTypeManager() {
      const manager = document.getElementById('scheduleTypeManager');
      if (manager) {
        const isHidden = manager.style.display === 'none' || !manager.style.display;
        manager.style.display = isHidden ? 'block' : 'none';
        if (isHidden) {
          loadScheduleTypes();
        }
      }
    }
    window.toggleScheduleTypeManager = toggleScheduleTypeManager;
    
    // ìŠ¤ì¼€ì¤„ íƒ€ì… ëª©ë¡ ë¡œë“œ
    async function loadScheduleTypes() {
      try {
        const response = await fetch('/api/schedules/types');
        const result = await response.json();
        
        if (result.success && result.data) {
          // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
          const select = document.getElementById('adminScheduleType');
          if (select) {
            select.innerHTML = '<option value="">íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”</option>' +
              result.data.map(type => 
                `<option value="${escapeHtml(type.name)}">${escapeHtml(type.name)}</option>`
              ).join('');
          }
          
          // íƒ€ì… ëª©ë¡ ì—…ë°ì´íŠ¸
          const typeList = document.getElementById('scheduleTypeList');
          if (typeList) {
            if (result.data.length === 0) {
              typeList.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">ë“±ë¡ëœ ìŠ¤ì¼€ì¤„ íƒ€ì…ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            } else {
              typeList.innerHTML = result.data.map(type => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f0f0f0;">
                  <span>${escapeHtml(type.name)}</span>
                  <button type="button" class="save-btn" onclick="deleteCustomScheduleType(${type.id}, '${escapeHtml(type.name)}')" style="padding: 4px 8px; font-size: 12px; background: #e74c3c;">ì‚­ì œ</button>
                </div>
              `).join('');
            }
          }
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¤„ íƒ€ì… ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadScheduleTypes = loadScheduleTypes;
    
    // ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€
    async function addCustomScheduleType() {
      const input = document.getElementById('scheduleTypeInput');
      if (!input) return;
      
      const typeName = input.value.trim();
      if (!typeName) {
        alert('ìŠ¤ì¼€ì¤„ íƒ€ì…ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      try {
        console.log('ğŸ“ [ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€] ìš”ì²­ ì‹œì‘:', typeName);
        
        const response = await fetch('/api/schedules/types', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: typeName,
            display_order: 0
          })
        });
        
        console.log('ğŸ“ [ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€] ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('ğŸ“ [ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€] ì‘ë‹µ ë°ì´í„°:', result);
        
        if (result.success) {
          input.value = '';
          loadScheduleTypes(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          alert('ìŠ¤ì¼€ì¤„ íƒ€ì…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          console.error('âŒ [ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€] ì‹¤íŒ¨:', result.message);
          alert(result.message || 'ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('âŒ [ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€] ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¤„ íƒ€ì… ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }
    window.addCustomScheduleType = addCustomScheduleType;
    
    // ìŠ¤ì¼€ì¤„ íƒ€ì… ì‚­ì œ
    async function deleteCustomScheduleType(typeId, typeName) {
      if (!confirm(`'${typeName}' íƒ€ì…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      try {
        const response = await fetch(`/api/schedules/types/${typeId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          loadScheduleTypes(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          alert('ìŠ¤ì¼€ì¤„ íƒ€ì…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          
          // í˜„ì¬ ì„ íƒëœ íƒ€ì…ì´ ì‚­ì œëœ íƒ€ì…ì´ë©´ ì´ˆê¸°í™”
          const select = document.getElementById('adminScheduleType');
          if (select && select.value === typeName) {
            select.value = '';
          }
        } else {
          alert(result.message || 'ìŠ¤ì¼€ì¤„ íƒ€ì… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ìŠ¤ì¼€ì¤„ íƒ€ì… ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ìŠ¤ì¼€ì¤„ íƒ€ì… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteCustomScheduleType = deleteCustomScheduleType;
    
    // HTML ì´ìŠ¤ì¼€ì´í”„ í—¬í¼ í•¨ìˆ˜
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ìŠ¤ì¼€ì¤„ í¼ ì—´ ë•Œ íƒ€ì… ëª©ë¡ë„ ë¡œë“œ
    const originalToggleAdminScheduleForm = toggleAdminScheduleForm;
    toggleAdminScheduleForm = function() {
      originalToggleAdminScheduleForm();
      const form = document.getElementById('addAdminScheduleForm');
      if (form && form.style.display !== 'none') {
        loadScheduleTypes();
      }
    };
    window.toggleAdminScheduleForm = toggleAdminScheduleForm;
    
    // ========== ê´€ë¦¬ì ë‹¬ë ¥ ë·° ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ë¡œë“œ
    async function loadCalendarSchedules() {
      const container = document.getElementById('calendarContainer');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      const listTableBody = document.getElementById('scheduleListTableBody');
      if (listTableBody) {
        listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      }
      
      try {
        const monthInput = document.getElementById('calendarMonthSelect');
        const month = monthInput ? monthInput.value : '';
        
        let url = '/api/schedules/calendar';
        if (month) {
          url += `?month=${encodeURIComponent(month)}`;
        }
        
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          renderCalendar(result.data, month);
          renderScheduleListTable(result.data);
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          const listTableBody = document.getElementById('scheduleListTableBody');
          if (listTableBody) {
            listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
          }
        }
      } catch (error) {
        console.error('ë‹¬ë ¥ ìŠ¤ì¼€ì¥´ ì¡°íšŒ ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        const listTableBody = document.getElementById('scheduleListTableBody');
        if (listTableBody) {
          listTableBody.innerHTML = '<tr><td colspan="8" class="no-data">ìŠ¤ì¼€ì¥´ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      }
    }
    window.loadCalendarSchedules = loadCalendarSchedules;
    
    // ìŠ¤ì¼€ì¤„ ë©”ëª¨ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
    async function loadScheduleMemos() {
      const memoSection = document.getElementById('scheduleMemoSection');
      const memoGrid = document.getElementById('scheduleMemoGrid');
      
      if (!memoSection || !memoGrid) return;
      
      // ê´€ë¦¬ìë§Œ ë©”ëª¨ ë¡œë“œ
      const roleNormalized = (currentRole || '').toString().trim();
      if (roleNormalized !== 'ê´€ë¦¬ì') {
        memoSection.style.display = 'none';
        return;
      }
      
      memoSection.style.display = 'block';
      
      // ìº˜ë¦°ë” ë°•ìŠ¤ì˜ ì‹¤ì œ ë„ˆë¹„ë¥¼ ì°¸ì¡°í•˜ì—¬ ë©”ëª¨ ì„¹ì…˜ ë„ˆë¹„ ì„¤ì •
      const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
      if (scheduleCalendarTab && scheduleCalendarTab.offsetWidth > 0) {
        // ìº˜ë¦°ë” ë°•ìŠ¤ ì°¾ê¸° (ë©”ëª¨ ì„¹ì…˜ì´ ì•„ë‹Œ ì²« ë²ˆì§¸ í°ìƒ‰ ë°•ìŠ¤)
        const calendarBox = scheduleCalendarTab.querySelector('div[style*="background: #ffffff"]:not(#scheduleMemoSection)');
        if (calendarBox && calendarBox.offsetWidth > 0) {
          const calendarComputedStyle = window.getComputedStyle(calendarBox);
          // ë©”ëª¨ ì„¹ì…˜ì— ìº˜ë¦°ë” ë°•ìŠ¤ì™€ ë™ì¼í•œ ë„ˆë¹„ ì ìš©
          memoSection.style.width = calendarComputedStyle.width;
          memoSection.style.maxWidth = calendarComputedStyle.maxWidth || 'none';
          memoSection.style.minWidth = '0';
          memoSection.style.boxSizing = 'border-box';
          // ê°•ì œë¡œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°
          void memoSection.offsetWidth;
        } else {
          // ìº˜ë¦°ë” ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë©´ íƒ­ ë„ˆë¹„ ì‚¬ìš©
          memoSection.style.width = scheduleCalendarTab.offsetWidth + 'px';
          memoSection.style.maxWidth = '100%';
          memoSection.style.boxSizing = 'border-box';
          memoSection.style.minWidth = '0';
          void memoSection.offsetWidth;
        }
      } else {
        // íƒ­ì´ ì•„ì§ ë Œë”ë§ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš© í›„ ì¬ì‹œë„
        memoSection.style.width = '100%';
        memoSection.style.maxWidth = '100%';
        memoSection.style.boxSizing = 'border-box';
        memoSection.style.minWidth = '0';
        // ì•½ê°„ì˜ ì§€ì—° í›„ ë‹¤ì‹œ ì‹œë„
        setTimeout(() => {
          const scheduleCalendarTab = document.getElementById('scheduleCalendarTab');
          if (scheduleCalendarTab && scheduleCalendarTab.offsetWidth > 0) {
            const calendarBox = scheduleCalendarTab.querySelector('div[style*="background: #ffffff"]:not(#scheduleMemoSection)');
            if (calendarBox && calendarBox.offsetWidth > 0) {
              const calendarComputedStyle = window.getComputedStyle(calendarBox);
              memoSection.style.width = calendarComputedStyle.width;
              memoSection.style.maxWidth = calendarComputedStyle.maxWidth || 'none';
              void memoSection.offsetWidth;
            }
          }
        }, 200);
      }
      
      // ì´ˆê¸° ê·¸ë¦¬ë“œ êµ¬ì¡° ì„¤ì • (15ê°œ ë¹ˆ ì¹´ë“œ) - ì²˜ìŒë¶€í„° ë„“ê²Œ í‘œì‹œ
      const initialCards = [];
      for (let i = 0; i < 15; i++) {
        initialCards.push(`
          <div class="schedule-memo-card-empty" onclick="openScheduleMemoCreateModal()" style="background: #f8f9fa; border: 2px dashed #ffeaa7; border-radius: 12px; padding: 10px; cursor: pointer; transition: all 0.3s ease; height: 70px; display: flex; align-items: center; justify-content: center; text-align: center; color: #999; box-sizing: border-box;">
            <div>
              <div style="font-size: 20px; margin-bottom: 4px;">â•</div>
              <div style="font-size: 11px; font-weight: 600;">ë©”ëª¨ ì‘ì„±</div>
            </div>
          </div>
        `);
      }
      memoGrid.innerHTML = initialCards.join('');
      
      // ê°•ì œë¡œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° (ë„ˆë¹„ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ë„ë¡)
      void memoSection.offsetWidth;
      
      try {
        const headers = {
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch('/api/schedules/admin-memo', {
          credentials: 'include',
          headers: headers
        });
        
        const result = await response.json();
        
        if (result.success) {
          renderScheduleMemoGrid(result.data || []);
        } else {
          memoGrid.innerHTML = `<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #e74c3c;">${result.message || 'ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}</div>`;
        }
      } catch (error) {
        console.error('ë©”ëª¨ ë¡œë“œ ì˜¤ë¥˜:', error);
        memoGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #e74c3c;">ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    window.loadScheduleMemos = loadScheduleMemos;
    
    // ìŠ¤ì¼€ì¤„ ë©”ëª¨ ê·¸ë¦¬ë“œ ë Œë”ë§ í•¨ìˆ˜
    function renderScheduleMemoGrid(memos) {
      const memoGrid = document.getElementById('scheduleMemoGrid');
      if (!memoGrid) return;
      
      const maxCards = 15; // 5x3 = 15ê°œ
      const memoCards = [];
      
      // ê¸°ì¡´ ë©”ëª¨ ì¹´ë“œ ìƒì„±
      memos.slice(0, maxCards).forEach(memo => {
        const title = (memo.title || '').trim();
        const companyName = (memo.company_name || '').trim();
        const updatedAt = memo.updated_at ? (memo.updated_at.split(' ')[0] || '') : '';
        
        memoCards.push(`
          <div class="schedule-memo-card" onclick="showScheduleMemoDetail(${memo.id})" style="background: linear-gradient(135deg, #fffef9 0%, #ffffff 100%); border: 2px solid #ffeaa7; border-radius: 12px; padding: 10px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1); height: 70px; display: flex; flex-direction: column; justify-content: space-between; overflow: hidden; box-sizing: border-box;">
            <div style="flex: 1; overflow: hidden; min-height: 0; display: flex; align-items: center;">
              <div style="font-weight: 700; font-size: 14px; color: #ff6b35; word-break: break-word; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; width: 100%;">${escapeHtml(title)}</div>
            </div>
            <div style="font-size: 9px; color: #999; flex-shrink: 0; margin-top: 4px;">${updatedAt}</div>
          </div>
        `);
      });
      
      // ë¹ˆ ì¹´ë“œ ìƒì„± (ë©”ëª¨ ì‘ì„± ë²„íŠ¼)
      for (let i = memos.length; i < maxCards; i++) {
        memoCards.push(`
          <div class="schedule-memo-card-empty" onclick="openScheduleMemoCreateModal()" style="background: #f8f9fa; border: 2px dashed #ffeaa7; border-radius: 12px; padding: 10px; cursor: pointer; transition: all 0.3s ease; height: 70px; display: flex; align-items: center; justify-content: center; text-align: center; color: #999; box-sizing: border-box;">
            <div>
              <div style="font-size: 20px; margin-bottom: 4px;">â•</div>
              <div style="font-size: 11px; font-weight: 600;">ë©”ëª¨ ì‘ì„±</div>
            </div>
          </div>
        `);
      }
      
      memoGrid.innerHTML = memoCards.join('');
      
      // ê°•ì œë¡œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° (ë„ˆë¹„ê°€ ì œëŒ€ë¡œ ì ìš©ë˜ë„ë¡)
      const memoSection = document.getElementById('scheduleMemoSection');
      if (memoSection) {
        memoSection.style.width = '100%';
        memoSection.style.maxWidth = '100%';
        memoSection.style.boxSizing = 'border-box';
        memoSection.style.minWidth = '0';
        // ê°•ì œë¡œ ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚°
        void memoSection.offsetWidth;
        void memoGrid.offsetWidth;
        
        // ê·¸ë¦¬ë“œ ë„ˆë¹„ë„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •
        memoGrid.style.width = '100%';
        memoGrid.style.maxWidth = '100%';
        memoGrid.style.minWidth = '0';
      }
    }
    
    // ë©”ëª¨ ì‘ì„± ëª¨ë‹¬ ì—´ê¸°
    function openScheduleMemoCreateModal() {
      const modal = document.getElementById('scheduleMemoCreateModal');
      const form = document.getElementById('scheduleMemoCreateForm');
      if (modal && form) {
        form.reset();
        document.getElementById('scheduleMemoCreateMessage').innerHTML = '';
        initScheduleMemoCompanyDropdown('create');
        modal.style.display = 'block';
      }
    }
    window.openScheduleMemoCreateModal = openScheduleMemoCreateModal;
    
    // ë©”ëª¨ ì‘ì„± ëª¨ë‹¬ ë‹«ê¸°
    function closeScheduleMemoCreateModal() {
      const modal = document.getElementById('scheduleMemoCreateModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }
    window.closeScheduleMemoCreateModal = closeScheduleMemoCreateModal;
    
    // ë©”ëª¨ ì‘ì„± ì €ì¥
    async function saveScheduleMemoCreate() {
      const title = document.getElementById('scheduleMemoCreateTitle')?.value.trim();
      const companyName = document.getElementById('scheduleMemoCreateCompanyName')?.value.trim() || '';
      const content = document.getElementById('scheduleMemoCreateContent')?.value.trim();
      const messageEl = document.getElementById('scheduleMemoCreateMessage');
      
      if (!title || !content) {
        if (messageEl) {
          messageEl.innerHTML = '<span style="color: #e74c3c;">ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (messageEl) {
        messageEl.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      try {
        const headers = {
          'Content-Type': 'application/json',
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch('/api/schedules/admin-memo', {
          method: 'POST',
          credentials: 'include',
          headers: headers,
          body: JSON.stringify({
            title: title,
            company_name: companyName,
            content: content
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageEl) {
            messageEl.innerHTML = '<span style="color: #00b894;">âœ… ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          setTimeout(() => {
            closeScheduleMemoCreateModal();
            loadScheduleMemos();
          }, 500);
        } else {
          if (messageEl) {
            messageEl.innerHTML = `<span style="color: #e74c3c;">âŒ ${result.message || 'ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('ë©”ëª¨ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageEl) {
          messageEl.innerHTML = '<span style="color: #e74c3c;">âŒ ë©”ëª¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.saveScheduleMemoCreate = saveScheduleMemoCreate;
    
    // ë©”ëª¨ ìƒì„¸ë³´ê¸°
    async function showScheduleMemoDetail(memoId) {
      const modal = document.getElementById('scheduleMemoDetailModal');
      if (!modal) return;
      
      try {
        const headers = {
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch(`/api/schedules/admin-memo/${memoId}`, {
          credentials: 'include',
          headers: headers
        });
        
        const result = await response.json();
        
        if (result.success && result.data) {
          const memo = result.data;
          document.getElementById('scheduleMemoEditId').value = memo.id;
          document.getElementById('scheduleMemoDetailTitle').textContent = memo.title || '';
          document.getElementById('scheduleMemoDetailCompany').textContent = memo.company_name || 'ì „ì²´';
          document.getElementById('scheduleMemoDetailContent').textContent = memo.content || '';
          
          const infoText = [];
          if (memo.updated_at) {
            infoText.push(`ìˆ˜ì •: ${memo.updated_at}`);
          }
          if (memo.updated_by) {
            infoText.push(`ì‘ì„±ì: ${memo.updated_by}`);
          }
          document.getElementById('scheduleMemoDetailInfo').textContent = infoText.join(' | ');
          
          showScheduleMemoDetailView();
          modal.style.display = 'block';
        } else {
          alert(result.message || 'ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë©”ëª¨ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.showScheduleMemoDetail = showScheduleMemoDetail;
    
    // ë©”ëª¨ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸°
    function closeScheduleMemoDetailModal() {
      const modal = document.getElementById('scheduleMemoDetailModal');
      if (modal) {
        modal.style.display = 'none';
        showScheduleMemoDetailView();
      }
    }
    window.closeScheduleMemoDetailModal = closeScheduleMemoDetailModal;
    
    // ë©”ëª¨ ìƒì„¸ë³´ê¸° ë·° í‘œì‹œ
    function showScheduleMemoDetailView() {
      document.getElementById('scheduleMemoDetailView').style.display = 'block';
      document.getElementById('scheduleMemoEditView').style.display = 'none';
    }
    window.showScheduleMemoDetailView = showScheduleMemoDetailView;
    
    // ë©”ëª¨ ìˆ˜ì • í¼ í‘œì‹œ
    async function showScheduleMemoEditForm() {
      const memoId = document.getElementById('scheduleMemoEditId')?.value;
      if (!memoId) return;
      
      try {
        const headers = {
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch(`/api/schedules/admin-memo/${memoId}`, {
          credentials: 'include',
          headers: headers
        });
        
        const result = await response.json();
        
        if (result.success && result.data) {
          const memo = result.data;
          document.getElementById('scheduleMemoEditTitle').value = memo.title || '';
          document.getElementById('scheduleMemoEditCompanyInput').value = memo.company_name || '';
          document.getElementById('scheduleMemoEditCompanyName').value = memo.company_name || '';
          document.getElementById('scheduleMemoEditContent').value = memo.content || '';
          
          initScheduleMemoCompanyDropdown('edit');
          
          document.getElementById('scheduleMemoDetailView').style.display = 'none';
          document.getElementById('scheduleMemoEditView').style.display = 'block';
        }
      } catch (error) {
        console.error('ë©”ëª¨ ìˆ˜ì • í¼ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.showScheduleMemoEditForm = showScheduleMemoEditForm;
    
    // ë©”ëª¨ ìˆ˜ì • ì €ì¥
    async function saveScheduleMemoEdit() {
      const memoId = document.getElementById('scheduleMemoEditId')?.value;
      const title = document.getElementById('scheduleMemoEditTitle')?.value.trim();
      const companyName = document.getElementById('scheduleMemoEditCompanyName')?.value.trim() || '';
      const content = document.getElementById('scheduleMemoEditContent')?.value.trim();
      const messageEl = document.getElementById('scheduleMemoEditMessage');
      
      if (!memoId || !title || !content) {
        if (messageEl) {
          messageEl.innerHTML = '<span style="color: #e74c3c;">ì œëª©ê³¼ ë‚´ìš©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (messageEl) {
        messageEl.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      try {
        const headers = {
          'Content-Type': 'application/json',
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch(`/api/schedules/admin-memo/${memoId}`, {
          method: 'PUT',
          credentials: 'include',
          headers: headers,
          body: JSON.stringify({
            title: title,
            company_name: companyName,
            content: content
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageEl) {
            messageEl.innerHTML = '<span style="color: #00b894;">âœ… ë©”ëª¨ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          setTimeout(() => {
            closeScheduleMemoDetailModal();
            loadScheduleMemos();
          }, 500);
        } else {
          if (messageEl) {
            messageEl.innerHTML = `<span style="color: #e74c3c;">âŒ ${result.message || 'ë©”ëª¨ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('ë©”ëª¨ ìˆ˜ì • ì˜¤ë¥˜:', error);
        if (messageEl) {
          messageEl.innerHTML = '<span style="color: #e74c3c;">âŒ ë©”ëª¨ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.saveScheduleMemoEdit = saveScheduleMemoEdit;
    
    // ë©”ëª¨ ì‚­ì œ
    async function deleteScheduleMemo() {
      const memoId = document.getElementById('scheduleMemoEditId')?.value;
      if (!memoId) return;
      
      if (!confirm('ì •ë§ ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const headers = {
          'X-User-Role': encodeURIComponent(currentRole || ''),
          'X-User-Name': encodeURIComponent(currentUsername || ''),
          'X-Company-Name': encodeURIComponent(currentCompany || '')
        };
        
        const response = await fetch(`/api/schedules/admin-memo/${memoId}`, {
          method: 'DELETE',
          credentials: 'include',
          headers: headers
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ë©”ëª¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          closeScheduleMemoDetailModal();
          loadScheduleMemos();
        } else {
          alert(result.message || 'ë©”ëª¨ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë©”ëª¨ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ë©”ëª¨ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteScheduleMemo = deleteScheduleMemo;
    
    // í™”ì£¼ì‚¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    async function initScheduleMemoCompanyDropdown(mode) {
      const inputId = mode === 'create' ? 'scheduleMemoCreateCompanyInput' : 'scheduleMemoEditCompanyInput';
      const hiddenId = mode === 'create' ? 'scheduleMemoCreateCompanyName' : 'scheduleMemoEditCompanyName';
      const dropdownId = mode === 'create' ? 'scheduleMemoCreateCompanyDropdown' : 'scheduleMemoEditCompanyDropdown';
      
      try {
        const response = await fetch('/api/auth/companies', {
          credentials: 'include'
        });
        const result = await response.json();
        
        if (result.success && result.companies) {
          const companies = result.companies.map(c => c.company_name).filter(c => c && c !== 'ê´€ë¦¬ì');
          const input = document.getElementById(inputId);
          const hidden = document.getElementById(hiddenId);
          const dropdown = document.getElementById(dropdownId);
          
          if (input && hidden && dropdown) {
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°ë¥¼ ìœ„í•´ ìš”ì†Œ ë³µì œ
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);
            const newHidden = hidden.cloneNode(true);
            hidden.parentNode.replaceChild(newHidden, hidden);
            
            const currentInput = document.getElementById(inputId);
            const currentHidden = document.getElementById(hiddenId);
            const currentDropdown = document.getElementById(dropdownId);
            
            let isOpen = false;
            let closeTimeout = null;
            
            const updateDropdown = (filterText = '') => {
              const filtered = companies.filter(c => 
                c.toLowerCase().includes(filterText.toLowerCase())
              );
              
              if (filtered.length === 0) {
                currentDropdown.innerHTML = '<div class="sc-dropdown-item" style="color: #999; cursor: default;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
              } else {
                currentDropdown.innerHTML = filtered.map(name => 
                  `<div class="sc-dropdown-item" data-value="${escapeHtml(name)}">${escapeHtml(name)}</div>`
                ).join('');
              }
            };
            
            const openDropdown = () => {
              clearTimeout(closeTimeout);
              updateDropdown(currentInput.value);
              currentDropdown.classList.add('show');
              isOpen = true;
            };
            
            const scheduleClose = () => {
              clearTimeout(closeTimeout);
              closeTimeout = setTimeout(() => {
                currentDropdown.classList.remove('show');
                isOpen = false;
              }, 120);
            };
            
            currentInput.addEventListener('input', (e) => {
              currentHidden.value = e.target.value;
              updateDropdown(e.target.value);
              if (!isOpen) openDropdown();
            });
            
            ['focus', 'click'].forEach(evt => {
              currentInput.addEventListener(evt, () => {
                clearTimeout(closeTimeout);
                openDropdown();
              });
            });
            
            currentDropdown.addEventListener('click', (e) => {
              const item = e.target.closest('.sc-dropdown-item');
              if (!item || !item.dataset.value) return;
              currentInput.value = item.dataset.value;
              currentHidden.value = item.dataset.value;
              currentDropdown.classList.remove('show');
              isOpen = false;
            });
            
            document.addEventListener('mousedown', (e) => {
              if (!currentInput.contains(e.target) && !currentDropdown.contains(e.target)) {
                scheduleClose();
              }
            });
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // í™”ì£¼ì‚¬ë³„ ìƒ‰ìƒ í• ë‹¹ í•¨ìˆ˜
    function getCompanyColor(companyName) {
      // ë‹¤ì–‘í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
      const colorPalette = [
        { start: '#ff6b35', end: '#feca57' }, // ì˜¤ë Œì§€-ë…¸ë‘
        { start: '#6c5ce7', end: '#a29bfe' }, // ë³´ë¼
        { start: '#00b894', end: '#00cec9' }, // ì²­ë¡
        { start: '#e17055', end: '#fdcb6e' }, // ì½”ë„-ë…¸ë‘
        { start: '#0984e3', end: '#74b9ff' }, // íŒŒë‘
        { start: '#d63031', end: '#ff7675' }, // ë¹¨ê°•
        { start: '#00b894', end: '#55efc4' }, // ë¯¼íŠ¸
        { start: '#fdcb6e', end: '#ffeaa7' }, // ë…¸ë‘
        { start: '#e84393', end: '#fd79a8' }, // í•‘í¬
        { start: '#00b894', end: '#6c5ce7' }, // ì²­ë¡-ë³´ë¼
        { start: '#f39c12', end: '#f1c40f' }, // ì£¼í™©-ë…¸ë‘
        { start: '#16a085', end: '#1abc9c' }, // ì²­ë¡
        { start: '#8e44ad', end: '#9b59b6' }, // ë³´ë¼
        { start: '#c0392b', end: '#e74c3c' }, // ë¹¨ê°•
        { start: '#2980b9', end: '#3498db' }, // íŒŒë‘
      ];
      
      if (!companyName) return colorPalette[0];
      
      // í™”ì£¼ì‚¬ëª…ì„ ê¸°ë°˜ìœ¼ë¡œ ìƒ‰ìƒ ì¸ë±ìŠ¤ ê²°ì • (ì¼ê´€ì„± ìœ ì§€)
      let hash = 0;
      for (let i = 0; i < companyName.length; i++) {
        hash = companyName.charCodeAt(i) + ((hash << 5) - hash);
      }
      const index = Math.abs(hash) % colorPalette.length;
      return colorPalette[index];
    }
    window.getCompanyColor = getCompanyColor;
    
    // ë‹¬ë ¥ ë Œë”ë§
    function renderCalendar(schedules, month) {
      const container = document.getElementById('calendarContainer');
      if (!container) return;
      
      // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
      if (!window.scheduleModalData) {
        window.scheduleModalData = {};
      }
      
      // ì›” ì„¤ì •
      let currentDate;
      if (month) {
        const [year, monthNum] = month.split('-');
        currentDate = new Date(parseInt(year), parseInt(monthNum) - 1, 1);
      } else {
        currentDate = new Date();
        currentDate.setDate(1);
      }
      
      const year = currentDate.getFullYear();
      const monthNum = currentDate.getMonth();
      const firstDay = new Date(year, monthNum, 1);
      const lastDay = new Date(year, monthNum + 1, 0);
      const daysInMonth = lastDay.getDate();
      const startingDayOfWeek = firstDay.getDay();
      
      // ë‚ ì§œë³„ë¡œ ìŠ¤ì¼€ì¥´ ê·¸ë£¹í™” (schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬"ì¸ ê²½ìš° ì¤‘ë³µ ì œê±°)
      const schedulesByDate = {};
      const allCompaniesScheduleKeys = new Set(); // ëª¨ë“ í™”ì£¼ì‚¬ ìŠ¤ì¼€ì¤„ ì¶”ì ìš© (ê°™ì€ ì œëª©, ê°™ì€ ë‚ ì§œ ë²”ìœ„ë©´ 1ê°œë§Œ ìœ ì§€)
      
      // ë¨¼ì € "ëª¨ë“ í™”ì£¼ì‚¬" ìŠ¤ì¼€ì¤„ì„ í•„í„°ë§í•˜ì—¬ ì¤‘ë³µ ì œê±°
      const processedSchedules = [];
      const allCompaniesSchedulesMap = new Map(); // key -> schedule ë§¤í•‘
      
      schedules.forEach(schedule => {
        // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬"ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° (company_nameì´ ë¬´ì—‡ì´ë“  ìƒê´€ì—†ì´)
        const isAllCompaniesSchedule = schedule.schedule_type && 
                                       (schedule.schedule_type.startsWith('ëª¨ë“ í™”ì£¼ì‚¬') || schedule.schedule_type === 'ëª¨ë“ í™”ì£¼ì‚¬');
        
        if (isAllCompaniesSchedule) {
          // ê°™ì€ ì œëª©, ê°™ì€ ì‹œì‘ì¼, ê°™ì€ ì¢…ë£Œì¼ì¸ ê²½ìš° ì¤‘ë³µ ì œê±°
          // ìº˜ë¦°ë”ì—ëŠ” "ì œì´ì œì´(íƒ€ì…)" í˜•ì‹ìœ¼ë¡œ 1ê°œë§Œ í‘œì‹œ
          const key = `${schedule.title}_${schedule.start_date}_${schedule.end_date}`;
          if (!allCompaniesSchedulesMap.has(key)) {
            // ìº˜ë¦°ë” í‘œì‹œìš©ìœ¼ë¡œ company_nameì„ "ì œì´ì œì´"ë¡œ ë³€ê²½
            const displaySchedule = {...schedule};
            displaySchedule.company_name = 'ì œì´ì œì´';
            allCompaniesSchedulesMap.set(key, displaySchedule);
            processedSchedules.push(displaySchedule);
          }
        } else {
          // ì¼ë°˜ ìŠ¤ì¼€ì¤„ì€ ëª¨ë‘ ì¶”ê°€
          processedSchedules.push(schedule);
        }
      });
      
      // ì¤‘ë³µ ì œê±°ëœ ìŠ¤ì¼€ì¤„ë“¤ì„ ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
      processedSchedules.forEach(schedule => {
        const start = new Date(schedule.start_date);
        const end = new Date(schedule.end_date);
        const current = new Date(start);
        
        while (current <= end) {
          const dateKey = current.toISOString().split('T')[0];
          if (!schedulesByDate[dateKey]) {
            schedulesByDate[dateKey] = [];
          }
          schedulesByDate[dateKey].push(schedule);
          current.setDate(current.getDate() + 1);
        }
      });
      
      // ë‹¬ë ¥ HTML ìƒì„±
      const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
      const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      
      let html = `
        <div style="background: #ffffff; border-radius: 14px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <h4 style="text-align: center; margin-bottom: 20px; color: #ff6b35; font-size: 24px; font-weight: 700;">
            ${year}ë…„ ${monthNames[monthNum]}
          </h4>
          <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
      `;
      
      // ìš”ì¼ í—¤ë”
      dayNames.forEach(day => {
        html += `
          <div style="text-align: center; padding: 12px; font-weight: 700; color: ${day === 'ì¼' ? '#e74c3c' : day === 'í† ' ? '#3498db' : '#2d3436'}; background: #fff9e6; border-radius: 8px;">
            ${day}
          </div>
        `;
      });
      
      // ë¹ˆ ì¹¸ (ì²« ì£¼ ì‹œì‘ì¼ ì „)
      for (let i = 0; i < startingDayOfWeek; i++) {
        html += '<div style="min-height: 100px; background: #f8f9fa; border-radius: 8px;"></div>';
      }
      
      // ë‚ ì§œ ì¹¸
      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${String(monthNum + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const daySchedules = schedulesByDate[dateKey] || [];
        const isToday = new Date().toDateString() === new Date(year, monthNum, day).toDateString();
        
        // ìŠ¤ì¼€ì¥´ ë°ì´í„°ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©)
        window.scheduleModalData[dateKey] = daySchedules;
        
        html += `
          <div style="min-height: 100px; background: ${isToday ? '#fff9e6' : '#ffffff'}; border: 2px solid ${isToday ? '#ff6b35' : '#ffeaa7'}; border-radius: 8px; padding: 8px; cursor: pointer; transition: all 0.2s;" 
               onclick="showScheduleModal('${dateKey}', '')">
            <div style="font-weight: 700; margin-bottom: 6px; color: ${isToday ? '#ff6b35' : '#2d3436'};">
              ${day}
            </div>
            <div style="display: flex; flex-direction: column; gap: 4px;">
        `;
        
        // ìŠ¤ì¼€ì¥´ í‘œì‹œ (ìµœëŒ€ 5ê°œ)
        daySchedules.slice(0, 5).forEach((schedule, idx) => {
          const companyName = escapeHtml(schedule.company_name || '');
          let scheduleType = escapeHtml(schedule.schedule_type || '');
          const title = escapeHtml(schedule.title || '');
          const color = getCompanyColor(schedule.company_name);
          
          // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬-"ë¡œ ì‹œì‘í•˜ë©´ ì ‘ë‘ì‚¬ ì œê±° (ì˜ˆ: "ëª¨ë“ í™”ì£¼ì‚¬-ì…ê³ " â†’ "ì…ê³ ")
          if (scheduleType.startsWith('ëª¨ë“ í™”ì£¼ì‚¬-')) {
            scheduleType = scheduleType.replace('ëª¨ë“ í™”ì£¼ì‚¬-', '');
          }
          
          // "í™”ì£¼ì‚¬ì´ë¦„(íƒ€ì…)" í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
          const displayText = scheduleType ? `${companyName}(${scheduleType})` : companyName;
          html += `
            <div style="background: linear-gradient(135deg, ${color.start} 0%, ${color.end} 100%); color: white; padding: 4px 6px; border-radius: 4px; font-size: 11px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" 
                 title="${displayText}: ${title}">
              ${displayText.length > 12 ? displayText.substring(0, 12) + '...' : displayText}
            </div>
          `;
        });
        
        if (daySchedules.length > 5) {
          html += `<div style="font-size: 10px; color: #636e72; text-align: center;">+${daySchedules.length - 5}ê°œ</div>`;
        }
        
        html += `
            </div>
          </div>
        `;
      }
      
      html += `
          </div>
        </div>
      `;
      
      container.innerHTML = html;
    }
    window.renderCalendar = renderCalendar;
    
    // ìŠ¤ì¼€ì¥´ ëª©ë¡ í…Œì´ë¸” ë Œë”ë§
    function renderScheduleListTable(schedules) {
      const tbody = document.getElementById('scheduleListTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      if (!schedules || schedules.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="no-data">ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        // í†µê³„ ì—…ë°ì´íŠ¸
        const statisticsSpan = document.getElementById('schedulesStatistics');
        if (statisticsSpan) {
          statisticsSpan.textContent = '(ì´ 0ê°œ)';
        }
        return;
      }
      
      // "ëª¨ë“ í™”ì£¼ì‚¬" íƒ€ì… ìŠ¤ì¼€ì¤„ ì¤‘ë³µ ì œê±° (ê°™ì€ ì œëª©, ê°™ì€ ë‚ ì§œ ë²”ìœ„ë©´ 1ê°œë§Œ í‘œì‹œ)
      const uniqueSchedules = [];
      const allCompaniesScheduleKeys = new Set(); // ëª¨ë“ í™”ì£¼ì‚¬ ìŠ¤ì¼€ì¤„ ì¶”ì ìš©
      
      schedules.forEach(schedule => {
        // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬"ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ì¤‘ë³µ ì œê±°
        if (schedule.schedule_type && (schedule.schedule_type.startsWith('ëª¨ë“ í™”ì£¼ì‚¬') || schedule.schedule_type === 'ëª¨ë“ í™”ì£¼ì‚¬')) {
          // ê°™ì€ ì œëª©, ê°™ì€ ì‹œì‘ì¼, ê°™ì€ ì¢…ë£Œì¼ì¸ ê²½ìš° ì¤‘ë³µ ì œê±°
          // ëª©ë¡ì—ëŠ” "ì œì´ì œì´(íƒ€ì…)" í˜•ì‹ìœ¼ë¡œ 1ê°œë§Œ í‘œì‹œ
          const key = `${schedule.title}_${schedule.start_date}_${schedule.end_date}`;
          if (!allCompaniesScheduleKeys.has(key)) {
            allCompaniesScheduleKeys.add(key);
            // ìº˜ë¦°ë” í‘œì‹œìš©ìœ¼ë¡œ company_nameì„ "ì œì´ì œì´"ë¡œ ë³€ê²½
            const displaySchedule = {...schedule};
            displaySchedule.company_name = 'ì œì´ì œì´';
            uniqueSchedules.push(displaySchedule);
          }
        } else {
          // ì¼ë°˜ ìŠ¤ì¼€ì¤„ì€ ëª¨ë‘ ì¶”ê°€
          uniqueSchedules.push(schedule);
        }
      });
      
      // í†µê³„ ì—…ë°ì´íŠ¸ (ì¤‘ë³µ ì œê±°ëœ ê°œìˆ˜ë¡œ í‘œì‹œ)
      const statisticsSpan = document.getElementById('schedulesStatistics');
      if (statisticsSpan) {
        statisticsSpan.textContent = `(ì´ ${uniqueSchedules.length}ê°œ)`;
      }
      
      // ì‹œì‘ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
      const sortedSchedules = [...uniqueSchedules].sort((a, b) => {
        const dateA = new Date(a.start_date);
        const dateB = new Date(b.start_date);
        return dateB - dateA;
      });
      
      sortedSchedules.forEach(schedule => {
        const tr = document.createElement('tr');
        
        // ë‚ ì§œ í¬ë§·íŒ…
        const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '-';
        const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '-';
        const createdAt = schedule.created_at ? new Date(schedule.created_at).toLocaleDateString('ko-KR') : '-';
        
        // í–‰ì‚¬ ë‚´ìš©ê³¼ ìš”ì²­ì‚¬í•­ì€ ê¸¸ì´ ì œí•œ
        const eventDescription = schedule.event_description || '';
        const requestNote = schedule.request_note || '';
        const eventDescriptionShort = eventDescription.length > 50 ? eventDescription.substring(0, 50) + '...' : eventDescription;
        const requestNoteShort = requestNote.length > 50 ? requestNote.substring(0, 50) + '...' : requestNote;
        
        // ì‚­ì œ ë²„íŠ¼ (ID í™•ì¸ ë° ë””ë²„ê¹…)
        const scheduleId = schedule.id;
        
        // ID ë””ë²„ê¹… (ëª¨ë“  ìŠ¤ì¼€ì¤„)
        if (!scheduleId || scheduleId === null || scheduleId === undefined) {
          console.error('âŒ ìŠ¤ì¼€ì¤„ IDê°€ ì—†ìŠµë‹ˆë‹¤:', {
            id: scheduleId,
            type: typeof scheduleId,
            schedule_keys: Object.keys(schedule),
            full_schedule: schedule
          });
        }
        
        // ê´€ë¦¬ì ëª¨ë“œ í™•ì¸
        const roleNormalized = (typeof currentRole !== 'undefined' ? currentRole : '').toString().trim();
        const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
        
        // ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
        let actionButtons = '';
        if (isAdmin) {
          if (scheduleId && scheduleId !== null && scheduleId !== undefined) {
            actionButtons = `
              <div style="display: flex; gap: 6px; justify-content: center;">
                <button class="save-btn" onclick="editSchedule(${scheduleId})" 
                        style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(116, 185, 255, 0.25);">
                  âœï¸ ìˆ˜ì •
                </button>
                <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\nì‚­ì œëœ ìŠ¤ì¼€ì¥´ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) deleteSchedule(${scheduleId})" 
                        style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(231, 76, 60, 0.25);">
                  ğŸ—‘ï¸ ì‚­ì œ
                </button>
              </div>
            `;
          } else {
            actionButtons = `
              <div style="display: flex; gap: 6px; justify-content: center;">
                <button disabled style="background: #95a5a6; color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; cursor: not-allowed; opacity: 0.6;">
                  ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€ (ID ì—†ìŒ)
                </button>
              </div>
            `;
          }
        } else {
          // í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œëŠ” ë²„íŠ¼ ì—†ìŒ
          actionButtons = '<span style="color: #999;">-</span>';
        }
        
        // í™”ì£¼ì‚¬ì´ë¦„(íƒ€ì…) í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
        const companyName = escapeHtml(schedule.company_name || '');
        let scheduleType = escapeHtml(schedule.schedule_type || '');
        
        // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬-"ë¡œ ì‹œì‘í•˜ë©´ ì ‘ë‘ì‚¬ ì œê±° (ì˜ˆ: "ëª¨ë“ í™”ì£¼ì‚¬-ì…ê³ " â†’ "ì…ê³ ")
        if (scheduleType.startsWith('ëª¨ë“ í™”ì£¼ì‚¬-')) {
          scheduleType = scheduleType.replace('ëª¨ë“ í™”ì£¼ì‚¬-', '');
        }
        
        const companyDisplay = scheduleType ? `${companyName}(${scheduleType})` : companyName;
        
        tr.innerHTML = `
          <td>${companyDisplay}</td>
          <td>${escapeHtml(schedule.title || '')}</td>
          <td>${startDate}</td>
          <td>${endDate}</td>
          <td style="max-width: 300px; word-wrap: break-word;" title="${escapeHtml(eventDescription)}">${escapeHtml(eventDescriptionShort)}</td>
          <td style="max-width: 200px; word-wrap: break-word;" title="${escapeHtml(requestNote)}">${escapeHtml(requestNoteShort || '-')}</td>
          <td>${createdAt}</td>
          <td style="text-align: center;">${actionButtons}</td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    window.renderScheduleListTable = renderScheduleListTable;
    
    // ìŠ¤ì¼€ì¥´ ë°ì´í„° ì €ì¥ìš© ì „ì—­ ë³€ìˆ˜ (ë‚ ì§œë³„ ìŠ¤ì¼€ì¥´ ì €ì¥)
    window.scheduleModalData = {};
    
    // ìŠ¤ì¼€ì¥´ ëª¨ë‹¬ í‘œì‹œ
    function showScheduleModal(date, schedulesJson) {
      const dateObj = new Date(date);
      const dateStr = `${dateObj.getFullYear()}ë…„ ${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;
      
      // ì „ì—­ ë³€ìˆ˜ì—ì„œ ìŠ¤ì¼€ì¥´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë” ì•ˆì „í•œ ë°©ë²•)
      let schedules = window.scheduleModalData[date] || [];
      
      // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ JSON íŒŒì‹± ì‹œë„ (í•˜ìœ„ í˜¸í™˜ì„±)
      if (schedules.length === 0 && schedulesJson) {
        try {
          schedules = JSON.parse(schedulesJson.replace(/&quot;/g, '"').replace(/&#39;/g, "'"));
        } catch (e) {
          console.error('ìŠ¤ì¼€ì¥´ íŒŒì‹± ì˜¤ë¥˜:', e);
          schedules = [];
        }
      }
      
      let modalHtml = `
        <div id="scheduleModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeScheduleModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 22px; font-weight: 700;">${dateStr} ìŠ¤ì¼€ì¥´</h3>
              <button onclick="closeScheduleModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
            </div>
      `;
      
      if (!schedules || schedules.length === 0) {
        modalHtml += `
          <div style="text-align: center; padding: 40px; color: #636e72;">
            ì´ ë‚ ì§œì—ëŠ” ë“±ë¡ëœ ìŠ¤ì¼€ì¥´ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        `;
      } else {
        schedules.forEach((schedule, idx) => {
          const startDate = schedule.start_date ? new Date(schedule.start_date).toLocaleDateString('ko-KR') : '';
          const endDate = schedule.end_date ? new Date(schedule.end_date).toLocaleDateString('ko-KR') : '';
          const color = getCompanyColor(schedule.company_name);
          
          // í™”ì£¼ì‚¬ì´ë¦„(íƒ€ì…) í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
          const companyName = escapeHtml(schedule.company_name || '');
          let scheduleType = escapeHtml(schedule.schedule_type || '');
          
          // schedule_typeì´ "ëª¨ë“ í™”ì£¼ì‚¬-"ë¡œ ì‹œì‘í•˜ë©´ ì ‘ë‘ì‚¬ ì œê±° (ì˜ˆ: "ëª¨ë“ í™”ì£¼ì‚¬-ì…ê³ " â†’ "ì…ê³ ")
          if (scheduleType.startsWith('ëª¨ë“ í™”ì£¼ì‚¬-')) {
            scheduleType = scheduleType.replace('ëª¨ë“ í™”ì£¼ì‚¬-', '');
          }
          
          const companyDisplay = scheduleType ? `${companyName}(${scheduleType})` : companyName;
          
          modalHtml += `
            <div style="background: #fff9e6; border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <h4 style="margin: 0; color: #ff6b35; font-size: 18px; font-weight: 700;">${escapeHtml(schedule.title || '')}</h4>
                <span style="background: linear-gradient(135deg, ${color.start} 0%, ${color.end} 100%); color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">${companyDisplay}</span>
              </div>
              <div style="margin-bottom: 8px; color: #2d3436; font-size: 14px;">
                <strong>ê¸°ê°„:</strong> ${startDate} ~ ${endDate}
              </div>
              <div style="margin-bottom: 8px; color: #2d3436; font-size: 14px;">
                <strong>í–‰ì‚¬ ë‚´ìš©:</strong><br>
                <div style="margin-top: 4px; padding: 8px; background: white; border-radius: 8px; white-space: pre-wrap;">${escapeHtml(schedule.event_description || '')}</div>
              </div>
              ${schedule.request_note ? `
                <div style="color: #2d3436; font-size: 14px;">
                  <strong>ìš”ì²­ì‚¬í•­:</strong><br>
                  <div style="margin-top: 4px; padding: 8px; background: white; border-radius: 8px; white-space: pre-wrap;">${escapeHtml(schedule.request_note)}</div>
                </div>
              ` : ''}
            </div>
          `;
        });
      }
      
      modalHtml += `
          </div>
        </div>
      `;
      
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('scheduleModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }
    window.showScheduleModal = showScheduleModal;
    
    // ìŠ¤ì¼€ì¥´ ëª¨ë‹¬ ë‹«ê¸°
    function closeScheduleModal(event) {
      if (event && event.target.id !== 'scheduleModal' && !event.target.closest('#scheduleModal > div')) {
        return;
      }
      const modal = document.getElementById('scheduleModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeScheduleModal = closeScheduleModal;
    
    // ========== C/S ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // C/S ë“±ë¡ í¼ ì ‘ì´ì‹
    function toggleCsForm() {
      const form = document.getElementById('addCsForm');
      const icon = document.getElementById('addCsIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none';
        form.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–²' : 'â–¼';
        
        // í¼ì´ ì—´ë¦´ ë•Œ
        if (isHidden) {
          // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œ í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
          if (currentRole === 'ê´€ë¦¬ì') {
            loadCsCompanyList();
          }
          
          // C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ
          loadCsIssueTypesForForm();
        }
      }
    }
    window.toggleCsForm = toggleCsForm;
    
    // C/S ë“±ë¡ìš© í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ììš©)
    function loadCsCompanyList() {
      const companySelect = document.getElementById('csCompanyName');
      const companyField = document.getElementById('csCompanyNameField');
      
      if (!companySelect || !companyField) return;
      
      // ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ í™”ì£¼ì‚¬ëª… í•„ë“œ í‘œì‹œ
      if (currentRole === 'ê´€ë¦¬ì') {
        companyField.style.display = 'block';
        companySelect.required = true;
      } else {
        companyField.style.display = 'none';
        companySelect.required = false;
      }
      
      // í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
      fetch('/api/auth/companies')
        .then(response => response.json())
        .then(result => {
          if (result.success && result.companies) {
            companySelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            // í™”ì£¼ì‚¬ë§Œ í•„í„°ë§ (ê´€ë¦¬ì ì œì™¸)
            const companies = result.companies.filter(company => company.role !== 'ê´€ë¦¬ì');
            companies.forEach(company => {
              const option = document.createElement('option');
              option.value = company.company_name || company.username;
              option.textContent = company.company_name || company.username;
              companySelect.appendChild(option);
            });
          }
        })
        .catch(error => {
          console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        });
    }
    window.loadCsCompanyList = loadCsCompanyList;
    
    // C/S í¼ ì´ˆê¸°í™”
    function resetCsForm() {
      document.getElementById('csManagementNumber').value = '';
      document.getElementById('csCustomerName').value = '';
      document.getElementById('csIssueType').value = '';
      document.getElementById('csContent').value = '';
      document.getElementById('csFormMessage').innerHTML = '';
      
      // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œ í™”ì£¼ì‚¬ëª… ì´ˆê¸°í™”
      const companySelect = document.getElementById('csCompanyName');
      if (companySelect) {
        companySelect.value = '';
      }
    }
    window.resetCsForm = resetCsForm;
    
    // C/S ë“±ë¡
    async function saveCs(event) {
      event.preventDefault();
      const messageDiv = document.getElementById('csFormMessage');
      
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ë“±ë¡ ì¤‘...</span>';
      }
      
      const managementNumber = document.getElementById('csManagementNumber').value.trim();
      const customerName = document.getElementById('csCustomerName').value.trim();
      const issueType = document.getElementById('csIssueType').value.trim();
      const content = document.getElementById('csContent').value.trim();
      
      // ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œ í™”ì£¼ì‚¬ëª… ê°€ì ¸ì˜¤ê¸°
      let companyName = currentCompany;
      let username = currentUsername;
      if (currentRole === 'ê´€ë¦¬ì') {
        const selectedCompany = document.getElementById('csCompanyName').value.trim();
        if (!selectedCompany) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ í™”ì£¼ì‚¬ëª…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</span>';
          }
          return;
        }
        companyName = selectedCompany;
        // í™”ì£¼ì‚¬ëª…ìœ¼ë¡œ username ì°¾ê¸° (ì„ íƒì‚¬í•­, ì—†ìœ¼ë©´ í™”ì£¼ì‚¬ëª… ì‚¬ìš©)
        username = selectedCompany;
      }
      
      if (!managementNumber || !issueType || !content) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ëª¨ë“  í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      try {
        const response = await fetch('/api/cs/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            company_name: companyName,
            username: username,
            management_number: managementNumber,
            customer_name: customerName || null,
            issue_type: issueType,
            content: content
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… C/S ì ‘ìˆ˜ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          resetCsForm();
          toggleCsForm();
          refreshCsData();
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ' + (result.message || 'ë“±ë¡ ì‹¤íŒ¨') + '</span>';
          }
        }
      } catch (error) {
        console.error('C/S ë“±ë¡ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</span>';
        }
      }
    }
    window.saveCs = saveCs;
    // C/S ì›” ëª©ë¡ ë¡œë“œ
    function loadCsAvailableMonths() {
      const companyFilter = (currentRole === 'ê´€ë¦¬ì') ? '' : currentCompany;
      const url = `${API_BASE_URL}/api/cs/available-months?company=${encodeURIComponent(companyFilter)}&role=${encodeURIComponent(currentRole)}`;
      
      fetch(url)
        .then(response => response.json())
        .then(result => {
          const monthSelect = document.getElementById('csMonthSelect');
          if (!monthSelect) return;
          
          monthSelect.innerHTML = '';
          
          if (result.success && result.months && result.months.length > 0) {
            // ë…„ë„ë³„ë¡œ ê·¸ë£¹í™”
            const monthsByYear = {};
            result.months.forEach(monthStr => {
              const yearMatch = monthStr.match(/(\d{4})ë…„/);
              if (yearMatch) {
                const year = yearMatch[1];
                if (!monthsByYear[year]) {
                  monthsByYear[year] = [];
                }
                monthsByYear[year].push(monthStr);
              }
            });
            
            // ë…„ë„ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
            const years = Object.keys(monthsByYear).sort((a, b) => {
              if (b === 'ê¸°íƒ€') return -1;
              return parseInt(b) - parseInt(a);
            });
            
            // ì˜µì…˜ ê·¸ë£¹ìœ¼ë¡œ ë…„ë„ë³„ í‘œì‹œ
            years.forEach(year => {
              const optgroup = document.createElement('optgroup');
              optgroup.label = `${year}ë…„`;
              monthsByYear[year].forEach(monthStr => {
                const option = document.createElement('option');
                option.value = monthStr;
                option.textContent = monthStr;
                optgroup.appendChild(option);
              });
              monthSelect.appendChild(optgroup);
            });
            
            // í˜„ì¬ ì›” ì„ íƒ (ê¸°ë³¸ê°’) - 01ì›” í˜•ì‹ìœ¼ë¡œ ë§ì¶¤
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${String(today.getMonth() + 1).padStart(2, '0')}ì›”`;
            // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ì›” ì°¾ê¸°
            const exactMatch = result.months.find(m => m === currentMonth);
            if (exactMatch) {
              monthSelect.value = exactMatch;
            } else {
              // ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ê°€ì¥ ìµœê·¼ ì›” ì„ íƒ
              monthSelect.value = result.months[0];
            }
            
            // C/S íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œë§Œ ë°ì´í„° ë¡œë“œ
            const csTab = document.getElementById('csTab');
            if (csTab && !csTab.classList.contains('hidden') && csTab.style.display !== 'none') {
              loadCsData();
            }
          } else {
            // í˜„ì¬ ì›” ì¶”ê°€ (ë°ì´í„°ê°€ ì—†ì„ ë•Œ) - 01ì›” í˜•ì‹ìœ¼ë¡œ ë§ì¶¤
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${String(today.getMonth() + 1).padStart(2, '0')}ì›”`;
            const option = document.createElement('option');
            option.value = currentMonth;
            option.textContent = currentMonth;
            monthSelect.appendChild(option);
            monthSelect.value = currentMonth;
            // ë°ì´í„°ê°€ ì—†ì–´ë„ C/S íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ë°ì´í„° ë¡œë“œ
            const csTab = document.getElementById('csTab');
            if (csTab && !csTab.classList.contains('hidden') && csTab.style.display !== 'none') {
              loadCsData();
            }
          }
          
          // C/S ë“±ë¡ ì„¹ì…˜ í‘œì‹œ (í™”ì£¼ì‚¬ ë° ê´€ë¦¬ì ëª¨ë‘, ì›” ëª©ë¡ ë¡œë“œ í›„)
          const csRegisterSection = document.getElementById('csRegisterSection');
          if (csRegisterSection) {
            csRegisterSection.style.display = 'block';
          }
          
          // ì›” ë³€ê²½ ì´ë²¤íŠ¸
          monthSelect.onchange = function() {
            loadCsData();
          };
        })
        .catch(error => {
          console.error('C/S ì›” ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
          const monthSelect = document.getElementById('csMonthSelect');
          if (monthSelect) {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}ë…„${String(today.getMonth() + 1).padStart(2, '0')}ì›”`;
            monthSelect.innerHTML = `<option value="${currentMonth}">${currentMonth}</option>`;
            monthSelect.value = currentMonth;
          }
        });
    }
    window.loadCsAvailableMonths = loadCsAvailableMonths;
    
    // ì „ë‹¬ ì¡°íšŒ í•¨ìˆ˜
    function loadPreviousMonthCs() {
      const monthSelect = document.getElementById('csMonthSelect');
      if (!monthSelect) return;
      
      const today = new Date();
      let prevYear = today.getFullYear();
      let prevMonth = today.getMonth(); // 0-11 (í˜„ì¬ ì›” - 1)
      
      if (prevMonth === 0) {
        // 1ì›”ì´ë©´ ì „ë…„ë„ 12ì›”
        prevYear -= 1;
        prevMonth = 12;
      }
      
      const previousMonthStr = `${prevYear}ë…„${String(prevMonth).padStart(2, '0')}ì›”`;
      
      // ì „ë‹¬ ì›”ì´ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
      const options = Array.from(monthSelect.options);
      const foundOption = options.find(opt => opt.value === previousMonthStr);
      
      if (foundOption) {
        monthSelect.value = previousMonthStr;
        loadCsData();
      } else {
        // ì „ë‹¬ ì›”ì´ ëª©ë¡ì— ì—†ìœ¼ë©´ ì•Œë¦¼
        alert(`ì „ë‹¬(${previousMonthStr}) ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
      }
    }
    window.loadPreviousMonthCs = loadPreviousMonthCs;
    
    // C/S ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    function refreshCsData() {
      const csTab = document.getElementById('csTab');
      if (csTab && !csTab.classList.contains('hidden') && csTab.style.display !== 'none') {
        loadCsData();
      }
    }
    window.refreshCsData = refreshCsData;
    
    // C/S ë°ì´í„° ë¡œë“œ
    function loadCsData() {
      const csTab = document.getElementById('csTab');
      if (csTab && (csTab.classList.contains('hidden') || csTab.style.display === 'none')) {
        return;
      }
      
      const selectedMonth = document.getElementById('csMonthSelect')?.value || '';
      let companyFilter = '';
      
      // ê´€ë¦¬ì ëª¨ë“œ: ì„ íƒí•œ í™”ì£¼ì‚¬ í•„í„° ì ìš©
      if (currentRole === 'ê´€ë¦¬ì') {
        const selectedCompany = document.getElementById('csCompanySelect')?.value || '';
        companyFilter = selectedCompany;
      } else {
        // í™”ì£¼ì‚¬ ëª¨ë“œ: ìì‹ ì˜ ë°ì´í„°ë§Œ
        companyFilter = currentCompany;
      }
      
      const url = `${API_BASE_URL}/api/cs/?company=${encodeURIComponent(companyFilter)}&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}`;
      
      fetch(url)
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            currentCsData = result.data || [];
            renderCsTable(currentCsData);
            updateCsStats(currentCsData);
            filterCsByStatus(currentCsFilter);
            
            // ê´€ë¦¬ì ëª¨ë“œì—ì„œ í™”ì£¼ì‚¬ë³„ í†µê³„ë¥¼ ìœ„í•´ ì „ì²´ ë°ì´í„° ë¡œë“œ (í•„í„° ì—†ì´)
            if (currentRole === 'ê´€ë¦¬ì') {
              const allDataUrl = `${API_BASE_URL}/api/cs/?company=&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}`;
              fetch(allDataUrl)
                .then(response => response.json())
                .then(allResult => {
                  if (allResult.success) {
                    allCsDataForStats = allResult.data || [];
                    updateCsCompanyStats(allCsDataForStats);
                  }
                })
                .catch(error => {
                  console.error('ì „ì²´ C/S ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                });
            }
          } else {
            showMessage('âŒ ' + (result.message || 'C/S ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨'), 'error');
            document.getElementById('csTableBody').innerHTML = 
              `<tr><td colspan="9" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            currentCsData = [];
            updateCsStats([]);
          }
        })
        .catch(error => {
          console.error('C/S ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
          showMessage('âŒ C/S ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
          currentCsData = [];
          updateCsStats([]);
        });
    }
    window.loadCsData = loadCsData;
    
    // C/S ê´€ë¦¬ìš© í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ
    async function loadCompaniesForCs() {
      const select = document.getElementById('csCompanySelect');
      const label = document.getElementById('csCompanyLabel');
      
      // ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ í‘œì‹œ
      if (currentRole !== 'ê´€ë¦¬ì') {
        if (select) select.style.display = 'none';
        if (label) label.style.display = 'none';
        return;
      }
      
      if (!select) return;
      
      // ê´€ë¦¬ì ëª¨ë“œì—ì„œë§Œ í‘œì‹œ
      if (select) select.style.display = 'inline-block';
      if (label) label.style.display = 'inline-block';
      
      try {
        const response = await fetch('/api/auth/companies');
        const result = await response.json();
        
        if (result.success && result.companies) {
          // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ "ì „ì²´" ì˜µì…˜ ì œì™¸)
          while (select.options.length > 1) {
            select.remove(1);
          }
          
          // í™”ì£¼ì‚¬ë§Œ í•„í„°ë§ (ê´€ë¦¬ì ì œì™¸)
          const companies = result.companies.filter(company => company.role !== 'ê´€ë¦¬ì');
          
          companies.forEach(company => {
            const option = document.createElement('option');
            option.value = company.company_name;
            option.textContent = company.company_name;
            select.appendChild(option);
          });
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCompaniesForCs = loadCompaniesForCs;
    
    // C/S í…Œì´ë¸” ë Œë”ë§
    function renderCsTable(csList) {
      const tbody = document.getElementById('csTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '';
      
      const isAdmin = (currentRole === 'ê´€ë¦¬ì');
      
      // í•„í„°ë§ ì ìš©
      let filteredList = csList;
      
      // ìƒíƒœë³„ í•„í„°ë§
      if (currentCsFilter === 'completed') {
        filteredList = filteredList.filter(cs => cs.status === 'ì²˜ë¦¬ì™„ë£Œ' || cs.status === 'ì²˜ë¦¬ë¶ˆê°€');
      } else if (currentCsFilter === 'pending') {
        filteredList = filteredList.filter(cs => cs.status === 'ì ‘ìˆ˜');
      }
      
      // ì¢…ë¥˜ë³„ í•„í„°ë§
      if (currentCsTypeFilter) {
        filteredList = filteredList.filter(cs => cs.issue_type === currentCsTypeFilter);
      }
      
        if (!filteredList || filteredList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="13" class="no-data">ë“±ë¡ëœ C/S ì ‘ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¹€
        const adminHeader = document.getElementById('csAdminActionsHeader');
        if (adminHeader) {
          adminHeader.style.display = isAdmin ? 'table-cell' : 'none';
        }
        // ì¬ìš”ì²­ ì—´ í‘œì‹œ/ìˆ¨ê¹€ (í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œë§Œ)
        const resendHeader = document.getElementById('csResendHeader');
        if (resendHeader) {
          resendHeader.style.display = !isAdmin ? 'table-cell' : 'none';
        }
        return;
      }
      
      // ê´€ë¦¬ì ì—´ í‘œì‹œ/ìˆ¨ê¹€
      const adminHeader = document.getElementById('csAdminActionsHeader');
      if (adminHeader) {
        adminHeader.style.display = isAdmin ? 'table-cell' : 'none';
      }
      // ì¬ìš”ì²­ ì—´ í‘œì‹œ/ìˆ¨ê¹€ (í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œë§Œ)
      const resendHeader = document.getElementById('csResendHeader');
      if (resendHeader) {
        resendHeader.style.display = !isAdmin ? 'table-cell' : 'none';
      }
      
      // ì „ì²´ ë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ (ìˆœë²ˆ ê³„ì‚°ìš©)
      const totalCount = csList.length;
      
      filteredList.forEach((cs, index) => {
        const tr = document.createElement('tr');
        
        // ìˆœë²ˆ: ì˜¤ë˜ëœ ê²ƒë¶€í„° 1, 2, 3... (ì „ì²´ ë¦¬ìŠ¤íŠ¸ ê¸°ì¤€)
        // ë¦¬ìŠ¤íŠ¸ëŠ” ìµœì‹ ìˆœ ì •ë ¬ì´ë¯€ë¡œ, ì „ì²´ ê°œìˆ˜ì—ì„œ í˜„ì¬ ì¸ë±ìŠ¤ë¥¼ ë¹¼ì„œ ê³„ì‚°
        // ì „ì²´ ë¦¬ìŠ¤íŠ¸ì—ì„œ í˜„ì¬ í•­ëª©ì˜ ìœ„ì¹˜ ì°¾ê¸°
        const originalIndex = csList.findIndex(item => item.id === cs.id);
        const rowNumber = totalCount - originalIndex;
        
        // ë‚ ì§œì™€ ì‹œê°„ ì´ˆê¹Œì§€ í‘œì‹œ (ì„œë²„ì—ì„œ ì´ë¯¸ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ì €ì¥ë¨)
        let date = '-';
        if (cs.created_at) {
          try {
            // ì„œë²„ì—ì„œ ë°›ì€ ì‹œê°„ ë¬¸ìì—´ (ì´ë¯¸ í•œêµ­ ì‹œê°„)
            const dateStr = String(cs.created_at);
            
            // ë‚ ì§œ í˜•ì‹ì´ ì´ë¯¸ YYYY-MM-DD HH:MM:SS í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            if (dateStr.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/)) {
              date = dateStr;
            } else {
              // ë‹¤ë¥¸ í˜•ì‹ì´ë©´ íŒŒì‹± í›„ í‘œì‹œ
              const dateObj = new Date(dateStr);
              if (!isNaN(dateObj.getTime())) {
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getDate()).padStart(2, '0');
                const hours = String(dateObj.getHours()).padStart(2, '0');
                const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                const seconds = String(dateObj.getSeconds()).padStart(2, '0');
                date = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
              } else {
                date = dateStr;
              }
            }
          } catch (e) {
            console.error('ë‚ ì§œ íŒŒì‹± ì˜¤ë¥˜:', e, cs.created_at);
            date = cs.created_at || '-';
          }
        } else if (cs.date) {
          date = cs.date;
        }
        const managementNumber = cs.management_number || '';
        const generatedManagementNumber = cs.generated_management_number || '';
        const companyName = escapeHtml(cs.company_name || '');
        const customerName = escapeHtml(cs.customer_name || '');
        const issueType = escapeHtml(cs.issue_type || '');
        const content = escapeHtml(cs.content || '');
        const status = cs.status || 'ì ‘ìˆ˜';
        const processor = escapeHtml(cs.processor || '');
        const adminMessage = escapeHtml(cs.admin_message || '');
        
        // C/S ì¢…ë¥˜ë³„ ìƒ‰ìƒ
        let issueTypeColor = '#636e72';
        let issueTypeBg = '#ecf0f1';
        if (issueType === 'ì˜¤ë°°ì†¡') {
          issueTypeColor = '#e74c3c';
          issueTypeBg = '#ffe5e5';
        } else if (issueType === 'ëˆ„ë½') {
          issueTypeColor = '#f39c12';
          issueTypeBg = '#fff5e5';
        } else if (issueType === 'êµí™˜') {
          issueTypeColor = '#3498db';
          issueTypeBg = '#e5f3ff';
        } else if (issueType === 'ë°˜í’ˆ') {
          issueTypeColor = '#9b59b6';
          issueTypeBg = '#f0e5ff';
        } else if (issueType === 'ì·¨ì†Œ') {
          issueTypeColor = '#e74c3c';
          issueTypeBg = '#ffe5e5';
        } else if (issueType === 'ê¸°íƒ€') {
          issueTypeColor = '#95a5a6';
          issueTypeBg = '#f5f5f5';
        }
        
        // ìƒíƒœë³„ ìƒ‰ìƒ
        let statusColor = '#636e72';
        if (status === 'ì²˜ë¦¬ì™„ë£Œ') {
          statusColor = '#00b894';
        } else if (status === 'ì²˜ë¦¬ë¶ˆê°€') {
          statusColor = '#e74c3c';
        } else {
          statusColor = '#f39c12';
        }
        
        // ê´€ë¦¬ììš© ê´€ë¦¬ ë²„íŠ¼
        let manageHtml = '';
        if (isAdmin) {
          manageHtml = `
            <div style="display: flex; gap: 5px; flex-wrap: nowrap; align-items: center;">
              <button class="save-btn" onclick="updateCsGeneratedManagementNumber(${cs.id}, '${escapeHtml(generatedManagementNumber)}', '${escapeHtml(customerName || '')}')" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(116, 185, 255, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ê´€ë¦¬ë²ˆí˜¸</button>
              <button class="save-btn" onclick="processCsComplete(${cs.id})" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0, 184, 148, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ì²˜ë¦¬ì™„ë£Œ</button>
              <button class="save-btn" onclick="processCsImpossible(${cs.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(231, 76, 60, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ì²˜ë¦¬ë¶ˆê°€</button>
              <button class="save-btn" onclick="deleteCs(${cs.id})" style="background: linear-gradient(135deg, #b2bec3 0%, #636e72 100%); color: white; border: none; padding: 5px 8px; font-size: 11px; border-radius: 6px; box-shadow: 0 2px 4px rgba(99, 110, 114, 0.25); transition: all 0.3s ease; white-space: nowrap; flex-shrink: 1;">ì‚­ì œ</button>
            </div>
          `;
        }
        
        tr.innerHTML = `
          <td style="white-space: nowrap; text-align: center; font-weight: 600;">${rowNumber}</td>
          <td style="white-space: nowrap; text-align: center;">${date}</td>
          <td style="white-space: nowrap; text-align: center; width: 100px; min-width: 100px; max-width: 100px; overflow: hidden; text-overflow: ellipsis;">${managementNumber || '-'}</td>
          <td style="white-space: nowrap; text-align: center; width: 100px; min-width: 100px; max-width: 100px; overflow: hidden; text-overflow: ellipsis;">${generatedManagementNumber || '-'}</td>
          <td style="white-space: nowrap; text-align: center;">${companyName}</td>
          <td style="white-space: nowrap; text-align: center;">${customerName || '-'}</td>
          <td style="white-space: nowrap; text-align: center;">
            ${issueType ? `<span style="display: inline-block; padding: 4px 10px; border-radius: 6px; background: ${issueTypeBg}; color: ${issueTypeColor}; font-weight: 600; font-size: 11px; border: 1px solid ${issueTypeColor};">${issueType}</span>` : '-'}
          </td>
          <td style="max-width: 300px; word-wrap: break-word; text-align: center;">${content}</td>
          <td style="white-space: nowrap; color: ${statusColor}; font-weight: 600; text-align: center;">${status}</td>
          <td style="white-space: nowrap; text-align: center;">
            ${processor ? `<span style="display: inline-block; padding: 3px 8px; border-radius: 4px; background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; font-weight: 600; font-size: 11px;">${processor}</span>` : '-'}
          </td>
          <td style="max-width: 200px; word-wrap: break-word; text-align: center;">${adminMessage || '-'}</td>
          ${isAdmin ? `<td style="text-align: center; white-space: nowrap; min-width: 200px;">${manageHtml}</td>` : ''}
          ${!isAdmin && status !== 'ì²˜ë¦¬ì™„ë£Œ' && status !== 'ì²˜ë¦¬ë¶ˆê°€' ? `<td style="text-align: center; white-space: nowrap;">
            <button class="save-btn" onclick="resendCsNotification(${cs.id})" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 6px; box-shadow: 0 2px 4px rgba(243, 156, 18, 0.25); transition: all 0.3s ease; white-space: nowrap; cursor: pointer;">
              ğŸ”” ì¬ìš”ì²­
            </button>
          </td>` : !isAdmin ? `<td style="text-align: center; white-space: nowrap;">-</td>` : ''}
        `;
        
        tbody.appendChild(tr);
      });
    }
    window.renderCsTable = renderCsTable;
    
    // C/S í†µê³„ ì—…ë°ì´íŠ¸
    function updateCsStats(csList) {
      const total = csList.length;
      const completed = csList.filter(cs => cs.status === 'ì²˜ë¦¬ì™„ë£Œ' || cs.status === 'ì²˜ë¦¬ë¶ˆê°€').length;
      const pending = csList.filter(cs => cs.status === 'ì ‘ìˆ˜').length;
      
      // ì¢…ë¥˜ë³„ í†µê³„
      const missing = csList.filter(cs => cs.issue_type === 'ëˆ„ë½').length;
      const wrongDelivery = csList.filter(cs => cs.issue_type === 'ì˜¤ë°°ì†¡').length;
      const exchange = csList.filter(cs => cs.issue_type === 'êµí™˜').length;
      const returnType = csList.filter(cs => cs.issue_type === 'ë°˜í’ˆ').length;
      const cancel = csList.filter(cs => cs.issue_type === 'ì·¨ì†Œ').length;
      const other = csList.filter(cs => cs.issue_type === 'ê¸°íƒ€').length;
      
      // ìƒíƒœë³„ í†µê³„ ì—…ë°ì´íŠ¸
      const totalCountEl = document.getElementById('csTotalCount');
      const completedCountEl = document.getElementById('csCompletedCount');
      const pendingCountEl = document.getElementById('csPendingCount');
      
      if (totalCountEl) totalCountEl.textContent = total;
      if (completedCountEl) completedCountEl.textContent = completed;
      if (pendingCountEl) pendingCountEl.textContent = pending;
      
      // ì¢…ë¥˜ë³„ í†µê³„ ì—…ë°ì´íŠ¸
      const missingCountEl = document.getElementById('csMissingCount');
      const wrongDeliveryCountEl = document.getElementById('csWrongDeliveryCount');
      const exchangeCountEl = document.getElementById('csExchangeCount');
      const returnCountEl = document.getElementById('csReturnCount');
      const cancelCountEl = document.getElementById('csCancelCount');
      const otherCountEl = document.getElementById('csOtherCount');
      
      if (missingCountEl) missingCountEl.textContent = missing;
      if (wrongDeliveryCountEl) wrongDeliveryCountEl.textContent = wrongDelivery;
      if (exchangeCountEl) exchangeCountEl.textContent = exchange;
      if (returnCountEl) returnCountEl.textContent = returnType;
      if (cancelCountEl) cancelCountEl.textContent = cancel;
      if (otherCountEl) otherCountEl.textContent = other;
      
      // í™”ì£¼ì‚¬ë³„ í†µê³„ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì ì „ìš©) - ì „ì²´ ë°ì´í„° ì‚¬ìš©
      if (currentRole === 'ê´€ë¦¬ì') {
        // ì „ì²´ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ í˜„ì¬ ë°ì´í„° ì‚¬ìš©
        updateCsCompanyStats(allCsDataForStats.length > 0 ? allCsDataForStats : csList);
      }
    }
    window.updateCsStats = updateCsStats;
    
    // C/S í™”ì£¼ì‚¬ë³„ í†µê³„ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ì ì „ìš©)
    function updateCsCompanyStats(csList) {
      const statsSection = document.getElementById('csAdminCompanyStatsSection');
      const statsContainer = document.getElementById('csAdminCompanyStatsContainer');
      
      if (!statsSection || !statsContainer) return;
      
      // ê´€ë¦¬ì ëª¨ë“œê°€ ì•„ë‹ˆë©´ ìˆ¨ê¹€
      if (currentRole !== 'ê´€ë¦¬ì') {
        statsSection.style.display = 'none';
        return;
      }
      
      // ì „ì²´ í†µê³„ ê³„ì‚°
      const allStats = {
        total: csList.length,
        completed: csList.filter(cs => cs.status === 'ì²˜ë¦¬ì™„ë£Œ' || cs.status === 'ì²˜ë¦¬ë¶ˆê°€').length,
        pending: csList.filter(cs => cs.status === 'ì ‘ìˆ˜').length
      };
      
      // í™”ì£¼ì‚¬ë³„ ê·¸ë£¹í™”
      const stats = {};
      csList.forEach(cs => {
        const companyName = cs.company_name || 'ê¸°íƒ€';
        if (!stats[companyName]) {
          stats[companyName] = {
            total: 0,
            completed: 0,
            pending: 0
          };
        }
        stats[companyName].total++;
        if (cs.status === 'ì²˜ë¦¬ì™„ë£Œ' || cs.status === 'ì²˜ë¦¬ë¶ˆê°€') {
          stats[companyName].completed++;
        } else if (cs.status === 'ì ‘ìˆ˜') {
          stats[companyName].pending++;
        }
      });
      
      if (Object.keys(stats).length === 0 && allStats.total === 0) {
        statsContainer.innerHTML = '';
        statsSection.style.display = 'none';
        return;
      }
      
      // í˜„ì¬ ì„ íƒëœ í™”ì£¼ì‚¬ í™•ì¸
      const selectedCompany = document.getElementById('csCompanySelect')?.value || '';
      
      // HTML ìƒì„± - ì „ì²´ ì˜µì…˜ì„ ë§¨ ì™¼ìª½ì— ì¶”ê°€
      let html = '';
      
      // ì „ì²´ ì˜µì…˜ (ë§¨ ì™¼ìª½)
      const isAllSelected = !selectedCompany || selectedCompany === '';
      html += `
        <div onclick="filterCsByCompany('')" 
             style="padding: 12px 16px; border-radius: 10px; background: ${isAllSelected ? 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)' : 'linear-gradient(135deg, #fffef9 0%, #ffffff 100%)'}; 
                    color: ${isAllSelected ? 'white' : '#636e72'}; cursor: pointer; font-size: 13px; font-weight: 600; 
                    border: 2px solid ${isAllSelected ? '#ff6b35' : '#ffeaa7'}; transition: all 0.3s ease; 
                    white-space: nowrap; min-width: 150px; box-shadow: ${isAllSelected ? '0 4px 12px rgba(255, 107, 53, 0.3)' : '0 2px 6px rgba(0, 0, 0, 0.1)'};"
             onmouseover="if('' !== '${selectedCompany}') { this.style.transform='scale(1.05)'; this.style.borderColor='#ffa502'; }"
             onmouseout="if('' !== '${selectedCompany}') { this.style.transform='scale(1)'; this.style.borderColor='#ffeaa7'; }">
          <div style="font-size: 14px; font-weight: 700; margin-bottom: 4px; text-align: left;">ì „ì²´</div>
          <div style="font-size: 12px; opacity: 0.9; text-align: left;">ì´ <strong>${allStats.total}</strong>ê±´</div>
          <div style="font-size: 11px; opacity: 0.8; margin-top: 2px; text-align: left;">ì²˜ë¦¬ì™„ë£Œ: ${allStats.completed} | ë¯¸ì²˜ë¦¬: ${allStats.pending}</div>
        </div>
      `;
      
      // í™”ì£¼ì‚¬ë³„ í†µê³„ ë°•ìŠ¤ë“¤
      html += Object.entries(stats)
        .sort((a, b) => b[1].total - a[1].total) // ì´ ê±´ìˆ˜ë¡œ ì •ë ¬
        .map(([companyName, data]) => {
          const isSelected = selectedCompany === companyName;
          return `
            <div onclick="filterCsByCompany('${escapeHtml(companyName)}')" 
                 style="padding: 12px 16px; border-radius: 10px; background: ${isSelected ? 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)' : 'linear-gradient(135deg, #fffef9 0%, #ffffff 100%)'}; 
                        color: ${isSelected ? 'white' : '#636e72'}; cursor: pointer; font-size: 13px; font-weight: 600; 
                        border: 2px solid ${isSelected ? '#ff6b35' : '#ffeaa7'}; transition: all 0.3s ease; 
                        white-space: nowrap; min-width: 150px; box-shadow: ${isSelected ? '0 4px 12px rgba(255, 107, 53, 0.3)' : '0 2px 6px rgba(0, 0, 0, 0.1)'};"
                 onmouseover="if('${escapeHtml(companyName)}' !== '${selectedCompany}') { this.style.transform='scale(1.05)'; this.style.borderColor='#ffa502'; }"
                 onmouseout="if('${escapeHtml(companyName)}' !== '${selectedCompany}') { this.style.transform='scale(1)'; this.style.borderColor='#ffeaa7'; }">
              <div style="font-size: 14px; font-weight: 700; margin-bottom: 4px; text-align: left;">${escapeHtml(companyName)}</div>
              <div style="font-size: 12px; opacity: 0.9; text-align: left;">ì´ <strong>${data.total}</strong>ê±´</div>
              <div style="font-size: 11px; opacity: 0.8; margin-top: 2px; text-align: left;">ì²˜ë¦¬ì™„ë£Œ: ${data.completed} | ë¯¸ì²˜ë¦¬: ${data.pending}</div>
            </div>
          `;
        }).join('');
      
      statsContainer.innerHTML = html;
      statsSection.style.display = 'block';
    }
    window.updateCsCompanyStats = updateCsCompanyStats;
    
    // í™”ì£¼ì‚¬ë³„ C/S í•„í„°ë§
    function filterCsByCompany(companyName) {
      const companySelect = document.getElementById('csCompanySelect');
      if (companySelect) {
        companySelect.value = companyName || '';
        loadCsData();
      }
    }
    window.filterCsByCompany = filterCsByCompany;
    
    // C/S ìƒíƒœë³„ í•„í„°ë§
    function filterCsByStatus(filter) {
      currentCsFilter = filter;
      currentCsTypeFilter = null; // ìƒíƒœ í•„í„° ë³€ê²½ ì‹œ ì¢…ë¥˜ í•„í„° ì´ˆê¸°í™”
      
      // í†µê³„ ë°•ìŠ¤ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
      const allFilter = document.getElementById('csFilterAll');
      const completedFilter = document.getElementById('csFilterCompleted');
      const pendingFilter = document.getElementById('csFilterPending');
      
      // ëª¨ë“  ìƒíƒœ í•„í„° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      if (allFilter) {
        allFilter.style.background = 'linear-gradient(135deg, #fffef9 0%, #ffffff 100%)';
        allFilter.style.color = '#636e72';
        allFilter.style.borderColor = '#ffeaa7';
      }
      if (completedFilter) {
        completedFilter.style.background = 'linear-gradient(135deg, #fffef9 0%, #ffffff 100%)';
        completedFilter.style.color = '#636e72';
        completedFilter.style.borderColor = '#ffeaa7';
      }
      if (pendingFilter) {
        pendingFilter.style.background = 'linear-gradient(135deg, #fffef9 0%, #ffffff 100%)';
        pendingFilter.style.color = '#636e72';
        pendingFilter.style.borderColor = '#ffeaa7';
      }
      
      // ì¢…ë¥˜ í•„í„° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” (ì›ë˜ ìƒ‰ìƒìœ¼ë¡œ)
      const typeFilterConfigs = {
        'csFilterMissing': { color: 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)', border: '#e74c3c' },
        'csFilterWrongDelivery': { color: 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)', border: '#f39c12' },
        'csFilterExchange': { color: 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)', border: '#3498db' },
        'csFilterReturn': { color: 'linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)', border: '#9b59b6' },
        'csFilterCancel': { color: 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)', border: '#95a5a6' },
        'csFilterOther': { color: 'linear-gradient(135deg, #1abc9c 0%, #16a085 100%)', border: '#1abc9c' }
      };
      
      Object.entries(typeFilterConfigs).forEach(([id, config]) => {
        const el = document.getElementById(id);
        if (el) {
          el.style.background = config.color;
          el.style.color = 'white';
          el.style.borderColor = config.border;
          el.style.opacity = '1';
          el.style.transform = 'scale(1)';
          el.style.boxShadow = 'none';
          el.classList.remove('active');
        }
      });
      
      // ì„ íƒëœ í•„í„° í™œì„±í™”
      if (filter === 'all' && allFilter) {
        allFilter.style.background = 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)';
        allFilter.style.color = 'white';
        allFilter.style.borderColor = '#ff6b35';
      } else if (filter === 'completed' && completedFilter) {
        completedFilter.style.background = 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)';
        completedFilter.style.color = 'white';
        completedFilter.style.borderColor = '#ff6b35';
      } else if (filter === 'pending' && pendingFilter) {
        pendingFilter.style.background = 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)';
        pendingFilter.style.color = 'white';
        pendingFilter.style.borderColor = '#ff6b35';
      }
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      if (currentCsData && currentCsData.length > 0) {
        renderCsTable(currentCsData);
      }
    }
    window.filterCsByStatus = filterCsByStatus;
    
    // C/S ì¢…ë¥˜ë³„ í•„í„°ë§
    function filterCsByType(type) {
      if (currentCsTypeFilter === type) {
        // ê°™ì€ ì¢…ë¥˜ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ í•„í„° í•´ì œ
        currentCsTypeFilter = null;
      } else {
        currentCsTypeFilter = type;
      }
      
      // ì¢…ë¥˜ í•„í„° ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
      const typeFilterIds = {
        'ëˆ„ë½': { id: 'csFilterMissing', color: 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)', border: '#e74c3c' },
        'ì˜¤ë°°ì†¡': { id: 'csFilterWrongDelivery', color: 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)', border: '#f39c12' },
        'êµí™˜': { id: 'csFilterExchange', color: 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)', border: '#3498db' },
        'ë°˜í’ˆ': { id: 'csFilterReturn', color: 'linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)', border: '#9b59b6' },
        'ì·¨ì†Œ': { id: 'csFilterCancel', color: 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)', border: '#95a5a6' },
        'ê¸°íƒ€': { id: 'csFilterOther', color: 'linear-gradient(135deg, #1abc9c 0%, #16a085 100%)', border: '#1abc9c' }
      };
      
      // ëª¨ë“  ì¢…ë¥˜ í•„í„° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” (ì›ë˜ ìƒ‰ìƒìœ¼ë¡œ)
      Object.entries(typeFilterIds).forEach(([type, config]) => {
        const el = document.getElementById(config.id);
        if (el) {
          el.style.background = config.color;
          el.style.color = 'white';
          el.style.borderColor = config.border;
          el.style.opacity = '1';
          el.classList.remove('active');
        }
      });
      
      // ì„ íƒëœ ì¢…ë¥˜ í•„í„° í™œì„±í™” (ë” ì§„í•˜ê²Œ)
      if (currentCsTypeFilter && typeFilterIds[currentCsTypeFilter]) {
        const activeEl = document.getElementById(typeFilterIds[currentCsTypeFilter].id);
        if (activeEl) {
          activeEl.style.opacity = '1';
          activeEl.style.transform = 'scale(1.1)';
          activeEl.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
          activeEl.classList.add('active');
        }
      }
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      if (currentCsData && currentCsData.length > 0) {
        renderCsTable(currentCsData);
      }
    }
    window.filterCsByType = filterCsByType;
    
    // C/S ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
    function exportCsData() {
      const selectedMonth = document.getElementById('csMonthSelect')?.value || '';
      let companyFilter = '';
      
      // ê´€ë¦¬ì ëª¨ë“œ: ì„ íƒí•œ í™”ì£¼ì‚¬ í•„í„° ì ìš©
      if (currentRole === 'ê´€ë¦¬ì') {
        const selectedCompany = document.getElementById('csCompanySelect')?.value || '';
        companyFilter = selectedCompany;
      } else {
        // í™”ì£¼ì‚¬ ëª¨ë“œ: ìì‹ ì˜ ë°ì´í„°ë§Œ
        companyFilter = currentCompany;
      }
      
      const url = `${API_BASE_URL}/api/cs/export?company=${encodeURIComponent(companyFilter)}&month=${encodeURIComponent(selectedMonth)}&role=${encodeURIComponent(currentRole)}`;
      
      window.open(url, '_blank');
    }
    window.exportCsData = exportCsData;
    
    // í…”ë ˆê·¸ë¨ ì•Œë¦¼ í…ŒìŠ¤íŠ¸
    async function testTelegram() {
      if (!confirm('í…”ë ˆê·¸ë¨ ì•Œë¦¼ì„ í…ŒìŠ¤íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch('/api/cs/test-telegram', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('âœ… ' + result.message, 'success');
        } else {
          showMessage('âŒ ' + (result.message || 'í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'), 'error');
        }
      } catch (error) {
        console.error('í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
        showMessage('âŒ í…”ë ˆê·¸ë¨ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    window.testTelegram = testTelegram;
    
    // ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸ ì—…ë°ì´íŠ¸ (ê´€ë¦¬ììš© - ë°˜í’ˆë‚´ì—­ ë¹„ê³  ì…ë ¥ ë°©ì‹ê³¼ ë™ì¼)
    function updateCsGeneratedManagementNumber(csId, currentNumber, currentCustomerName) {
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('csGeneratedManagementNumberModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="csGeneratedManagementNumberModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeCsGeneratedManagementNumberModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 22px; font-weight: 700;">ê´€ë¦¬ë²ˆí˜¸ ë° ê³ ê°ëª… ì…ë ¥</h3>
              <button onclick="closeCsGeneratedManagementNumberModal()" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;">Ã—</button>
            </div>
            <div style="margin-bottom: 20px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸</label>
              <input type="text" id="csGeneratedManagementNumberInput" class="request-input" style="min-height: auto;" value="${escapeHtml(currentNumber || '')}" placeholder="ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div style="margin-bottom: 20px;">
              <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ê³ ê°ëª…</label>
              <input type="text" id="csCustomerNameInput" class="request-input" style="min-height: auto;" value="${escapeHtml(currentCustomerName || '')}" placeholder="ê³ ê°ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button onclick="closeCsGeneratedManagementNumberModal()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);">ì·¨ì†Œ</button>
              <button onclick="saveCsGeneratedManagementNumber(${csId})" class="save-btn">ğŸ’¾ ì €ì¥</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      document.getElementById('csGeneratedManagementNumberInput').focus();
    }
    window.updateCsGeneratedManagementNumber = updateCsGeneratedManagementNumber;
    
    // ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeCsGeneratedManagementNumberModal(event) {
      if (event && event.target.id !== 'csGeneratedManagementNumberModal' && !event.target.closest('#csGeneratedManagementNumberModal > div')) {
        return;
      }
      const modal = document.getElementById('csGeneratedManagementNumberModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeCsGeneratedManagementNumberModal = closeCsGeneratedManagementNumberModal;
    
    // ìƒì„±ëœ ê´€ë¦¬ë²ˆí˜¸ ì €ì¥
    function saveCsGeneratedManagementNumber(csId) {
      const newNumber = document.getElementById('csGeneratedManagementNumberInput').value.trim();
      const customerName = document.getElementById('csCustomerNameInput').value.trim();
      
      // ê´€ë¦¬ë²ˆí˜¸ì™€ ê³ ê°ëª…ì„ í•¨ê»˜ ì—…ë°ì´íŠ¸
      Promise.all([
        fetch(`/api/cs/${csId}/generated-management-number`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ generated_management_number: newNumber || null })
        }),
        fetch(`/api/cs/${csId}/customer-name`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ customer_name: customerName || null })
        })
      ])
      .then(responses => Promise.all(responses.map(r => r.json())))
      .then(results => {
        const success = results.every(r => r.success);
        if (success) {
          showMessage('âœ… ê´€ë¦¬ë²ˆí˜¸ì™€ ê³ ê°ëª…ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          closeCsGeneratedManagementNumberModal();
          refreshCsData();
        } else {
          const errorMessages = results.filter(r => !r.success).map(r => r.message).join(', ');
          showMessage('âŒ ' + (errorMessages || 'ì—…ë°ì´íŠ¸ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ê´€ë¦¬ë²ˆí˜¸ ë° ê³ ê°ëª… ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.saveCsGeneratedManagementNumber = saveCsGeneratedManagementNumber;
    
    // ì²˜ë¦¬ì™„ë£Œ (ê´€ë¦¬ììš©)
    function processCsComplete(csId) {
      const message = prompt('ì²˜ë¦¬ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):', '');
      if (message === null) return; // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
      
      fetch(`/api/cs/${csId}/status`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          status: 'ì²˜ë¦¬ì™„ë£Œ',
          admin_message: message ? message.trim() : null,
          processor: currentCompany
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ì²˜ë¦¬ì™„ë£Œë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshCsData();
          // í†µê³„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
          loadCsData();
        } else {
          showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì²˜ë¦¬ì™„ë£Œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.processCsComplete = processCsComplete;
    
    // ì²˜ë¦¬ë¶ˆê°€ (ê´€ë¦¬ììš©)
    function processCsImpossible(csId) {
      const message = prompt('ì²˜ë¦¬ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):', '');
      if (message === null) return; // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
      
      fetch(`/api/cs/${csId}/status`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          status: 'ì²˜ë¦¬ë¶ˆê°€',
          admin_message: message ? message.trim() : null,
          processor: currentCompany
        })
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… ì²˜ë¦¬ë¶ˆê°€ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshCsData();
          // í†µê³„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
          loadCsData();
        } else {
          showMessage('âŒ ' + (result.message || 'ì²˜ë¦¬ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì²˜ë¦¬ë¶ˆê°€ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.processCsImpossible = processCsImpossible;
    
    // C/S ì‚­ì œ (ê´€ë¦¬ììš©)
    function deleteCs(csId) {
      if (!confirm('í•´ë‹¹ C/S ì ‘ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      const roleParam = encodeURIComponent(currentRole || '');
      
      fetch(`/api/cs/${csId}?role=${roleParam}`, {
        method: 'DELETE'
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          showMessage('âœ… C/S ì ‘ìˆ˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          refreshCsData();
        } else {
          showMessage('âŒ ' + (result.message || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'), 'error');
        }
      })
      .catch(error => {
        console.error('C/S ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ C/S ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      });
    }
    window.deleteCs = deleteCs;
    
    // C/S ì¬ìš”ì²­ ì•Œë¦¼ ì „ì†¡ (í™”ì£¼ì‚¬ìš©)
    async function resendCsNotification(csId) {
      if (!confirm('ì¬ìš”ì²­ ì•Œë¦¼ì„ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/cs/${csId}/resend-notification`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('âœ… ì¬ìš”ì²­ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        } else {
          showMessage('âŒ ' + (result.message || 'ì¬ìš”ì²­ ì•Œë¦¼ ì „ì†¡ ì‹¤íŒ¨'), 'error');
        }
      } catch (error) {
        console.error('ì¬ìš”ì²­ ì•Œë¦¼ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì¬ìš”ì²­ ì•Œë¦¼ ì „ì†¡ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    window.resendCsNotification = resendCsNotification;
    
    // ========== C/S ì¢…ë¥˜ ê´€ë¦¬ í•¨ìˆ˜ ==========
    
    // C/S ì¢…ë¥˜ ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°
    function openCsIssueTypesManager() {
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('csIssueTypesManagerModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="csIssueTypesManagerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeCsIssueTypesManager(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 900px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 24px; font-weight: 700;">âš™ï¸ C/S ì¢…ë¥˜ ê´€ë¦¬</h3>
              <button onclick="closeCsIssueTypesManager()" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
              <button onclick="openAddCsIssueTypeModal()" class="save-btn" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">â• ì¢…ë¥˜ ì¶”ê°€</button>
            </div>
            
            <div id="csIssueTypesList" style="margin-top: 20px;">
              <div style="text-align: center; padding: 20px; color: #636e72;">ë¡œë”© ì¤‘...</div>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      loadCsIssueTypes();
    }
    window.openCsIssueTypesManager = openCsIssueTypesManager;
    
    // C/S ì¢…ë¥˜ ê´€ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
    function closeCsIssueTypesManager(event) {
      if (event && event.target.id !== 'csIssueTypesManagerModal' && !event.target.closest('#csIssueTypesManagerModal > div')) {
        return;
      }
      const modal = document.getElementById('csIssueTypesManagerModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeCsIssueTypesManager = closeCsIssueTypesManager;
    
    // C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ
    async function loadCsIssueTypes() {
      const listDiv = document.getElementById('csIssueTypesList');
      if (!listDiv) return;
      
      try {
        const response = await fetch('/api/cs/issue-types');
        const result = await response.json();
        
        if (result.success && result.data) {
          const types = result.data;
          
          if (types.length === 0) {
            listDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #636e72;">ë“±ë¡ëœ ì¢…ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
          }
          
          let html = '<table style="width: 100%; border-collapse: collapse;">';
          html += '<thead><tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">';
          html += '<th style="padding: 12px; text-align: left; font-weight: 600;">ìˆœì„œ</th>';
          html += '<th style="padding: 12px; text-align: left; font-weight: 600;">ì¢…ë¥˜ëª…</th>';
          html += '<th style="padding: 12px; text-align: left; font-weight: 600;">ìƒ‰ìƒ</th>';
          html += '<th style="padding: 12px; text-align: left; font-weight: 600;">ìƒíƒœ</th>';
          html += '<th style="padding: 12px; text-align: center; font-weight: 600;">ê´€ë¦¬</th>';
          html += '</tr></thead><tbody>';
          
          types.forEach(type => {
            const statusText = type.is_active ? 'í™œì„±' : 'ë¹„í™œì„±';
            const statusColor = type.is_active ? '#00b894' : '#636e72';
            html += `<tr style="border-bottom: 1px solid #dee2e6;">`;
            html += `<td style="padding: 12px;">${type.display_order || 0}</td>`;
            html += `<td style="padding: 12px;">
              <span style="display: inline-block; padding: 4px 10px; border-radius: 6px; background: ${type.bg_color || '#ecf0f1'}; color: ${type.color || '#636e72'}; font-weight: 600; font-size: 12px; border: 1px solid ${type.color || '#636e72'};">
                ${escapeHtml(type.name)}
              </span>
            </td>`;
            html += `<td style="padding: 12px;">
              <div style="display: flex; gap: 8px; align-items: center;">
                <div style="width: 30px; height: 20px; background: ${type.color || '#636e72'}; border-radius: 4px; border: 1px solid #ddd;"></div>
                <span style="font-size: 12px; color: #636e72;">${type.color || '#636e72'}</span>
              </div>
            </td>`;
            html += `<td style="padding: 12px;">
              <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
            </td>`;
            html += `<td style="padding: 12px; text-align: center;">
              <button onclick="openEditCsIssueTypeModal(${type.id}, '${escapeHtml(type.name)}', '${escapeHtml(type.color || '')}', '${escapeHtml(type.bg_color || '')}', ${type.display_order || 0}, ${type.is_active})" 
                      class="save-btn" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); padding: 5px 10px; font-size: 12px; margin-right: 5px;">ìˆ˜ì •</button>
              <button onclick="deleteCsIssueType(${type.id}, '${escapeHtml(type.name)}')" 
                      class="save-btn" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); padding: 5px 10px; font-size: 12px;">ì‚­ì œ</button>
            </td>`;
            html += `</tr>`;
          });
          
          html += '</tbody></table>';
          listDiv.innerHTML = html;
        } else {
          listDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #e74c3c;">ì¢…ë¥˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
      } catch (error) {
        console.error('C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        listDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #e74c3c;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</div>';
      }
    }
    window.loadCsIssueTypes = loadCsIssueTypes;
    
    // C/S ì¢…ë¥˜ ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
    function openAddCsIssueTypeModal() {
      const existingModal = document.getElementById('addCsIssueTypeModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="addCsIssueTypeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; display: flex; align-items: center; justify-content: center;" onclick="closeAddCsIssueTypeModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 20px; font-weight: 700;">â• C/S ì¢…ë¥˜ ì¶”ê°€</h3>
              <button onclick="closeAddCsIssueTypeModal()" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <form onsubmit="saveCsIssueType(event); return false;">
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë¥˜ëª… *</label>
                <input type="text" id="newCsIssueTypeName" class="request-input" style="min-height: auto;" placeholder="ì˜ˆ: ì˜¤ë°°ì†¡" required>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                <input type="color" id="newCsIssueTypeColor" class="request-input" style="min-height: auto; height: 40px;" value="#636e72">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°°ê²½ ìƒ‰ìƒ</label>
                <input type="color" id="newCsIssueTypeBgColor" class="request-input" style="min-height: auto; height: 40px;" value="#ecf0f1">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í‘œì‹œ ìˆœì„œ</label>
                <input type="number" id="newCsIssueTypeOrder" class="request-input" style="min-height: auto;" value="0" min="0">
              </div>
              <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button type="button" onclick="closeAddCsIssueTypeModal()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);">ì·¨ì†Œ</button>
                <button type="submit" class="save-btn">ğŸ’¾ ì €ì¥</button>
              </div>
            </form>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      document.getElementById('newCsIssueTypeName').focus();
    }
    window.openAddCsIssueTypeModal = openAddCsIssueTypeModal;
    
    // C/S ì¢…ë¥˜ ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°
    function closeAddCsIssueTypeModal(event) {
      if (event && event.target.id !== 'addCsIssueTypeModal' && !event.target.closest('#addCsIssueTypeModal > div')) {
        return;
      }
      const modal = document.getElementById('addCsIssueTypeModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeAddCsIssueTypeModal = closeAddCsIssueTypeModal;
    
    // C/S ì¢…ë¥˜ ì €ì¥
    async function saveCsIssueType(event) {
      event.preventDefault();
      
      const name = document.getElementById('newCsIssueTypeName').value.trim();
      const color = document.getElementById('newCsIssueTypeColor').value;
      const bgColor = document.getElementById('newCsIssueTypeBgColor').value;
      const displayOrder = parseInt(document.getElementById('newCsIssueTypeOrder').value) || 0;
      
      if (!name) {
        showMessage('âŒ ì¢…ë¥˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      try {
        const response = await fetch(`/api/cs/issue-types?role=${encodeURIComponent(currentRole)}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            color: color,
            bg_color: bgColor,
            display_order: displayOrder
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('âœ… C/S ì¢…ë¥˜ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          closeAddCsIssueTypeModal();
          loadCsIssueTypes();
          loadCsIssueTypesForForm(); // í¼ì˜ ì¢…ë¥˜ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
        } else {
          showMessage('âŒ ' + (result.message || 'ì¶”ê°€ ì‹¤íŒ¨'), 'error');
        }
      } catch (error) {
        console.error('C/S ì¢…ë¥˜ ì¶”ê°€ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    window.saveCsIssueType = saveCsIssueType;
    
    // C/S ì¢…ë¥˜ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    function openEditCsIssueTypeModal(id, name, color, bgColor, displayOrder, isActive) {
      const existingModal = document.getElementById('editCsIssueTypeModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="editCsIssueTypeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10001; display: flex; align-items: center; justify-content: center;" onclick="closeEditCsIssueTypeModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 20px; font-weight: 700;">âœï¸ C/S ì¢…ë¥˜ ìˆ˜ì •</h3>
              <button onclick="closeEditCsIssueTypeModal()" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 20px; cursor: pointer;">Ã—</button>
            </div>
            <form onsubmit="updateCsIssueType(event, ${id}); return false;">
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì¢…ë¥˜ëª… *</label>
                <input type="text" id="editCsIssueTypeName" class="request-input" style="min-height: auto;" value="${escapeHtml(name)}" required>
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
                <input type="color" id="editCsIssueTypeColor" class="request-input" style="min-height: auto; height: 40px;" value="${color || '#636e72'}">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ë°°ê²½ ìƒ‰ìƒ</label>
                <input type="color" id="editCsIssueTypeBgColor" class="request-input" style="min-height: auto; height: 40px;" value="${bgColor || '#ecf0f1'}">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">í‘œì‹œ ìˆœì„œ</label>
                <input type="number" id="editCsIssueTypeOrder" class="request-input" style="min-height: auto;" value="${displayOrder || 0}" min="0">
              </div>
              <div style="margin-bottom: 15px;">
                <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">
                  <input type="checkbox" id="editCsIssueTypeActive" ${isActive ? 'checked' : ''} style="margin-right: 8px;">
                  í™œì„±í™”
                </label>
              </div>
              <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button type="button" onclick="closeEditCsIssueTypeModal()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%);">ì·¨ì†Œ</button>
                <button type="submit" class="save-btn">ğŸ’¾ ì €ì¥</button>
              </div>
            </form>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      document.getElementById('editCsIssueTypeName').focus();
    }
    window.openEditCsIssueTypeModal = openEditCsIssueTypeModal;
    
    // C/S ì¢…ë¥˜ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
    function closeEditCsIssueTypeModal(event) {
      if (event && event.target.id !== 'editCsIssueTypeModal' && !event.target.closest('#editCsIssueTypeModal > div')) {
        return;
      }
      const modal = document.getElementById('editCsIssueTypeModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeEditCsIssueTypeModal = closeEditCsIssueTypeModal;
    
    // C/S ì¢…ë¥˜ ì—…ë°ì´íŠ¸
    async function updateCsIssueType(event, id) {
      event.preventDefault();
      
      const name = document.getElementById('editCsIssueTypeName').value.trim();
      const color = document.getElementById('editCsIssueTypeColor').value;
      const bgColor = document.getElementById('editCsIssueTypeBgColor').value;
      const displayOrder = parseInt(document.getElementById('editCsIssueTypeOrder').value) || 0;
      const isActive = document.getElementById('editCsIssueTypeActive').checked;
      
      if (!name) {
        showMessage('âŒ ì¢…ë¥˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      try {
        const response = await fetch(`/api/cs/issue-types/${id}?role=${encodeURIComponent(currentRole)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            color: color,
            bg_color: bgColor,
            display_order: displayOrder,
            is_active: isActive
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('âœ… C/S ì¢…ë¥˜ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          closeEditCsIssueTypeModal();
          loadCsIssueTypes();
          loadCsIssueTypesForForm(); // í¼ì˜ ì¢…ë¥˜ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
        } else {
          showMessage('âŒ ' + (result.message || 'ìˆ˜ì • ì‹¤íŒ¨'), 'error');
        }
      } catch (error) {
        console.error('C/S ì¢…ë¥˜ ìˆ˜ì • ì˜¤ë¥˜:', error);
        showMessage('âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    window.updateCsIssueType = updateCsIssueType;
    
    // C/S ì¢…ë¥˜ ì‚­ì œ
    async function deleteCsIssueType(id, name) {
      if (!confirm(`"${name}" ì¢…ë¥˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      try {
        const response = await fetch(`/api/cs/issue-types/${id}?role=${encodeURIComponent(currentRole)}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          showMessage('âœ… C/S ì¢…ë¥˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadCsIssueTypes();
          loadCsIssueTypesForForm(); // í¼ì˜ ì¢…ë¥˜ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
        } else {
          showMessage('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      } catch (error) {
        console.error('C/S ì¢…ë¥˜ ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
      }
    }
    window.deleteCsIssueType = deleteCsIssueType;
    
    // C/S ë“±ë¡ í¼ìš© ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ
    async function loadCsIssueTypesForForm() {
      try {
        const response = await fetch('/api/cs/issue-types');
        const result = await response.json();
        
        if (result.success && result.data) {
          const select = document.getElementById('csIssueType');
          if (!select) return;
          
          const activeTypes = result.data.filter(type => type.is_active !== false);
          activeTypes.sort((a, b) => (a.display_order || 0) - (b.display_order || 0));
          
          select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
          activeTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type.name;
            option.textContent = type.name;
            select.appendChild(option);
          });
        }
      } catch (error) {
        console.error('C/S ì¢…ë¥˜ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCsIssueTypesForForm = loadCsIssueTypesForForm;
    
    // ========== í™”ì£¼ì‚¬ ì •ë³´ ê´€ë ¨ í•¨ìˆ˜ ==========
    // ì‚¬ì—…ì ì •ë³´ í•„ìˆ˜ íŒì—… ëª¨ë‹¬ í‘œì‹œ
    function showBusinessInfoRequiredModal() {
      // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
      const existingModal = document.getElementById('businessInfoRequiredModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modalHtml = `
        <div id="businessInfoRequiredModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 20000; display: flex; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;">
          <div style="background: linear-gradient(135deg, #ffffff 0%, #fff9e6 100%); border-radius: 20px; padding: 40px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); position: relative;">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button onclick="closeBusinessInfoRequiredModal()" style="position: absolute; top: 20px; right: 20px; background: #e74c3c; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">Ã—</button>
            
            <!-- ì œëª© -->
            <div style="text-align: center; margin-bottom: 30px;">
              <div style="font-size: 64px; margin-bottom: 20px;">âš ï¸</div>
              <h2 style="margin: 0; color: #e74c3c; font-weight: 700; font-size: 32px; line-height: 1.3;">ì‚¬ì—…ì ì •ë³´ ì…ë ¥ í•„ìš”</h2>
              <p style="margin: 15px 0 0 0; color: #2d3436; font-size: 18px; line-height: 1.6;">ë°˜í’ˆ ë‚´ì—­ì„ ì¡°íšŒí•˜ë ¤ë©´ ì‚¬ì—…ì ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            
            <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 2px solid #ffc107;">
              <div style="display: flex; align-items: flex-start; gap: 12px;">
                <div style="font-size: 24px;">â„¹ï¸</div>
                <div style="flex: 1;">
                  <h4 style="margin: 0 0 10px 0; color: #856404; font-weight: 600; font-size: 16px;">ì‚¬ì—…ì ì •ë³´ ì…ë ¥ ì•ˆë‚´</h4>
                  <ul style="margin: 0; padding-left: 20px; color: #856404; font-size: 14px; line-height: 1.8;">
                    <li>ë°˜í’ˆ ë‚´ì—­ ì¡°íšŒë¥¼ ìœ„í•´ ì‚¬ì—…ì ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
                    <li>ì•„ë˜ í¼ì— ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>
                    <li>ì •ë³´ ì…ë ¥ í›„ ì €ì¥í•˜ë©´ ë°˜í’ˆ ë‚´ì—­ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- ì‚¬ì—…ì ì •ë³´ ì…ë ¥ í¼ -->
            <form id="businessInfoRequiredForm" onsubmit="saveBusinessInfoFromModal(event); return false;" style="margin-bottom: 20px;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì‚¬ì—…ìë²ˆí˜¸ *</label>
                  <input type="text" id="modalBusinessNumber" class="request-input" style="min-height: auto;" placeholder="ì‚¬ì—…ìë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ëŒ€í‘œëª… *</label>
                  <input type="text" id="modalBusinessName" class="request-input" style="min-height: auto;" placeholder="ëŒ€í‘œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div style="grid-column: 1 / -1;">
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì£¼ì†Œ *</label>
                  <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                    <input type="text" id="modalPostcode" class="request-input" style="min-height: auto; width: 120px;" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button type="button" onclick="openPostcodeSearchForModal()" class="save-btn" style="padding: 10px 20px; font-size: 14px; white-space: nowrap;">ğŸ” ì£¼ì†Œ ê²€ìƒ‰</button>
                  </div>
                  <input type="text" id="modalBusinessAddress" class="request-input" style="min-height: auto; margin-bottom: 8px;" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly required>
                  <input type="text" id="modalBusinessAddressDetail" class="request-input" style="min-height: auto;" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „í™”ë²ˆí˜¸ *</label>
                  <input type="tel" id="modalBusinessTel" class="request-input" style="min-height: auto;" placeholder="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                
                <div>
                  <label style="color: #2d3436; font-weight: 600; margin-bottom: 8px; display: block;">ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ *</label>
                  <input type="email" id="modalBusinessEmail" class="request-input" style="min-height: auto;" placeholder="ì „ìì„¸ê¸ˆê³„ì‚°ì„œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
              </div>
              
              <div style="margin-top: 30px; display: flex; gap: 12px; justify-content: center;">
                <button type="submit" class="save-btn" style="padding: 14px 40px; font-size: 18px; font-weight: 600;">ğŸ’¾ ì •ë³´ ì €ì¥</button>
                <button type="button" onclick="closeBusinessInfoRequiredModal()" class="save-btn" style="background: linear-gradient(135deg, #636e72 0%, #2d3436 100%); padding: 14px 40px; font-size: 18px; font-weight: 600;">ì·¨ì†Œ</button>
              </div>
              <div id="businessInfoRequiredMessage" style="margin-top: 20px; text-align: center;"></div>
            </form>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // ê¸°ì¡´ í™”ì£¼ì‚¬ ì •ë³´ê°€ ìˆìœ¼ë©´ í¼ì— ì±„ìš°ê¸°
      loadCompanyInfoToModal();
    }
    window.showBusinessInfoRequiredModal = showBusinessInfoRequiredModal;
    
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeBusinessInfoRequiredModal() {
      const modal = document.getElementById('businessInfoRequiredModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeBusinessInfoRequiredModal = closeBusinessInfoRequiredModal;
    
    // ëª¨ë‹¬ì— í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
    async function loadCompanyInfoToModal() {
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          document.getElementById('modalBusinessNumber').value = data.business_number || '';
          document.getElementById('modalBusinessName').value = data.business_name || '';
          
          // ì£¼ì†Œ íŒŒì‹± (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹)
          const fullAddress = data.business_address || '';
          const addressParts = fullAddress.split('|');
          if (addressParts.length >= 3) {
            document.getElementById('modalPostcode').value = addressParts[0] || '';
            document.getElementById('modalBusinessAddress').value = addressParts[1] || '';
            document.getElementById('modalBusinessAddressDetail').value = addressParts[2] || '';
          } else if (fullAddress) {
            // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
            document.getElementById('modalPostcode').value = '';
            document.getElementById('modalBusinessAddress').value = fullAddress;
            document.getElementById('modalBusinessAddressDetail').value = '';
          } else {
            document.getElementById('modalPostcode').value = '';
            document.getElementById('modalBusinessAddress').value = '';
            document.getElementById('modalBusinessAddressDetail').value = '';
          }
          
          document.getElementById('modalBusinessTel').value = data.business_tel || '';
          document.getElementById('modalBusinessEmail').value = data.business_email || '';
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // ëª¨ë‹¬ì—ì„œ ì‚¬ì—…ì ì •ë³´ ì €ì¥
    async function saveBusinessInfoFromModal(event) {
      event.preventDefault();
      
      const messageDiv = document.getElementById('businessInfoRequiredMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      const businessNumber = document.getElementById('modalBusinessNumber').value.trim();
      const businessName = document.getElementById('modalBusinessName').value.trim();
      const postcode = document.getElementById('modalPostcode').value.trim();
      const businessAddress = document.getElementById('modalBusinessAddress').value.trim();
      const businessAddressDetail = document.getElementById('modalBusinessAddressDetail').value.trim();
      const businessTel = document.getElementById('modalBusinessTel').value.trim();
      const businessEmail = document.getElementById('modalBusinessEmail').value.trim();
      
      // ì£¼ì†Œ í˜•ì‹: postcode|address|addressDetail
      const fullAddress = postcode || businessAddress || businessAddressDetail 
        ? `${postcode}|${businessAddress}|${businessAddressDetail}` 
        : '';
      
      if (!businessNumber || !businessName || !businessAddress || !businessTel || !businessEmail) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: currentUsername,
            business_number: businessNumber,
            business_name: businessName,
            business_address: fullAddress,
            business_tel: businessTel,
            business_email: businessEmail
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… ì‚¬ì—…ì ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë°˜í’ˆ ë‚´ì—­ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>';
          }
          
          // ëª¨ë‹¬ ë‹«ê¸°
          setTimeout(() => {
            closeBusinessInfoRequiredModal();
            // ë°˜í’ˆ ë‚´ì—­ ë‹¤ì‹œ ë¡œë“œ
            loadData();
          }, 1500);
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ' + (result.message || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.') + '</span>';
          }
        }
      } catch (error) {
        console.error('ì‚¬ì—…ì ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</span>';
        }
      }
    }
    window.saveBusinessInfoFromModal = saveBusinessInfoFromModal;
    
    // ëª¨ë‹¬ìš© ì£¼ì†Œ ê²€ìƒ‰
    function openPostcodeSearchForModal() {
      new daum.Postcode({
        oncomplete: function(data) {
          // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.
          // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
          let addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
          let extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
          if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
            addr = data.roadAddress;
          } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
            addr = data.jibunAddress;
          }
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
          if(data.userSelectedType === 'R'){
            // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
            // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
            if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
              extraAddr += data.bname;
            }
            // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
            if(data.buildingName !== '' && data.apartment === 'Y'){
              extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
            }
            // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
            if(extraAddr !== ''){
              extraAddr = ' (' + extraAddr + ')';
            }
            // ì¡°í•©ëœ ì°¸ê³ í•­ëª©ì„ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
            addr += extraAddr;
          }
          
          // ëª¨ë‹¬ì˜ input í•„ë“œì— ê°’ ì…ë ¥
          document.getElementById('modalPostcode').value = data.zonecode;
          document.getElementById('modalBusinessAddress').value = addr;
          // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
          document.getElementById('modalBusinessAddressDetail').focus();
        },
        width: '100%',
        height: '100%',
        maxSuggestItems: 5
      }).open();
    }
    window.openPostcodeSearchForModal = openPostcodeSearchForModal;
    
    // ì‚¬ì—…ì ì •ë³´ ì™„ì„±ë„ í™•ì¸
    function checkBusinessInfoComplete(data) {
      if (!data) return false;
      
      const businessNumber = (data.business_number || '').trim();
      const businessName = (data.business_name || '').trim();
      const businessAddress = (data.business_address || '').trim();
      const businessTel = (data.business_tel || '').trim();
      const businessEmail = (data.business_email || '').trim();
      
      // ì£¼ì†Œ ê²€ì¦ (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹ì´ê±°ë‚˜ ê¸°ì¡´ í˜•ì‹)
      let hasValidAddress = false;
      if (businessAddress) {
        const addressParts = businessAddress.split('|');
        if (addressParts.length >= 3) {
          // ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹ì¸ ê²½ìš°, ê¸°ë³¸ì£¼ì†Œê°€ ìˆì–´ì•¼ í•¨
          hasValidAddress = addressParts[1] && addressParts[1].trim().length > 0;
        } else {
          // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
          hasValidAddress = businessAddress.length > 0;
        }
      }
      
      // ëª¨ë“  í•„ë“œê°€ ì…ë ¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      return businessNumber && businessName && hasValidAddress && businessTel && businessEmail;
    }
    window.checkBusinessInfoComplete = checkBusinessInfoComplete;
    
    // ì‚¬ì—…ì ì •ë³´ ë°°ë„ˆ í‘œì‹œ/ìˆ¨ê¹€
    function updateBusinessInfoBanner(data) {
      const banner = document.getElementById('companyInfoBanner');
      if (!banner) return;
      
      const roleNormalized = (currentRole || '').toString().trim();
      const isAdmin = (roleNormalized === 'ê´€ë¦¬ì');
      
      // ê´€ë¦¬ì ëª¨ë“œì—ì„œëŠ” ë°°ë„ˆ í‘œì‹œ ì•ˆ í•¨
      if (isAdmin) {
        banner.style.display = 'none';
        return;
      }
      
      // í™”ì£¼ì‚¬ ëª¨ë“œì—ì„œ ì‚¬ì—…ì ì •ë³´ê°€ ì™„ì„±ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë°°ë„ˆ í‘œì‹œ
      if (!checkBusinessInfoComplete(data)) {
        banner.style.display = 'block';
      } else {
        banner.style.display = 'none';
      }
    }
    window.updateBusinessInfoBanner = updateBusinessInfoBanner;
    
    // í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ
    async function loadCompanyInfo() {
      const messageDiv = document.getElementById('companyInfoMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ë¡œë”© ì¤‘...</span>';
      }
      
      try {
        const response = await fetch(`/api/auth/my-info?username=${encodeURIComponent(currentUsername)}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          
          // ê¸°ë³¸ ì •ë³´ (ì½ê¸° ì „ìš©)
          document.getElementById('companyInfoName').value = data.company_name || '';
          document.getElementById('companyInfoUsername').value = data.username || '';
          document.getElementById('companyInfoRole').value = data.role || 'í™”ì£¼ì‚¬';
          
          // ì‚¬ì—…ì ì •ë³´ (ìˆ˜ì • ê°€ëŠ¥)
          document.getElementById('companyInfoBusinessNumber').value = data.business_number || '';
          document.getElementById('companyInfoBusinessName').value = data.business_name || '';
          
          // ì£¼ì†Œ íŒŒì‹± (ìš°í¸ë²ˆí˜¸|ê¸°ë³¸ì£¼ì†Œ|ìƒì„¸ì£¼ì†Œ í˜•ì‹)
          const fullAddress = data.business_address || '';
          const addressParts = fullAddress.split('|');
          if (addressParts.length >= 3) {
            document.getElementById('companyInfoPostcode').value = addressParts[0] || '';
            document.getElementById('companyInfoBusinessAddress').value = addressParts[1] || '';
            document.getElementById('companyInfoBusinessAddressDetail').value = addressParts[2] || '';
          } else if (fullAddress) {
            // ê¸°ì¡´ í˜•ì‹ (êµ¬ë¶„ì ì—†ì´ ì €ì¥ëœ ê²½ìš°)
            document.getElementById('companyInfoPostcode').value = '';
            document.getElementById('companyInfoBusinessAddress').value = fullAddress;
            document.getElementById('companyInfoBusinessAddressDetail').value = '';
          } else {
            document.getElementById('companyInfoPostcode').value = '';
            document.getElementById('companyInfoBusinessAddress').value = '';
            document.getElementById('companyInfoBusinessAddressDetail').value = '';
          }
          
          document.getElementById('companyInfoBusinessTel').value = data.business_tel || '';
          document.getElementById('companyInfoBusinessEmail').value = data.business_email || '';
          
          // ì‚¬ì—…ì ì •ë³´ ë°°ë„ˆ ì—…ë°ì´íŠ¸
          updateBusinessInfoBanner(data);
          
          // í™”ì£¼ì‚¬ ì •ë³´ ì…ë ¥ ì—¬ë¶€ í™•ì¸ (ì‚¬ì—…ìë²ˆí˜¸, ëŒ€í‘œëª…, ì£¼ì†Œ, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼ ëª¨ë‘ í™•ì¸)
          const hasBusinessInfo = !!(data.business_number && data.business_name && data.business_address && data.business_tel && data.business_email);
          
          // í™”ì£¼ì‚¬ ì •ë³´ ë¯¸ì…ë ¥ ì—¬ë¶€ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥ (ì´ˆê¸° ë©”ë‰´ ê²°ì •ìš©)
          window.hasCompanyInfo = hasBusinessInfo;
          
          if (messageDiv) {
            messageDiv.innerHTML = '';
          }
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'í™”ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">í™”ì£¼ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.loadCompanyInfo = loadCompanyInfo;
    
    // í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥
    async function saveCompanyInfo(event) {
      event.preventDefault();
      const messageDiv = document.getElementById('companyInfoMessage');
      
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: currentUsername,
            business_number: document.getElementById('companyInfoBusinessNumber').value.trim() || null,
            business_name: document.getElementById('companyInfoBusinessName').value.trim() || null,
            business_address: (() => {
              const postcode = document.getElementById('companyInfoPostcode').value.trim();
              const address = document.getElementById('companyInfoBusinessAddress').value.trim();
              const addressDetail = document.getElementById('companyInfoBusinessAddressDetail').value.trim();
              if (postcode || address || addressDetail) {
                return `${postcode}|${address}|${addressDetail}`;
              }
              return null;
            })(),
            business_tel: document.getElementById('companyInfoBusinessTel').value.trim() || null,
            business_email: document.getElementById('companyInfoBusinessEmail').value.trim() || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… í™”ì£¼ì‚¬ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          // ì •ë³´ ë‹¤ì‹œ ë¡œë“œ (ë°°ë„ˆ ì—…ë°ì´íŠ¸ í¬í•¨)
          setTimeout(() => {
            loadCompanyInfo();
          }, 1000);
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">í™”ì£¼ì‚¬ ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.saveCompanyInfo = saveCompanyInfo;
    
    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    async function changePassword(event) {
      event.preventDefault();
      const messageDiv = document.getElementById('passwordChangeMessage');
      
      const currentPassword = document.getElementById('currentPassword').value.trim();
      const newPassword = document.getElementById('newPassword').value.trim();
      const newPasswordConfirm = document.getElementById('newPasswordConfirm').value.trim();
      
      if (!currentPassword || !newPassword || !newPasswordConfirm) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      if (newPassword !== newPasswordConfirm) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (newPassword.length < 4) {
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</span>';
        }
        return;
      }
      
      if (messageDiv) {
        messageDiv.innerHTML = '<span style="color: #636e72;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘...</span>';
      }
      
      try {
        const response = await fetch('/api/auth/change-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: currentUsername,
            old_password: currentPassword,
            new_password: newPassword
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (messageDiv) {
            messageDiv.innerHTML = '<span style="color: #00b894;">âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          resetPasswordForm();
        } else {
          if (messageDiv) {
            messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        if (messageDiv) {
          messageDiv.innerHTML = '<span style="color: #e74c3c;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.changePassword = changePassword;
    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í¼ ì´ˆê¸°í™”
    function resetPasswordForm() {
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('newPasswordConfirm').value = '';
      const messageDiv = document.getElementById('passwordChangeMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '';
      }
    }
    window.resetPasswordForm = resetPasswordForm;
    
    // ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰
    function openPostcodeSearch() {
      new daum.Postcode({
        oncomplete: function(data) {
          // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.
          // ê° ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ ì¡°í•©í•œë‹¤.
          let addr = ''; // ì£¼ì†Œ ë³€ìˆ˜
          let extraAddr = ''; // ì°¸ê³ í•­ëª© ë³€ìˆ˜
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œ íƒ€ì…ì— ë”°ë¼ í•´ë‹¹ ì£¼ì†Œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
          if (data.userSelectedType === 'R') { // ì‚¬ìš©ìê°€ ë„ë¡œëª… ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°
            addr = data.roadAddress;
          } else { // ì‚¬ìš©ìê°€ ì§€ë²ˆ ì£¼ì†Œë¥¼ ì„ íƒí–ˆì„ ê²½ìš°(J)
            addr = data.jibunAddress;
          }
          
          // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì£¼ì†Œê°€ ë„ë¡œëª… íƒ€ì…ì¼ë•Œ ì°¸ê³ í•­ëª©ì„ ì¡°í•©í•œë‹¤.
          if(data.userSelectedType === 'R'){
            // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
            // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
            if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
              extraAddr += data.bname;
            }
            // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
            if(data.buildingName !== '' && data.apartment === 'Y'){
              extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
            }
            // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
            if(extraAddr !== ''){
              extraAddr = ' (' + extraAddr + ')';
            }
          }
          
          // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
          document.getElementById('companyInfoPostcode').value = data.zonecode;
          document.getElementById('companyInfoBusinessAddress').value = addr + extraAddr;
          // ì»¤ì„œë¥¼ ìƒì„¸ì£¼ì†Œ í•„ë“œë¡œ ì´ë™í•œë‹¤.
          document.getElementById('companyInfoBusinessAddressDetail').focus();
        },
        width: '100%',
        height: '100%',
        maxSuggestItems: 5
      }).open({
        q: document.getElementById('companyInfoPostcode').value || '',
        left: (window.screen.width / 2) - (500 / 2),
        top: (window.screen.height / 2) - (600 / 2)
      });
    }
    window.openPostcodeSearch = openPostcodeSearch;
    
    // ========== ê²Œì‹œíŒ ê´€ë ¨ í•¨ìˆ˜ ==========
    
    // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ììš©)
    async function loadCategories() {
      const tbody = document.getElementById('categoryTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="4" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="no-data">ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(category => {
            const tr = document.createElement('tr');
            const createdAt = category.created_at ? new Date(category.created_at).toLocaleDateString('ko-KR') : '-';
            
            tr.innerHTML = `
              <td>${escapeHtml(category.name || '')}</td>
              <td>${category.display_order || 0}</td>
              <td>${createdAt}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="editCategory(${category.id}, '${escapeHtml(category.name || '')}', ${category.display_order || 0})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\\ní•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ê²Œì‹œê¸€ì´ ì‚­ì œë©ë‹ˆë‹¤.')) deleteCategory(${category.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="4" class="no-data">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="4" class="no-data">ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadCategories = loadCategories;
    
    // ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ì„¹ì…˜ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleCategoryManagement() {
      const content = document.getElementById('categoryManagementContent');
      const icon = document.getElementById('categoryManagementIcon');
      if (content && icon) {
        const isHidden = content.style.display === 'none';
        content.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
        if (isHidden) {
          // í¼ì¹  ë•Œ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ
          loadCategories();
        }
      }
    }
    window.toggleCategoryManagement = toggleCategoryManagement;
    
    // ì¹´í…Œê³ ë¦¬ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleCategoryForm() {
      const form = document.getElementById('categoryForm');
      if (form) {
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        if (form.style.display === 'block') {
          document.getElementById('categoryName').value = '';
          document.getElementById('categoryOrder').value = '0';
          document.getElementById('categoryMessage').innerHTML = '';
        }
      }
    }
    window.toggleCategoryForm = toggleCategoryForm;
    
    // ì¹´í…Œê³ ë¦¬ ì €ì¥
    async function saveCategory() {
      const name = document.getElementById('categoryName').value.trim();
      const order = parseInt(document.getElementById('categoryOrder').value) || 0;
      const messageDiv = document.getElementById('categoryMessage');
      
      if (!name) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/board/categories', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            display_order: order
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ì¹´í…Œê³ ë¦¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          toggleCategoryForm();
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ì¹´í…Œê³ ë¦¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ìƒì„± ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveCategory = saveCategory;
    
    // ì¹´í…Œê³ ë¦¬ ìˆ˜ì •
    function editCategory(categoryId, name, order) {
      document.getElementById('categoryName').value = name;
      document.getElementById('categoryOrder').value = order;
      document.getElementById('categoryForm').style.display = 'block';
      
      // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
      const saveBtn = document.querySelector('#categoryForm .save-btn');
      if (saveBtn) {
        saveBtn.onclick = () => updateCategory(categoryId);
      }
    }
    window.editCategory = editCategory;
    
    // ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
    async function updateCategory(categoryId) {
      const name = document.getElementById('categoryName').value.trim();
      const order = parseInt(document.getElementById('categoryOrder').value) || 0;
      const messageDiv = document.getElementById('categoryMessage');
      
      if (!name) {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/board/categories/${categoryId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            display_order: order
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ì¹´í…Œê³ ë¦¬ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          toggleCategoryForm();
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#categoryForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveCategory;
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ì¹´í…Œê³ ë¦¬ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateCategory = updateCategory;
    
    // ì¹´í…Œê³ ë¦¬ ì‚­ì œ
    async function deleteCategory(categoryId) {
      try {
        const response = await fetch(`/api/board/categories/${categoryId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadCategories();
          // í™”ì£¼ì‚¬ ëª¨ë“œ ì…€ë ‰íŠ¸ë„ ì—…ë°ì´íŠ¸
          if (typeof loadBoardCategoriesForSelect === 'function') {
            loadBoardCategoriesForSelect();
          }
        } else {
          alert(result.message || 'ì¹´í…Œê³ ë¦¬ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteCategory = deleteCategory;
    
    // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ (ê´€ë¦¬ììš©)
    async function loadBoards() {
      const tbody = document.getElementById('boardTableBody');
      if (!tbody) {
        console.error('boardTableBodyë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const categoryFilter = document.getElementById('boardCategoryFilter');
        const categoryId = categoryFilter ? categoryFilter.value : '';
        
        let url = '/api/board/posts';
        if (categoryId) {
          url += `?category_id=${categoryId}`;
        }
        
        console.log('ê²Œì‹œê¸€ ëª©ë¡ ìš”ì²­ URL:', url);
        
        const response = await fetch(url, {
          signal: AbortSignal.timeout(10000) // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
        });
        console.log('ê²Œì‹œê¸€ ëª©ë¡ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('ê²Œì‹œê¸€ ëª©ë¡ ì‘ë‹µ ì˜¤ë¥˜:', response.status, errorText);
          tbody.innerHTML = `<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${response.status})</td></tr>`;
          return;
        }
        
        const result = await response.json();
        console.log('ê²Œì‹œê¸€ ëª©ë¡ ì‘ë‹µ ë°ì´í„°:', result);
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì˜ í‚¤ í™•ì¸
          if (result.data.length > 0) {
            const firstPost = result.data[0];
            console.log('ğŸ” ì²« ë²ˆì§¸ ê²Œì‹œê¸€ í‚¤:', Object.keys(firstPost));
            console.log('ğŸ” ì²« ë²ˆì§¸ ê²Œì‹œê¸€ id:', firstPost.id, 'íƒ€ì…:', typeof firstPost.id);
            console.log('ğŸ” ì²« ë²ˆì§¸ ê²Œì‹œê¸€ ì „ì²´:', firstPost);
          }
          
          tbody.innerHTML = '';
          result.data.forEach((post, index) => {
            // post.idê°€ ì—†ê±°ë‚˜ undefinedì´ë©´ ê±´ë„ˆë›°ê¸°
            if (post.id === undefined || post.id === null) {
              console.warn(`ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤ (ì¸ë±ìŠ¤ ${index}):`, post);
              console.warn('ê²Œì‹œê¸€ì˜ ëª¨ë“  í‚¤:', Object.keys(post));
              return;
            }
            
            const tr = document.createElement('tr');
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            // is_pinned ì²´í¬ (ì—„ê²©í•˜ê²Œ - ë¬¸ìì—´ '1', ìˆ«ì 1, boolean trueë§Œ trueë¡œ ì¸ì‹)
            const isPinned = post.is_pinned === true || post.is_pinned === 1 || String(post.is_pinned) === '1';
            const categoryName = (post.category_name || '').trim();
            const isNoticeCategory = categoryName === 'ê³µì§€ì‚¬í•­';
            
            // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ê²Œì‹œê¸€ë§Œ ë¡œê·¸
            if (index === 0) {
              console.log('ğŸ” ê²Œì‹œê¸€ ìŠ¤íƒ€ì¼ ì²´í¬:', {
                id: post.id,
                title: post.title,
                is_pinned: post.is_pinned,
                isPinned: isPinned,
                category_name: categoryName,
                isNoticeCategory: isNoticeCategory
              });
            }
            
            // ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì œëª© ìŠ¤íƒ€ì¼ ê²°ì •
            // 1ìˆœìœ„: ê³µì§€ì‚¬í•­ ì²´í¬(is_pinned) - ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
            // 2ìˆœìœ„: ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬ - êµµì€ ê¸€ì”¨
            // 3ìˆœìœ„: ë‚˜ë¨¸ì§€ - ì¼ë°˜ ìŠ¤íƒ€ì¼
            let titleStyle = 'cursor: pointer;';
            let titlePrefix = '';
            
            if (isPinned) {
              // ê³µì§€ì‚¬í•­ ì²´í¬: ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
              titlePrefix = 'ğŸ“Œ ';
              titleStyle += ' font-weight: 700; color: #e74c3c;';
            } else if (isNoticeCategory) {
              // ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬: êµµì€ ê¸€ì”¨
              titleStyle += ' font-weight: 700; color: #2d3436;';
            } else {
              // ë‚˜ë¨¸ì§€: ì¼ë°˜ ìŠ¤íƒ€ì¼
              titleStyle += ' font-weight: normal; color: #2d3436;';
            }
            
            tr.innerHTML = `
              <td>${escapeHtml(post.category_name || '')}</td>
              <td style="${titleStyle}" onclick="showBoardDetail(${post.id})" title="í´ë¦­í•˜ì—¬ ìƒì„¸ ë³´ê¸°">
                ${titlePrefix}${escapeHtml(post.title || '')}
              </td>
              <td>${escapeHtml(post.author_name || '')}</td>
              <td>${post.view_count || 0}</td>
              <td>${createdAt}</td>
              <td style="text-align: center;">
                <button class="save-btn" onclick="event.stopPropagation(); editBoard(${post.id})" style="background: linear-gradient(135deg, #ffeaa7 0%, #ffd93d 100%); color: #2d3436; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px; margin-right: 4px;">ìˆ˜ì •</button>
                <button class="save-btn" onclick="event.stopPropagation(); if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) deleteBoard(${post.id})" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; padding: 6px 12px; font-size: 12px; border-radius: 8px;">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          console.error('ê²Œì‹œê¸€ ëª©ë¡ ì‘ë‹µ ì‹¤íŒ¨:', result);
          tbody.innerHTML = `<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ${result.message || ''}</td></tr>`;
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        if (error.name === 'AbortError' || error.name === 'TimeoutError') {
          tbody.innerHTML = `<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ íƒ€ì„ì•„ì›ƒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</td></tr>`;
        } else {
          tbody.innerHTML = `<tr><td colspan="6" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</td></tr>`;
        }
      }
    }
    window.loadBoards = loadBoards;
    
    // ê²Œì‹œê¸€ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleBoardForm() {
      const form = document.getElementById('boardForm');
      if (form) {
        const isHidden = form.style.display === 'none' || !form.style.display;
        form.style.display = isHidden ? 'block' : 'none';
        
        if (isHidden) {
          // í¼ì„ ì—´ ë•Œ ì´ˆê¸°í™”
          resetBoardForm();
          loadCategoriesForBoard();
          
          // Summernote ì—ë””í„° ì´ˆê¸°í™”
          setTimeout(() => {
            const contentElement = $('#boardContent');
            if (contentElement.length) {
              // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ ìˆìœ¼ë©´ ì œê±° í›„ ì¬ì´ˆê¸°í™”
              if (contentElement.hasClass('note-editable')) {
                try {
                  contentElement.summernote('destroy');
                } catch (e) {
                  console.log('Summernote destroy ì˜¤ë¥˜ (ë¬´ì‹œ):', e);
                }
              }
              
              // ì›ë³¸ textarea ì´ˆê¸°í™”
              const textarea = document.getElementById('boardContent');
              if (textarea) {
                textarea.value = '';
              }
              
              // ìƒˆë¡œ ì´ˆê¸°í™”
              contentElement.summernote({
                height: 300,
                lang: 'ko-KR',
                toolbar: [
                  ['style', ['style']],
                  ['font', ['bold', 'italic', 'underline', 'clear']],
                  ['fontname', ['fontname']],
                  ['fontsize', ['fontsize']],
                  ['color', ['color']],
                  ['para', ['ul', 'ol', 'paragraph']],
                  ['table', ['table']],
                  ['insert', ['link', 'picture', 'video']],
                  ['view', ['fullscreen', 'codeview', 'help']]
                ],
                fontNames: ['ë§‘ì€ ê³ ë”•', 'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Times New Roman', 'Verdana'],
                fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '36', '48'],
                placeholder: 'ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'
              });
              
              // ì´ˆê¸°í™” í›„ ë¹ˆ ë‚´ìš© ì„¤ì •
              setTimeout(() => {
                contentElement.summernote('code', '');
              }, 50);
            }
          }, 100);
        }
      }
    }
    window.toggleBoardForm = toggleBoardForm;
    
    // ê²Œì‹œê¸€ í¼ ì´ˆê¸°í™”
    function resetBoardForm() {
      // ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”
      const categorySelect = document.getElementById('boardCategoryId');
      if (categorySelect) {
        categorySelect.value = '';
      }
      
      // ì œëª© ì´ˆê¸°í™”
      const titleInput = document.getElementById('boardTitle');
      if (titleInput) {
        titleInput.value = '';
      }
      
      // ë‚´ìš© ì´ˆê¸°í™” (Summernote ì—ë””í„°)
      const contentElement = document.getElementById('boardContent');
      if (contentElement) {
        // Summernote ì—ë””í„°ê°€ ì´ˆê¸°í™”ë˜ì–´ ìˆìœ¼ë©´ ì½”ë“œë¡œ ì´ˆê¸°í™”
        if ($('#boardContent').length && $('#boardContent').hasClass('note-editable')) {
          try {
            $('#boardContent').summernote('code', '');
            $('#boardContent').summernote('reset');
            // ì¶”ê°€ë¡œ ë¹ˆ HTML ì„¤ì •
            $('#boardContent').summernote('code', '<p><br></p>');
          } catch (e) {
            console.error('Summernote ì´ˆê¸°í™” ì˜¤ë¥˜:', e);
            // ì—ëŸ¬ ë°œìƒ ì‹œ ì—ë””í„° ì œê±° í›„ ì¬ì´ˆê¸°í™”
            $('#boardContent').summernote('destroy');
            contentElement.value = '';
          }
        } else {
          // ì¼ë°˜ textareaì¸ ê²½ìš°
          contentElement.value = '';
        }
      }
      
      // ê³ ì • ì—¬ë¶€ ì´ˆê¸°í™”
      const isPinnedCheckbox = document.getElementById('boardIsPinned');
      if (isPinnedCheckbox) {
        isPinnedCheckbox.checked = false;
      }
      
      // íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”
      const fileList = document.getElementById('boardFileList');
      if (fileList) {
        fileList.innerHTML = '';
      }
      
      // ë©”ì‹œì§€ ì´ˆê¸°í™”
      const messageDiv = document.getElementById('boardMessage');
      if (messageDiv) {
        messageDiv.innerHTML = '';
      }
      
      // íŒŒì¼ ë°°ì—´ ì´ˆê¸°í™”
      if (typeof boardFiles !== 'undefined') {
        boardFiles = [];
      }
    }
    window.resetBoardForm = resetBoardForm;
    
    // ê²Œì‹œê¸€ ì‘ì„±ìš© ì¹´í…Œê³ ë¦¬ ë¡œë“œ
    async function loadCategoriesForBoard() {
      const select = document.getElementById('boardCategoryId');
      const filterSelect = document.getElementById('boardCategoryFilter');
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          // ê²Œì‹œê¸€ ì‘ì„±ìš© ì…€ë ‰íŠ¸
          if (select) {
            while (select.options.length > 1) {
              select.remove(1);
            }
            result.data.forEach(category => {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = category.name;
              select.appendChild(option);
            });
          }
          
          // í•„í„°ìš© ì…€ë ‰íŠ¸
          if (filterSelect) {
            while (filterSelect.options.length > 1) {
              filterSelect.remove(1);
            }
            result.data.forEach(category => {
              const option = document.createElement('option');
              option.value = category.id;
              option.textContent = category.name;
              filterSelect.appendChild(option);
            });
          }
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadCategoriesForBoard = loadCategoriesForBoard;
    
    // ê²Œì‹œê¸€ ì²¨ë¶€íŒŒì¼ ê´€ë¦¬
    let boardFiles = [];
    
    function handleBoardFileSelect(event) {
      const files = Array.from(event.target.files);
      if (files.length === 0) return;
      
      const fileList = document.getElementById('boardFileList');
      fileList.innerHTML = '';
      
      files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
        
        fileItem.innerHTML = `
          <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.name)}</span>
          <button type="button" onclick="removeBoardFile(${index})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
        `;
        fileList.appendChild(fileItem);
        
        // íŒŒì¼ ì—…ë¡œë“œ
        uploadBoardFile(file, index);
      });
    }
    window.handleBoardFileSelect = handleBoardFileSelect;
    
    async function uploadBoardFile(file, index) {
      try {
        const formData = new FormData();
        formData.append('file', file);
        
        const response = await fetch('/api/board/upload', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success && result.data) {
          boardFiles[index] = result.data;
        } else {
          alert(`íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: ${file.name}`);
        }
      } catch (error) {
        console.error('íŒŒì¼ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert(`íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ${file.name}`);
      }
    }
    window.uploadBoardFile = uploadBoardFile;
    
    function removeBoardFile(index) {
      boardFiles.splice(index, 1);
      const fileList = document.getElementById('boardFileList');
      fileList.innerHTML = '';
      boardFiles.forEach((file, idx) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
        fileItem.innerHTML = `
          <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.file_name)}</span>
          <button type="button" onclick="removeBoardFile(${idx})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
        `;
        fileList.appendChild(fileItem);
      });
    }
    window.removeBoardFile = removeBoardFile;
    // ê²Œì‹œê¸€ ì €ì¥
    async function saveBoard() {
      const categoryId = document.getElementById('boardCategoryId').value;
      const title = document.getElementById('boardTitle').value.trim();
      // Summernote ì—ë””í„°ê°€ ì´ˆê¸°í™”ë˜ì–´ ìˆìœ¼ë©´ ì½”ë“œë¡œ ê°€ì ¸ì˜¤ê¸°, ì•„ë‹ˆë©´ ì¼ë°˜ value
      let content = '';
      if ($('#boardContent').length && $('#boardContent').hasClass('note-editable')) {
        content = $('#boardContent').summernote('code');
      } else {
        content = document.getElementById('boardContent').value.trim();
      }
      const isPinned = document.getElementById('boardIsPinned').checked;
      const messageDiv = document.getElementById('boardMessage');
      
      if (!categoryId || !title || !content || content === '<p><br></p>') {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬, ì œëª©, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch('/api/board/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            category_id: parseInt(categoryId),
            title: title,
            content: content,
            author_name: currentCompany,
            author_role: currentRole || 'ê´€ë¦¬ì',
            is_pinned: isPinned,
            files: boardFiles
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          
          // Summernote ì—ë””í„° ê°•ì œ ì´ˆê¸°í™”
          if ($('#boardContent').length && $('#boardContent').hasClass('note-editable')) {
            $('#boardContent').summernote('code', '');
            $('#boardContent').summernote('reset');
          }
          
          // í¼ ì´ˆê¸°í™”
          resetBoardForm();
          
          // í¼ ë‹«ê¸°
          toggleBoardForm();
          
          // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          loadBoards();
          
          // ì„±ê³µ ë©”ì‹œì§€ 2ì´ˆ í›„ ìë™ ì œê±°
          setTimeout(() => {
            if (messageDiv) {
              messageDiv.innerHTML = '';
            }
          }, 2000);
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ë“±ë¡ ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ê²Œì‹œê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.saveBoard = saveBoard;
    // ê²Œì‹œê¸€ ìˆ˜ì •
    async function editBoard(boardId) {
      try {
        const response = await fetch(`/api/board/posts/${boardId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const post = result.data;
          
          // í¼ í‘œì‹œ
          document.getElementById('boardForm').style.display = 'block';
          
          // ì¹´í…Œê³ ë¦¬ ë¨¼ì € ë¡œë“œ
          await loadCategoriesForBoard();
          
          // ì¹´í…Œê³ ë¦¬ ê°’ ì„¤ì • (ì¹´í…Œê³ ë¦¬ ë¡œë“œ í›„)
          setTimeout(() => {
            const categorySelect = document.getElementById('boardCategoryId');
            if (categorySelect && post.category_id) {
              categorySelect.value = post.category_id;
              console.log('ğŸ” ì¹´í…Œê³ ë¦¬ ì„¤ì •:', post.category_id, 'ì„ íƒëœ ê°’:', categorySelect.value);
            }
          }, 100);
          
          document.getElementById('boardTitle').value = post.title || '';
          
          // ê³µì§€ì‚¬í•­ ì²´í¬ë°•ìŠ¤ ì„¤ì • (ì—„ê²©í•˜ê²Œ - 1, true, '1'ë§Œ ì²´í¬)
          const isPinnedCheckbox = document.getElementById('boardIsPinned');
          if (isPinnedCheckbox) {
            const isPinned = post.is_pinned === true || post.is_pinned === 1 || String(post.is_pinned) === '1';
            isPinnedCheckbox.checked = isPinned;
            console.log('ğŸ” ê³µì§€ì‚¬í•­ ì²´í¬ë°•ìŠ¤ ì„¤ì •:', {
              post_is_pinned: post.is_pinned,
              isPinned: isPinned,
              checked: isPinnedCheckbox.checked
            });
          }
          
          // ì²¨ë¶€íŒŒì¼ í‘œì‹œ
          boardFiles = post.files || [];
          const fileList = document.getElementById('boardFileList');
          fileList.innerHTML = '';
          boardFiles.forEach((file, idx) => {
            const fileItem = document.createElement('div');
            fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; background: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #ffeaa7;';
            fileItem.innerHTML = `
              <span style="font-size: 12px; color: #636e72;">${escapeHtml(file.file_name)}</span>
              <button type="button" onclick="removeBoardFile(${idx})" style="background: #e74c3c; color: white; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">ì‚­ì œ</button>
            `;
            fileList.appendChild(fileItem);
          });
          
          // Summernote ì—ë””í„° ì´ˆê¸°í™” (ìˆ˜ì • ëª¨ë“œ)
          setTimeout(() => {
            if ($('#boardContent').length && !$('#boardContent').hasClass('note-editable')) {
              $('#boardContent').summernote({
                height: 300,
                lang: 'ko-KR',
                toolbar: [
                  ['style', ['style']],
                  ['font', ['bold', 'italic', 'underline', 'clear']],
                  ['fontname', ['fontname']],
                  ['fontsize', ['fontsize']],
                  ['color', ['color']],
                  ['para', ['ul', 'ol', 'paragraph']],
                  ['table', ['table']],
                  ['insert', ['link', 'picture', 'video']],
                  ['view', ['fullscreen', 'codeview', 'help']]
                ],
                fontNames: ['ë§‘ì€ ê³ ë”•', 'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Times New Roman', 'Verdana'],
                fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '36', '48'],
                placeholder: 'ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'
              });
              // ì—ë””í„° ì´ˆê¸°í™” í›„ ë‚´ìš© ì„¤ì •
              setTimeout(() => {
                $('#boardContent').summernote('code', post.content || '');
              }, 100);
            } else if ($('#boardContent').hasClass('note-editable')) {
              // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ë‚´ìš© ì„¤ì •
              $('#boardContent').summernote('code', post.content || '');
            }
          }, 200);
          
          // ì €ì¥ í•¨ìˆ˜ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
          const saveBtn = document.querySelector('#boardForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = () => updateBoard(boardId);
            saveBtn.textContent = 'ìˆ˜ì •';
          }
          
          // ìŠ¤í¬ë¡¤
          document.getElementById('boardTab').scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          alert('ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editBoard = editBoard;
    
    // ê²Œì‹œê¸€ ì—…ë°ì´íŠ¸
    async function updateBoard(boardId) {
      const categoryId = document.getElementById('boardCategoryId').value;
      const title = document.getElementById('boardTitle').value.trim();
      // Summernote ì—ë””í„°ê°€ ì´ˆê¸°í™”ë˜ì–´ ìˆìœ¼ë©´ ì½”ë“œë¡œ ê°€ì ¸ì˜¤ê¸°, ì•„ë‹ˆë©´ ì¼ë°˜ value
      let content = '';
      if ($('#boardContent').length && $('#boardContent').hasClass('note-editable')) {
        content = $('#boardContent').summernote('code');
      } else {
        content = document.getElementById('boardContent').value.trim();
      }
      const isPinned = document.getElementById('boardIsPinned').checked;
      const messageDiv = document.getElementById('boardMessage');
      
      if (!categoryId || !title || !content || content === '<p><br></p>') {
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ì¹´í…Œê³ ë¦¬, ì œëª©, ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }
      
      try {
        const response = await fetch(`/api/board/posts/${boardId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            category_id: parseInt(categoryId),
            title: title,
            content: content,
            is_pinned: isPinned,
            files: boardFiles
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          messageDiv.innerHTML = '<span style="color: #00b894;">ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          resetBoardForm();
          toggleBoardForm();
          loadBoards();
          
          // ì €ì¥ ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
          const saveBtn = document.querySelector('#boardForm .save-btn');
          if (saveBtn) {
            saveBtn.onclick = saveBoard;
            saveBtn.textContent = 'ì €ì¥';
          }
        } else {
          messageDiv.innerHTML = `<span style="color: #e74c3c;">${result.message || 'ê²Œì‹œê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ìˆ˜ì • ì˜¤ë¥˜:', error);
        messageDiv.innerHTML = '<span style="color: #e74c3c;">ê²Œì‹œê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
      }
    }
    window.updateBoard = updateBoard;
    
    // ê²Œì‹œê¸€ ì‚­ì œ
    async function deleteBoard(boardId) {
      try {
        const response = await fetch(`/api/board/posts/${boardId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          loadBoards();
        } else {
          alert(result.message || 'ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deleteBoard = deleteBoard;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë°•ìŠ¤ ë¡œë“œ
    async function loadBoardCategoriesForSelect() {
      const menuBox = document.getElementById('boardCategoryMenuBox');
      if (!menuBox) return;
      
      try {
        const response = await fetch('/api/board/categories');
        const result = await response.json();
        
        if (result.success && result.data) {
          // ê¸°ì¡´ ë²„íŠ¼ ì œê±° (ì „ì²´ ë²„íŠ¼ ì œì™¸)
          const existingButtons = menuBox.querySelectorAll('.category-menu-btn:not([data-category-id=""])');
          existingButtons.forEach(btn => btn.remove());
          
          result.data.forEach(category => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'category-menu-btn';
            btn.setAttribute('data-category-id', category.id);
            btn.textContent = category.name;
            btn.onclick = () => selectBoardCategory(category.id);
            btn.style.cssText = 'padding: 10px 20px; background: linear-gradient(135deg, #ffffff 0%, #fffef9 100%); color: #2d3436; border: 2px solid #ffeaa7; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1);';
            btn.onmouseover = function() { 
              if (!this.classList.contains('active')) {
                this.style.background = 'linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%)';
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 4px 12px rgba(255, 152, 0, 0.2)';
              }
            };
            btn.onmouseout = function() { 
              if (!this.classList.contains('active')) {
                this.style.background = 'linear-gradient(135deg, #ffffff 0%, #fffef9 100%)';
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 2px 8px rgba(255, 152, 0, 0.1)';
              }
            };
            menuBox.appendChild(btn);
          });
        }
      } catch (error) {
        console.error('ì¹´í…Œê³ ë¦¬ ë©”ë‰´ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    window.loadBoardCategoriesForSelect = loadBoardCategoriesForSelect;
    
    // ì¹´í…Œê³ ë¦¬ ì„ íƒ í•¨ìˆ˜
    function selectBoardCategory(categoryId) {
      // categoryIdë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜ (ë¹ˆ ë¬¸ìì—´ë„ í—ˆìš©)
      const categoryIdStr = categoryId === null || categoryId === undefined ? '' : String(categoryId);
      
      // ëª¨ë“  ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±° ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      const allButtons = document.querySelectorAll('.category-menu-btn');
      allButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.style.background = 'linear-gradient(135deg, #ffffff 0%, #fffef9 100%)';
        btn.style.color = '#2d3436';
        btn.style.border = '2px solid #ffeaa7';
        btn.style.boxShadow = '0 2px 8px rgba(255, 152, 0, 0.1)';
        btn.style.transform = 'translateY(0)';
      });
      
      // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€ ë° ìŠ¤íƒ€ì¼ ì ìš©
      const selectedBtn = document.querySelector(`.category-menu-btn[data-category-id="${categoryIdStr}"]`);
      if (selectedBtn) {
        selectedBtn.classList.add('active');
        selectedBtn.style.background = 'linear-gradient(135deg, #ff6b35 0%, #feca57 100%)';
        selectedBtn.style.color = 'white';
        selectedBtn.style.border = 'none';
        selectedBtn.style.boxShadow = '0 3px 10px rgba(255, 107, 53, 0.25)';
      }
      
      // ê²Œì‹œê¸€ ë¡œë“œ (categoryIdë¥¼ ë¬¸ìì—´ë¡œ ì „ë‹¬)
      loadBoardPostsByCategoryFilter(categoryIdStr);
    }
    window.selectBoardCategory = selectBoardCategory;
    
    /* ========== íŒì—… ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ (ê´€ë¦¬ì ëª¨ë“œ) ========== */
    
    // íŒì—… ëª©ë¡ ë¡œë“œ
    async function loadPopups() {
      const tbody = document.getElementById('popupListTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/popups/');
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ íŒì—…ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(popup => {
            const row = document.createElement('tr');
            // PostgreSQLì€ boolean, SQLiteëŠ” 1/0
            const isActive = typeof popup.is_active === 'boolean' ? popup.is_active : popup.is_active === 1;
            const statusText = isActive ? 'í™œì„±' : 'ë¹„í™œì„±';
            const statusClass = isActive ? 'success' : 'error';
            const startDate = popup.start_date ? popup.start_date.split('T')[0] : '';
            const endDate = popup.end_date ? popup.end_date.split('T')[0] : '';
            const createdDate = popup.created_at ? popup.created_at.split('T')[0] : '';
            
            row.innerHTML = `
              <td>${escapeHtml(popup.title || '')}</td>
              <td>${startDate}</td>
              <td>${endDate}</td>
              <td><span class="${statusClass}">${statusText}</span></td>
              <td>${createdDate}</td>
              <td>
                <button class="edit-btn" onclick="editPopup(${popup.id})" style="margin-right: 8px;">ìˆ˜ì •</button>
                <button class="delete-btn" onclick="deletePopup(${popup.id})">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">íŒì—…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('íŒì—… ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">íŒì—…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadPopups = loadPopups;
    
    // íŒì—… í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function togglePopupForm() {
      const form = document.getElementById('popupForm');
      const icon = document.getElementById('addPopupIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none' || !form.style.display;
        form.style.display = isHidden ? 'block' : 'none';
        icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
        
        if (isHidden) {
          // í¼ ì—´ ë•Œ ì´ˆê¸°í™”
          resetPopupForm();
        }
      }
    }
    window.togglePopupForm = togglePopupForm;
    
    // íŒì—… í¼ ì´ˆê¸°í™”
    function resetPopupForm() {
      document.getElementById('popupId').value = '';
      document.getElementById('popupTitleInput').value = '';
      document.getElementById('popupContentText').value = '';
      document.getElementById('popupStartDate').value = '';
      document.getElementById('popupEndDate').value = '';
      document.getElementById('popupIsActive').checked = true;
      document.getElementById('popupImageUrl').value = '';
      document.getElementById('popupWidth').value = '600';
      document.getElementById('popupHeight').value = '400';
      removePopupImage();
      const message = document.getElementById('popupMessage');
      if (message) {
        message.textContent = '';
        message.className = '';
      }
    }
    window.resetPopupForm = resetPopupForm;
    
    // íŒì—… ì´ë¯¸ì§€ ì„ íƒ ì²˜ë¦¬
    async function handlePopupImageSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        alert('ì´ë¯¸ì§€ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      const formData = new FormData();
      formData.append('file', file);
      
      try {
        const response = await fetch('/api/board/upload', {
          method: 'POST',
          body: formData
        });
        const result = await response.json();
        
        if (result.success && result.data) {
          const imageUrl = result.data.file_url;
          document.getElementById('popupImageUrl').value = imageUrl;
          document.getElementById('popupImagePreviewImg').src = imageUrl;
          document.getElementById('popupImagePreview').style.display = 'block';
          document.getElementById('removePopupImageBtn').style.display = 'inline-block';
        } else {
          alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (error) {
        console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.handlePopupImageSelect = handlePopupImageSelect;
    
    // íŒì—… ì´ë¯¸ì§€ ì œê±°
    function removePopupImage() {
      document.getElementById('popupImageUrl').value = '';
      document.getElementById('popupImageInput').value = '';
      document.getElementById('popupImagePreview').style.display = 'none';
      document.getElementById('removePopupImageBtn').style.display = 'none';
    }
    window.removePopupImage = removePopupImage;
    
    // íŒì—… ì €ì¥
    async function savePopup() {
      const popupId = document.getElementById('popupId');
      const titleEl = document.getElementById('popupTitleInput');
      const contentEl = document.getElementById('popupContentText');
      const startDateEl = document.getElementById('popupStartDate');
      const endDateEl = document.getElementById('popupEndDate');
      const imageUrlEl = document.getElementById('popupImageUrl');
      const widthEl = document.getElementById('popupWidth');
      const heightEl = document.getElementById('popupHeight');
      const isActiveEl = document.getElementById('popupIsActive');
      const message = document.getElementById('popupMessage');
      
      if (!popupId || !titleEl || !contentEl || !startDateEl || !endDateEl) {
        console.error('í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        if (message) {
          message.textContent = 'âŒ í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.';
          message.className = 'error';
        }
        return;
      }
      
      const popupIdValue = popupId.value;
      const title = titleEl.value.trim();
      const content = contentEl.value.trim();
      const startDate = startDateEl.value;
      const endDate = endDateEl.value;
      const imageUrl = imageUrlEl ? imageUrlEl.value.trim() : '';
      const width = widthEl ? (parseInt(widthEl.value) || 600) : 600;
      const height = heightEl ? (parseInt(heightEl.value) || 400) : 400;
      const isActive = isActiveEl ? isActiveEl.checked : true;
      
      console.log('íŒì—… ì €ì¥ ì‹œë„:', { popupIdValue, title, content, startDate, endDate, imageUrl, width, height, isActive });
      
      if (!title || !content || !startDate || !endDate) {
        console.error('í•„ìˆ˜ í•„ë“œ ëˆ„ë½:', { title: !!title, content: !!content, startDate: !!startDate, endDate: !!endDate });
        if (message) {
          message.textContent = 'âŒ ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
          message.className = 'error';
        }
        return;
      }
      
      if (new Date(startDate) > new Date(endDate)) {
        if (message) {
          message.textContent = 'âŒ ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.';
          message.className = 'error';
        }
        return;
      }
      
      const data = {
        title,
        content,
        start_date: startDate,
        end_date: endDate,
        image_url: imageUrl || null,
        width: width,
        height: height,
        is_active: isActive
      };
      
      console.log('íŒì—… ì €ì¥ ë°ì´í„°:', data);
      
      try {
        let response;
        if (popupIdValue) {
          // ìˆ˜ì •
          console.log('íŒì—… ìˆ˜ì • ìš”ì²­:', popupIdValue);
          response = await fetch(`/api/popups/${popupIdValue}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        } else {
          // ìƒì„±
          console.log('íŒì—… ìƒì„± ìš”ì²­');
          response = await fetch('/api/popups/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        }
        
        console.log('íŒì—… ì €ì¥ ì‘ë‹µ ìƒíƒœ:', response.status);
        const result = await response.json();
        console.log('íŒì—… ì €ì¥ ì‘ë‹µ ë°ì´í„°:', result);
        
        if (result.success) {
          if (message) {
            message.textContent = 'âœ… ' + result.message;
            message.className = 'success';
          }
          setTimeout(() => {
            resetPopupForm();
            togglePopupForm();
            loadPopups();
          }, 500);
        } else {
          if (message) {
            message.textContent = 'âŒ ' + (result.message || 'ì €ì¥ ì‹¤íŒ¨');
            message.className = 'error';
          }
        }
      } catch (error) {
        console.error('íŒì—… ì €ì¥ ì˜¤ë¥˜:', error);
        if (message) {
          message.textContent = 'âŒ íŒì—… ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
          message.className = 'error';
        }
      }
    }
    window.savePopup = savePopup;
    // íŒì—… ìˆ˜ì •
    async function editPopup(popupId) {
      try {
        const response = await fetch(`/api/popups/${popupId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const popup = result.data;
          document.getElementById('popupId').value = popup.id;
          document.getElementById('popupTitleInput').value = popup.title || '';
          document.getElementById('popupContentText').value = popup.content || '';
          document.getElementById('popupStartDate').value = popup.start_date ? popup.start_date.split('T')[0] : '';
          document.getElementById('popupEndDate').value = popup.end_date ? popup.end_date.split('T')[0] : '';
          document.getElementById('popupWidth').value = popup.width || 600;
          document.getElementById('popupHeight').value = popup.height || 400;
          // PostgreSQLì€ boolean, SQLiteëŠ” 1/0
          const isActive = typeof popup.is_active === 'boolean' ? popup.is_active : popup.is_active === 1;
          document.getElementById('popupIsActive').checked = isActive;
          
          // ì´ë¯¸ì§€ ì„¤ì •
          if (popup.image_url) {
            document.getElementById('popupImageUrl').value = popup.image_url;
            document.getElementById('popupImagePreviewImg').src = popup.image_url;
            document.getElementById('popupImagePreview').style.display = 'block';
            document.getElementById('removePopupImageBtn').style.display = 'inline-block';
          } else {
            removePopupImage();
          }
          
          // í¼ ì—´ê¸°
          const form = document.getElementById('popupForm');
          const icon = document.getElementById('addPopupIcon');
          if (form && icon) {
            form.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
          }
        } else {
          alert('íŒì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('íŒì—… ìˆ˜ì • ì˜¤ë¥˜:', error);
        alert('íŒì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.editPopup = editPopup;
    // íŒì—… ì‚­ì œ
    async function deletePopup(popupId) {
      if (!confirm('ì •ë§ë¡œ ì´ íŒì—…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/popups/${popupId}`, {
          method: 'DELETE'
        });
        const result = await response.json();
        
        if (result.success) {
          alert('âœ… ' + result.message);
          loadPopups();
        } else {
          alert('âŒ ' + (result.message || 'ì‚­ì œ ì‹¤íŒ¨'));
        }
      } catch (error) {
        console.error('íŒì—… ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('âŒ íŒì—… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.deletePopup = deletePopup;
    
    /* ========== í—¤ë” ë°°ë„ˆ ê´€ë¦¬ ê´€ë ¨ í•¨ìˆ˜ (ê´€ë¦¬ì ëª¨ë“œ) ========== */
    
    // ë°°ë„ˆ ëª©ë¡ ë¡œë“œ
    async function hbLoadBanners() {
      const tbody = document.getElementById('hbBannerListTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/header-banners/');
        const result = await response.json();
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë“±ë¡ëœ ë°°ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach(banner => {
            const row = document.createElement('tr');
            const isActive = typeof banner.is_active === 'boolean' ? banner.is_active : banner.is_active === 1;
            const statusText = isActive ? 'í™œì„±' : 'ë¹„í™œì„±';
            const statusClass = isActive ? 'success' : 'error';
            const createdDate = banner.created_at ? banner.created_at.split('T')[0] : '';
            let linkText = 'ì—†ìŒ';
            if (banner.link_type === 'board_post' && banner.board_post_id) {
              linkText = `ê²Œì‹œê¸€ #${banner.board_post_id}`;
            }
            
            row.innerHTML = `
              <td style="text-align: center;">${banner.display_order || 0}</td>
              <td>${escapeHtml(banner.text || '')}</td>
              <td>${linkText}</td>
              <td><span class="${statusClass}">${statusText}</span></td>
              <td>${createdDate}</td>
              <td>
                <button class="edit-btn" onclick="hbEditBanner(${banner.id})" style="margin-right: 8px;">ìˆ˜ì •</button>
                <button class="delete-btn" onclick="hbDeleteBanner(${banner.id})">ì‚­ì œ</button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë°°ë„ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ë°°ë„ˆ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë°°ë„ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.hbLoadBanners = hbLoadBanners;
    
    // ë°°ë„ˆ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function hbToggleBannerForm() {
      const form = document.getElementById('hbBannerForm');
      const icon = document.getElementById('hbAddBannerIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none' || !form.style.display;
        form.style.display = isHidden ? 'block' : 'none';
        icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
        
        if (isHidden) {
          hbResetBannerForm();
          hbLoadBoardPostsForSelect();
        }
      }
    }
    window.hbToggleBannerForm = hbToggleBannerForm;
    
    // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ (ë°°ë„ˆ ë§í¬ìš©)
    async function hbLoadBoardPostsForSelect() {
      const select = document.getElementById('hbBoardPostSelect');
      if (!select) return;
      
      try {
        const response = await fetch('/api/board/posts');
        const result = await response.json();
        
        if (result.success && result.data) {
          select.innerHTML = '<option value="">ê²Œì‹œê¸€ ì„ íƒ</option>';
          result.data.forEach(post => {
            const option = document.createElement('option');
            option.value = post.id;
            option.textContent = `${escapeHtml(post.title || '')} (${post.created_at ? post.created_at.split('T')[0] : ''})`;
            select.appendChild(option);
          });
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        select.innerHTML = '<option value="">ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨</option>';
      }
    }
    window.hbLoadBoardPostsForSelect = hbLoadBoardPostsForSelect;
    
    // ë§í¬ íƒ€ì… ë³€ê²½ ì‹œ ê²Œì‹œê¸€ ì„ íƒ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
    function hbToggleBoardPostSelect() {
      const linkType = document.getElementById('hbBannerLinkType').value;
      const wrapper = document.getElementById('hbBoardPostSelectWrapper');
      if (wrapper) {
        wrapper.style.display = linkType === 'board_post' ? 'block' : 'none';
      }
    }
    window.hbToggleBoardPostSelect = hbToggleBoardPostSelect;
    
    // ë°°ë„ˆ í¼ ì´ˆê¸°í™”
    function hbResetBannerForm() {
      document.getElementById('hbBannerId').value = '';
      document.getElementById('hbBannerText').value = '';
      document.getElementById('hbBannerLinkType').value = 'none';
      document.getElementById('hbBoardPostSelect').value = '';
      document.getElementById('hbBannerDisplayOrder').value = '0';
      document.getElementById('hbBannerIsActive').checked = true;
      document.getElementById('hbBannerTextColor').value = '#2d3436';
      document.getElementById('hbBannerBgColor').value = '#fff9e6';
      hbToggleBoardPostSelect();
      const message = document.getElementById('hbBannerMessage');
      if (message) {
        message.textContent = '';
        message.className = '';
      }
    }
    window.hbResetBannerForm = hbResetBannerForm;
    
    // ë°°ë„ˆ ì €ì¥
    async function hbSaveBanner() {
      const bannerId = document.getElementById('hbBannerId').value;
      const text = document.getElementById('hbBannerText').value.trim();
      const linkType = document.getElementById('hbBannerLinkType').value;
      const boardPostId = document.getElementById('hbBoardPostSelect').value;
      const displayOrder = parseInt(document.getElementById('hbBannerDisplayOrder').value) || 0;
      const isActive = document.getElementById('hbBannerIsActive').checked;
      const textColor = document.getElementById('hbBannerTextColor').value;
      const bgColor = document.getElementById('hbBannerBgColor').value;
      
      if (!text) {
        alert('ë°°ë„ˆ ë¬¸êµ¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const messageEl = document.getElementById('hbBannerMessage');
      if (messageEl) {
        messageEl.innerHTML = '<span style="color: #636e72;">ì €ì¥ ì¤‘...</span>';
      }
      
      try {
        const bannerData = {
          text: text,
          link_type: linkType,
          board_post_id: linkType === 'board_post' && boardPostId ? parseInt(boardPostId) : null,
          display_order: displayOrder,
          is_active: isActive,
          text_color: textColor,
          bg_color: bgColor
        };
        
        let response;
        if (bannerId) {
          // ìˆ˜ì •
          response = await fetch(`/api/header-banners/${bannerId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(bannerData)
          });
        } else {
          // ìƒì„±
          response = await fetch('/api/header-banners/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(bannerData)
          });
        }
        
        const result = await response.json();
        
        if (result.success) {
          if (messageEl) {
            messageEl.innerHTML = '<span style="color: #00b894;">âœ… ë°°ë„ˆê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          hbLoadBanners();
          hbLoadHeaderBanner(); // í—¤ë” ë°°ë„ˆ ìƒˆë¡œê³ ì¹¨
          setTimeout(() => {
            hbToggleBannerForm();
          }, 1000);
        } else {
          if (messageEl) {
            messageEl.innerHTML = `<span style="color: #e74c3c;">âŒ ${result.message || 'ë°°ë„ˆ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}</span>`;
          }
        }
      } catch (error) {
        console.error('ë°°ë„ˆ ì €ì¥ ì˜¤ë¥˜:', error);
        if (messageEl) {
          messageEl.innerHTML = '<span style="color: #e74c3c;">âŒ ë°°ë„ˆ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>';
        }
      }
    }
    window.hbSaveBanner = hbSaveBanner;
    
    // ë°°ë„ˆ ìˆ˜ì •
    async function hbEditBanner(bannerId) {
      try {
        const response = await fetch(`/api/header-banners/${bannerId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const banner = result.data;
          document.getElementById('hbBannerId').value = banner.id;
          document.getElementById('hbBannerText').value = banner.text || '';
          document.getElementById('hbBannerLinkType').value = banner.link_type || 'none';
          document.getElementById('hbBoardPostSelect').value = banner.board_post_id || '';
          document.getElementById('hbBannerDisplayOrder').value = banner.display_order || 0;
          const isActive = typeof banner.is_active === 'boolean' ? banner.is_active : banner.is_active === 1;
          document.getElementById('hbBannerIsActive').checked = isActive;
          document.getElementById('hbBannerTextColor').value = banner.text_color || '#2d3436';
          document.getElementById('hbBannerBgColor').value = banner.bg_color || '#fff9e6';
          
          hbToggleBoardPostSelect();
          
          // í¼ ì—´ê¸°
          const form = document.getElementById('hbBannerForm');
          const icon = document.getElementById('hbAddBannerIcon');
          if (form && icon) {
            form.style.display = 'block';
            icon.style.transform = 'rotate(180deg)';
          }
          
          // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
          hbLoadBoardPostsForSelect();
        } else {
          alert('ë°°ë„ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë°°ë„ˆ ìˆ˜ì • ì˜¤ë¥˜:', error);
        alert('ë°°ë„ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.hbEditBanner = hbEditBanner;
    
    // ë°°ë„ˆ ì‚­ì œ
    async function hbDeleteBanner(bannerId) {
      if (!confirm('ì •ë§ë¡œ ì´ ë°°ë„ˆë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/header-banners/${bannerId}`, {
          method: 'DELETE'
        });
        const result = await response.json();
        
        if (result.success) {
          alert('ë°°ë„ˆê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          hbLoadBanners();
          hbLoadHeaderBanner(); // í—¤ë” ë°°ë„ˆ ìƒˆë¡œê³ ì¹¨
        } else {
          alert(result.message || 'ë°°ë„ˆ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ë°°ë„ˆ ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('âŒ ë°°ë„ˆ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.hbDeleteBanner = hbDeleteBanner;
    
    /* ========== í—¤ë” ë°°ë„ˆ í‘œì‹œ ê´€ë ¨ í•¨ìˆ˜ (ì‚¬ìš©ììš©) ========== */
    
    // í—¤ë” ë°°ë„ˆ ë¡œë“œ ë° í‘œì‹œ
    let hbCurrentBannerIndex = 0;
    let hbBannerInterval = null;
    
    async function hbLoadHeaderBanner() {
      const container = document.getElementById('hbBannerContainer');
      const wrapper = document.getElementById('hbBannerWrapper');
      if (!container || !wrapper) return;
      
      try {
        const response = await fetch('/api/header-banners/active');
        const result = await response.json();
        
        if (result.success && result.data && result.data.length > 0) {
          const banners = result.data;
          container.style.display = 'block';
          
          // ê¸°ì¡´ ë°°ë„ˆ ì œê±°
          wrapper.innerHTML = '';
          hbCurrentBannerIndex = 0;
          
          // ë°°ë„ˆ ì•„ì´í…œ ìƒì„±
          banners.forEach((banner, index) => {
            const bannerItem = document.createElement('div');
            bannerItem.className = 'hb-banner-item';
            bannerItem.dataset.index = index;
            const bgColor = banner.bg_color || '#fff9e6';
            const textColor = banner.text_color || '#ff6b35';
            bannerItem.style.cssText = `
              min-width: 100%;
              height: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 0 24px;
              background: ${bgColor};
              cursor: ${banner.link_type === 'board_post' && banner.board_post_id ? 'pointer' : 'default'};
              white-space: nowrap;
              overflow: hidden;
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
            `;
            
            // ì²« ë²ˆì§¸ ë°°ë„ˆëŠ” ì¦‰ì‹œ í‘œì‹œ, ë‚˜ë¨¸ì§€ëŠ” ì˜¤ë¥¸ìª½ì— ìˆ¨ê¹€
            if (index === 0) {
              bannerItem.style.transform = 'translateX(0)';
              bannerItem.style.opacity = '1';
            } else {
              bannerItem.style.transform = 'translateX(100%)';
              bannerItem.style.opacity = '0';
            }
            
            // í…ìŠ¤íŠ¸ê°€ ê¸¸ë©´ íë¥´ëŠ” íš¨ê³¼, ì§§ìœ¼ë©´ ì¤‘ì•™ ì •ë ¬
            const textLength = (banner.text || '').length;
            const needsMarquee = textLength > 25;
            
            if (needsMarquee) {
              // í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ê³„ì‚° (1ì´ˆì— ì•½ 30px ì´ë™ - ë” ëŠë¦¬ê²Œ)
              const textWidth = textLength * 12; // ëŒ€ëµì ì¸ í…ìŠ¤íŠ¸ ë„ˆë¹„ ê³„ì‚° (í°íŠ¸ í¬ê¸° 18px + ì—¬ë°±)
              const animationDuration = Math.max(15, (textWidth / 30)); // ìµœì†Œ 15ì´ˆ, ë” ëŠë¦¬ê²Œ
              
              // ë§ˆí€´ íš¨ê³¼ë¥¼ ìœ„í•´ í…ìŠ¤íŠ¸ë¥¼ í•œ ë²ˆë§Œ íë¥´ê²Œ (ë¬´í•œ ë°˜ë³µ ì—†ìŒ)
              const marqueeContainer = document.createElement('div');
              marqueeContainer.style.cssText = `
                display: flex;
                align-items: center;
                height: 100%;
                width: 100%;
                position: relative;
                z-index: 2;
                overflow: hidden;
              `;
              
              const textSpan = document.createElement('span');
              textSpan.className = 'hb-banner-text';
              textSpan.textContent = banner.text || '';
              textSpan.style.cssText = `
                display: inline-block;
                font-weight: 800;
                font-size: 18px;
                letter-spacing: 1px;
                color: ${textColor};
                white-space: nowrap;
                padding: 0 30px;
                animation: hbBlink 3s ease-in-out infinite, hbMarqueeLeftOnce ${animationDuration}s linear forwards;
              `;
              
              marqueeContainer.appendChild(textSpan);
              bannerItem.appendChild(marqueeContainer);
              
              // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ ì‹œê°„ì„ ë°°ë„ˆ ì•„ì´í…œì— ì €ì¥
              bannerItem.dataset.animationDuration = animationDuration;
              bannerItem.dataset.needsMarquee = 'true';
            } else {
              // ì§§ì€ í…ìŠ¤íŠ¸ëŠ” ì¤‘ì•™ ì •ë ¬
              const textSpan = document.createElement('span');
              textSpan.className = 'hb-banner-text';
              textSpan.textContent = banner.text || '';
              textSpan.style.cssText = `
                display: inline-block;
                font-weight: 800;
                font-size: 18px;
                letter-spacing: 1px;
                color: ${textColor};
                white-space: nowrap;
                position: relative;
                z-index: 2;
                animation: hbBlink 3s ease-in-out infinite;
              `;
              bannerItem.appendChild(textSpan);
            }
            
            // í´ë¦­ ì´ë²¤íŠ¸ (ê²Œì‹œê¸€ ë§í¬)
            if (banner.link_type === 'board_post' && banner.board_post_id) {
              bannerItem.onclick = () => {
                // ê²Œì‹œíŒ íƒ­ìœ¼ë¡œ ì „í™˜í•˜ê³  í•´ë‹¹ ê²Œì‹œê¸€ í‘œì‹œ
                if (currentRole === 'ê´€ë¦¬ì') {
                  switchAdminTab('board');
                  setTimeout(() => {
                    // ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° í•¨ìˆ˜ í˜¸ì¶œ (ê²Œì‹œíŒ APIì— ë”°ë¼ ìˆ˜ì • í•„ìš”)
                    if (typeof showBoardDetail === 'function') {
                      showBoardDetail(banner.board_post_id);
                    }
                  }, 500);
                } else {
                  switchMenu('board');
                  setTimeout(() => {
                    if (typeof showBoardDetail === 'function') {
                      showBoardDetail(banner.board_post_id);
                    }
                  }, 500);
                }
              };
              bannerItem.style.textDecoration = 'underline';
            }
            
            wrapper.appendChild(bannerItem);
          });
          
          // ë°°ë„ˆê°€ 1ê°œ ì´ìƒì´ë©´ ì¹´ë£¨ì…€ ì‹œì‘
          if (banners.length > 1) {
            hbStartBannerCarousel();
          } else {
            // ë°°ë„ˆê°€ í•˜ë‚˜ì¼ ë•ŒëŠ” ì²« ë²ˆì§¸ ë°°ë„ˆë§Œ í‘œì‹œ
            const firstBannerElement = wrapper.querySelector('.hb-banner-item');
            if (firstBannerElement) {
              firstBannerElement.style.transform = 'translateX(0)';
              firstBannerElement.style.opacity = '1';
            }
          }
        } else {
          container.style.display = 'none';
          hbStopBannerCarousel();
        }
      } catch (error) {
        console.error('í—¤ë” ë°°ë„ˆ ë¡œë“œ ì˜¤ë¥˜:', error);
        container.style.display = 'none';
      }
    }
    window.hbLoadHeaderBanner = hbLoadHeaderBanner;
    
    // ë°°ë„ˆ ì¹´ë£¨ì…€ ì‹œì‘
    function hbStartBannerCarousel() {
      hbStopBannerCarousel();
      const wrapper = document.getElementById('hbBannerWrapper');
      if (!wrapper) return;
      
      const banners = wrapper.querySelectorAll('.hb-banner-item');
      if (banners.length <= 1) return;
      
      // ì´ˆê¸° ìœ„ì¹˜ ì„¤ì • - ì²« ë²ˆì§¸ ë°°ë„ˆë§Œ í‘œì‹œ (ì™¼ìª½ì—ì„œ ì‹œì‘)
      banners.forEach((banner, index) => {
        if (index === 0) {
          banner.style.transform = 'translateX(0)';
          banner.style.opacity = '1';
          banner.style.transition = 'none';
          // ì²« ë²ˆì§¸ ë°°ë„ˆì˜ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
          const firstBannerText = banner.querySelector('.hb-banner-text');
          if (firstBannerText) {
            firstBannerText.style.transform = 'translateX(100%)';
            setTimeout(() => {
              firstBannerText.style.transform = '';
            }, 10);
          }
        } else {
          banner.style.transform = 'translateX(100%)';
          banner.style.opacity = '0';
          banner.style.transition = 'none';
          // ìˆ¨ê²¨ì§„ ë°°ë„ˆì˜ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì¼ì‹œì •ì§€
          const hiddenBannerText = banner.querySelector('.hb-banner-text');
          if (hiddenBannerText) {
            hiddenBannerText.style.animationPlayState = 'paused';
            hiddenBannerText.style.transform = 'translateX(100%)';
          }
        }
      });
      
      // ë‹¤ìŒ ë°°ë„ˆë¡œ ì „í™˜í•˜ëŠ” í•¨ìˆ˜
      function switchToNextBanner() {
        // ë°°ë„ˆ ëª©ë¡ì„ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ ìµœì‹  ìƒíƒœ ìœ ì§€
        const currentBanners = wrapper.querySelectorAll('.hb-banner-item');
        if (currentBanners.length === 0) {
          console.warn('ë°°ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        const currentBanner = currentBanners[hbCurrentBannerIndex];
        const nextIndex = (hbCurrentBannerIndex + 1) % currentBanners.length;
        const nextBanner = currentBanners[nextIndex];
        
        // ë°°ë„ˆ ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        if (!currentBanner || !nextBanner) {
          console.warn('ë°°ë„ˆ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', { hbCurrentBannerIndex, nextIndex, currentBannersLength: currentBanners.length });
          return;
        }
        
        console.log('ë°°ë„ˆ ì „í™˜:', hbCurrentBannerIndex, '->', nextIndex);
        
        // í˜„ì¬ ë°°ë„ˆë¥¼ ì™¼ìª½ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ
        currentBanner.style.transition = 'transform 0.3s ease-in-out, opacity 0.3s ease-in-out';
        currentBanner.style.transform = 'translateX(-100%)';
        currentBanner.style.opacity = '0';
        
        // ë‹¤ìŒ ë°°ë„ˆë¥¼ ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ ë‚˜ì˜¤ê²Œ
        nextBanner.style.transition = 'transform 0.3s ease-in-out, opacity 0.3s ease-in-out';
        nextBanner.style.transform = 'translateX(0)';
        nextBanner.style.opacity = '1';
        
        // ë‹¤ìŒ ë°°ë„ˆì˜ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì™„ì „íˆ ì¬ì‹œì‘
        const nextBannerText = nextBanner.querySelector('.hb-banner-text');
        if (nextBannerText) {
          // í…ìŠ¤íŠ¸ì˜ transform ì´ˆê¸°í™”
          nextBannerText.style.transform = 'translateX(100%)';
          // ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘ì„ ìœ„í•´ ì ì‹œ ì œê±° í›„ ë‹¤ì‹œ ì¶”ê°€
          const animation = nextBannerText.style.animation;
          nextBannerText.style.animation = 'none';
          // ê°•ì œë¡œ ë¦¬í”Œë¡œìš° ë°œìƒ
          void nextBannerText.offsetWidth;
          // ì• ë‹ˆë©”ì´ì…˜ ë³µì›
          nextBannerText.style.animation = animation;
          // transform ì´ˆê¸°í™” ì œê±° (ì• ë‹ˆë©”ì´ì…˜ì´ ë‹¤ì‹œ ì‹œì‘ë˜ë„ë¡)
          setTimeout(() => {
            nextBannerText.style.transform = '';
          }, 10);
        }
        
        hbCurrentBannerIndex = nextIndex;
        
        // ë‹¤ìŒ ë°°ë„ˆì˜ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ í™•ì¸
        const nextNeedsMarquee = nextBanner.dataset.needsMarquee === 'true';
        
        if (nextNeedsMarquee) {
          // ê¸´ í…ìŠ¤íŠ¸ì¸ ê²½ìš° ì €ì¥ëœ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ì‚¬ìš©
          const animationDuration = parseFloat(nextBanner.dataset.animationDuration) || 15;
          const animationDurationMs = animationDuration * 1000; // ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
          console.log('ë‹¤ìŒ ë°°ë„ˆ ì „í™˜ ì˜ˆì•½:', animationDurationMs, 'ms í›„');
          // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ ë‹¤ìŒ ë°°ë„ˆë¡œ ì „í™˜
          hbBannerInterval = setTimeout(switchToNextBanner, animationDurationMs);
        } else {
          // ì§§ì€ í…ìŠ¤íŠ¸ì¸ ê²½ìš° 5ì´ˆ í›„ ë‹¤ìŒ ë°°ë„ˆë¡œ ì „í™˜
          console.log('ë‹¤ìŒ ë°°ë„ˆ ì „í™˜ ì˜ˆì•½: 5ì´ˆ í›„');
          hbBannerInterval = setTimeout(switchToNextBanner, 5000);
        }
      }
      
      // ì²« ë²ˆì§¸ ë°°ë„ˆì˜ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ í™•ì¸
      const firstBanner = banners[0];
      const firstNeedsMarquee = firstBanner.dataset.needsMarquee === 'true';
      
      if (firstNeedsMarquee) {
        // ê¸´ í…ìŠ¤íŠ¸ì¸ ê²½ìš° ì €ì¥ëœ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ì‚¬ìš©
        const animationDuration = parseFloat(firstBanner.dataset.animationDuration) || 15;
        const animationDurationMs = animationDuration * 1000; // ë°€ë¦¬ì´ˆë¡œ ë³€í™˜
        console.log('ì²« ë²ˆì§¸ ë°°ë„ˆ ì „í™˜ ì˜ˆì•½:', animationDurationMs, 'ms í›„');
        // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚œ í›„ ë‹¤ìŒ ë°°ë„ˆë¡œ ì „í™˜
        hbBannerInterval = setTimeout(switchToNextBanner, animationDurationMs);
      } else {
        // ì§§ì€ í…ìŠ¤íŠ¸ì¸ ê²½ìš° 5ì´ˆ í›„ ë‹¤ìŒ ë°°ë„ˆë¡œ ì „í™˜
        console.log('ì²« ë²ˆì§¸ ë°°ë„ˆ ì „í™˜ ì˜ˆì•½: 5ì´ˆ í›„');
        hbBannerInterval = setTimeout(switchToNextBanner, 5000);
      }
    }
    window.hbStartBannerCarousel = hbStartBannerCarousel;
    
    // ë°°ë„ˆ ì¹´ë£¨ì…€ ì¤‘ì§€
    function hbStopBannerCarousel() {
      if (hbBannerInterval) {
        clearTimeout(hbBannerInterval);
        hbBannerInterval = null;
      }
    }
    window.hbStopBannerCarousel = hbStopBannerCarousel;
    
    /* ========== íŒì—… í‘œì‹œ ê´€ë ¨ í•¨ìˆ˜ (ì‚¬ìš©ììš©) ========== */
    
    // í™œì„± íŒì—… í™•ì¸ ë° í‘œì‹œ
    async function checkAndShowPopup() {
      // ì´ë¯¸ ë‹«ì€ íŒì—…ì¸ì§€ í™•ì¸ (localStorage - í•˜ë£¨ ë™ì•ˆ í‘œì‹œ ì•ˆ í•¨)
      const closedPopupData = localStorage.getItem('closedPopupData');
      let closedPopupInfo = null;
      
      if (closedPopupData) {
        try {
          closedPopupInfo = JSON.parse(closedPopupData);
          // ì˜¤ëŠ˜ ë‚ ì§œì™€ ë¹„êµ
          const today = new Date().toISOString().split('T')[0];
          if (closedPopupInfo.date !== today) {
            // í•˜ë£¨ê°€ ì§€ë‚¬ìœ¼ë©´ ì‚­ì œ
            localStorage.removeItem('closedPopupData');
            closedPopupInfo = null;
          }
        } catch (e) {
          // íŒŒì‹± ì˜¤ë¥˜ ì‹œ ì‚­ì œ
          localStorage.removeItem('closedPopupData');
        }
      }
      
      try {
        const response = await fetch('/api/popups/active', {
          signal: AbortSignal.timeout(5000) // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
        });
        
        if (!response.ok) {
          // 504 íƒ€ì„ì•„ì›ƒ ë“± ì˜¤ë¥˜ ì‹œ ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰
          return;
        }
        
        const result = await response.json();
        
        if (result.success && result.data) {
          const popup = result.data;
          
          // ì´ë¯¸ ë‹«ì€ íŒì—…ì´ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ (í•˜ë£¨ ë™ì•ˆ)
          if (closedPopupInfo && closedPopupInfo.popupId === popup.id) {
            return;
          }
          
          // íŒì—… í‘œì‹œ
          showPopup(popup);
        }
      } catch (error) {
        // íƒ€ì„ì•„ì›ƒì´ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ë¬´ì‹œ (ì‚¬ì´íŠ¸ ë¡œë”© ë°©ì§€)
        if (error.name === 'AbortError' || error.name === 'TimeoutError') {
          console.warn('íŒì—… ì¡°íšŒ íƒ€ì„ì•„ì›ƒ (ë¬´ì‹œ)');
        } else {
          console.error('í™œì„± íŒì—… í™•ì¸ ì˜¤ë¥˜:', error);
        }
      }
    }
    window.checkAndShowPopup = checkAndShowPopup;
    
    // íŒì—… í‘œì‹œ
    function showPopup(popup) {
      const layer = document.getElementById('popupLayer');
      const popupContentDiv = document.getElementById('popupContent');
      const title = document.getElementById('popupTitle');
      const body = document.getElementById('popupBody');
      
      if (layer && popupContentDiv && title && body) {
        title.textContent = popup.title || '';
        
        // ì´ë¯¸ì§€ í‘œì‹œ
        const imageUrl = popup.image_url;
        let bodyContent = '';
        if (imageUrl) {
          bodyContent = `<img src="${escapeHtml(imageUrl)}" alt="íŒì—… ì´ë¯¸ì§€" style="max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 15px; display: block;">`;
        }
        bodyContent += `<div style="white-space: pre-wrap;">${escapeHtml(popup.content || '')}</div>`;
        body.innerHTML = bodyContent;
        
        // ì‚¬ì´ì¦ˆ ì„¤ì •
        const width = popup.width || 600;
        const height = popup.height || 400;
        popupContentDiv.style.width = width + 'px';
        popupContentDiv.style.maxWidth = width + 'px';
        popupContentDiv.style.maxHeight = height + 'px';
        
        layer.style.display = 'flex';
        
        // íŒì—… IDë¥¼ data ì†ì„±ì— ì €ì¥ (ë‹«ì„ ë•Œ ì‚¬ìš©)
        layer.setAttribute('data-popup-id', popup.id);
      }
    }
    window.showPopup = showPopup;
    
    // íŒì—… ë‹«ê¸° (ì¼ì‹œì ìœ¼ë¡œë§Œ ë‹«ê¸°)
    function closePopup() {
      const layer = document.getElementById('popupLayer');
      if (layer) {
        layer.style.display = 'none';
      }
    }
    window.closePopup = closePopup;
    
    // íŒì—… ë‹«ê¸° (í•˜ë£¨ ë™ì•ˆ í‘œì‹œ ì•ˆ í•¨)
    function closePopupForToday() {
      const layer = document.getElementById('popupLayer');
      if (layer) {
        const popupId = layer.getAttribute('data-popup-id');
        if (popupId) {
          // ë‹«ì€ íŒì—… ì •ë³´ë¥¼ localStorageì— ì €ì¥ (ì˜¤ëŠ˜ ë‚ ì§œì™€ í•¨ê»˜ ì €ì¥í•˜ì—¬ í•˜ë£¨ ë™ì•ˆ ë‹¤ì‹œ í‘œì‹œí•˜ì§€ ì•ŠìŒ)
          const today = new Date().toISOString().split('T')[0];
          const closedPopupData = {
            popupId: parseInt(popupId),
            date: today
          };
          localStorage.setItem('closedPopupData', JSON.stringify(closedPopupData));
        }
        layer.style.display = 'none';
      }
    }
    window.closePopupForToday = closePopupForToday;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ì¹´í…Œê³ ë¦¬ í•„í„°ë¡œ ê²Œì‹œê¸€ ë¡œë“œ
    async function loadBoardPostsByCategoryFilter(categoryId = null) {
      // categoryIdê°€ ì œê³µë˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ ì„ íƒëœ ë²„íŠ¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°
      if (categoryId === null) {
        const activeBtn = document.querySelector('.category-menu-btn.active');
        categoryId = activeBtn ? activeBtn.getAttribute('data-category-id') || '' : '';
      }
      
      const tbody = document.getElementById('boardPostList');
      
      if (!tbody) return;
      
      tbody.innerHTML = '<tr><td colspan="5" class="no-data">ë¡œë”© ì¤‘...</td></tr>';
      
      try {
        let url = '/api/board/posts';
        // categoryIdê°€ ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹ˆê³  ìœ íš¨í•œ ìˆ«ìì¸ ê²½ìš°ì—ë§Œ ì¶”ê°€
        if (categoryId && categoryId !== '' && !isNaN(parseInt(categoryId))) {
          const categoryIdNum = parseInt(categoryId);
          url += `?category_id=${categoryIdNum}`;
          console.log('ğŸ” ì¹´í…Œê³ ë¦¬ í•„í„°ë§:', { categoryId, categoryIdNum, url });
        } else {
          console.log('ğŸ” ì „ì²´ ê²Œì‹œê¸€ ì¡°íšŒ:', { categoryId, url });
        }
        
        const response = await fetch(url);
        const result = await response.json();
        
        console.log('ğŸ” API ì‘ë‹µ:', { success: result.success, count: result.count, dataLength: result.data ? result.data.length : 0 });
        
        if (result.success && result.data) {
          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="no-data">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
          }
          
          tbody.innerHTML = '';
          result.data.forEach((post, index) => {
            // is_pinned ì²´í¬ (ì—„ê²©í•˜ê²Œ - ë¬¸ìì—´ '1', ìˆ«ì 1, boolean trueë§Œ trueë¡œ ì¸ì‹)
            const isPinned = post.is_pinned === true || post.is_pinned === 1 || String(post.is_pinned) === '1';
            const categoryName = (post.category_name || '').trim();
            const isNoticeCategory = categoryName === 'ê³µì§€ì‚¬í•­';
            
            // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ê²Œì‹œê¸€ë§Œ ë¡œê·¸
            if (index === 0) {
              console.log('ğŸ” ê²Œì‹œê¸€ ìŠ¤íƒ€ì¼ ì²´í¬:', {
                id: post.id,
                title: post.title,
                is_pinned: post.is_pinned,
                isPinned: isPinned,
                category_name: categoryName,
                isNoticeCategory: isNoticeCategory
              });
            }
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            
            // ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì œëª© ìŠ¤íƒ€ì¼ ê²°ì •
            // 1ìˆœìœ„: ê³µì§€ì‚¬í•­ ì²´í¬(is_pinned) - ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
            // 2ìˆœìœ„: ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬ - êµµì€ ê¸€ì”¨
            // 3ìˆœìœ„: ë‚˜ë¨¸ì§€ - ì¼ë°˜ ìŠ¤íƒ€ì¼
            let titleStyle = '';
            let titlePrefix = '';
            
            if (isPinned) {
              // ê³µì§€ì‚¬í•­ ì²´í¬: ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
              titlePrefix = 'ğŸ“Œ ';
              titleStyle = 'font-weight: 700; color: #e74c3c;';
            } else if (isNoticeCategory) {
              // ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬: êµµì€ ê¸€ì”¨
              titleStyle = 'font-weight: 700; color: #2d3436;';
            } else {
              // ë‚˜ë¨¸ì§€: ì¼ë°˜ ìŠ¤íƒ€ì¼
              titleStyle = 'font-weight: normal; color: #2d3436;';
            }
            
            const tr = document.createElement('tr');
            tr.style.cursor = 'pointer';
            tr.onclick = () => showBoardDetail(post.id);
            tr.onmouseover = function() { this.style.backgroundColor = '#fff9e6'; };
            tr.onmouseout = function() { this.style.backgroundColor = ''; };
            
            tr.innerHTML = `
              <td style="text-align: center;">${result.data.length - index}</td>
              <td style="text-align: center;">
                <span style="font-size: 12px; color: #636e72; background: #fff9e6; padding: 4px 8px; border-radius: 4px;">${escapeHtml(post.category_name || '')}</span>
              </td>
              <td style="${titleStyle}">
                ${titlePrefix}${escapeHtml(post.title || '')}
              </td>
              <td style="text-align: center;">${escapeHtml(post.author_name || '')}</td>
              <td style="text-align: center;">${createdAt}</td>
            `;
            
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="5" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        tbody.innerHTML = '<tr><td colspan="5" class="no-data">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadBoardPostsByCategoryFilter = loadBoardPostsByCategoryFilter;
    
    // í™”ì£¼ì‚¬ ëª¨ë“œ: ì¹´í…Œê³ ë¦¬ë³„ ê²Œì‹œê¸€ ë¡œë“œ
    let currentBoardCategoryId = null;
    
    async function loadBoardPostsByCategory(categoryId) {
      currentBoardCategoryId = categoryId;
      const container = document.getElementById('boardPostList');
      const title = document.getElementById('boardCategoryTitle');
      
      if (!container) return;
      
      container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const response = await fetch(`/api/board/posts?category_id=${categoryId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          // ì¹´í…Œê³ ë¦¬ëª… ê°€ì ¸ì˜¤ê¸°
          const categoryResponse = await fetch('/api/board/categories');
          const categoryResult = await categoryResponse.json();
          const category = categoryResult.data.find(c => c.id == categoryId);
          if (title && category) {
            title.textContent = `ğŸ“‹ ${category.name}`;
          }
          
          if (result.data.length === 0) {
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #636e72;">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
          }
          
          container.innerHTML = '';
          result.data.forEach((post, idx) => {
            // is_pinned ì²´í¬ (ì—„ê²©í•˜ê²Œ - ë¬¸ìì—´ '1', ìˆ«ì 1, boolean trueë§Œ trueë¡œ ì¸ì‹)
            const isPinned = post.is_pinned === true || post.is_pinned === 1 || String(post.is_pinned) === '1';
            const categoryName = (post.category_name || '').trim();
            const isNoticeCategory = categoryName === 'ê³µì§€ì‚¬í•­';
            
            // ë””ë²„ê¹…: ì²« ë²ˆì§¸ ê²Œì‹œê¸€ë§Œ ë¡œê·¸
            if (idx === 0) {
              console.log('ğŸ” ê²Œì‹œê¸€ ìŠ¤íƒ€ì¼ ì²´í¬ (ì¹´ë“œ):', {
                id: post.id,
                title: post.title,
                is_pinned: post.is_pinned,
                isPinned: isPinned,
                category_name: categoryName,
                isNoticeCategory: isNoticeCategory
              });
            }
            const createdAt = post.created_at ? new Date(post.created_at).toLocaleDateString('ko-KR') : '-';
            
            // ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ì œëª© ìŠ¤íƒ€ì¼ ê²°ì •
            // 1ìˆœìœ„: ê³µì§€ì‚¬í•­ ì²´í¬(is_pinned) - ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
            // 2ìˆœìœ„: ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬ - êµµì€ ê¸€ì”¨
            // 3ìˆœìœ„: ë‚˜ë¨¸ì§€ - ì¼ë°˜ ìŠ¤íƒ€ì¼
            let titleFontWeight = 'normal';
            let titleColor = '#2d3436';
            let titlePrefix = '';
            
            if (isPinned) {
              // ê³µì§€ì‚¬í•­ ì²´í¬: ë¹¨ê°„ìƒ‰ êµµì€ ê¸€ì”¨
              titlePrefix = 'ğŸ“Œ ';
              titleFontWeight = '700';
              titleColor = '#e74c3c';
            } else if (isNoticeCategory) {
              // ê³µì§€ì‚¬í•­ ì¹´í…Œê³ ë¦¬: êµµì€ ê¸€ì”¨
              titleFontWeight = '700';
              titleColor = '#2d3436';
            } else {
              // ë‚˜ë¨¸ì§€: ì¼ë°˜ ìŠ¤íƒ€ì¼
              titleFontWeight = 'normal';
              titleColor = '#2d3436';
            }
            
            const postCard = document.createElement('div');
            postCard.style.cssText = 'background: #ffffff; border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s;';
            postCard.onclick = () => showBoardDetail(post.id);
            postCard.onmouseover = function() { this.style.transform = 'translateY(-2px)'; this.style.boxShadow = '0 4px 12px rgba(255, 107, 53, 0.2)'; };
            postCard.onmouseout = function() { this.style.transform = 'translateY(0)'; this.style.boxShadow = 'none'; };
            
            postCard.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <h4 style="margin: 0; color: ${titleColor}; font-size: 18px; font-weight: ${titleFontWeight};">
                  ${titlePrefix}${escapeHtml(post.title || '')}
                </h4>
                <span style="font-size: 12px; color: #636e72;">ì¡°íšŒìˆ˜: ${post.view_count || 0}</span>
              </div>
              <div style="color: #636e72; font-size: 13px; margin-bottom: 12px;">
                ì‘ì„±ì: ${escapeHtml(post.author_name || '')} | ì‘ì„±ì¼: ${createdAt}
              </div>
              <div style="color: #2d3436; font-size: 14px; line-height: 1.6; max-height: 60px; overflow: hidden; text-overflow: ellipsis;">
                ${escapeHtml((post.content || '').substring(0, 100))}${(post.content || '').length > 100 ? '...' : ''}
              </div>
            `;
            
            container.appendChild(postCard);
          });
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    window.loadBoardPostsByCategory = loadBoardPostsByCategory;
    
    // ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸°
    async function showBoardDetail(boardId) {
      // boardId ìœ íš¨ì„± ê²€ì‚¬
      if (!boardId || boardId === 'null' || boardId === 'undefined') {
        console.error('ê²Œì‹œê¸€ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', boardId);
        alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      try {
        const response = await fetch(`/api/board/posts/${boardId}`);
        const result = await response.json();
        
        if (result.success && result.data) {
          const post = result.data;
          const isPinned = post.is_pinned || (post.is_pinned === 1);
          // ì‘ì„±ì¼/ìˆ˜ì •ì¼ í¬ë§·íŒ… (null ì²´í¬ ê°•í™”)
          let createdAt = '-';
          if (post.created_at) {
            try {
              const date = new Date(post.created_at);
              if (!isNaN(date.getTime())) {
                createdAt = date.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                });
              }
            } catch (e) {
              console.error('ì‘ì„±ì¼ í¬ë§·íŒ… ì˜¤ë¥˜:', e);
              createdAt = post.created_at;
            }
          }
          
          let updatedAt = '-';
          if (post.updated_at) {
            try {
              const date = new Date(post.updated_at);
              if (!isNaN(date.getTime())) {
                updatedAt = date.toLocaleDateString('ko-KR', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                });
              }
            } catch (e) {
              console.error('ìˆ˜ì •ì¼ í¬ë§·íŒ… ì˜¤ë¥˜:', e);
              updatedAt = post.updated_at;
            }
          }
          
          // ì¡°íšŒìˆ˜ ì¦ê°€ API í˜¸ì¶œ
          try {
            await fetch(`/api/board/posts/${boardId}/view`, { method: 'POST' });
          } catch (e) {
            console.error('ì¡°íšŒìˆ˜ ì¦ê°€ ì˜¤ë¥˜:', e);
          }
          
          let modalHtml = `
            <div id="boardDetailModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeBoardDetailModal(event)">
              <div style="background: white; border-radius: 16px; padding: 30px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                  <div style="flex: 1;">
                    <h3 style="margin: 0 0 8px 0; color: #ff6b35; font-size: 22px; font-weight: ${isPinned ? '700' : '600'};">
                      ${isPinned ? 'ğŸ“Œ ' : ''}${escapeHtml(post.title || '')}
                    </h3>
                    <div style="color: #636e72; font-size: 13px;">
                      ì‘ì„±ì: ${escapeHtml(post.author_name || '')} | ì‘ì„±ì¼: ${createdAt}
                      ${updatedAt !== createdAt && updatedAt !== '-' ? ' | ìˆ˜ì •ì¼: ' + updatedAt : ''} | ì¡°íšŒìˆ˜: ${post.view_count || 0}
                    </div>
                  </div>
                  <button onclick="closeBoardDetailModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
                </div>
                <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; line-height: 1.8; color: #2d3436; font-size: 14px; min-height: 100px; word-wrap: break-word; overflow-wrap: break-word;">
                  ${convertVideoLinks(post.content || '')}
                </div>
          `;
          
          // ì²¨ë¶€íŒŒì¼ í‘œì‹œ
          if (post.files && post.files.length > 0) {
            modalHtml += `
              <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                <h4 style="margin: 0 0 12px 0; color: #2d3436; font-size: 16px; font-weight: 600;">ì²¨ë¶€íŒŒì¼</h4>
                <div style="display: flex; flex-direction: column; gap: 8px;">
            `;
            post.files.forEach(file => {
              modalHtml += `
                <a href="${escapeHtml(file.file_url)}" target="_blank" style="display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: #fff9e6; border: 1px solid #ffeaa7; border-radius: 8px; text-decoration: none; color: #2d3436; transition: all 0.2s;" onmouseover="this.style.background='#ffeaa7'" onmouseout="this.style.background='#fff9e6'">
                  <span style="font-size: 18px;">ğŸ“</span>
                  <span style="flex: 1; font-size: 14px;">${escapeHtml(file.file_name)}</span>
                  <span style="font-size: 12px; color: #636e72;">${file.file_size ? (file.file_size / 1024).toFixed(1) + ' KB' : ''}</span>
                </a>
              `;
            });
            modalHtml += `
                </div>
              </div>
            `;
          }
          
          modalHtml += `
              </div>
            </div>
          `;
          
          // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
          const existingModal = document.getElementById('boardDetailModal');
          if (existingModal) {
            existingModal.remove();
          }
          
          document.body.insertAdjacentHTML('beforeend', modalHtml);
        } else {
          alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
        alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }
    window.showBoardDetail = showBoardDetail;
    
    // ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeBoardDetailModal(event) {
      if (event && event.target.id !== 'boardDetailModal' && !event.target.closest('#boardDetailModal > div')) {
        return;
      }
      const modal = document.getElementById('boardDetailModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeBoardDetailModal = closeBoardDetailModal;
    
    // ê²Œì‹œê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (í™”ì£¼ì‚¬ ëª¨ë“œ)
    async function loadBoardPosts() {
      loadBoardPostsByCategoryFilter();
    }
    window.loadBoardPosts = loadBoardPosts;
    
    // í—¤ë” hover ì´ë²¤íŠ¸ ì™„ì „íˆ ì°¨ë‹¨
    function disableHeaderHover() {
      const headerCells = document.querySelectorAll('thead th');
      const thead = document.querySelector('thead');
      
      // thead ìì²´ì—ë„ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
      if (thead) {
        const theadRow = thead.querySelector('tr');
        if (theadRow) {
          theadRow.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          theadRow.style.setProperty('background-color', '#ff9500', 'important');
        }
        const forceTheadStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          const row = this.querySelector('tr');
          if (row) {
            row.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
            row.style.setProperty('background-color', '#ff9500', 'important');
          }
        };
        forceTheadStyle.call(thead);
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout'].forEach(eventType => {
          thead.addEventListener(eventType, forceTheadStyle, true);
        });
      }
      
      headerCells.forEach(th => {
        // ê°•ì œ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜
        const forceStyle = function() {
          this.style.setProperty('background', 'linear-gradient(135deg, #ff9500 0%, #ffa502 100%)', 'important');
          this.style.setProperty('background-color', '#ff9500', 'important');
          this.style.setProperty('color', 'white', 'important');
          this.style.setProperty('cursor', 'default', 'important');
          this.style.setProperty('transition', 'none', 'important');
          this.style.setProperty('opacity', '1', 'important');
          this.style.setProperty('text-align', 'center', 'important');
          this.style.setProperty('border', 'none', 'important');
          this.style.setProperty('margin', '0', 'important');
          // ëª¨ë“  ìì‹ ìš”ì†Œì—ë„ ì ìš©
          const children = this.querySelectorAll('*');
          children.forEach(child => {
            child.style.setProperty('background', 'transparent', 'important');
            child.style.setProperty('background-color', 'transparent', 'important');
            child.style.setProperty('color', 'white', 'important');
          });
        };
        
        // ëª¨ë“  ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì—ì„œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš© (ìº¡ì²˜ ë‹¨ê³„ì—ì„œ)
        ['mouseenter', 'mouseleave', 'mouseover', 'mouseout', 'mousemove'].forEach(eventType => {
          th.addEventListener(eventType, function(e) {
            e.stopPropagation();
            forceStyle.call(this);
          }, true); // ìº¡ì²˜ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬
        });
        
        // ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ê°•ì œ ì ìš©
        forceStyle.call(th);
        
        // requestAnimationFrameì„ ì‚¬ìš©í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ìŠ¤íƒ€ì¼ í™•ì¸
        function checkAndForceStyle() {
          const computedStyle = window.getComputedStyle(th);
          const bg = computedStyle.backgroundColor;
          const color = computedStyle.color;
          const textAlign = computedStyle.textAlign;
          // ìƒ‰ìƒì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (rgb(255, 149, 0) = #ff9500 ì£¼í™©ìƒ‰, rgb(255, 255, 255) = white)
          // ì£¼í™©ìƒ‰ ê³„ì—´ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê°•ì œ ì ìš© (rgb(255, 149, 0) ë˜ëŠ” rgb(255, 165, 2))
          const isOrange = bg.includes('rgb(255, 149') || bg.includes('rgb(255, 165') || bg.includes('255, 149') || bg.includes('255, 165');
          if (!isOrange || color !== 'rgb(255, 255, 255)' || textAlign !== 'center') {
            forceStyle.call(th);
          }
          requestAnimationFrame(checkAndForceStyle);
        }
        checkAndForceStyle();
      });
    }
    // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ì–¸ì œë“ ì§€ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡
    window.disableHeaderHover = disableHeaderHover;
    
    /* ========== í™”ì£¼ì‚¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ========== */
    async function loadCompanies() {
      const adminTbody = document.getElementById('adminTableBody');
      const consignorTbody = document.getElementById('consignorTableBody');
      const adminStatisticsSpan = document.getElementById('adminStatistics');
      const consignorStatisticsSpan = document.getElementById('consignorStatistics');
      
      if (!adminTbody || !consignorTbody) return;
      
      adminTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      consignorTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
      
      try {
        const response = await fetch('/api/auth/companies');
        const result = await response.json();
        
        if (result.success && result.companies) {
          updateReturnCompanyOptionsList(result.companies, true);
          
          // ê´€ë¦¬ìì™€ í™”ì£¼ì‚¬ ë¶„ë¦¬
          const admins = result.companies.filter(company => company.role === 'ê´€ë¦¬ì');
          const consignors = result.companies.filter(company => company.role !== 'ê´€ë¦¬ì');
          
          // í†µê³„ ì—…ë°ì´íŠ¸
          if (adminStatisticsSpan) {
            adminStatisticsSpan.textContent = `(${admins.length}ëª…)`;
          }
          if (consignorStatisticsSpan) {
            consignorStatisticsSpan.textContent = `(${consignors.length}ëª…)`;
          }
          
          // ê´€ë¦¬ì í…Œì´ë¸” ë Œë”ë§
          adminTbody.innerHTML = '';
          if (admins.length === 0) {
            adminTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë“±ë¡ëœ ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          } else {
            admins.forEach(company => {
              const row = document.createElement('tr');
              const createdDate = company.created_at ? new Date(company.created_at).toLocaleDateString('ko-KR') : '-';
              const lastLogin = company.last_login ? new Date(company.last_login).toLocaleDateString('ko-KR') : '-';
              const tags = company.search_keywords || '';
              
              row.innerHTML = `
                <td style="text-align: center;">${escapeHtml(company.company_name || '')}</td>
                <td style="text-align: center;">${escapeHtml(company.username || '')}</td>
                <td style="text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; background: #e74c3c; color: white;">
                    ${escapeHtml(company.role || 'ê´€ë¦¬ì')}
                  </span>
                </td>
                <td style="text-align: center;">${escapeHtml(tags)}</td>
                <td style="text-align: center;">${escapeHtml(company.business_number || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_name || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_address || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_tel || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_email || '-')}</td>
                <td style="text-align: center;">
                  ${company.business_certificate_url ? 
                    `<button onclick="viewCertificate(${company.id}, '${escapeHtml(company.business_certificate_url)}')" style="padding: 4px 8px; background: #74b9ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ë³´ê¸°</button>` : 
                    `<button onclick="uploadCertificate(${company.id})" style="padding: 4px 8px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì—…ë¡œë“œ</button>`
                  }
                </td>
                <td style="text-align: center;">${lastLogin}</td>
                <td style="text-align: center;">${createdDate}</td>
                <td style="text-align: center; white-space: nowrap;">
                  <div style="display: inline-flex; gap: 4px; justify-content: center; align-items: center; flex-wrap: nowrap;">
                    <button onclick="openTagModal(${company.id}, '${escapeHtml(company.username)}', '${escapeHtml(company.company_name)}', '${escapeHtml(tags)}')" style="padding: 4px 8px; background: #74b9ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">íƒœê·¸</button>
                    <button onclick="changeCompanyPassword(${company.id}, '${escapeHtml(company.username)}')" style="padding: 4px 8px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">ë¹„ë°€ë²ˆí˜¸</button>
                    <button onclick="deleteCompany(${company.id}, '${escapeHtml(company.company_name)}')" style="padding: 4px 8px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">ì‚­ì œ</button>
                  </div>
                </td>
              `;
              adminTbody.appendChild(row);
            });
          }
          
          // í™”ì£¼ì‚¬ í…Œì´ë¸” ë Œë”ë§
          consignorTbody.innerHTML = '';
          if (consignors.length === 0) {
            consignorTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë“±ë¡ëœ í™”ì£¼ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          } else {
            consignors.forEach(company => {
              const row = document.createElement('tr');
              const createdDate = company.created_at ? new Date(company.created_at).toLocaleDateString('ko-KR') : '-';
              const lastLogin = company.last_login ? new Date(company.last_login).toLocaleDateString('ko-KR') : '-';
              const tags = company.search_keywords || '';
              
              row.innerHTML = `
                <td style="text-align: center;">${escapeHtml(company.company_name || '')}</td>
                <td style="text-align: center;">${escapeHtml(company.username || '')}</td>
                <td style="text-align: center;">
                  <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; background: #3498db; color: white;">
                    ${escapeHtml(company.role || 'í™”ì£¼ì‚¬')}
                  </span>
                </td>
                <td style="text-align: center;">${escapeHtml(tags)}</td>
                <td style="text-align: center;">${escapeHtml(company.business_number || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_name || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_address || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_tel || '-')}</td>
                <td style="text-align: center;">${escapeHtml(company.business_email || '-')}</td>
                <td style="text-align: center;">
                  ${company.business_certificate_url ? 
                    `<button onclick="viewCertificate(${company.id}, '${escapeHtml(company.business_certificate_url)}')" style="padding: 4px 8px; background: #74b9ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ë³´ê¸°</button>` : 
                    `<button onclick="uploadCertificate(${company.id})" style="padding: 4px 8px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">ì—…ë¡œë“œ</button>`
                  }
                </td>
                <td style="text-align: center;">${lastLogin}</td>
                <td style="text-align: center;">${createdDate}</td>
                <td style="text-align: center; white-space: nowrap;">
                  <div style="display: inline-flex; gap: 4px; justify-content: center; align-items: center; flex-wrap: nowrap;">
                    <button onclick="openTagModal(${company.id}, '${escapeHtml(company.username)}', '${escapeHtml(company.company_name)}', '${escapeHtml(tags)}')" style="padding: 4px 8px; background: #74b9ff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">íƒœê·¸</button>
                    <button onclick="changeCompanyPassword(${company.id}, '${escapeHtml(company.username)}')" style="padding: 4px 8px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">ë¹„ë°€ë²ˆí˜¸</button>
                    <button onclick="deleteCompany(${company.id}, '${escapeHtml(company.company_name)}')" style="padding: 4px 8px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; white-space: nowrap; min-width: auto;">ì‚­ì œ</button>
                  </div>
                </td>
              `;
              consignorTbody.appendChild(row);
            });
          }
        } else {
          adminTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
          consignorTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        adminTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
        consignorTbody.innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    window.loadCompanies = loadCompanies;
    
    // í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    function refreshCompaniesData() {
      loadCompanies();
    }
    window.refreshCompaniesData = refreshCompaniesData;
    
    // í™”ì£¼ì‚¬ ë“±ë¡ í¼ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleAddCompanyForm() {
      const form = document.getElementById('addCompanyForm');
      const icon = document.getElementById('addCompanyIcon');
      if (form && icon) {
        const isHidden = form.style.display === 'none';
        form.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
      }
    }
    window.toggleAddCompanyForm = toggleAddCompanyForm;
    
    // ê´€ë¦¬ì ëª©ë¡ ì ‘ê¸°/í¼ì¹˜ê¸°
    function toggleAdminList() {
      const content = document.getElementById('adminListContent');
      const icon = document.getElementById('adminListIcon');
      if (content && icon) {
        const isHidden = content.style.display === 'none';
        content.style.display = isHidden ? 'block' : 'none';
        icon.textContent = isHidden ? 'â–¼' : 'â–¶';
      }
    }
    window.toggleAdminList = toggleAdminList;
    
    // í™”ì£¼ì‚¬ ë“±ë¡
    async function registerCompany() {
      const companyName = document.getElementById('adminRegCompanyName').value.trim();
      const username = document.getElementById('adminRegUsername').value.trim();
      const password = document.getElementById('adminRegPassword').value.trim();
      const role = document.getElementById('adminRegRole').value;
      const businessNumber = document.getElementById('adminRegBusinessNumber').value.trim();
      const businessName = document.getElementById('adminRegBusinessName').value.trim();
      const businessAddress = document.getElementById('adminRegBusinessAddress').value.trim();
      const businessTel = document.getElementById('adminRegBusinessTel').value.trim();
      const businessEmail = document.getElementById('adminRegBusinessEmail').value.trim();
      const statusDiv = document.getElementById('adminRegisterStatus');
      
      if (!companyName || !username || !password || !role) {
        if (statusDiv) {
          statusDiv.innerHTML = '<span style="color: #e74c3c;">í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        }
        return;
      }
      
      if (statusDiv) {
        statusDiv.innerHTML = '<span style="color: #3498db;">ë“±ë¡ ì¤‘...</span>';
      }
      
      try {
        const response = await fetch('/api/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            company_name: companyName,
            username: username,
            password: password,
            role: role,
            business_number: businessNumber || null,
            business_name: businessName || null,
            business_address: businessAddress || null,
            business_tel: businessTel || null,
            business_email: businessEmail || null
          })
        });
        
        const result = await response.json();
        
        if (result.success) {
          if (statusDiv) {
            statusDiv.innerHTML = '<span style="color: #00b894;">âœ… í™”ì£¼ì‚¬ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
          }
          // í¼ ì´ˆê¸°í™”
          document.getElementById('adminRegisterForm').reset();
          toggleAddCompanyForm();
          // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          loadCompanies();
          refreshReturnCompanyOptions();
          // C/S í™”ì£¼ì‚¬ ë“œë¡­ë‹¤ìš´ë„ ìƒˆë¡œê³ ì¹¨ (C/S íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œ)
          if (typeof loadCompaniesForCs === 'function') {
            loadCompaniesForCs();
          }
        } else {
          if (statusDiv) {
            statusDiv.innerHTML = `<span style="color: #e74c3c;">âŒ ${result.message || 'ë“±ë¡ ì‹¤íŒ¨'}</span>`;
          }
        }
      } catch (error) {
        console.error('í™”ì£¼ì‚¬ ë“±ë¡ ì˜¤ë¥˜:', error);
        if (statusDiv) {
          statusDiv.innerHTML = `<span style="color: #e74c3c;">âŒ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</span>`;
        }
      }
    }
    window.registerCompany = registerCompany;
    
    /* ========== í™”ì£¼ì‚¬ ì‚­ì œ ========== */
    function deleteCompany(companyId, companyName) {
      if (!confirm(`ì •ë§ë¡œ "${companyName}" í™”ì£¼ì‚¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì‚­ì œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('í™”ì£¼ì‚¬ ì‚­ì œ ì˜¤ë¥˜:', error);
        showMessage('âŒ í™”ì£¼ì‚¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.deleteCompany = deleteCompany;
    /* ========== í™”ì£¼ì‚¬ íƒœê·¸ ê´€ë¦¬ ========== */
    function openTagModal(companyId, username, companyName, currentTags) {
      // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
      const existingModal = document.getElementById('tagModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      // ëª¨ë‹¬ HTML ìƒì„±
      const modalHtml = `
        <div id="tagModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeTagModal(event)">
          <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3 style="margin: 0; color: #ff6b35; font-size: 22px; font-weight: 700;">ğŸ·ï¸ íƒœê·¸ ê´€ë¦¬</h3>
              <button onclick="closeTagModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #636e72; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">Ã—</button>
            </div>
            
            <div style="margin-bottom: 20px;">
              <p style="margin: 0 0 10px 0; color: #333; font-size: 14px; font-weight: 600;">í™”ì£¼ì‚¬: <span style="color: #ff6b35;">${escapeHtml(companyName)}</span></p>
              <p style="margin: 0; color: #666; font-size: 12px;">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì—¬ëŸ¬ íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
              <p style="margin: 5px 0 0 0; color: #999; font-size: 11px;">ì˜ˆ: tks, TKSì»´í¼ë‹ˆ, í‹°ì¼€ì´ì—ìŠ¤</p>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-size: 14px; font-weight: 600;">íƒœê·¸ ì…ë ¥</label>
              <textarea id="tagInput" placeholder="íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: tks, TKSì»´í¼ë‹ˆ)" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 80px; box-sizing: border-box;" onfocus="this.style.borderColor='#74b9ff'" onblur="this.style.borderColor='#e0e0e0'">${escapeHtml(currentTags || '')}</textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
              <button onclick="closeTagModal()" style="background: #e0e0e0; color: #333; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#d0d0d0'" onmouseout="this.style.background='#e0e0e0'">ì·¨ì†Œ</button>
              <button onclick="saveCompanyTags(${companyId}, '${escapeHtml(username)}')" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 6px rgba(116, 185, 255, 0.25);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(116, 185, 255, 0.35)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 6px rgba(116, 185, 255, 0.25)'">ì €ì¥</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      
      // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
      setTimeout(() => {
        const tagInput = document.getElementById('tagInput');
        if (tagInput) {
          tagInput.focus();
          tagInput.setSelectionRange(tagInput.value.length, tagInput.value.length);
        }
      }, 100);
    }
    window.openTagModal = openTagModal;
    
    // íƒœê·¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeTagModal(event) {
      if (event && event.target.id !== 'tagModal' && !event.target.closest('#tagModal > div')) {
        return;
      }
      const modal = document.getElementById('tagModal');
      if (modal) {
        modal.remove();
      }
    }
    window.closeTagModal = closeTagModal;
    
    // íƒœê·¸ ì €ì¥
    async function saveCompanyTags(companyId, username) {
      const tagInput = document.getElementById('tagInput');
      if (!tagInput) {
        showMessage('âŒ íƒœê·¸ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        return;
      }
      
      const tags = tagInput.value.trim();
      
      try {
        const response = await fetch('/api/auth/update-info', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: username,
            search_keywords: tags
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showMessage('âœ… íƒœê·¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          closeTagModal();
          loadCompanies(); // í™”ì£¼ì‚¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
          showMessage('âŒ ' + (data.message || 'íƒœê·¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'), 'error');
        }
      } catch (error) {
        console.error('íƒœê·¸ ì €ì¥ ì˜¤ë¥˜:', error);
        showMessage('âŒ íƒœê·¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      }
    }
    window.saveCompanyTags = saveCompanyTags;
    
    /* ========== í™”ì£¼ì‚¬ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ========== */
    function changeCompanyPassword(companyId, username) {
      const newPassword = prompt(`${username}ì˜ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:`, '');
      
      if (!newPassword) {
        return;
      }
      
      if (newPassword.length < 4) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`ì •ë§ë¡œ "${username}"ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      fetch(`/api/auth/company/${companyId}/password`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          new_password: newPassword
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ' + data.message, 'success');
        } else {
          showMessage('âŒ ' + (data.message || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        showMessage('âŒ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.changeCompanyPassword = changeCompanyPassword;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ========== */
    function uploadCertificate(companyId) {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*,.pdf';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // íŒŒì¼ í¬ê¸° í™•ì¸ (10MB ì œí•œ)
        if (file.size > 10 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        
        // íŒŒì¼ì„ Base64ë¡œ ë³€í™˜
        const reader = new FileReader();
        reader.onload = function(event) {
          const base64Data = event.target.result;
          
          // Cloudinaryì— ì—…ë¡œë“œ
          uploadCertificateToCloudinary(companyId, base64Data, file.name);
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    window.uploadCertificate = uploadCertificate;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ Cloudinary ì—…ë¡œë“œ ========== */
    function uploadCertificateToCloudinary(companyId, base64Data, fileName) {
      showMessage('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘...', 'success');
      
      // Base64 ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
      const blob = dataURLtoBlob(base64Data);
      
      // FormData ìƒì„±
      const formData = new FormData();
      formData.append('file', blob, fileName);
      
      // ì„œë²„ë¥¼ í†µí•´ Cloudinaryì— ì—…ë¡œë“œ
      fetch('/api/uploads/certificate', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success && data.url) {
          // ì—…ë¡œë“œëœ URLì„ ì„œë²„ì— ì €ì¥
          return fetch(`/api/auth/company/${companyId}/certificate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              certificate_url: data.url
            })
          });
        } else {
          throw new Error(data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨');
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showMessage('âœ… ì‚¬ì—…ì ë“±ë¡ì¦ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadCompanies();
        } else {
          showMessage('âŒ ' + (data.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨'), 'error');
        }
      })
      .catch(error => {
        console.error('ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        showMessage('âŒ ì‚¬ì—…ì ë“±ë¡ì¦ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      });
    }
    window.uploadCertificateToCloudinary = uploadCertificateToCloudinary;
    
    /* ========== Base64ë¥¼ Blobìœ¼ë¡œ ë³€í™˜ ========== */
    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], { type: mime });
    }
    window.dataURLtoBlob = dataURLtoBlob;
    
    /* ========== ì‚¬ì—…ì ë“±ë¡ì¦ ë³´ê¸° ========== */
    function viewCertificate(companyId, certificateUrl) {
      // ìƒˆ ì°½ì—ì„œ ì‚¬ì—…ì ë“±ë¡ì¦ ì—´ê¸°
      window.open(certificateUrl, '_blank');
    }
    window.viewCertificate = viewCertificate;
    
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', function() {
      setupReturnCompanyDropdown();
      // ìë™ ë¡œê·¸ì¸ í™•ì¸
      const savedCompany = localStorage.getItem('client_company');
      const savedUsername = localStorage.getItem('client_username');
      const savedRole = localStorage.getItem('client_role');
      const loginTime = localStorage.getItem('client_loginTime');
      
      if (savedCompany && savedUsername && loginTime) {
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
          currentCompany = savedCompany;
          currentUsername = savedUsername;
          currentRole = (savedRole || '').toString().trim();
          console.log('ìë™ ë¡œê·¸ì¸ - ê¶Œí•œ:', currentRole, 'íƒ€ì…:', typeof currentRole); // ë””ë²„ê¹…ìš©
          console.log('ìë™ ë¡œê·¸ì¸ - ê´€ë¦¬ì ì—¬ë¶€:', currentRole === 'ê´€ë¦¬ì'); // ë””ë²„ê¹…ìš©
          showDashboard();
          // í—¤ë” hover ì°¨ë‹¨ ì ìš©
          setTimeout(() => {
            disableHeaderHover();
            // í™œì„± íŒì—… í™•ì¸
            checkAndShowPopup();
          }, 100);
          return;
        } else {
          localStorage.removeItem('client_company');
          localStorage.removeItem('client_username');
          localStorage.removeItem('client_role');
          localStorage.removeItem('client_loginTime');
        }
      }
      
      // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
      document.getElementById('loginSection').style.display = 'flex';
      document.getElementById('dashboardSection').style.display = 'none';
      
      // ë¡œê³  URL ì„¤ì • (Cloudinary)
      const logoUrl = 'https://res.cloudinary.com/dokk81rjh/image/upload/v1762922695/logo_srff9i.png';
      const fallbackLogoUrl = '/static/logo.png'; // ë¡œì»¬ íŒŒì¼ ê²½ë¡œ (ë°±ì—…)
      const loginLogo = document.getElementById('loginLogo');
      if (loginLogo) {
        loginLogo.src = logoUrl || fallbackLogoUrl;
      }
      
      // ì—”í„°í‚¤ ì´ë²¤íŠ¸
      document.getElementById('username').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          document.getElementById('password').focus();
        }
      });
      
      document.getElementById('password').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          doLogin();
        }
      });
      
      // ê´€ë¦¬ì í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©)
      document.addEventListener('submit', function(e) {
        if (e.target && e.target.id === 'adminRegisterForm') {
          e.preventDefault();
          e.stopPropagation();
          console.log('í¼ ì œì¶œ ì´ë²¤íŠ¸ ê°ì§€');
          if (typeof registerCompany === 'function') {
            registerCompany();
          } else {
            console.error('registerCompany í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        }
      });
      
      // ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë„ ì¶”ê°€ (ì´ì¤‘ ë³´ì•ˆ)
      document.addEventListener('click', function(e) {
        if (e.target && (e.target.id === 'adminRegisterBtn' || e.target.closest('#adminRegisterBtn'))) {
          const btn = e.target.id === 'adminRegisterBtn' ? e.target : e.target.closest('#adminRegisterBtn');
          if (btn && btn.type !== 'submit') {
            e.preventDefault();
            e.stopPropagation();
            console.log('ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ê°ì§€');
            if (typeof registerCompany === 'function') {
              registerCompany();
            } else {
              console.error('registerCompany í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
          }
        }
      });
      
    });
  </script>
</body>
</html>