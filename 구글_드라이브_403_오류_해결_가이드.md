# Google Drive 403 storageQuotaExceeded 오류 해결 가이드

## ⚠️ 오류 발생

업로드 시 다음 오류가 발생합니다:
- **오류 코드**: `403 Forbidden`
- **오류 메시지**: `Service Accounts do not have storage quota`
- **오류 이유**: `storageQuotaExceeded`

## 🔍 문제 원인

Google 서비스 계정은 **저장 공간 할당량이 없습니다**. 따라서:
- ✅ **공유 드라이브(Shared Drive)**에 파일을 업로드할 수 있음
- ❌ **개인 드라이브의 공유된 폴더**에는 파일을 업로드할 수 없음

현재 `제이제이솔루션` 폴더가 개인 드라이브의 공유된 폴더이므로 업로드가 실패합니다.

## ✅ 해결 방법

### 방법 1: 공유 드라이브(Shared Drive) 사용 (권장)

**Google Workspace 관리자가 필요한 방법:**

1. **Google Workspace 관리자에게 공유 드라이브 생성 요청**
   - 공유 드라이브 이름: `제이제이솔루션`
   - 공유 드라이브 생성 후 현재 폴더 내용을 이동

2. **공유 드라이브에 서비스 계정 추가**
   - 공유 드라이브 → 설정 → 멤버 관리
   - 서비스 계정 추가: `id-pl-drive-uploader@composite-dream-477907-c5.iam.gserviceaccount.com`
   - 권한: **콘텐츠 관리자** 또는 **편집자**

3. **폴더 구조 생성**
   - 공유 드라이브 내에 `정산파일` 폴더 생성

**장점:**
- 서비스 계정이 자유롭게 파일 업로드 가능
- 모든 팀원이 접근 가능
- 저장 공간 할당량 문제 없음

### 방법 2: OAuth 2.0 사용 (개인 드라이브 사용 가능)

**사용자 계정으로 업로드하는 방법:**

1. **OAuth 2.0 설정**
   - Google Cloud Console에서 OAuth 2.0 클라이언트 ID 생성
   - 사용자 인증 후 토큰 저장
   - 파일 업로드 시 사용자 계정 사용

2. **코드 수정**
   - `api/uploads/oauth_drive.py` 모듈 사용
   - 이미 구현되어 있으나 추가 설정 필요

**단점:**
- 사용자 인증 필요
- 토큰 만료 시 재인증 필요
- 구현 복잡도 증가

### 방법 3: 폴더 소유자 변경 (비권장)

**Google Workspace 관리자에게 폴더 소유자 변경 요청:**
- 폴더 소유자를 서비스 계정으로 변경
- 보안 및 권한 관리 문제 가능성

## 🔧 임시 해결책 (테스트용)

테스트 목적으로만 사용 가능:

1. **사용자 계정으로 직접 업로드**
   - Google Drive 웹 인터페이스에서 직접 업로드
   - 자동화 불가

2. **Cloudinary 사용 (이미지만)**
   - 이미지는 이미 Cloudinary 사용 중
   - 엑셀 파일은 Cloudinary에서 지원하지 않음

## 📋 체크리스트

현재 상황 확인:
- [ ] `제이제이솔루션` 폴더가 개인 드라이브에 있는지 확인
- [ ] 공유 드라이브를 사용할 수 있는지 확인 (Google Workspace 필요)
- [ ] Google Workspace 관리자에게 문의 가능한지 확인

## 💡 권장 사항

**가장 간단한 해결 방법:**
1. Google Workspace 관리자에게 공유 드라이브 생성 요청
2. 현재 폴더를 공유 드라이브로 이동
3. 서비스 계정을 공유 드라이브에 추가
4. 다시 업로드 테스트

**참고:**
- Google Workspace가 없으면 OAuth 2.0을 사용해야 합니다
- 개인 Google 계정으로는 공유 드라이브를 생성할 수 없습니다
- Google Workspace Essentials 이상이 필요합니다

## 📞 추가 도움

문제가 지속되면:
1. Google Workspace 관리자에게 문의
2. OAuth 2.0 구현 검토
3. 대안 솔루션 검토 (예: Cloudinary, 다른 클라우드 스토리지)

